(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[7449],{11449:function(ce,b,e){"use strict";e.d(b,{Z:function(){return w}});var x=e(88986),p=e(33565),W=e(12924),_=e.n(W),z=e(3115),g=e(49111),L=e(19650),j=e(62029),V=e(57663),o=e(71577),N=e(91768),G=e(28216),h=e(37055),t=e(10237);function m(P){var Z=h.ZP.getHelpContentByMenuKey(),R={key:P};return t.WY.get({url:Z,params:R})}var I=e(74228),d=e.n(I),y=e(1164),i=e(76466),f=e(38642);class u extends _().Component{constructor(Z){var R;super(Z);R=this,this.getHelpContentByMenuKey=()=>{var S=this.props.defaultMenuKey;m(S).then(O=>{var n=O.data,l=n.help_url,s=n.video_url;this.setState({videoUrl:s,helpUrl:l})})},this.handleOpenHelpUrl=S=>{if((0,f.ve)()){window.open(S,"_blank");return}y.Z.targetTo({path:S,isExternalLink:!0})},this.handleOpenVideo=function(S){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:R.props.t("helpCenter.video");R.setState(n=>({resourcePlayInfo:(0,x.Z)((0,x.Z)({},n.resourcePlayInfo),{},{resourceInfo:{originUrl:S,source:{FD:S,OD:S},contentType:"mp4"}}),previewInfo:(0,x.Z)((0,x.Z)({},n.previewInfo),{},{title:O,visible:!0,onCancel:R.handleCancelPreview})}))},this.handleCancelPreview=()=>{var S=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,x.Z)((0,x.Z)({},S),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:Z.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var Z=this.state,R=Z.helpUrl,S=Z.resourcePlayInfo,O=Z.previewInfo,n=Z.videoUrl,l=this.props.t;return _().createElement("div",{className:d().helpCenter},n&&_().createElement(o.Z,{type:"link",className:d()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(n)},l("helpCenter.video")),R&&_().createElement(o.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(R)},l("helpCenter.tutorial")),_().createElement(i.Z,(0,j.Z)({},S,{previewInfo:O})))}}var F=P=>({defaultMenuKey:P.currentRoute.menuKey});u.defaultProps={defaultMenuKey:""};var B=(0,G.$j)(F)((0,N.Z)()(u));function K(P){var Z=P.extra,R=localStorage.getItem("dingPersonnel"),S=sessionStorage.getItem("dingPersonnel");return _().createElement(L.Z,null,Z,R!=="dingPersonnel"&&S!=="dingPersonnel"&&(0,f.eY)("COMMONEXTRA_HELP_CENTER")&&_().createElement(B,null))}var a=K,q=e(4408);function re(P){var Z=(0,W.useState)({helpCenter:(0,f.eY)("HEAD_HELP_CENTER_BUT")}),R=(0,p.Z)(Z,1),S=R[0],O=P.pageContainerParams,n=O===void 0?{}:O,l=P.noPadding,s=l===void 0?!1:l,$=P.isPersonal,T=$===void 0?!1:$,H=P.pageTitle,C=P.className,A=C===void 0?"":C,J={extra:S.helpCenter?_().createElement(a,{extra:n.extra}):n.extra},ee=(0,x.Z)((0,x.Z)({},n),J);return _().createElement("div",{className:"page-container-content ".concat(s?"page-container-noPadding":""," ").concat(T?"page-container-content_personal_background":""," ").concat(A)},H&&_().createElement(q.Z,{title:H}),T?_().createElement(z.Z,null,P.children):_().createElement(z.Z,ee,P.children))}var w=re},21049:function(ce,b,e){"use strict";var x=e(57663),p=e(71577),W=e(34792),_=e(48086),z=e(12924),g=e.n(z),L=e(91768),j=e(80991),V=e(84874),o=e(24144);class N extends g().Component{constructor(h){super(h);this.onUploadSuccess=t=>{var m=t.fileList,I=this.props.t,d=this.props.courseType,y=d===void 0?"":d,i=m.length>0?m[0].url:"";y==="graphic"?this.props.handleCoverChange(i):this.props.formik.setFieldValue("cover",i),_.default.success(" ".concat(I("course.courseDetailCoverSuccess")))},this.onUploadFailed=()=>{var t=this.props.t;_.default.error("".concat(t("course.courseDetailCoverFailure")))},this.handleDeleteCover=()=>{this.props.handleDeleteCover()},this.renderImageFilters=()=>{var t=this.props,m=t.prefixCls,I=t.defaultFieldList,d=t.courseType,y=d===void 0?"":d,i="".concat(m,"__imgfilters");return g().createElement("div",{className:"coverSty ".concat(i)},g().createElement("img",{src:I,alt:""}),g().createElement("div",{className:"".concat(i,"__mask")}),y==="graphic"?g().createElement("span",{className:"delete-icon",onClick:this.handleDeleteCover},g().createElement(V.Z,{iconClass:"icon-guanbi",size:"10px"})):null)},this.renderUploadBtn=()=>{var t=this.props,m=t.prefixCls,I=t.t,d=t.courseType,y=d===void 0?"":d,i=this.state.type,f="".concat(m,"__uploader");return g().createElement("div",{className:f},g().createElement(o.ZM,{uploadConfig:{listType:"picture",accept:"jpeg ,jpg ,png",showUploadList:!1,maxCount:1},size:{value:64,unit:"kb"},onUploadSuccess:this.onUploadSuccess,onUploadFailed:this.onUploadFailed,clip:i,imgCropConfig:{widthScale:1,heightScale:1},render:()=>g().createElement("div",null,g().createElement(p.Z,{type:"default"},g().createElement(V.Z,{iconClass:"iconf-add",color:"#4D536E",size:"14px"}),I("course.courseDetailCover")),y==="graphic"?g().createElement("p",null,"(",I("shareInfo.shareCoverTip"),")"):g().createElement("p",null,"(",I("shareInfo.articleCoverTip"),")"))}))},this.state={type:"crop"}}render(){var h=this.props.prefixCls;return g().createElement("section",{className:"".concat(h)},this.renderImageFilters(),this.renderUploadBtn())}}N.defaultProps={prefixCls:"article-cover__content"},b.Z=(0,j.$j)((0,L.Z)()(N))},57666:function(ce,b,e){"use strict";e.r(b),e.d(b,{default:function(){return ue}});var x=e(71194),p=e(57016),W=e(57106),_=e(6129),z=e(57663),g=e(71577),L=e(62029),j=e(20228),V=e(11382),o=e(34792),N=e(48086),G=e(88986),h=e(12924),t=e.n(h),m=e(91768),I=e(57068),d=e(28216),y=e(80991),i=e(91805),f=e(90994),u=e(43859),F=e(88983),B=e(47933);class K extends t().Component{constructor(){super(...arguments);this.handleChange=r=>{this.props.formik.setFieldValue("articleType",r.target.value)}}render(){var r=this.props,c=r.t,E=r.defaultFieldList;return t().createElement(B.ZP.Group,{onChange:this.handleChange,value:E},t().createElement(B.ZP,{value:"H5"},c("h5Article.formRowDraft")),t().createElement(B.ZP,{value:"URL"},c("h5Article.formRowUrl")))}}var a=(0,y.$j)((0,m.Z)()(K)),q=e(21049),re=(0,u.Z)(a),w=(0,u.Z)(q.Z),P=e(6793),Z=e(2396),R=e(3407),S=(0,P.me)(),O=R.Z[S].h5Article.validation,n=te=>{var r;return Z.fA.url.test(te)||(r=O.urlIllegal),r},l={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},s=e(62615),$=e(52670),T=e(7584);class H extends t().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var r=this.props.handleSubmit;r()},this.onShareConfig=()=>{this.props.onShareConfig&&this.props.onShareConfig()},this.renderFooter=()=>{var r=this.props,c=r.isSubmitting,E=c===void 0?!1:c,v=r.onCancel,U=r.t,se=r.isEdit,ae=r.onPreview,ne=r.values;return t().createElement("footer",{className:""},t().createElement("div",{className:"cl-form-fixed-footer__container"},t().createElement(g.Z,{onClick:()=>ae(ne)},U("course.preview")),t().createElement(g.Z,{onClick:v},U("common.cancel")),t().createElement(g.Z,{type:"primary",disabled:E,loading:E,onClick:this.handlePropsSubmit},U(se?"common.save":"common.release"))))},this.renderContentRow=()=>{var r=this.props,c=r.values,E=r.t;return c.articleType==="URL"?t().createElement(y.gN,{component:T.Z,name:"articleUrl",type:"text",defaultValue:c.articleUrl,validate:n,style:{width:"824px"},placeholder:E("h5Article.urlPlace")}):t().createElement(y.gN,{component:s.h,displayType:"Custom",name:"h5Article",defaultFieldList:c.h5Article,scrollDOMSelector:".h5-article-page",topHeight:128,validate:$.rn})}}render(){var r=this.props,c=r.values,E=r.t,v=r.tagGroupInit;return t().createElement(t().Fragment,null,t().createElement(y.l0,{className:"cl-form cl-h5-article-form"},t().createElement(y.gN,(0,L.Z)({component:T.Z,name:"title",label:E("h5Article.formRowName"),required:!0,type:"text",defaultValue:c.title,validate:U=>(0,Z.QK)(U,E("h5Article.namePlace")),style:{width:"100%"},maxLength:30,placeholder:E("h5Article.namePlace")},l)),t().createElement(y.gN,(0,L.Z)({component:w,displayType:"Custom",name:"cover",label:E("course.courseCreatePanelFTCover"),required:!0,defaultFieldList:c.cover},l)),t().createElement(y.gN,(0,L.Z)({component:re,displayType:"Custom",name:"articleType",label:E("h5Article.formRowType"),required:!0,defaultFieldList:c.articleType},l)),t().createElement(y.gN,(0,L.Z)({component:s.QS,displayType:"Custom",name:"tagGroup",label:E("common.detailTag"),defaultFieldList:v},l)),this.renderContentRow(),this.renderFooter(),t().createElement(s.I,null)))}}var C=(0,m.Z)()(H),A=e(1164),J=e(86726),ee=e(10237),D=e(37055),M=e(11449),Y=e(28531),ie=e(4408),ve=e(38642),oe={getArticleInfo:D.ZP.H5Article.getArticleInfo,add:D.ZP.H5Article.add,localAdd:D.ZP.localStorage.addResource,edit:D.ZP.H5Article.edit},Ee=te=>({userInfo:te.user});class he extends h.Component{constructor(){super(...arguments);this.state={allowActions:(0,J.V9)("library",this.props.userInfo.modules),initialParams:{title:"",articleType:"H5",articleUrl:"",h5Article:null,cover:"".concat("https://oss.coolcollege.cn","/1794891397082517504.png")},isLoading:!0,showModel:!1,articleId:"",articleInfo:"",h5ArticleShare:{showShareConfig:!1,id:""},h5ShareWay:{showShareWay:!1,shareUrl:""},blackList:{shareSettingFlag:(0,ve.eY)("RESOURCE_LIBRARY_SHARE_SETTING")}},this.initRefFormik=r=>{this.refForm=r},this.getDetail=r=>{ee.WY.get({url:oe.getArticleInfo({id:r})}).then(c=>{var E=c.data,v=E.name,U=E.content_type,se=E.url,ae=E.content_json,ne=E.cover,Q=U==="h5/article";this.setState({initialParams:{title:v,articleType:Q?"H5":"URL",articleUrl:Q?"":se,h5Article:Q?JSON.parse(ae):null,cover:ne||"".concat("https://oss.coolcollege.cn","/1794891397082517504.png")},isLoading:!1})})},this.handleSubmit=(r,c)=>{var E=r.title,v=r.articleType,U=r.articleUrl,se=r.h5Article,ae=r.tagGroup,ne=r.cover,Q=I.parse(this.props.location.search),X=Q.id,me=Q.classifyId,pe=Q.privatization,de=v==="H5",le=ae?ae.tagsNameList:[],k={name:E,content_type:de?"h5/article":"h5/link",url:de?"":U,content_json:de?se:"",resource_classify:me,cover:ne,type:"article",privatization:pe,private_resource_id:(0,P.RA)(),enterprise_id:this.props.userInfo.enterpriseId,classify_id:me},ge=pe?oe.localAdd():oe.add();ee.WY.post({url:X?oe.edit({id:X}):ge,data:(0,G.Z)((0,G.Z)({},k),{},{id:X})}).then(fe=>{if(N.default.success(X?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess")),X){var Ce={tags:le,resourceId:X,resourceType:"resource"};(0,Y.tB)(Ce)}else if(le&&le.length){var _e={tags:le,resourceId:fe.data.id,resourceType:"resource"};(0,Y.tB)(_e)}this.setState({showModel:!0,articleId:X||fe.data.id,articleInfo:r})}).catch(()=>{c.setSubmitting(!1)})},this.clickJump=r=>{var c=this.state,E=c.articleId,v=c.articleInfo;r==="back"&&this.handleCancel(),r==="see"&&(v.articleType==="H5"?(localStorage.H5PreviewContent=v.h5Article instanceof Object?JSON.stringify(v.h5Article):v.h5Article,A.Z.targetTo({path:"/training/resourceManage/library/articlePreview?action=localPreview&title=".concat(v.title)})):v.articleUrl&&A.Z.targetTo({path:v.articleUrl,isExternalLink:!0})),r==="config"&&this.setState({showModel:!1,articleId:"",articleInfo:""},()=>{this.setState({h5ArticleShare:{showShareConfig:!0,id:E}})})},this.clickOpen=()=>{var r=I.parse(this.props.location.search),c=r.id;this.setState({h5ArticleShare:{showShareConfig:!0,id:c}})},this.handleCancel=()=>{var r=I.parse(this.props.location.search),c=r.classifyId;this.props.history.push("/knowledgeBase/learningResources/library?id=".concat(c))},this.handlePreview=r=>{this.refForm.submitForm(),this.refForm.runValidations().then(c=>{Object.keys(c).length||(r.articleType==="H5"?(localStorage.H5PreviewContent=r.h5Article instanceof Object?JSON.stringify(r.h5Article):r.h5Article,A.Z.targetTo({path:"/training/resourceManage/library/articlePreview?action=localPreview&title=".concat(r.title)})):Z.fA.url.test(r.articleUrl)&&A.Z.targetTo({path:r.articleUrl,isExternalLink:!0}))})},this.handleShareCancel=()=>{this.setState({h5ArticleShare:{showShareConfig:!1,id:""}},()=>{this.handleCancel()})},this.cancelTipOpenWay=r=>{var c=r.shareUrl;this.setState({h5ArticleShare:{showShareConfig:!1,id:""},h5ShareWay:{showShareWay:!0,shareUrl:c}})},this.closeShareWay=()=>{this.setState({h5ShareWay:{showShareWay:!1,shareUrl:""}},()=>{this.handleCancel()})}}componentDidMount(){var r=I.parse(this.props.location.search),c=r.id,E=r.uploadType;c?this.getDetail(c):this.setState({isLoading:!1,uploadType:E})}render(){var r=this.props,c=r.prefixCls,E=r.location,v=r.t,U=this.state,se=U.initialParams,ae=U.isLoading,ne=U.showModel,Q=U.h5ArticleShare,X=U.articleInfo,me=U.allowActions,pe=U.h5ShareWay,de=U.blackList;if(ae)return t().createElement(V.Z,{size:"large"});var le=I.parse(E.search),k=le.id,ge=le.privatization,fe=(0,J.H3)("share",me),Ce=(0,J.e)("market",this.props.userInfo.modules),_e={resourceType:"resource",resourceId:k},Pe="".concat(v(k?"common.edit":"common.add")).concat(v("h5Article.title"));return t().createElement(M.Z,{pageContainerParams:{header:{title:Pe}}},t().createElement(ie.Z,{title:v(k?"documentTitle.editArticle":"documentTitle.addArticle")}),t().createElement("div",{className:c},t().createElement("div",{className:"".concat(c,"__content")},t().createElement(y.J9,{ref:this.initRefFormik,initialValues:se,onSubmit:this.handleSubmit,render:Ie=>t().createElement(C,(0,L.Z)({},Ie,{title:Pe,tagGroupInit:_e,isEdit:!!k,onCancel:this.handleCancel,onPreview:this.handlePreview,onShareConfig:this.clickOpen}))})),t().createElement(p.Z,{title:v(k?"common.saveSuccess":"personal.publishSuccess"),visible:ne,closable:!1,footer:null,maskClosable:!1},t().createElement(_.ZP,{status:"success",title:v(k?"common.saveSuccess":"personal.publishSuccess"),subTitle:v(k?"shareInfo.articleSaveTip":"shareInfo.articleReleaseTip"),extra:[t().createElement(t().Fragment,null,Ce&&fe&&X.articleType==="H5"&&!ge&&de.shareSettingFlag&&t().createElement(g.Z,{type:"primary",onClick:()=>this.clickJump("config")},v("resourceLibrary.shareSetting"))),t().createElement(g.Z,{key:"seeArticle",onClick:()=>this.clickJump("see")},v("shareInfo.seeArticle")),t().createElement(g.Z,{key:"returnTable",onClick:()=>this.clickJump("back")},v("shareInfo.returnTable"))]})),t().createElement(i.Z,(0,L.Z)({},Q,{cancelTipOpenWay:this.cancelTipOpenWay,onCancelShare:this.handleShareCancel})),t().createElement(f.Z,(0,L.Z)({},pe,{closeShareWay:this.closeShareWay}))))}}he.defaultProps={prefixCls:"h5-article-page"};var ue=(0,d.$j)(Ee)((0,m.Z)()(he))},95371:function(ce,b,e){"use strict";e.d(b,{iv:function(){return _},lK:function(){return z},bS:function(){return g},Ds:function(){return L},TP:function(){return V},bG:function(){return o},SI:function(){return N},PC:function(){return G}});var x=e(88986),p=e(37055),W=e(10237);function _(){var h=p.ZP.shareSettings.getServiceAuthorizeList();return W.WY.get({url:h,params:{enterprise_id:p.ZP.enterpriseId,app_id:p.ZP.shareId}})}function z(h){var t=p.ZP.shareSettings.getShareConfig();return W.WY.get({url:t,params:{enterprise_id:p.ZP.enterpriseId,app_id:p.ZP.shareId,source_knowledge_id:h}})}function g(h,t){var m=t?p.ZP.shareSettings.addShareSettings():p.ZP.shareSettings.editShareSettings();return W.WY.post({url:m,data:(0,x.Z)((0,x.Z)({},h),{},{enterprise_id:p.ZP.enterpriseId,app_id:p.ZP.shareId,user_id:p.ZP.userId})})}function L(h){var t=h.source_knowledge_id,m=h.knowledge_type,I=p.ZP.shareSettings.doShare();return W.WY.post({url:I,data:{knowledge_id:t,knowledge_type:m,enterprise_id:p.ZP.enterpriseId,app_id:p.ZP.shareId,share_user:p.ZP.userId}})}function j(h){var t=CONFIG.shareSettings.getShareInfo();return request.get({url:t,params:{share_id:h,enterprise_id:CONFIG.enterpriseId}})}function V(h){var t=p.ZP.H5Article.getArticleInfo({id:h});return W.WY.get({url:t,params:{}})}function o(h,t){var m=p.ZP.shareSettings.sendMessage();return W.WY.get({url:m,params:{enterprise_id:p.ZP.enterpriseId,app_id:p.ZP.shareId,source_knowledge_id:h,share_url:t}})}function N(h){var t=h.resourceId,m=p.ZP.LibraryList.uploadThirdPart(t);return W.WY.post({url:m,data:{source:"lai_hua"}})}function G(h,t){var m=t.oldResourceId,I=t.resourceId,d=p.ZP.LibraryList.replaceResource({oldResourceId:m,resourceId:I});return W.WY.post({url:d,data:h})}},90994:function(ce,b,e){"use strict";var x=e(71194),p=e(57016),W=e(57663),_=e(71577),z=e(47673),g=e(4107),L=e(34792),j=e(48086),V=e(12924),o=e.n(V),N=e(92592),G=e(91768),h=e(28216),t=e(95371),m=e(1164),I=y=>{var i=y.user,f=y.resourceLibrary;return{userInfo:i,resourceLibrary:f}};class d extends o().Component{constructor(){super(...arguments);this.state={codeUrl:"",isModalVisible:!1},this.handleCancel=()=>{var i=this.props.closeShareWay;i&&i()},this.copy=()=>{var i=document.getElementById("link");i.select(),document.execCommand("Copy"),j.default.success(this.props.t("live.copySuccess"))},this.open=()=>{var i=this.props.shareUrl;m.Z.targetTo({path:i,isExternalLink:!0})},this.sendMessage=()=>{this.setState({isModalVisible:!0})},this.handleOk=()=>{var i=this.props,f=i.sourceKnowledgeId,u=i.shareUrl,F=i.t;(0,t.bG)(f,u).then(B=>{var K=B.data.code;K===2e5||K==="200000"?(j.default.success(F("shareInfo.sendSuccess")),this.setState({isModalVisible:!1})):j.default.error(F("shareInfo.sendFail"))})},this.handleSendCancel=()=>{this.setState({isModalVisible:!1})},this.download=()=>{var i=document.getElementById("code_canvas"),f=this.state.codeUrl,u=new Image;u.crossOrigin="anonymous",u.src=f,u.onload=()=>{var F=i.getContext("2d");F.textAlign="center",F.fillStyle="#fff",F.fillRect(0,0,750,886),F.drawImage(u,185,217,381,381),F.font="42px bold serif",F.fillStyle="#4F4F4F";var B=i.toDataURL("image/jpeg"),K=document.createElement("a");K.setAttribute("href",B),K.setAttribute("download","\u4E8C\u7EF4\u7801.jpg"),document.body.insertAdjacentElement("beforeend",K),K.click(),K.remove()}}}componentDidUpdate(i){i.showShareWay!==this.props.showShareWay&&this.props.showShareWay&&N.toDataURL(this.props.shareUrl,{width:500}).then(f=>{this.setState({codeUrl:f})}).catch(()=>{j.default.error(this.props.t("integralMall.qrCodeFailed"))})}render(){var i=this.props,f=i.prefixCls,u=i.t,F=i.showShareWay,B=i.shareUrl,K=i.courseType,a=i.shareScene,q=this.state,re=q.codeUrl,w=q.isModalVisible;return o().createElement(p.Z,{centered:!0,title:u("shareInfo.shareWay"),visible:F,footer:null,onCancel:this.handleCancel,maskClosable:!1,width:920,bodyStyle:{padding:"24px"}},o().createElement("div",{className:"".concat(f)},o().createElement("div",{className:"".concat(f,"_tip")},a!="customer_training"?u("shareInfo.shareWayTipOne"):null,a!="customer_training"?o().createElement("br",null):null,a!="customer_training"?u("shareInfo.shareWayTipTwo"):null,a==="customer_training"?u("shareInfo.shareWayTip"):null),o().createElement("div",{className:"".concat(f,"_title")},o().createElement("span",null,u("shareInfo.firstWay"))," ",u("shareInfo.firstWayDesc")),o().createElement("div",{className:"".concat(f,"_url")},o().createElement(g.Z,{className:"".concat(f,"_url_input"),readOnly:!0,value:B}),o().createElement(g.Z,{className:"".concat(f,"_url_hidden"),value:B,id:"link"}),o().createElement(_.Z,{type:"link",onClick:this.copy},u("common.copy")),o().createElement(_.Z,{type:"link",onClick:this.open},u("shareInfo.openShare"))),o().createElement("div",{className:"".concat(f,"_title")},o().createElement("span",null,u("shareInfo.secondWay"))," ",u("shareInfo.secondWayDesc")),o().createElement("div",{className:"".concat(f,"_code")},o().createElement("div",{className:"".concat(f,"_code_white")},o().createElement("img",{className:"".concat(f,"_code_white_img"),src:re,alt:""})),o().createElement("canvas",{className:"".concat(f,"_code_canvas"),id:"code_canvas",width:750,height:886}),o().createElement(_.Z,{type:"link",onClick:this.download},u("shareInfo.downloadCode"))),K==="graphicLesson"&&a==="customer_training"&&o().createElement(o().Fragment,null,o().createElement("div",{className:"".concat(f,"_wrapper")},o().createElement("div",{className:"".concat(f,"_title")},o().createElement("span",null,u("shareInfo.thirdWay"))," ",u("shareInfo.thirdWayDesc"),o().createElement("span",{className:"".concat(f,"_descDetail")},u("shareInfo.thirdWayDescDetail"))),o().createElement(_.Z,{type:"link",onClick:this.sendMessage},u("shareInfo.sendMessages"))),o().createElement(p.Z,{title:u("shareInfo.modalTitle"),visible:w,onOk:this.handleOk,onCancel:this.handleSendCancel},o().createElement("p",null,u("shareInfo.modalTipsContent"))))))}}d.defaultProps={prefixCls:"share-way"},b.Z=(0,h.$j)(I)((0,G.Z)()(d))},91805:function(ce,b,e){"use strict";var x=e(71194),p=e(57016),W=e(62029),_=e(48736),z=e(27049),g=e(47673),L=e(4107),j=e(88983),V=e(47933),o=e(43358),N=e(34041),G=e(13062),h=e(71230),t=e(89032),m=e(15746),I=e(9715),d=e(86585),y=e(77576),i=e(59314),f=e(57663),u=e(71577),F=e(34792),B=e(48086),K=e(12924),a=e.n(K),q=e(91768),re=e(28216),w=e(5430),P=e(95371),Z=S=>{var O=S.user,n=S.resourceLibrary;return{userInfo:O,resourceLibrary:n}};class R extends a().Component{constructor(O){super(O);this.formRef=a().createRef(),this.share=!1,this.getAuthorizeList=()=>{(0,P.iv)().then(n=>{var l=n.data.data.authorize_info_list;this.setState({authorize_info_list:l})})},this.getShareConfigs=()=>{var n=this.props.id;(0,P.TP)(n).then(l=>{var s=l.data,$=s.cover,T=s.title;this.setState({defaultUrl:$||"".concat("https://oss.coolcollege.cn","/1794891397082517504.png")}),(0,P.lK)(n).then(H=>{if(H.data.data&&H.data.data.app_id!==""){var C=H.data.data;this.formRef.current.setFieldsValue({is_share:C.open_share==="TRUE",is_card:C.open_staff_card==="TRUE",is_open:C.user_visible==="PUBLIC"?"1":"0",phone:C.user_phones===""?"":C.user_phones.join(","),officialAccountId:C.official_account_app_id,selectCount:C.official_account_app_id===w.ZP.account?"all":"select",cardTitle:C.share_title===""?T:C.share_title,cardContent:C.share_desc}),this.setState({openShare:C.open_share==="TRUE",officialAccount:C.official_account,officialAccountNew:C.official_account_app_id===w.ZP.account?w.ZP.account:"",isAdd:!1,knowledge_id:C.knowledge_id})}else this.formRef.current.setFieldsValue({cardTitle:T})})})},this.changeShareStatus=n=>{this.setState({openShare:n}),!n&&this.formRef.current&&this.formRef.current.setFields([{name:"selectCount",errors:[]},{name:"officialAccountId",errors:[]},{name:"phone",errors:[]}])},this.selectOfficialAccount=(n,l)=>{this.setState({officialAccount:l.children})},this.changePerm=n=>{n==="all"?(this.formRef.current.setFieldsValue({officialAccountId:w.ZP.account}),this.setState({officialAccount:w.ZP.accountName,officialAccountNew:w.ZP.account})):(this.formRef.current.setFieldsValue({officialAccountId:null}),this.setState({officialAccount:"",officialAccountNew:""}))},this.onFinish=n=>{var l=this.props,s=l.id,$=l.t,T=this.state,H=T.officialAccount,C=T.isAdd,A=T.defaultUrl,J=T.knowledge_id,ee=T.officialAccountNew,D=n.is_share,M=n.is_open,Y=n.is_card,ie=n.phone,ve=n.officialAccountId,oe=n.cardTitle,Ee=n.cardContent,he=n.selectCount,ue={source_knowledge_id:s,auth_wechat:"TRUE",official_account_app_id:he==="all"?ee:ve,official_account:H,auth_phone:M==="1"?"FALSE":"TRUE",open_staff_card:Y?"TRUE":"FALSE",user_visible:M==="1"?"PUBLIC":"ASSIGN_ACCOUNT",open_share:D?"TRUE":"FALSE",share_title:oe,share_desc:Ee,knowledge_type:"ARTICLE",share_image_url:A};M==="0"&&(ue.user_phones=ie.split(",")),(0,P.bS)(ue,C).then(te=>{var r=te.data,c=r.code,E=r.data;c===2e5||c==="200000"?(B.default.success($("common.saveSuccess")),this.share?this.doShare(C?E:J):this.handleCancelShare()):B.default.error($("common.saveFailure"))})},this.onFinishFailed=()=>{this.share=!1},this.doShare=n=>{var l=this.props.t;(0,P.Ds)({source_knowledge_id:n,knowledge_type:"ARTICLE"}).then(s=>{var $=s.data,T=$.code,H=$.data;if(T===2e5||T==="200000"){var C=this.props.cancelTipOpenWay;C&&C({shareUrl:"".concat(H.share_url,"&kid=").concat(this.props.id,"&eid=").concat(w.ZP.enterpriseId,"&aid=").concat(w.ZP.shareId)})}else B.default.error(l("study.operateFailed"));this.share=!1})},this.handleCancelShare=()=>{var n=this.props.onCancelShare;this.setState({knowledge_id:""}),n&&n(),this.share=!1},this.operate=n=>{n==="save"&&this.formRef.current.submit(),n==="saveAndShare"&&(this.share=!0,this.formRef.current.submit()),n==="cancel"&&this.handleCancelShare()},this.testPhone=n=>{for(var l=n.split(","),s=0;s<l.length;s+=1)if(!/(^1[0-9]{10}$)/.test(l[s]))return!1;return!0},this.state={initValues:{is_share:!1,is_card:!1,is_open:"1",phone:"",officialAccountId:null,selectCount:"select",cardTitle:"",cardContent:"",attachment:null},defaultUrl:"",authorize_info_list:[],officialAccount:"",officialAccountNew:"",isAdd:!0,openShare:!1,knowledge_id:""}}componentDidUpdate(O){O.showShareConfig!==this.props.showShareConfig&&this.props.showShareConfig&&(this.getAuthorizeList(),this.getShareConfigs()),O.showShareConfig!==this.props.showShareConfig&&!this.props.showShareConfig&&this.changeShareStatus(!1)}render(){var O=this,n=this.props,l=n.prefixCls,s=n.t,$=n.showShareConfig,T=this.state,H=T.initValues,C=T.authorize_info_list,A=T.openShare,J=T.defaultUrl,ee={labelCol:{span:4},wrapperCol:{span:20}};return a().createElement(p.Z,{centered:!0,title:s("resourceLibrary.shareSetting"),visible:$,footer:[a().createElement(u.Z,{key:"cancel",className:"".concat(l,"_button_cancel"),onClick:()=>this.operate("cancel")},s("common.cancel")),a().createElement(u.Z,{key:"save",className:"".concat(l,"_button_save"),type:"primary",onClick:()=>this.operate("save"),htmlType:"submit"},s("common.save")),a().createElement(u.Z,{key:"saveAndShare",disabled:!A,type:"primary",onClick:()=>this.operate("saveAndShare"),htmlType:"submit"},s("shareInfo.saveAndShare"))],onCancel:this.handleCancelShare,width:920,destroyOnClose:!0,bodyStyle:{padding:"24px"},wrapClassName:"share-setting-model",maskClosable:!1},a().createElement("div",{className:l},a().createElement("div",{className:"".concat(l,"_form")},a().createElement(d.Z,(0,W.Z)({name:"share_config"},ee,{ref:this.formRef,labelAlign:"left",onFinish:this.onFinish,initialValues:H,onFieldsChange:this.onFieldsChange,onFinishFailed:this.onFinishFailed,requiredMark:!1}),a().createElement("div",{className:"".concat(l,"_form_title")},s("shareInfo.singleShare")),a().createElement(d.Z.Item,{label:s("shareInfo.shareSwitch"),colon:!1},a().createElement(h.Z,{gutter:8,align:"middle"},a().createElement(m.Z,{span:2},a().createElement(d.Z.Item,{name:"is_share",valuePropName:"checked",noStyle:!0},a().createElement(i.Z,{onChange:this.changeShareStatus,className:"".concat(l,"_form_switch"),checkedChildren:s("common.activatedStr"),unCheckedChildren:s("common.deactivatedStr")}))),a().createElement(m.Z,{span:22,className:"".concat(l,"_form_gray")},s("shareInfo.shareSwitchTip")))),a().createElement(d.Z.Item,{label:s("shareInfo.weChatPermission"),colon:!1,className:"".concat(l,"_form_specials")},a().createElement(h.Z,{gutter:8},a().createElement(m.Z,{span:12},a().createElement(d.Z.Item,{name:"selectCount",colon:!1,rules:[{required:A,message:s("shareInfo.selectWeiInfo")}]},a().createElement(N.Z,{placeholder:s("shareInfo.selectCountWay"),allowClear:!0,width:200,onSelect:this.changePerm,disabled:!A},a().createElement(N.Z.Option,{value:"select"},s("shareInfo.selectMine")),a().createElement(N.Z.Option,{value:"all"},s("shareInfo.selectOfficial"))))),a().createElement(m.Z,{span:12},a().createElement(d.Z.Item,{noStyle:!0,shouldUpdate:(D,M)=>D.selectCount!==M.selectCount},D=>{var M=D.getFieldValue;return M("selectCount")==="select"?a().createElement(d.Z.Item,{name:"officialAccountId",colon:!1,rules:[{required:A,message:s("shareInfo.pleaseSelectService")}]},a().createElement(N.Z,{placeholder:s("shareInfo.pleaseSelectService"),allowClear:!0,width:200,onSelect:this.selectOfficialAccount,disabled:!A},C.map(Y=>a().createElement(N.Z.Option,{info:Y,key:Y.auth_info_id,value:Y.authorizer_app_id},Y.name)))):null})))),a().createElement(d.Z.Item,{label:s("shareInfo.permissionSettings"),colon:!1,name:"is_open"},a().createElement(V.ZP.Group,{disabled:!A,onChange:this.changeOpen},a().createElement(V.ZP,{value:"1"},s("shareInfo.allAccess")),a().createElement(V.ZP,{value:"0"},s("shareInfo.partAccess")))),a().createElement(d.Z.Item,{noStyle:!0,shouldUpdate:(D,M)=>D.is_open!==M.is_open},D=>{var M=D.getFieldValue;return M("is_open")==="0"?a().createElement(d.Z.Item,{label:s("shareInfo.followingAccess"),name:"phone",colon:!1,rules:[{required:A,message:s("shareInfo.allPhoneTip")},()=>({validator(Y,ie){return!A||!ie||O.testPhone(ie)?Promise.resolve():Promise.reject(new Error(s("shareInfo.rightPhoneTip")))}})]},a().createElement(L.Z,{disabled:!A,placeholder:s("shareInfo.allPhoneTip")})):null}),a().createElement(d.Z.Item,{label:s("shareInfo.employeeBusinessCard"),colon:!1},a().createElement(h.Z,{gutter:8},a().createElement(m.Z,{span:2},a().createElement(d.Z.Item,{name:"is_card",valuePropName:"checked",noStyle:!0},a().createElement(i.Z,{disabled:!A,className:"".concat(l,"_form_switch"),checkedChildren:s("common.activatedStr"),unCheckedChildren:s("common.deactivatedStr")}))),a().createElement(m.Z,{span:22,className:"".concat(l,"_form_gray")},s("shareInfo.userCardTip")))),a().createElement(z.Z,null),a().createElement("div",{className:"".concat(l,"_form_title")},s("shareInfo.cardShareInfo")),a().createElement(h.Z,{gutter:8},a().createElement(m.Z,{span:12},a().createElement(d.Z.Item,{label:s("shareInfo.cardTitle"),colon:!1,name:"cardTitle",rules:[{required:A,message:s("shareInfo.shareTitleTip")}]},a().createElement(L.Z,{disabled:!A,placeholder:s("shareInfo.cardTitleTip"),maxLength:40})),a().createElement(d.Z.Item,{label:s("shareInfo.cardContent"),colon:!1,name:"cardContent"},a().createElement(L.Z.TextArea,{autoSize:{minRows:3,maxRows:3},disabled:!A,placeholder:s("shareInfo.cardContentTip"),maxLength:60}))),a().createElement(m.Z,{span:12,className:"".concat(l,"_form_switch")},a().createElement("div",{className:"".concat(l,"_form_preview")},s("shareInfo.cardPreview")),a().createElement("div",{className:"".concat(l,"_form_paddingLeft")},a().createElement(d.Z.Item,{noStyle:!0,shouldUpdate:(D,M)=>D.cardTitle!==M.cardTitle||D.cardContent!==M.cardContent},D=>{var M=D.getFieldValue;return a().createElement("div",{className:"".concat(l,"_form_card")},a().createElement("div",{className:"".concat(l,"_form_card_title")},M("cardTitle")),a().createElement("div",{className:"".concat(l,"_form_card_content")},a().createElement("div",{className:"".concat(l,"_form_card_content_left")},M("cardContent")),a().createElement("div",{className:"".concat(l,"_form_card_content_right")},a().createElement("img",{src:J,alt:"pictures"}))))})))),a().createElement(d.Z.Item,{className:"".concat(l,"_button"),wrapperCol:{span:20,offset:4}})))))}}R.defaultProps={prefixCls:"share-setting-page"},b.Z=(0,re.$j)(Z)((0,q.Z)()(R))}}]);
