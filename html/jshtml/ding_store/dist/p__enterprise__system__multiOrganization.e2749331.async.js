(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[7295],{30614:function(la,xe,h){"use strict";h.r(xe),h.d(xe,{default:function(){return na}});var V=h(57361),q=h(33565),dt=h(9754),Z=h.n(dt),k=h(12924),t=h.n(k),K=h(28216),D=h(91768),da=h(18106),ze=h(88108),pa=h(47673),M=h(4107),ca=h(22385),A=h(31097),Se=h(73218),be=h(76570),ie=h(79906),R=h(62029),ha=h(14781),ue=h(53431),ua=h(49111),pt=h(19650),ma=h(57663),x=h(71577),ga=h(62350),ct=h(75443),va=h(71194),H=h(57016),_=h(88986),fa=h(34792),C=h(48086),ya=h(43358),me=h(34041),ge=h(36202),z=h(6793),E=h(10237),y=h(37055),X=h(84874),re=h(18329),Le=h(64262),Ee=h(85372),ht=h(64630),ut=h(8908),ee=h(60667),ae=h(80430),mt=M.Z.Search,ve=me.Z.Option,W={pageNumber:1,pageSize:20};function De(g,l){var i=y.ZP.AuthorizationAccount.removeAuth(),e={department_ids:[],user_ids:g};E.WY.delete({url:i,data:e}).then(()=>{C.default.success("\u89E3\u9664\u6388\u6743\u6210\u529F"),l&&l()}).catch(()=>{C.default.error("\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u518D\u6B21\u5C1D\u8BD5")})}class gt extends k.Component{constructor(l){var i;super(l);i=this,this.onSearch=e=>{var a=e.target.value;W.pageNumber=1,this.getUserList(a)},this.onBtnSearch=e=>{W.pageNumber=1,this.getUserList(e)},this.onCancelOrg=()=>{var e=this.state.dialogConfig;e.bodyMask=!1,this.setState({showOrg:!1,dialogConfig:e})},this.onOkOrg=e=>{var a=this.state.dialogConfig;a.bodyMask=!1,this.setState({selectDeptAndUser:(0,_.Z)((0,_.Z)({},this.state.selectDeptAndUser),{},{user:e.users||[]}),showOrg:!1,dialogConfig:a},()=>{this.addAuth()})},this.onPageChange=e=>{W.pageNumber=e,this.getUserList()},this.onPageSizeChange=(e,a)=>{W.pageSize=a,this.getUserList()},this.getAuthorizationCount=()=>{var e=y.ZP.AuthorizationAccount.getAuthorizationCount(),a=this.state.dialogConfig;E.WY.get({url:e}).then(s=>{var r=s.data,o=r.quotaUserCount,n=r.activeUserCount;a.title=this.renderDialogTitle(o,n,o-n),this.setState({dialogConfig:a,quotaUserCount:o,activeUserCount:n})})},this.renderDialogTitle=(e,a,s)=>{var r=this.props,o=r.t,n=r.isVip,d=window.localStorage.getItem("enterpriseName")||"\u9177\u5B66\u9662",c=localStorage.getItem("themeColor")||"#516ae6";return t().createElement("div",{className:"authorization-account-dialog-title"},t().createElement("h3",null,d,o("setting.authorizedLabel"),n!==3&&t().createElement("span",{className:"authorization-account-dialog-title-sub"},"(",o("setting.totalQuota"),t().createElement("span",{style:{color:c}},e,o("common.userUnit")),"\uFF1B",o("setting.remainingQuota"),t().createElement("span",{style:{color:c}},s,o("common.userUnit")),")")))},this.handleShowDialog=()=>{var e=this.state.dialogConfig;e.visible=!0,W.pageNumber=1,W.pageSize=20,this.getAuthorizationCount(),this.getUserList(),this.setState({dialogConfig:e,currectSelectKeys:[]})},this.getUserList=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=i.state,s=a.filterPostId,r=a.filterDeptId,o=a.type,n=y.ZP.Organization.getDeptUser({deptId:r}),d="";s&&!r?n=y.ZP.Organization.getPostUserList({postId:s}):!s&&r?n=y.ZP.Organization.getDeptUser({deptId:r}):s&&r&&(n=y.ZP.Organization.getDeptUser({deptId:r}),d=s);var c=e||i.state.keyword,u={keyword:c,type:o,page_number:W.pageNumber,page_size:W.pageSize,recursion:!0,filter_auth:!0,post_id:d};E.WY.get({url:n,params:u}).then(m=>{m.data.list&&m.data.list.forEach(p=>{p.timeLabel=(0,z.p6)(p.create_time,"yyyy-MM-dd"),p.recent_login_time?p.lastLoginTime=(0,z.p6)(p.recent_login_time,"yyyy-MM-dd  hh:mm:ss"):p.lastLoginTime="",p.extend_list&&p.extend_list.forEach(f=>{p[f.column_key]=f.protect_value})}),i.setState({currectSelectKeys:[],userList:m.data.list||[],userTotal:m.data.total})})},this.handleSelectChange=e=>{this.setState({type:e},()=>{this.getUserList()})},this.handleSearchChange=e=>{var a=e.target.value;this.setState({keyword:a})},this.handleTreeSelectChange=(e,a)=>{W.pageNumber=1,this.setState({filterDeptId:e||1,filterDeptLabel:a||""},()=>{this.getUserList()})},this.handlePostSelectChange=e=>{this.setState({filterPostId:e},()=>{this.getUserList()})},this.rowSelection=e=>{this.setState({currectSelectKeys:e})},this.cancel=()=>{var e=this.state.dialogConfig;e.visible=!1,this.setState({dialogConfig:e})},this.sure=()=>{var e=this.state.dialogConfig;e.visible=!1,this.setState({dialogConfig:e})},this.addAuth=()=>{var e=this.props.t,a=y.ZP.AuthorizationAccount.addAuth(),s=this.state.selectDeptAndUser,r={user_ids:s.user.map(o=>o.id)};if(!r.user_ids.length){C.default.warn(this.props.t("authentication.pleaseSelectPeople"));return}E.WY.post({url:a,data:r}).then(()=>{C.default.success(e("setting.authSuccess")),this.setState({selectDeptAndUser:{dept:[],user:[],post:[],group:[]},currectSelectKeys:[]}),this.getUserList(),this.getAuthorizationCount()}).catch(()=>{this.setState({selectDeptAndUser:{dept:[],user:[],post:[],group:[]},currectSelectKeys:[]})})},this.handleRemoveAuth=()=>{var e=this.state,a=e.dialogConfig,s=e.unActiveTipConfig;a.bodyMask=!0,this.setState({dialogConfig:a},()=>{var r=s.title,o=s.content;H.Z.confirm({title:r,content:o,onOk:()=>{this.sureRemoveAuth()},onCancel:()=>{this.cancelRemoveAuth()}})})},this.removeAuthCbk=()=>{this.setState({currectSelectKeys:[]},()=>{this.getUserList(),this.getAuthorizationCount()})},this.cancelRemoveAuth=()=>{var e=this.state.dialogConfig;e.bodyMask=!1,this.setState({dialogConfig:e})},this.sureRemoveAuth=()=>{var e=this.state,a=e.dialogConfig,s=e.currectSelectKeys;a.bodyMask=!1,this.setState({dialogConfig:a}),De(s,()=>{this.removeAuthCbk()})},this.handleShowOrgDialog=()=>{var e=this.state.dialogConfig;e.bodyMask=!0,this.setState({showOrg:!0,dialogConfig:e})},this.getTableColumn=()=>{var e=this.props.t,a=this.state.userList,s=a[0]&&a[0].extend_list?a[0].extend_list:[],r=[{title:e("setting.authTableUserName"),dataIndex:"user_name",key:"user_name",width:90,fixed:"left",render:(o,n)=>{var d=n.user_id,c=n.source_type;return t().createElement(ee.Z,{type:c,value:d,name:o,dataType:"userName"})}},{title:e("personal.jobNumber"),dataIndex:"job_number",key:"job_number",width:100},{title:e("common.department"),dataIndex:"department_names",key:"department_names",width:150,render:(o,n)=>{var d=n.leaf_department_ids,c=n.source_type;return t().createElement(A.Z,{title:o},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},t().createElement(ae.Z,{list:d,nameList:o,sourceType:c,displayAll:!1})))}},{title:e("component.belongPost"),dataIndex:"post_names",key:"post_names",width:150,render:o=>t().createElement(A.Z,{title:o},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},o?o.join("\uFF0C"):""))},{title:e("marketing.loginEmail"),dataIndex:"login_email",key:"login_email",width:150,render:o=>o||"--"},{title:e("setting.joinTime"),dataIndex:"timeLabel",key:"timeLabel",width:120,render:o=>o||"--"}];return s.forEach(o=>{var n=o.column_value===e("searchInputPlaceholder.mobileOp")?"mobile":o.column_key;r.push({title:o.column_value,dataIndex:n,key:n,width:150})}),r.push({title:e("setting.activeStatus"),dataIndex:"active",key:"active",width:80,fixed:"right",render:o=>e(o==="true"?"setting.activeLabel":"setting.unActiveLabel")},{title:e("common.operate"),key:"operate",width:100,fixed:"right",render:(o,n)=>{var d=[n.id],c=localStorage.getItem("themeColor")||"#516ae6";return t().createElement(ct.Z,{title:e("setting.removeAuthTip"),okText:e("setting.remove"),cancelText:e("common.cancel"),onConfirm:()=>De(d,this.removeAuthCbk)},t().createElement("span",{className:"unactive-label",style:{color:c}},e("setting.removeAuthLabel")))}}),r},this.renderLeftRow=()=>{var e=this.props,a=e.t,s=e.isVip,r=this.state,o=r.currectSelectKeys,n=r.quotaUserCount,d=r.activeUserCount,c=n-d>0?n-d:0;return t().createElement("div",{className:"authorization-account-button-groups"},t().createElement(x.Z,{size:"small",type:"ghost",className:"authorization-account-top-unactive",disabled:o.length===0,onClick:this.handleRemoveAuth},a("setting.removeAuthLabel")),t().createElement(pt.Z,null,t().createElement(x.Z,{size:"small",type:"primary",disabled:s!==3&&c<=0,className:"authorization-account-top-active",onClick:this.handleShowOrgDialog},a("setting.addAuthUser"))))},this.importModalVisibility=e=>{this.setState({importVisible:e})},this.handleImportOk=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=i.state.selectDeptAndUser;i.setState({selectDeptAndUser:(0,_.Z)((0,_.Z)({},a),{},{user:e}),importVisible:!1},()=>{i.addAuth()})},this.getPlaceholder=()=>{var e=this.state.type,a=this.props.t,s=null;switch(e){case"job_number":s=a("searchInputPlaceholder.jobNumber");break;case"user_name":s=a("searchInputPlaceholder.userName");break;case"login_number":s=a("searchInputPlaceholder.loginBumberBase");break;case"email":s=a("searchInputPlaceholder.emailBase");break;default:s=a("searchInputPlaceholder.mobileNumber");break}return s},this.handleImportCancel=()=>{this.importModalVisibility(!1)},this.state={dialogConfig:{visible:!1,mask:!0,bodyMask:!1,title:"",bodyStyle:{padding:"0 20px"},wrapClassName:"authorization-account",onCancel:this.cancel,footer:null,width:750},unActiveTipConfig:{title:l.t("setting.removeAuthTipTitle"),content:l.t("setting.removeAuthTip")},userType:"unactive",quotaUserCount:0,activeUserCount:0,showOrg:!1,selectDeptAndUser:{dept:[],post:[],group:[],user:[]},userList:[],userTotal:0,filterDeptId:1,filterPostId:"",filterDeptLabel:"",keyword:"",type:"user_name",currectSelectKeys:[],importVisible:!1}}componentWillUnmount(){W.pageNumber=1,W.pageSize=20}render(){var l=this.state,i=l.showOrg,e=l.userType,a=l.dialogConfig,s=l.currectSelectKeys,r=l.userTotal,o=l.userList,n=l.filterDeptLabel,d=l.importVisible,c=l.type,u={columnWidth:50,selectedRowKeys:s,onChange:this.rowSelection},m=this.props,p=m.t,f=m.organizationType,w=localStorage.getItem("themeColor")||"#516ae6";return t().createElement("div",{className:"authorization-account"},t().createElement("div",{className:"authorization-account-btn",style:{color:w},onClick:this.handleShowDialog},t().createElement(X.Z,{iconClass:"icon-quanxian"}),p("setting.authorizedAccount")),i?t().createElement(Ee.Z,{onOk:this.onOkOrg,onCancel:this.onCancelOrg,tabs:["user"],chooseUserList:["immediate"],visible:i,title:p("setting.addAuth"),userType:e,okText:p("setting.authorizedLabel"),organizationType:f}):null,t().createElement(re.ZP,(0,R.Z)({},a,{bodyMask:!1}),t().createElement("div",{className:"authorization-account-body"},t().createElement("div",{className:"authorization-account-search-top"},t().createElement(Le.Z,{parentId:"",checkable:!1,asyncLoad:!0,treeSelect:!0,className:"authorization-account-top-org",handleTreeSelectChange:this.handleTreeSelectChange}),t().createElement(ht.Z,{className:"authorization-account-top-org",onChange:this.handlePostSelectChange}),t().createElement(M.Z.Group,{compact:!0},t().createElement(me.Z,{className:"authorization-account-top-select",defaultValue:c,onChange:this.handleSelectChange},t().createElement(ve,{value:"user_name"},p("searchInputPlaceholder.userNameOp")),t().createElement(ve,{value:"job_number"},p("searchInputPlaceholder.jobNumberOp")),t().createElement(ve,{value:"login_number"},p("searchInputPlaceholder.loginNumber")),t().createElement(ve,{value:"email"},p("searchInputPlaceholder.email"))),t().createElement(mt,{ref:N=>{this.mySearch=N},className:"authorization-account-top-search",onSearch:this.onBtnSearch,onChange:this.handleSearchChange,allowClear:!0,placeholder:p("searchInputPlaceholder.pleaseSelect")}))),t().createElement("div",{className:"authorization-account-list"},t().createElement(ge.f,{dataSource:o,columns:this.getTableColumn(),bordered:!0,rowKey:N=>N.id,size:"middle",pagination:!1,rowSelection:u,scroll:{y:"100%",x:750},headerTitle:this.renderLeftRow(),tableUUID:"04076768-0c33-4767-976a-f9f258f8e0ed"}),t().createElement("div",{className:"authorization-account-list-pagination"},t().createElement("span",null,n.length>0?n:p("dashboard.authorized"),t().createElement("span",{className:"count",style:{color:w}},r),p("common.userUnit")),t().createElement(ue.Z,{showSizeChanger:!0,size:"small",total:+r,onShowSizeChange:this.onPageSizeChange,defaultPageSize:20,onChange:this.onPageChange}))))),t().createElement(ut.Z,{visible:d,onOk:this.handleImportOk,onCancel:this.handleImportCancel}))}}var vt=(0,D.Z)()(gt),Sa=h(59250),_e=h(13013),ba=h(30887),oe=h(99210);class Ae extends k.Component{constructor(l){super(l);this.editDept=()=>{var i=this.props,e=i.titleOperateProps,a=i.deptId,s=i.deptName;e.edit(a,s)},this.handleMenuClick=i=>{var e=i.key;e==="edit"&&this.editDept()},this.state={hasClickDelete:!1}}render(){var l=this.props.t,i=t().createElement(oe.Z,{onClick:this.handleMenuClick},t().createElement(oe.Z.Item,{key:"edit"},l("common.edit")));return t().createElement("div",{className:"dept tree-node-title"},t().createElement(A.Z,{title:this.props.title},t().createElement("span",{className:"tooltip-span"},this.props.title)),t().createElement(_e.Z,{overlay:i},t().createElement(x.Z,{className:"tree-node-operate"},t().createElement(X.Z,{iconClass:"icon-icon_morex"}))))}}Ae.defaultProps={};var ft=(0,D.Z)()(Ae),Ea=h(34669),yt=h(82833);class St extends k.Component{constructor(l){super(l);this.startSyncOrg=()=>{var i=this.props,e=i.t,a=i.appType;a==="seeyon_app"?C.default.success(e("setting.dataSynchronismTips")):this.setState({inProgress:!0});var s=y.ZP.SynchOrg.startSynch(),r={enterpriseId:window.localStorage.getItem("enterpriseId")};E.WY.get({url:s,params:r}).then(o=>{o.data.code===0?a!=="seeyon_app"&&this.getProgress():o.data.code===1&&this.stopSyncOrg()})},this.getProgress=()=>{var i=this.props,e=i.t,a=i.onFinishSync,s=y.ZP.SynchOrg.synchProgress(),r={enterpriseId:window.localStorage.getItem("enterpriseId")},o=setInterval(()=>{E.WY.get({url:s,params:r}).then(n=>{this.setState({progress:+n.data}),n.data>=100&&(clearInterval(o),this.stopSyncOrg(),C.default.success(e("setting.synchronizeSuccess")),a&&a())})},1e3)},this.stopSyncOrg=()=>{setTimeout(()=>{this.setState({inProgress:!1})},500)},this.renderLabel=()=>{var i=this.props,e=i.t,a=i.appType,s=localStorage.getItem("themeColor")||"#516ae6";return t().createElement("div",{onClick:this.startSyncOrg,style:{color:s}},t().createElement(X.Z,{iconClass:"icon-huanyihuan"}),a==="seeyon_app"?e("setting.dataSynchronism"):"",a==="e_app"?e("setting.synchronizeDingtalk"):"",a==="wx_app"?e("setting.synchronizeWX"):"",a==="fs_app"?e("setting.synchronizeWX"):"",a==="third_oa_app"?e("setting.synchronizeWX"):"")},this.renderProgress=()=>t().createElement("div",null,t().createElement(yt.Z,{percent:this.state.progress,status:"active"})),this.state={inProgress:!1,progress:0}}render(){return t().createElement("div",{className:this.state.inProgress?"synch-org-container no-border":"synch-org-container"},this.state.inProgress?this.renderProgress():this.renderLabel())}}var bt=(0,K.$j)(g=>({appType:g.user.appType}))((0,D.Z)()(St)),$=h(59239),Ia=h(55446);class Ge extends t().Component{constructor(l){super(l);this.inputDeptName=e=>{var a=e.target.value;this.setState({deptName:a.trim()})},this.cancelAddDept=()=>{this.props.onAddCbk("cancel")},this.saveAddDept=()=>{var e=this.props,a=e.t,s=e.deptId;if(this.state.deptName.trim().length===0){C.default.error(a("setting.addDeptTip"));return}var r=y.ZP.Organization.editDept({deptId:s}),o={access_token:window.localStorage.getItem("token"),name:this.state.deptName,department_id:s};E.WY.post({url:r,data:o}).then(n=>{n.data.id||n.data.result==="true"?(this.props.onAddCbk("success"),C.default.success(a("common.editSuccess"))):n.data.msg&&C.default.error(n.data.msg)})};var i=t().createElement(x.Z,{key:"submit",type:"primary",onClick:this.saveAddDept},l.t("common.ok"));this.state={deptName:this.props.initValue,addDeptModal:{mask:!0,size:"small",footer:i,onCancel:this.cancelAddDept}}}render(){var l=this.props.t;return t().createElement(re.ZP,(0,R.Z)({},this.state.addDeptModal,{visible:this.props.visible,title:l("common.edit")}),t().createElement("div",{className:"add-user-group-body"},t().createElement($.Z,null,t().createElement($.Z.Item,{label:l("setting.deptLabel"),className:"add-user-group-label"},t().createElement(M.Z,{placeholder:l("setting.addDeptTip"),value:this.state.deptName,onInput:this.inputDeptName,className:"add-user-group-input",maxLength:50})))))}}Ge.defaultProps={type:"add",initValue:"",deptId:"",visible:!1,onAddCbk:()=>{}};var Et=(0,D.Z)()(Ge),ne=h(86726),Ie=h(98489),It=g=>({userInfo:g.user});class Me extends k.Component{constructor(l){var i;super(l);i=this,this.getStatus=(0,V.Z)(Z().mark(function e(){var a,s;return Z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,ie.eD)();case 2:s=o.sent,(s==null||(a=s.data)===null||a===void 0?void 0:a.code)===0&&i.setState({status:s.data.data});case 4:case"end":return o.stop()}},e)})),this.loadedRoot=e=>{if(this.props.onSelectNode){var a=t().createElement(ee.Z,{dataType:"departmentName",value:e.id,name:e.department_name,type:e.source_type});this.props.onSelectNode(e.id,a)}},this.getEnterpriseInfo=()=>{var e=y.ZP.Organization.getEnterpriseInfo();E.WY.get({url:e}).then(a=>{this.setState({isVip:a.data.isVip})})},this.onSearch=(e,a)=>{var s=typeof a!="undefined"?a:e.target.value;if(s.trim().length===0){this.clearSearch();return}var r=y.ZP.Organization.queryDept(),o={department_name:s,filter_auth:!0};E.WY.get({url:r,params:o}).then(n=>{this.setState({searchDeptResult:n.data.departments,isSearch:!0})})},this.inputSearchText=e=>{var a=e.target.value;this.setState({searchText:a})},this.clearSearch=()=>{this.setState({searchDeptResult:[],searchText:"",isSearch:!1})},this.treeNodeClick=(e,a)=>{var s=a.node;if(this.setState({activeDeptId:e[0]}),this.props.onSelectNode){var r=t().createElement("span",null,t().createElement(ee.Z,{dataType:"departmentName",value:s.dataRef.id,name:s.dataRef.department_name,type:s.dataRef.source_type}),"(",s.dataRef.user_count,")");this.props.onSelectNode(e[0],r)}},this.showAddDept=(e,a)=>{this.setState({showAddDept:!0,currentDeptId:e,editDeptName:a})},this.onAddDeptCbk=e=>{this.setState({showAddDept:!1}),e==="success"&&this.setState({refresh:this.state.refresh+1})},this.renderTree=()=>{var e=this.props,a=e.organizationType,s=e.tabStatus,r=s===void 0?"":s,o=e.userInfo,n=this.state.status,d={edit:this.showAddDept};return t().createElement("div",{className:"org-tree-padding-wrapper",style:r?{height:"calc(100vh - 379px )"}:{}},t().createElement(Le.Z,{parentId:"",checkable:!1,asyncLoad:!0,showUserCount:!0,showTitleToolTip:!0,handleSelect:this.treeNodeClick,handleLoadedCbk:this.loadedRoot,refresh:this.state.refresh,DeptTreeNodeTitle:n==="true"&&o.appId!=="9005"?ft:null,titleOperateProps:d,organizationType:a,ref:this.OrgTree}))},this.renderSearchResult=()=>{var e=this.props,a=e.t,s=e.tabStatus,r=s===void 0?"":s,o=this.state.searchDeptResult.map(n=>t().createElement(A.Z,{title:"".concat(n.department_name,"(").concat(n.user_count).concat(a("common.userUnit"),")"),key:n.id},t().createElement("div",{className:this.state.activeDeptId===n.id?"org-tree-search-one active":"org-tree-search-one",key:n.id,onClick:()=>this.treeNodeClick([n.id],{node:{dataRef:{department_name:n.department_name,user_count:n.user_count}}})},n.path&&"".concat(n.path.slice(1).join("-")).concat(n.path.length>1?"-":"").concat(n.department_name,"(").concat(n.user_count).concat(a("common.userUnit"),")"))));return t().createElement("div",{className:"org-tree-search-result",style:r?{height:"calc(100vh - 379px )"}:{}},o)},this.onFinishSync=()=>{var e=this.props.onFinishSync;this.OrgTree&&this.OrgTree.current&&this.OrgTree.current.getDeptTree(""),e()},this.renderSynchOrg=()=>{var e=this.state.allowActions,a=this.props,s=a.organizationType,r=a.isOpenThirdOaSync,o=(0,ne.H3)("sync",e);return r&&s==="third_oa_app"?null:o&&!Ie.Zv.isLingNanPrivate()?t().createElement(bt,{onFinishSync:this.onFinishSync}):null},this.OrgTree=t().createRef(),this.state={searchDeptResult:[],isSearch:!1,searchText:"",activeDeptId:"",isVip:0,allowActions:(0,ne.V9)("organization",l.userInfo.modules),showAddDept:!1,editDeptName:"",currentDeptId:"",status:!1,refresh:0}}componentDidMount(){this.getEnterpriseInfo(),this.getStatus()}render(){var l=this.props.t,i=this.state.searchText.length>0?t().createElement(Se.Z,{onClick:this.clearSearch}):t().createElement(be.Z,{onClick:e=>this.onSearch(e,this.state.searchText)});return t().createElement("div",{className:"org-tree-container dept"},t().createElement(M.Z,{className:"org-tree-search",value:this.state.searchText,placeholder:l("searchInputPlaceholder.department"),onInput:this.inputSearchText,onPressEnter:this.onSearch,suffix:i}),t().createElement("div",{className:"org-tree-operate"},this.renderSynchOrg(),this.state.isVip===2||this.state.isVip===5||this.state.isVip===6||this.state.isVip===8||this.state.isVip===3?t().createElement(vt,{isVip:this.state.isVip}):null),this.state.isSearch?this.renderSearchResult():this.renderTree(),this.state.showAddDept?t().createElement(Et,{visible:this.state.showAddDept,initValue:this.state.editDeptName,deptId:this.state.currentDeptId,type:"edit",onAddCbk:this.onAddDeptCbk}):null)}}Me.defaultProps={onSelectNode:()=>{}};var Pt=(0,K.$j)(It)((0,D.Z)()(Me)),Pa=h(32157),Ve=h(75869),Pe=h(49101),Ca=h(62999),$e=h(85733),Fe=h(54549),Re=h(88311),We=h(25547),Ct=h(2396);class je extends t().Component{constructor(l){super(l);this.getPostList=()=>{var e=this.props,a=e.type,s=e.currentPostId;E.WY.get({url:y.ZP.Organization.getPostGroupTree(),params:{show_leaf_node:!0,post_group_id:a==="add"?"":s}}).then(r=>{var o=(0,We.NP)(r.data.post_groups,{id:"value",post_group_name:"title"});this.setState({postList:o})})},this.getPostLeader=()=>{var e=y.ZP.Organization.getPostLeader(),a={postId:this.props.currentPostId,id:this.props.currentPostId,pageSize:20};E.WY.get({url:e,params:a}).then(s=>{s.data.code===0&&this.setState({postLeader:{user:s.data.data.userList,dept:[]},parentId:s.data.data.parentId,postName:s.data.data.depathmentName})})},this.showOrgDialog=()=>{this.setState({orgDialogVisible:!0})},this.cancelAddPost=()=>{this.props.onAddCbk("cancel")},this.checkPostName=(e,a,s)=>{var r=this.props.t;if(a){s();return}s(r("setting.addPostCheckNameTip"))},this.checkSuperiorPostId=(e,a,s)=>{var r=this.props.t;if(a){s();return}s(r("setting.superiorPostGroupTip"))},this.saveAddPost=()=>{var e=this.props,a=e.t,s=e.type,r=e.currentPostId,o=s==="add";this.props.form.validateFields((n,d)=>{if(!n){var c=d.postName,u=d.superiorPostId,m,p={post_name:(0,z.fy)(c),post_group_id:u};o?m=y.ZP.Organization.addPost():m=y.ZP.Organization.editPost({id:r}),E.WY[o?"post":"put"]({url:m,data:p}).then(()=>{this.props.onAddCbk("success"),C.default.success(this.props.type==="add"?a("common.addSuccess"):a("common.editSuccess"))})}})},this.addPostLeader=e=>{this.setState({orgDialogVisible:!1}),this.setState({postLeader:{dept:e.dept,user:e.user}})},this.cancelOrg=()=>{this.setState({orgDialogVisible:!1})},this.removeOneLeader=e=>{var a=[...this.state.postLeader.dept],s=[...this.state.postLeader.user],r=a.findIndex(n=>n.id===e),o=s.findIndex(n=>n.id===e);r!==-1?a.splice(r,1):o!==-1&&s.splice(o,1),this.setState({postLeader:{dept:a,user:s}})},this.renderPostLeader=()=>{var e=[...this.state.postLeader.dept,...this.state.postLeader.user].map(a=>t().createElement("span",{className:"post-leader-one",key:a.id},a.name,t().createElement(Fe.Z,{onClick:s=>{s.stopPropagation(),this.removeOneLeader(a.id)}})));return e};var i=t().createElement(x.Z,{key:"submit",type:"primary",onClick:this.saveAddPost},l.t("common.ok"));this.state={postName:"",superiorPostId:this.props.superiorPostId==="1"?void 0:this.props.superiorPostId,postList:[],orgDialogVisible:!1,postLeader:{dept:[],user:[]},parentId:"",addPostModal:{mask:!0,size:"small",footer:i,onCancel:this.cancelAddPost}}}componentDidMount(){this.props.type==="edit"&&this.getPostLeader(),this.getPostList()}render(){var l=this.props,i=l.t,e=l.form,a=e.getFieldDecorator,s=this.state,r=s.postName,o=s.superiorPostId,n=s.postList;return t().createElement(re.ZP,(0,R.Z)({},this.state.addPostModal,{visible:this.props.visible,title:this.props.type==="add"?i("setting.addPost"):i("setting.editPost"),bodyMask:this.state.orgDialogVisible}),t().createElement("div",{className:"add-post-body"},t().createElement($.Z,null,t().createElement($.Z.Item,{label:i("common.post"),required:!0,className:"add-post-label"},a("postName",{initialValue:r,rules:[{validator:this.checkPostName}]})(t().createElement(M.Z,{placeholder:i("setting.addPostNameTip"),className:"add-post-input",maxLength:32,onInput:d=>(0,Ct.q_)(d,32)}))),t().createElement($.Z.Item,{label:i("setting.postGroup"),required:!0,className:"add-post-group-label"},a("superiorPostId",{initialValue:o,rules:[{validator:this.checkSuperiorPostId}]})(t().createElement($e.Z,{style:{width:348},dropdownStyle:{maxHeight:300,overflow:"auto"},treeData:n,placeholder:i("setting.superiorPostGroupTip"),allowClear:!0,treeDefaultExpandAll:!0}))))),t().createElement(Re.Z,{visible:this.state.orgDialogVisible,onOk:this.addPostLeader,displayType:["dept"],initData:this.state.postLeader,modalConfig:{mask:!1},onCancel:this.cancelOrg}))}}je.defaultProps={type:"add",currentPostId:"",visible:!1,onAddCbk:()=>{}};var Tt=$.Z.create({name:"addPos"})((0,D.Z)()(je));class Be extends t().Component{constructor(l){super(l);this.getPostList=()=>{var e=this.props,a=e.type,s=e.postId;E.WY.get({url:y.ZP.Organization.getPostGroupTree(),params:{post_group_id:a==="add"?"":s}}).then(r=>{var o=(0,We.NP)(r.data.post_groups,{id:"value",post_group_name:"title"});this.setState({postList:o})})},this.cancelAddPostGroup=()=>{this.props.onAddCbk("cancel")},this.saveAddPostGroup=()=>{var e=this.props,a=e.t,s=e.form,r=e.type,o=e.postId,n=r==="add";s.validateFields((d,c)=>{if(!d){var u=c.postName,m=c.superiorPostId,p,f={post_group_name:(0,z.fy)(u),parent_id:m||""};n?p=y.ZP.Organization.addPostGroup():p=y.ZP.Organization.editPostGroup({id:o}),E.WY[n?"post":"put"]({url:p,data:f}).then(()=>{this.props.onAddCbk("success"),C.default.success(a(n?"common.addSuccess":"common.editSuccess"))})}})},this.checkPostName=(e,a,s)=>{var r=this.props.t;if(a){s();return}s(r("setting.addPostGroupCheckNameTip"))};var i=t().createElement(x.Z,{key:"submit",type:"primary",onClick:this.saveAddPostGroup},l.t("common.ok"));this.state={postName:this.props.initValue,superiorPostId:this.props.superiorPostId==="1"?void 0:this.props.superiorPostId,postList:[],addPostGroupModal:{mask:!0,size:"small",footer:i,onCancel:this.cancelAddPostGroup}}}componentDidMount(){this.getPostList()}render(){var l=this.props,i=l.t,e=l.form,a=e.getFieldDecorator,s=this.state,r=s.postName,o=s.superiorPostId,n=s.postList;return t().createElement(re.ZP,(0,R.Z)({},this.state.addPostGroupModal,{visible:this.props.visible,title:this.props.type==="add"?i("setting.addPostGroup"):i("setting.editPostGroup")}),t().createElement("div",{className:"add-post-group-body"},t().createElement($.Z,null,t().createElement($.Z.Item,{label:i("setting.postGroup"),required:!0,className:"add-post-group-label"},a("postName",{initialValue:r,rules:[{validator:this.checkPostName}]})(t().createElement(M.Z,{placeholder:i("setting.addPostGroupNameTip"),className:"add-post-group-input",maxLength:10}))),t().createElement($.Z.Item,{label:i("setting.superiorPostGroup"),className:"add-post-group-label"},a("superiorPostId",{initialValue:o})(t().createElement($e.Z,{style:{width:348},dropdownStyle:{maxHeight:300,overflow:"auto"},treeData:n,placeholder:i("setting.superiorPostGroupTip"),allowClear:!0,treeDefaultExpandAll:!0}))))))}}Be.defaultProps={type:"add",initValue:"",visible:!1,postId:"",onAddCbk:()=>{}};var Nt=$.Z.create({name:"addPostGroup"})((0,D.Z)()(Be)),Ta=h(20136),Ce=h(55241),Ye=h(2871);class Ke extends k.Component{constructor(l){var i;super(l);i=this,this.handleCommonDeletePostTip=function(){var e=(0,V.Z)(Z().mark(function a(s){var r,o,n,d,c,u=arguments;return Z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return r=u.length>1&&u[1]!==void 0?u[1]:"post",o=i.props,n=o.t,d=o.postId,p.next=4,(0,Ye.$)("POST",d,n("setting.postLabel"));case 4:if(c=p.sent,!c){p.next=7;break}return p.abrupt("return");case 7:i.beforeDeleteTip(s,r).then(()=>{r==="post"?i.sureDeletePost():i.sureDeletePostGroup()});case 8:case"end":return p.stop()}},a)}));return function(a){return e.apply(this,arguments)}}(),this.beforeDeleteTip=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"post";return e.stopPropagation(),new Promise(s=>{i.setState({popoverVisible:!1},()=>{var r=a==="post"?i.state.deletePostConfirmConfig:i.state.deletePostGroupConfirmConfig,o=r.title,n=r.content;H.Z.confirm({title:o,content:n,onOk:()=>{s()}})})})},this.handlePopoverVisible=e=>{this.setState({popoverVisible:e})},this.handleAddPostGroup=e=>{e.stopPropagation(),this.setState({popoverVisible:!1},()=>{var a=y.ZP.Organization.getPostGroupNodeInfo({id:this.props.postId});E.WY.get({url:a}).then(s=>{var r=s.data.post_group_level;r==="3"?C.default.warning(this.props.t("setting.isLevel3Tip")):this.props.addPostGroup(this.props.postId,"add")})})},this.handleEditPostGroup=e=>{var a=this.props,s=a.postId,r=a.dataRef;e.stopPropagation(),this.setState({popoverVisible:!1},()=>{this.props.updatePostGroupName(s,r)})},this.handleAddPost=e=>{e.stopPropagation(),this.setState({popoverVisible:!1},()=>{this.props.addPost(this.props.postId,"add",this.props.postId)})},this.sureDeletePostGroup=()=>{var e=this.props,a=e.t,s=e.postId,r=y.ZP.Organization.deletePostGroup({id:s});E.WY.delete({url:r}).then(()=>{C.default.success(a("announcement.deleteSucceed")),this.props.deletePostCbk("success")})},this.handleEditPost=e=>{var a=this.props,s=a.postId,r=a.superiorPostId;e.stopPropagation(),this.setState({popoverVisible:!1},()=>{this.props.addPost(s,"edit",r)})},this.sureDeletePost=()=>{var e=this.props,a=e.t,s=e.postId,r=y.ZP.Organization.deletePost({id:s});E.WY.delete({url:r}).then(o=>{if(o.data.deleted==="false"){var n="",d=JSON.parse(o.data.msg),c=[];for(var u in d)d[u]==="1"&&c.push(u);c.forEach(p=>{switch(p){case"isPostModelAbility":n+="".concat(a("personnelDevelope.isPostModelAbility"),"/");break;case"isPostStudyFunction":n+="".concat(a("personnelDevelope.isPostStudyFunction"),"/");break;case"isPostQualifications":n+="".concat(a("personnelDevelope.isPostQualifications"),"/");break;case"isPostChannel":n+="".concat(a("personnelDevelope.isPostChannel"),"/");break;default:break}});var m=n.lastIndexOf("/");n="".concat(n.substring(0,m),"\uFF0C").concat(a("personnelDevelope.noDelete")),C.default.error(n)}else C.default.success(a("announcement.deleteSucceed")),this.props.deletePostCbk("success")})},this.state={deletePostConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.deletePostTip")},deletePostGroupConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.deletePostGroupTip")},popoverVisible:!1}}renderPopoverDom(l,i){var e=this.props,a=e.type,s=e.userCount,r=e.isOpenThirdOaSync,o=null;return a==="create"?o=t().createElement(Ce.Z,{placement:"bottom",visible:this.state.popoverVisible,onVisibleChange:this.handlePopoverVisible,content:l,trigger:"hover"},t().createElement(x.Z,{className:"tree-node-operate"},t().createElement(X.Z,{iconClass:"icon-icon_morex"}))):s===0&&(o=t().createElement(Ce.Z,{placement:"bottom",title:"",content:i,trigger:"hover"},t().createElement(x.Z,{className:"tree-node-operate"},t().createElement(X.Z,{iconClass:"icon-icon_morex"})))),r&&a==="third_oa_sync"&&(o=null),o}render(){var l=this.props,i=l.t,e=l.isPostGroup,a=l.dataRef,s=t().createElement("div",{className:"tree-node-operate-menu"},t().createElement("div",{onClick:o=>{this.handleCommonDeletePostTip(o)}},i("common.delete"))),r;return e?r=t().createElement("div",{className:"tree-node-operate-menu"},t().createElement("div",{onClick:o=>{this.handleCommonDeletePostTip(o,"postGroup")}},i("common.delete")),t().createElement("div",{onClick:this.handleEditPostGroup},i("common.edit")),t().createElement("div",{onClick:this.handleAddPost},i("setting.addPost")),a.post_group_level&&a.post_group_level!=="3"?t().createElement("div",{onClick:this.handleAddPostGroup},i("setting.addPostGroup")):null):r=t().createElement("div",{className:"tree-node-operate-menu"},t().createElement("div",{onClick:this.handleEditPost},i("common.edit")),t().createElement("div",{onClick:o=>{this.handleCommonDeletePostTip(o)}},i("common.delete"))),t().createElement("div",{className:"tree-node-title"},t().createElement(A.Z,{title:this.props.title},t().createElement("span",{className:"tooltip-span"},this.props.title)),!Ie.Zv.isLingNanPrivate()&&this.renderPopoverDom(r,s))}}Ke.defaultProps={postId:"",isPostGroup:"",title:"",type:"create",deletePostCbk:()=>{},updatePostGroupName:()=>{},addPost:()=>{},addPostGroup:()=>{}};var He=(0,D.Z)()(Ke),Zt=h(81211),Xe=g=>{var l=g.onCustomInput,i=(0,Zt.Z)(g,["onCustomInput"]),e=(0,k.useState)(""),a=(0,q.Z)(e,2),s=a[0],r=a[1],o=()=>{l(s)},n=u=>{var m=u.target.value.trim();r(m)},d=()=>{r(""),setTimeout(()=>{l("")},0)},c=s.length>0?t().createElement(Se.Z,{onClick:d}):t().createElement(be.Z,{onClick:o});return t().createElement(t().Fragment,null,t().createElement(M.Z,(0,R.Z)({value:s,onInput:n,onPressEnter:o,suffix:c},i)))};Xe.defaultProps={onCustomInput:()=>{}};var Ut=(0,k.memo)(Xe),Qe=Ve.Z.TreeNode,kt=g=>({treeData:g.organization.postData,hidePosts:g.organization.hidePosts,activePostId:g.organization.activePostId});class Je extends k.Component{constructor(l){var i;super(l);i=this,this.onSearch=()=>{var e=this.props.organizationType,a=y.ZP.Organization.getPostTree();if(!this.state.searchText||this.state.searchText&&this.state.searchText.trim().length===0){this.setState({searchText:"",isSearch:!1});return}var s={filter_auth:!0,post_name:this.state.searchText,sync_organization:e||""};E.WY.get({url:a,params:s}).then(r=>{this.setState({searchPostResult:r.data.posts,isSearch:!0})})},this.onExpand=(e,a)=>{var s=a.expanded,r=a.node,o=[...this.state.expandedKeys],n=r.props.dataRef.id,d=o.indexOf(n);s?o.push(n):o.splice(d,1),this.setState({expandedKeys:o})},this.onAddPostGroupCbk=e=>{this.setState({showAddPostGroup:!1,editPostGroupName:"",currentOperatePost:""}),e==="success"&&this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!1}})},this.handleCustomInput=e=>{this.setState({searchText:e,isSearch:e.length>0},()=>{this.onSearch()})},this.addPostGroup=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;i.setState({showAddPostGroup:!0,currentOperatePostGroup:e})},this.inputSearchText=e=>{var a=e.target.value;this.setState({searchText:a})},this.treeNodeClick=(e,a)=>{var s=a.node.props.dataRef.id,r=a.node.props.dataRef.type;if(a.node.props.dataRef.post_group_level){var o=[...this.state.expandedKeys],n=o.indexOf(s);n!==-1?o.splice(n,1):o.push(s),this.setState({expandedKeys:o});return}if(this.props.onSelectNode){if(s===this.props.activePostId)return;this.props.dispatch({type:"organization/setActivePost",payload:{postId:e[0],postType:r}})}},this.searchResultClick=(e,a)=>{if(this.props.onSelectNode){if(e===this.props.activePostId)return;this.props.dispatch({type:"organization/setActivePost",payload:{postId:e,postType:a}})}},this.deletePostCbk=e=>{e==="success"&&this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!0}})},this.updatePostGroupName=(e,a)=>{this.setState({showAddPostGroup:!0,editPostGroupName:a.post_name,currentOperatePost:e,currentOperatePostGroup:a.parent_id})},this.addPost=(e,a,s)=>{this.setState({showAddPost:!0,currentOperatePost:e,currentOperatePostGroup:s,addPostType:a})},this.addPostCbk=e=>{this.setState({showAddPost:!1,currentOperatePost:""}),e==="success"&&this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!1}})},this.renderTreeNodes=e=>{var a=this.props,s=a.t,r=a.hidePosts,o=a.isOpenThirdOaSync;return e.map(n=>{var d={postId:n.id,title:r?"".concat(n.post_name):"".concat(n.post_name,"(").concat(n.user_count).concat(s("common.userUnit"),")"),isPostGroup:!!n.post_group_level,superiorPostId:n.parent_id,deletePostCbk:this.deletePostCbk,updatePostGroupName:this.updatePostGroupName,addPost:this.addPost,addPostGroup:this.addPostGroup,type:n.type,dataRef:(0,_.Z)({},n),userCount:n.user_count,isOpenThirdOaSync:o};return n.children?t().createElement(Qe,{className:n.children?"parent-node":"",title:t().createElement(He,d),key:n.id,isLeaf:!1,dataRef:n},this.renderTreeNodes(n.children)):t().createElement(Qe,(0,R.Z)({},n,{className:this.props.activePostId===n.id?"active-node":n.children?"parent-node":"",dataRef:n,key:n.id,isLeaf:!0,title:t().createElement(He,d)}))})},this.renderSearchResult=()=>{var e=this.props,a=e.t,s=e.tabStatus,r=s===void 0?"":s,o=e.hidePosts,n=this.state.searchPostResult.map(d=>t().createElement("div",{className:this.props.activePostId===d.id?"org-tree-search-one active":"org-tree-search-one",key:d.id,onClick:()=>this.searchResultClick(d.id,d.type)},d.post_name,o?"":"(".concat(d.user_count).concat(a("common.userUnit"),")")));return t().createElement("div",{className:"org-tree-search-result",style:r?{height:"calc(100vh - 379px )"}:{}},n)},this.state={searchPostResult:[],isSearch:!1,searchText:"",showAddPostGroup:!1,editPostGroupName:"",currentOperatePost:"",currentOperatePostGroup:void 0,showAddPost:!1,addPostType:"",expandedKeys:[]}}componentDidMount(){this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!0}})}render(){var l=this.props,i=l.t,e=l.tabStatus,a=e===void 0?"":e,s=l.organizationType,r=localStorage.getItem("themeColor")||"#516ae6";return t().createElement("div",{className:"org-tree-container post"},t().createElement(Ut,{className:"org-tree-search",placeholder:i("searchInputPlaceholder.post"),onCustomInput:this.handleCustomInput}),s!=="third_oa_app"?t().createElement("div",{className:"add-post-group",style:{color:r},onClick:()=>this.addPostGroup()},t().createElement(Pe.Z,null)," ",i("setting.addPostGroup")):null,this.state.showAddPostGroup?t().createElement(Nt,{visible:this.state.showAddPostGroup,initValue:this.state.editPostGroupName,postId:this.state.currentOperatePost,superiorPostId:this.state.currentOperatePostGroup,type:this.state.editPostGroupName.length>0?"edit":"add",onAddCbk:this.onAddPostGroupCbk}):null,this.state.isSearch?this.renderSearchResult():t().createElement("div",{className:"post-group-padding-tree",style:a?{height:"calc(100vh - 379px )"}:{}},t().createElement(Ve.Z,{expandedKeys:this.state.expandedKeys,onSelect:this.treeNodeClick,onExpand:this.onExpand,showLine:{showLeafIcon:!1}},this.renderTreeNodes(this.props.treeData))),this.state.showAddPost?t().createElement(Tt,{visible:this.state.showAddPost,type:this.state.addPostType,currentPostId:this.state.currentOperatePost,superiorPostId:this.state.currentOperatePostGroup,onAddCbk:this.addPostCbk}):null)}}Je.defaultProps={onSelectNode:()=>{}};var Ot=(0,K.$j)(kt)((0,D.Z)()(Je)),Na=h(63185),wt=h(9676);class qe extends t().Component{constructor(l){super(l);this.inputGroupName=e=>{this.setState({groupName:e.target.value})},this.cancelAddUserGroup=()=>{this.props.onAddCbk("cancel")},this.saveAddUserGroup=()=>{var e=this.props.t;if(this.state.groupName.trim().length===0){C.default.error(e("setting.addUserGroupTip"));return}var a=this.props.type==="add"?y.ZP.Organization.addUserGroup():y.ZP.Organization.updateUserGroup(),s={access_token:window.localStorage.getItem("token"),name:this.state.groupName,id:this.props.type==="add"?"":this.props.groupId};E.qg.post({url:a,data:s}).then(r=>{r.data.code===0?(this.props.onAddCbk("success"),C.default.success(this.props.type==="add"?e("common.addSuccess"):e("common.editSuccess"))):r.data.msg&&C.default.error(r.data.msg)})};var i=t().createElement(x.Z,{key:"submit",type:"primary",onClick:this.saveAddUserGroup},l.t("common.ok"));this.state={groupName:this.props.initValue,addUserGroupModal:{mask:!0,size:"small",footer:i,onCancel:this.cancelAddUserGroup}}}render(){var l=this.props.t;return t().createElement(re.ZP,(0,R.Z)({},this.state.addUserGroupModal,{visible:this.props.visible,title:this.props.type==="add"?l("common.add"):l("common.edit")}),t().createElement("div",{className:"add-user-group-body"},t().createElement($.Z,null,t().createElement($.Z.Item,{label:l("setting.groupLabel"),className:"add-user-group-label"},t().createElement(M.Z,{placeholder:l("setting.addUserGroupTip"),value:this.state.groupName,onInput:this.inputGroupName,className:"add-user-group-input",maxLength:15})))))}}qe.defaultProps={type:"add",initValue:"",groupId:"",visible:!1,onAddCbk:()=>{}};var xt=(0,D.Z)()(qe),zt=h(37882),Lt=g=>({groupList:g.organization.groupData,activeGroupId:g.organization.activeGroupId,dingDingGroupSearch:g.organization.dingDingGroupSearch});class et extends k.Component{constructor(l){var i;super(l);i=this,this.onSearch=()=>{this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.state.keyword,only_see_me:this.state.only_see_me,changeActive:!1}})},this.clearSearch=()=>{this.setState({keyword:""},()=>{this.saveSearchParam()}),this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:"",only_see_me:this.state.only_see_me,changeActive:!1}})},this.saveSearchParam=()=>{this.props.dispatch({type:"organization/setGroupSearchParams",payload:{keyword:this.state.keyword,only_see_me:this.state.only_see_me}})},this.inputSearchText=e=>{var a=e.target.value;this.setState({keyword:a},()=>{this.saveSearchParam()})},this.addUserGroup=()=>{this.setState({showAddUserGroup:!0,editUserGroupName:""})},this.onAddUserGroupCbk=e=>{this.setState({showAddUserGroup:!1}),e==="success"&&this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.state.keyword,only_see_me:this.state.only_see_me,changeActive:!1}})},this.editGroup=(e,a)=>{var s=this.state.popoverVisible;Object.keys(s).forEach(r=>{s[r]=!1}),this.setState({editUserGroupName:a,currentOperateGroup:e,showAddUserGroup:!0,popoverVisible:s})},this.deleteGroup=function(){var e=(0,V.Z)(Z().mark(function a(s){var r,o;return Z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,Ye.$)("USER_GROUP",s,i.props.t("component.userGroup"));case 2:if(r=d.sent,!r){d.next=5;break}return d.abrupt("return");case 5:o=i.state.popoverVisible,Object.keys(o).forEach(c=>{o[c]=!1}),i.setState({currentOperateGroup:s,popoverVisible:o},()=>{var c=i.state.deleteGroupConfirmConfig,u=c.title,m=c.content;H.Z.confirm({title:u,content:m,onOk:()=>{i.sureDeleteUserGroup()}})});case 8:case"end":return d.stop()}},a)}));return function(a){return e.apply(this,arguments)}}(),this.cancelDeleteUserGroup=()=>{this.setState({currentOperateGroup:""})},this.sureDeleteUserGroup=()=>{var e=this.props.t,a=y.ZP.Organization.deleteUserGroup(),s={access_token:window.localStorage.getItem("token"),groupId:this.state.currentOperateGroup};zt.qg.post({url:a,data:s}).then(r=>{r.data.code===0?(C.default.success(e("cart.deleteSuccess")),this.setState({currentOperateGroup:""}),this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.state.keyword,only_see_me:this.state.only_see_me,changeActive:!0}})):r.data.code===1?this.setState({currentOperateGroup:""}):(C.default.error(r.data.msg?r.data.msg:e("announcement.deleteFailed")),this.setState({currentOperateGroup:""}))})},this.treeNodeClick=e=>{this.props.onSelectNode&&this.props.dispatch({type:"organization/setActiveGroup",payload:{groupId:e}})},this.hanldeVisibleChange=e=>{var a=e.visible,s=e.id;this.setState(r=>({popoverVisible:(0,_.Z)((0,_.Z)({},r.popoverVisible),{},{["".concat(s)]:a})}))},this.renderGroupList=()=>{var e=this.props,a=e.t,s=e.tabStatus,r=s===void 0?"":s;if(!this.props.groupList)return null;var o=localStorage.getItem("themeColor")||"#516ae6",n=this.props.groupList.map(d=>{var c=t().createElement("div",{className:"org-group-operate-menu"},t().createElement("div",{className:"menu_more",onClick:u=>{u.stopPropagation(),this.editGroup(d.id,d.group_name)}},a("common.edit")),t().createElement("div",{className:"menu_more",onClick:u=>{u.stopPropagation(),this.deleteGroup(d.id)}},a("common.delete")));return t().createElement("div",{className:this.props.activeGroupId===d.id?"org-group-tree-one active":"org-group-tree-one",style:this.props.activeGroupId===d.id?{color:o}:{},key:d.id,onClick:u=>this.treeNodeClick(d.id,u)},t().createElement(A.Z,{title:"".concat(d.group_name,"(").concat(d.user_count).concat(a("common.userUnit"),")"),key:d.id},t().createElement("span",null,d.group_name,"(",d.user_count,a("common.userUnit"),")")),t().createElement(Ce.Z,{placement:"bottom",title:"",content:c,visible:this.state.popoverVisible[d.id]||!1,onVisibleChange:u=>this.hanldeVisibleChange({visible:u,id:d.id}),trigger:"hover"},t().createElement(x.Z,{className:"org-group-tree-operate-icon"},t().createElement(X.Z,{iconClass:"icon-icon_morex"}))))});return t().createElement("div",{className:"org-group-tree-list",style:r?{height:"calc(100vh - 411px )"}:{}},n)},this.searchMyCreate=e=>{this.setState({only_see_me:e.target.checked},()=>{this.onSearch(),this.saveSearchParam()})},this.state={keyword:"",only_see_me:!1,showAddUserGroup:!1,editUserGroupName:"",currentOperateGroup:"",deleteGroupConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.removeGroupTip")},popoverVisible:{}}}componentDidMount(){this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.state.keyword,only_see_me:this.state.only_see_me,changeActive:!0}})}componentWillUnmount(){this.props.dispatch({type:"organization/resetActiveId"})}render(){var l=this.props.t,i=this.state.keyword.length>0?t().createElement(Se.Z,{onClick:this.clearSearch}):t().createElement(be.Z,{onClick:this.onSearch});return t().createElement("div",{className:"org-tree-container group"},t().createElement(M.Z,{className:"org-tree-search",value:this.state.keyword,placeholder:l("searchInputPlaceholder.userGroup"),onInput:this.inputSearchText,onPressEnter:this.onSearch,suffix:i}),t().createElement("div",{className:"group-button"},t().createElement("div",{className:"add-user-group",onClick:this.addUserGroup},t().createElement(Pe.Z,null)," ",l("setting.addUserGroup")),t().createElement("div",null,t().createElement(wt.Z,{checked:this.state.only_see_me,onChange:this.searchMyCreate},l("common.myCreated")))),this.state.showAddUserGroup?t().createElement(xt,{visible:this.state.showAddUserGroup,initValue:this.state.editUserGroupName,groupId:this.state.currentOperateGroup,type:this.state.editUserGroupName.length>0?"edit":"add",onAddCbk:this.onAddUserGroupCbk}):null,this.renderGroupList())}}et.defaultProps={onSelectNode:()=>{}};var Dt=(0,K.$j)(Lt)((0,D.Z)()(et)),Te=ze.Z.TabPane;class tt extends k.Component{constructor(){super(...arguments);this.state={activeKey:"dept"},this.changeTab=l=>{var i=this.props.changeDisplayType;i&&typeof i=="function"&&i({activeTab:l})},this.handleDeptNode=(l,i)=>{this.props.onSelectNode({type:"dept",activeId:l,title:i})},this.handlePostNode=l=>{this.props.onSelectNode({type:"post",activeId:l,title:""})},this.handleGroupNode=l=>{this.props.onSelectNode({type:"group",activeId:l,title:""})},this.activeKeyChange=l=>{var i=this.props.changeDisplayType;i&&typeof i=="function"&&i({activeTab:l}),this.setState({activeKey:l})}}render(){var l=this.props,i=l.organizationType,e=l.onFinishSync,a=l.tabStatus,s=a===void 0?"":a,r=l.qyShield,o=l.isOpenThirdOaSync,n=this.state.activeKey,d=n===void 0?"":n;return t().createElement("div",{className:"orgbox-container"},t().createElement(ze.Z,{activeKey:d,onChange:this.activeKeyChange,centered:!0},t().createElement(Te,{tab:this.props.t("setting.deptLabel"),key:"dept"},t().createElement(Pt,{onSelectNode:this.handleDeptNode,organizationType:i,onFinishSync:e,tabStatus:s,isOpenThirdOaSync:o})),r==="false"?t().createElement(Te,{tab:this.props.t("setting.postLabel"),key:"post"},t().createElement(Ot,{onSelectNode:this.handlePostNode,tabStatus:s,organizationType:i,isOpenThirdOaSync:o})):null,t().createElement(Te,{tab:this.props.t("setting.groupLabel"),key:"group"},t().createElement(Dt,{onSelectNode:this.handleGroupNode,tabStatus:s}))))}}tt.defaultProps={onSelectNode:()=>{}};var _t=g=>{var l=g.user;return{qyShield:l.qyShield}},At=(0,K.$j)(_t)((0,D.Z)()(tt)),Ne=h(93485),at=h(90631),st=h(57119),Gt=h(3255),Mt=h(13656),Za=h(77576),Vt=h(59314),$t=h(54681),Ft=h(24144),fe=h(26885);class rt extends t().Component{constructor(l){var i;super(l);i=this,this.onUploadChange=a=>{var s=a.fileList,r=s.length>0?s[0].url:"";this.checkFaceImg("".concat(r),()=>{this.setState({imageUrl:r})})},this.onSaveEditUserField=()=>{var a=this.state,s=a.editField,r=a.imageUrl,o=a.qyWeChatVo;Object.keys(s).forEach(I=>{typeof s[I].value=="string"&&(s[I].value=(0,z.fy)(s[I].value))});var n=this.props,d=n.status,c=n.t,u=/^[\w]{15,18}$/,m=/^[0-9-]+$/,p=/\b[\w.%+-]+@[\w.-]+\.[a-zA-Z]{2,6}\b/,f=!1,w=[],N="",b=d==="true"?3:2;if(Object.keys(s).forEach((I,O)=>{O>b&&w.push({column_key:I,extend_value:s[I].value}),s[I].title==="\u8EAB\u4EFD\u8BC1\u53F7"?(N=(0,z.fy)(s[I].value),(0,z.fy)(s[I].value)!==""&&!s[I].value.match(u)&&(s[I].error="\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u8EAB\u4EFD\u8BC1\u53F7",f=!0)):s[I].title==="\u624B\u673A\u53F7"?(0,z.fy)(s[I].value)!==""&&!s[I].value.match(m)&&(s[I].error="\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",f=!0):s[I].title==="\u59D3\u540D"&&d==="true"&&(0,z.fy)(s[I].value)===""&&(s.user_name.error="\u8BF7\u8F93\u5165\u59D3\u540D",f=!0),(0,z.fy)(s.email.value)!==""&&!s.email.value.match(p)&&(s.email.error="\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1",f=!0)}),this.setState({editField:s}),!f){var v=y.ZP.Organization.setUserFieldValue(),S=this.props.userInfo,U={user_id:S.user_id,extend_list:w,face_url:r,mobile:s.mobile.value,login_email:s.email.value,reports_to:s.reports_to.value,qy_we_chat_vo:o};d==="true"&&Object.assign(U,{user_name:s.user_name.value}),E.WY.post({url:v,data:U}).then(I=>{if(I.data.code===0){this.props.onOk();var O=localStorage.isSubsidyEnterprise==="true"&&N;if(O){this.setSubsidyPhoto(N,r);return}C.default.success("\u7F16\u8F91\u6210\u529F")}else I.data.code===1&&I.data.msg==="enterpriseapi.574013"&&C.default.warn(c("component.supervisorErrorTip"))})}},this.cancelEditUserField=()=>{this.props.onCancel()},this.handleInput=(a,s)=>{var r=a.target.value;(s==="mobile"||s==="email")&&(r=r.trim());var o=this.state.editField;o[s].value=r,o[s].error="",this.setState({editField:o})},this.checkFaceImg=(a,s)=>{var r=this.props.t,o=y.ZP.Organization.checkImgFace(),n={type:0,imageUrl:a};E.WY.post({url:o,data:n}).then(d=>{d.status===200&&d.data&&d.data.result==="true"&&s()}).catch(d=>{if(d.response){var c=d.response.data.code;c==="enterpriseapi.568007"&&H.Z.error({title:r("faceImageModalInfo.title"),content:t().createElement("div",null,t().createElement("div",null,r("faceImageModalInfo.contentTitle"),": "),t().createElement("div",null,"1. ",r("faceImageModalInfo.contentTip1")),t().createElement("div",null,"2. ",r("faceImageModalInfo.contentTip2"))),width:600,okText:r("localStorage.onKnow")})}})},this.handleSwitch=a=>{a?this.setState({type:""}):this.setState({type:"crop"})},this.setSubsidyPhoto=function(){var a=(0,V.Z)(Z().mark(function s(r,o){var n,d,c;return Z().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=y.ZP.subsidyGz.setSubsidyPhoto(),d=(0,_.Z)({ercunPhotoUrl:o,cardNo:r},$t.Z),m.next=4,E.WY.post({url:n,data:d});case 4:c=m.sent,c.data.returnCode==="0"?C.default.success("\u7F16\u8F91\u6210\u529F\uFF0C\u5E7F\u5DDE\u76D1\u7BA1\u5E73\u53F0\u7167\u7247\u66F4\u65B0\u6210\u529F"):C.default.success("\u7F16\u8F91\u6210\u529F");case 6:case"end":return m.stop()}},s)}));return function(s,r){return a.apply(this,arguments)}}(),this.handleSelectWx=()=>{var a=this.props.user,s=[this.state.editField.reports_to.value.sync_user_id];(0,fe.Sk)({userIds:s,mode:"single"}).then(r=>{(0,fe.$f)({result:r,user:a,rangeType:"onlyDeptUser",hasDefault:!1}).then(o=>{var n=o.qyWeChatVo,d=o.rangeList;this.setState({qyWeChatVo:n},()=>{this.handleSelectSupervisor(d,!1)})})}).catch(()=>{this.setState({orgDialogVisible:!1})})},this.handleOrg=a=>{var s=localStorage.getItem("authorityType"),r=this.props.user.loginMode;a&&r==="WE_COM"&&s==="1"?this.handleSelectWx():this.setState({orgDialogVisible:a})},this.handleSelectSupervisor=function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=a.user,o=r===void 0?[]:r,n=i.state.editField,d=o[0]||{},c=d.name,u=d.id,m=d.unionid,p=d.user_id,f=d.source_type;n.reports_to.value={name:c,id:u,sync_user_id:m||p,sync_source_type:f,user_id:p,source_type:f},s||(delete n.reports_to.value.id,n.reports_to.value.name=n.reports_to.value.sync_user_id),i.setState({orgDialogVisible:!1,editField:n})};var e=t().createElement(x.Z,{key:"submit",type:"primary",onClick:this.onSaveEditUserField},l.t("common.ok"));this.state={addUserFieldModal:{mask:!0,size:"small",footer:e,onCancel:this.cancelEditUserField},qyWeChatVo:"",editField:{},imageUrl:"",type:"crop",orgDialogVisible:!1}}componentDidUpdate(l){if(l.visible!==this.props.visible&&this.props.visible){var i=this.props,e=i.userInfo,a=i.t,s={mobile:{error:"",value:e.mobile||"",title:a("setting.phoneLabel")},email:{error:"",value:e.login_email||"",title:a("marketing.loginEmail")},reports_to:{error:"",value:e.reports_to?(0,_.Z)((0,_.Z)({},e.reports_to),{},{user_id:e.reports_to.sync_user_id,source_type:e.reports_to.sync_source_type}):{},title:a("component.directSupervisor")}};this.props.status==="true"&&(s.user_name={error:"",value:e.user_name||"",title:a("common.userName")}),e.extend_list.forEach(r=>{s[r.column_key]={error:"",value:r.extend_value||"",title:r.column_value||""}}),this.setState({editField:s,imageUrl:e.face_url||""})}}render(){var l=this.props,i=l.t,e=l.userInfo,a=l.status,s=this.state,r=s.editField,o=s.imageUrl,n=s.type,d=s.orgDialogVisible,c=e.is_auth_email,u=e.is_auth_mobile,m=e.login_email;return!r.mobile&&!r.email||a==="true"&&!r.user_name?null:t().createElement("div",null,t().createElement(re.ZP,(0,R.Z)({},this.state.addUserFieldModal,{visible:this.props.visible,title:i("setting.userFieldInfo")}),t().createElement("div",{className:"edit-user-field"},t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("common.userName"),":"),t().createElement("div",{className:"field-item-value"},t().createElement(ee.Z,{type:e.source_type,value:e.user_id,name:e.user_name,dataType:"userName"}))),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("personal.jobNumber"),":"),t().createElement("div",{className:"field-item-value"},e.job_number)),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("common.department"),":"),t().createElement("div",{className:"field-item-value"},t().createElement(ae.Z,{list:e.leaf_department_ids,nameList:e.department_names,sourceType:e.source_type,displayAll:!1}))),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("component.directSupervisor"),":"),t().createElement("div",{className:"field-item-value"},t().createElement(Re.Z,{visible:d,title:i("component.chooseSupervisor"),onlyUser:!0,single:!0,initData:{user:r.reports_to.value.id?[r.reports_to.value]:[]},onOk:this.handleSelectSupervisor,onCancel:()=>this.handleOrg(!1)}),t().createElement("div",{className:"direct-supervisor-box"},t().createElement("div",{className:"direct-supervisor-box-text"},t().createElement(ee.Z,{type:r.reports_to.value.sync_source_type,value:r.reports_to.value.sync_user_id,name:r.reports_to.value.name,dataType:"userName"})),t().createElement(x.Z,{className:"direct-supervisor-box-btn",icon:t().createElement(Pe.Z,null),onClick:()=>this.handleOrg(!0)},i("component.chooseSupervisor"))))),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("component.belongPost"),":"),t().createElement("div",{className:"field-item-value"},e.post_names?e.post_names.join("\uFF0C"):"")),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label"},i("setting.facePhoto"),":"),t().createElement("div",{className:"field-item-value"},t().createElement("div",{style:{marginBottom:"7px"}},t().createElement(Vt.Z,{defaultChecked:!1,onChange:this.handleSwitch}),t().createElement("span",{className:"item-margin"},i("resourceLibrary.originUpload"))),t().createElement("div",{className:"upload-avatar"},t().createElement(Ft.G2,{onUploadedListChange:this.onUploadChange,fileList:o?[{url:o}]:[],clip:n,changeTip:"\u91CD\u65B0\u4E0A\u4F20",uploadConfig:{listType:"picture-card",accept:"jpeg, jpg, png",maxCount:1},size:{value:2,unit:"mb"},imageContainerClassName:"upload_img_container",imgCropConfig:{isShowMsg:!1,widthScale:5,heightScale:7}}),t().createElement("p",{className:"tips"},"\u652F\u6301.jpg/.jpeg/.png")))),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label required phone"},i("setting.userPhone"),":"),t().createElement("div",{className:"field-item-value"},t().createElement(M.Z,{disabled:u===1||Ie.Zv.isLingNanPrivate(),placeholder:"",value:r.mobile.value,maxLength:16,onInput:p=>this.handleInput(p,"mobile")}),r.mobile&&r.mobile.error&&t().createElement("p",{className:"field-item-value-tip"},r.mobile.error))),t().createElement("div",{className:"field-item"},t().createElement("div",{className:"field-item-label phone"},i("marketing.loginEmail"),":"),t().createElement("div",{className:"field-item-value"},t().createElement(M.Z,{disabled:c===1,placeholder:"",value:r.email.value,onInput:p=>this.handleInput(p,"email")}),r.email&&r.email.error&&t().createElement("p",{className:"field-item-value-tip"},r.email.error))),e.extend_list?e.extend_list.map(p=>t().createElement("div",{className:"field-item",key:p.column_value},t().createElement("div",{className:"field-item-label"},p.column_value,":"),t().createElement("div",{className:"field-item-value"},t().createElement(M.Z,{placeholder:"\u8BF7\u8F93\u5165".concat(p.column_value),value:r[p.column_key]?r[p.column_key].value:"",maxLength:60,onInput:f=>this.handleInput(f,p.column_key)}),r[p.column_key]&&r[p.column_key].error&&t().createElement("p",{className:"field-item-value-tip"},r[p.column_key].error)))):null)))}}rt.defaultProps={visible:!1,onOk:()=>{},onCancel:()=>{}};var Rt=g=>{var l=g.user;return{user:l,appType:l.appType}},Wt=(0,K.$j)(Rt)((0,D.Z)()(rt)),Ze=h(42706),jt=h(70775),Bt=h(67222),Ue=h(17215),le=h(38642),Yt=M.Z.Search,ye=me.Z.Option,F={pageNumber:1,pageSize:20},Kt=g=>({modules:g.user.modules,appType:g.user.appType,qyShield:g.user.qyShield,appId:g.user.appId});class Ht extends k.Component{constructor(l){var i;super(l);i=this,this.getUserList=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",r=i.props.organizationType;i.setState({loading:!0});var o=y.ZP.Organization.getDeptUser({deptId:e}),n=i.state,d=n.sortInfo,c=n.searchType,u="";d.order&&(d.order==="descend"?u="desc":d.order==="ascend"&&(u="asc"));var m={keyword:a,type:c,page_number:F.pageNumber,page_size:F.pageSize,recursion:!0,filter_auth:!0,sort:u,sync_organization:r||"",userIds:s};r==="weixin"&&c==="user_name"?m.keyword=s===""?a:"":m.keyword=a,E.WY.get({url:o,params:m}).then(p=>{p.data.list&&p.data.list.forEach(f=>{f.timeLabel=(0,z.p6)(f.create_time,"yyyy-MM-dd"),f.recent_login_time?f.lastLoginTime=(0,z.p6)(f.recent_login_time,"yyyy-MM-dd hh:mm:ss"):f.lastLoginTime="",f.extend_list&&f.extend_list.forEach(w=>{f[w.column_key]=w.protect_value})}),i.setState({userList:p.data.list||[],userTotal:p.data.total,loading:!1})})},this.handleSearch=function(){var e=(0,V.Z)(Z().mark(function a(s){var r,o,n,d,c,u,m,p,f;return Z().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(r=i.props,o=r.appType,n=r.appId,d=i.state.searchType,c=localStorage.getItem("qyWechatBook"),u="",m=o==="wx_app"&&c==="true"&&n==="9005",!(s&&d==="user_name"&&m)){N.next=18;break}return N.prev=6,N.next=9,(0,Bt.F_)(s);case 9:p=N.sent,f=p.data,f.success&&(u=f.data),N.next=18;break;case 14:N.prev=14,N.t0=N.catch(6),console.error(N.t0),u="";case 18:F.pageNumber=1,i.getUserList(i.props.deptId,s,u);case 20:case"end":return N.stop()}},a,null,[[6,14]])}));return function(a){return e.apply(this,arguments)}}(),this.searchChange=e=>{var a=e.target.value,s=e.type;s==="click"&&this.handleSearch(a)},this.pageChange=e=>{var a=this.mySearch.state.value;F.pageNumber=e,this.getUserList(this.props.deptId,a)},this.pageSizeChange=(e,a)=>{var s=this.mySearch.state.value;F.pageNumber=1,F.pageSize=a,this.getUserList(this.props.deptId,s)},this.importUser=()=>{this.setState({exportUserModalVisible:!0})},this.importWXUser=()=>{this.setState({exportWXUserModalVisible:!0})},this.hideExportUserModal=()=>{this.setState({exportUserModalVisible:!1}),this.getUserList(this.props.deptId)},this.hideExportWXUserModal=()=>{this.setState({exportWXUserModalVisible:!1}),this.getUserList(this.props.deptId)},this.hiddenEditField=()=>{this.setState({showEditField:!1})},this.showEditField=e=>{this.setState({showEditField:!0,currentUser:e})},this.sureEditField=()=>{this.hiddenEditField(),this.getUserList(this.props.deptId)},this.showFaceImg=e=>{this.setState({faceImgUrl:e,faceModalVisible:!0})},this.hideFaceModal=()=>{this.setState({faceModalVisible:!1,faceImgUrl:""})},this.handleChangeSort=(e,a,s)=>{var r=this.state.sortInfo;s.order&&r.order!==s.order&&(F.pageNumber=1,this.setState({sortInfo:s},()=>{this.getUserList(this.props.deptId)}))},this.showResetPasswordModal=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};i.setState({showResetPasswordModal:e,currentUser:a})},this.changeSelectType=e=>{this.setState({searchType:e},()=>{var a=this.mySearch.state.value;this.handleSearch(a)})},this.getPlaceholder=()=>{var e=this.state.searchType,a=this.props.t,s=null;switch(e){case"job_number":s=a("searchInputPlaceholder.jobNumber");break;case"user_name":s=a("searchInputPlaceholder.userName");break;case"login_number":s=a("searchInputPlaceholder.loginBumberBase");break;case"email":s=a("searchInputPlaceholder.emailBase");break;default:s=a("searchInputPlaceholder.mobileNumber");break}return s},this.headerTitle=()=>{var e=this.state,a=e.actions,s=e.status,r=this.props.t;return t().createElement("div",{className:"top-operate-container"},this.props.organizationType!=="third_oa_app"?t().createElement("div",{className:"top-operate-btn-wrapper"},(0,ne.H3)("batchImport",a)&&t().createElement(t().Fragment,null,t().createElement("div",{className:"top-operate-btn"},t().createElement(x.Z,{type:"primary",className:"top-operate-btn-btn",onClick:this.importUser},t().createElement(at.Z,null),r("setting.multipleImport"))),t().createElement("span",{className:"top-operate-btn-tip"},t().createElement(A.Z,{placement:"topLeft",title:r("setting.multipleImportTip")},t().createElement("span",null,t().createElement(st.Z,null)))),s==="true"?t().createElement(t().Fragment,null,t().createElement("div",{className:"top-operate-btn top-operate-btn-wx"},t().createElement(x.Z,{type:"primary",className:"top-operate-btn-btn",onClick:this.importWXUser},t().createElement(at.Z,null),r("setting.synchronousImport"))),t().createElement("span",{className:"top-operate-btn-tip"},t().createElement(A.Z,{placement:"topLeft",title:r("setting.synchImportTip")},t().createElement("span",null,t().createElement(st.Z,null))))):null)):null)},this.toolBarRender=()=>{var e=this.props.t,a=this.state.searchType;return t().createElement("div",{className:"role-container__content__search"},t().createElement(M.Z.Group,{compact:!0},t().createElement(me.Z,{style:{width:"115px",display:"inline-block"},defaultValue:a,onChange:this.changeSelectType},t().createElement(ye,{value:"user_name"},e("searchInputPlaceholder.userNameOp")),t().createElement(ye,{value:"job_number"},e("searchInputPlaceholder.jobNumberOp")),t().createElement(ye,{value:"login_number"},e("searchInputPlaceholder.loginNumber")),t().createElement(ye,{value:"email"},e("searchInputPlaceholder.email"))),t().createElement(Yt,{ref:s=>{this.mySearch=s},className:"top-operate-search",onSearch:this.handleSearch,onChange:this.searchChange,allowClear:!0,width:172,placeholder:e("searchInputPlaceholder.pleaseSelect")})))},this.getUserInfoColumnConfig=(0,V.Z)(Z().mark(function e(){var a,s,r,o,n;return Z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,le.Kb)((0,Ue.h)());case 2:if(a=c.sent,s=(0,q.Z)(a,2),r=s[0],o=s[1],!r){c.next=8;break}return c.abrupt("return");case 8:n=o.data,i.setState({extendFields:n.slice(6)});case 10:case"end":return c.stop()}},e)})),this.getStatus=(0,V.Z)(Z().mark(function e(){var a,s;return Z().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,ie.eD)();case 2:s=o.sent,(s==null||(a=s.data)===null||a===void 0?void 0:a.code)===0&&i.setState({status:s.data.data});case 4:case"end":return o.stop()}},e)})),this.getEnterpriseHandover=(0,V.Z)(Z().mark(function e(){var a,s,r,o,n,d,c,u;return Z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=y.ZP.DdLive.getBlackWhiteList(),s={enterpriseId:localStorage.getItem("enterpriseId"),status:0,type:"handover"},p.next=4,E.WY.get({url:a,params:s});case 4:r=p.sent,o=r.data,n=o.code,d=o.data.list,n===2e5&&(c=d.filter(f=>f.typeName==="handover"),c.length>0&&(u=c[0].whiteList,i.setState({showHandOver:!!(u&&u.length)})));case 7:case"end":return p.stop()}},e)})),this.state={status:!1,userList:[],userTotal:0,exportUserModalVisible:!1,exportWXUserModalVisible:!1,showEditField:!1,currentUser:{},actions:(0,ne.V9)("organization",l.modules),faceModalVisible:!1,faceImgUrl:"",loading:!1,sortInfo:{order:""},showResetPasswordModal:!1,searchType:"user_name",extendFields:[],associateModalVisible:!1,currentRow:{},showHandOver:!1}}componentDidMount(){this.getEnterpriseHandover(),this.getUserInfoColumnConfig(),this.getUserList(1),this.getStatus()}UNSAFE_componentWillUpdate(l){!!l.deptId&&(l.deptId!==this.props.deptId||l.isRefresh!==this.props.isRefresh)&&(F.pageNumber=1,this.getUserList(l.deptId))}componentWillUnmount(){F.pageNumber=1,F.pageSize=20}onAssociateOk(){}showAssociateModal(l){this.setState({currentRow:l},()=>{this.setState({associateModalVisible:!0})})}render(){var l=this.props,i=l.t,e=l.deptId,a=l.tabStatus,s=a===void 0?"":a,r=l.organizationType,o=l.hasRestPermission,n=l.isRefresh,d=this.state,c=d.extendFields,u=d.exportUserModalVisible,m=d.exportWXUserModalVisible,p=d.userList,f=d.showEditField,w=d.currentUser,N=d.actions,b=d.showResetPasswordModal,v=d.status,S=(0,_.Z)((0,_.Z)({},y.XE.INITIAL_PAGINATION),{},{current:F.pageNumber,pageSize:F.pageSize,defaultPageSize:20,total:Number(this.state.userTotal),onChange:this.pageChange,onShowSizeChange:this.pageSizeChange}),U=localStorage.getItem("uid"),I=U==="10"||o==="true",O=[{title:i("common.userName"),dataIndex:"user_name",key:"user_name",width:100,fixed:this.props.appType==="wx_app"?!1:"left",render:(T,P)=>{var L=P.user_id,J=P.source_type;return t().createElement(ee.Z,{type:J,value:L,name:T,dataType:"userName"})}},{title:i("personal.jobNumber"),dataIndex:"job_number",key:"job_number",width:100,render:(T,P)=>{var L=P.job_number;return L||"--"}},{title:i("setting.loginPhoneNumber"),dataIndex:"mobile",key:"id",width:100,render:(T,P)=>{var L=P.mobile;return L||"--"}},{title:i("common.department"),dataIndex:"department_names",key:"department_names",width:150,render:(T,P)=>{var L=P.leaf_department_ids,J=P.source_type,ce=P.department_infos;if(ce){var he=()=>t().createElement(ae.Z,{list:ce,displayAll:!0});return t().createElement(A.Z,{title:he()},t().createElement("div",{className:"cl-text-ellipsis",style:{width:150}},he()))}return t().createElement(A.Z,{title:T},t().createElement(ae.Z,{list:L,nameList:T,sourceType:J,displayAll:!1}))}},{title:i("component.directSupervisor"),dataIndex:"reports_to",key:"reports_to",width:100,render:T=>t().createElement(ee.Z,{type:T.sync_source_type,value:T.sync_user_id,dataType:"userName",name:T.name||"--"})},{title:i("component.belongPost"),dataIndex:"post_names",key:"post_names",width:150,render:T=>{var P=T?T.join("\uFF0C"):"--";return t().createElement(A.Z,{title:P},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},P))}},{title:this.props.t("marketing.loginEmail"),dataIndex:"login_email",key:"login_email",width:150,render:(T,P)=>{var L=P.login_email;return L||"--"}},{title:i("setting.syncTime"),dataIndex:"timeLabel",key:"timeLabel",width:120,render:(T,P)=>{var L=P.timeLabel;return L||"--"}},{title:i("setting.activeStatus"),dataIndex:"active",key:"active",width:120,render:T=>i(T==="true"?"setting.activeLabel":"setting.unActiveLabel")},{title:i("setting.lastLoginTime"),dataIndex:"recent_login_time",key:"recent_login_time",width:130,sorter:!0,sortDirections:["ascend","descend","ascend"],render:(T,P)=>{var L=P.recent_login_time;return L&&(0,z.p6)(L,"yyyy-MM-dd hh:mm:ss")||"--"}},{title:i("setting.facePhoto"),dataIndex:"face_url",key:"face_url",width:80,render:T=>{var P=T?"face-icon":"hide-img";return t().createElement("img",{onClick:()=>this.showFaceImg(T),className:P,src:T,alt:""})}}],te=(0,Ne.Z)(c),de;try{for(te.s();!(de=te.n()).done;){var pe=de.value,ke=function(P){pe.hasOwnProperty(P)&&O.push({title:pe[P],dataIndex:P,key:P,width:150,render:(L,J)=>J[P]||"--"})};for(var G in pe)ke(G)}}catch(T){te.e(T)}finally{te.f()}return O.push({title:this.props.t("common.operate"),width:150,key:"operate",fixed:"right",render:(T,P)=>t().createElement("div",{className:"cl-table__cell-action"},(0,ne.H3)("userEdit",N)&&t().createElement(t().Fragment,null,t().createElement("span",{onClick:()=>this.showEditField(P),className:"cl-pointer"},this.props.t("common.edit")),I&&t().createElement("span",{onClick:()=>this.showResetPasswordModal(!0,P),className:"cl-pointer"},this.props.t("account.resetPasswords"))),this.state.showHandOver?t().createElement("span",{onClick:()=>this.showAssociateModal(P),className:"cl-pointer"},this.props.t("common.associate")):null)}),t().createElement("div",{className:"dept-display-table"},t().createElement(Gt.Z,{isRefresh:n,organizationType:r,title:this.props.deptTitle,deptId:this.props.deptId}),t().createElement("div",{className:"dept-user-table"},t().createElement("div",{className:"dept-user-content-list",style:s?{minHeight:"calc(100vh - 412px"}:{}},t().createElement(ge.f,{key:"dept-table",dataSource:p,columns:O,onChange:this.handleChangeSort,rowKey:T=>T.id,pagination:!1,scroll:{y:"100%",x:"max-content"},loading:this.state.loading,headerTitle:this.headerTitle(),toolBarRender:this.toolBarRender,tableUUID:"58807149-837e-4c65-8f44-f5d4863dde97"})),t().createElement("div",{className:"dept-user-pagination-wrapper"},t().createElement(ue.Z,(0,R.Z)({},S,{className:"dept-user-pagination"})))),u?t().createElement(Ze.Z,{onHideModal:this.hideExportUserModal,exportUserModalVisible:u,groupId:"",deptId:e,organizationType:r}):null,m?t().createElement(Ze.Z,{onHideModal:this.hideExportWXUserModal,exportUserModalVisible:m,groupId:"",from:"wx",deptId:e,organizationType:r}):null,t().createElement(Wt,{visible:f,userInfo:w,onOk:this.sureEditField,onCancel:this.hiddenEditField,status:v}),this.state.associateModalVisible?t().createElement(jt.Z,{visible:this.state.associateModalVisible,onRefresh:()=>{this.setState({associateModalVisible:!1})},record:this.state.currentRow,onCancel:()=>{this.setState({associateModalVisible:!1})}}):null,t().createElement(H.Z,{title:"\u4EBA\u8138",visible:this.state.faceModalVisible,footer:null,onCancel:this.hideFaceModal,className:"face-modal-width"},t().createElement("img",{src:this.state.faceImgUrl,className:"face-img",alt:""})),t().createElement(Mt.Z,{visible:b,hideResetPasswordModal:()=>{this.showResetPasswordModal(!1)},userInfo:w}))}}var Xt=(0,D.Z)()((0,K.$j)(Kt)(Ht)),it=h(48479),j={pageNumber:1,pageSize:20},Qt=g=>({postId:g.organization.activePostId,postType:g.organization.activePostType,appType:g.user.appType});class Jt extends k.Component{constructor(l){var i;super(l);i=this,this.getLeader=e=>{var a=y.ZP.Organization.getPostLeader(),s={postId:e,id:e};E.WY.get({url:a,params:s}).then(r=>{this.setState({postInfo:{id:e,name:r.data.data.depathmentName},leaderList:r.data.data.userList})})},this.getUserList=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!!e){i.setState({loading:!0});var s=i.props.organizationType,r=y.ZP.Organization.getPostUserList({postId:e}),o=i.state,n=o.sortInfo,d=o.searchType,c="";n.order&&(n.order==="descend"?c="desc":n.order==="ascend"&&(c="asc"));var u={user_name:a,type:d,page_number:j.pageNumber,page_size:j.pageSize,filter_auth:!0,sort:c,sync_organization:s||""};E.WY.get({url:r,params:u}).then(m=>{m.data.list&&m.data.list.forEach(p=>{p.timeLabel=(0,z.p6)(p.create_time,"yyyy-MM-dd"),p.recent_login_time?p.lastLoginTime=(0,z.p6)(p.recent_login_time,"yyyy-MM-dd  hh:mm:ss"):p.lastLoginTime="",p.extend_list&&p.extend_list.map(f=>{p[f.column_key]=f.protect_value})}),i.setState({userList:m.data.list||[],userTotal:m.data.total,loading:!1})})}},this.handleSearch=e=>{j.pageNumber=1,this.getUserList(this.props.postId,e)},this.pageChange=e=>{var a=this.mySearch.state.searchValue;j.pageNumber=e,this.getUserList(this.props.postId,a)},this.pageSizeChange=(e,a)=>{var s=this.mySearch.state.searchValue;j.pageNumber=1,j.pageSize=a,this.getUserList(this.props.postId,s)},this.deleteLeader=e=>{this.setState({currentDeleteLeader:e},()=>{var a=this.state.deleteConfirmConfig,s=a.title,r=a.content;H.Z.confirm({title:s,content:r,onOk:()=>{this.sureDeleteLeader()},onCancel:()=>{this.cancelDeleteLeader()}})})},this.cancelDeleteLeader=()=>{this.setState({currentDeleteLeader:""})},this.sureDeleteLeader=()=>{var e=this.props.t,a=y.ZP.Organization.deletePostLeader(),s={access_token:window.localStorage.getItem("token"),userIds:this.state.currentDeleteLeader,departmentId:this.props.postId,postId:this.props.postId};E.qg.post({url:a,data:s}).then(r=>{if(r.data.code===0){C.default.success(e("cart.deleteSuccess"));var o=[...this.state.leaderList],n=o.findIndex(d=>d.id===this.state.currentDeleteLeader);o.splice(n,1),this.setState({leaderList:o,currentDeleteLeader:""})}})},this.showDeleteUser=()=>{var e=this.props.t;if(this.state.checkedUser.length===0)C.default.warn(e("setting.deleteUserTip"));else{var a=this.state.deleteUserConfirmConfig,s=a.title,r=a.content;H.Z.confirm({title:s,content:r,onOk:()=>{this.sureDeleteUser()}})}},this.cancelDeleteUser=()=>{},this.sureDeleteUser=()=>{var e=this.props.t,a=[...this.state.checkedUser],s=y.ZP.Organization.deleteUserFromPost(),r={access_token:window.localStorage.getItem("token"),postId:this.props.postId,id:this.props.postId,userIds:a.join(",")};E.qg.post({url:s,data:r}).then(o=>{o.data.code===0&&(C.default.success(e("cart.deleteSuccess")),this.getUserList(this.props.postId),this.setState({checkedUser:[]}),this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!1}}))})},this.savePostUser=e=>{var a=e.users.map(o=>o.id),s=y.ZP.Organization.addUserToPost(),r={access_token:window.localStorage.getItem("token"),postId:this.props.postId,id:this.props.postId,userIds:a.join(",")};E.qg.post({url:s,data:r}).then(o=>{o.data.code===0&&(this.getUserList(this.props.postId),this.props.dispatch({type:"organization/getPostTreeData",payload:{changeActive:!1}}))}),this.setState({orgDialogVisible:!1})},this.cancelOrg=()=>{this.setState({orgDialogVisible:!1})},this.renderPostLeader=()=>{var e=this.props.t;if(this.state.leaderList.length!==0){var a=this.state.leaderList.map(s=>t().createElement("span",{className:"post-leader-one",key:s.id},s.name,t().createElement(Fe.Z,{onClick:r=>this.deleteLeader(s.id,r),className:"post-leader-remove"})));return t().createElement("div",{className:"post-leader"},t().createElement("span",{className:"post-leader-label"},e("setting.postCharge"),"\uFF1A"),t().createElement("div",{className:"post-leader-user"},a))}},this.addUser=()=>{this.setState({orgDialogVisible:!0})},this.showFaceImg=e=>{this.setState({faceImgUrl:e,faceModalVisible:!0})},this.hideFaceModal=()=>{this.setState({faceModalVisible:!1,faceImgUrl:""})},this.handleChangeSort=(e,a,s)=>{var r=this.state.sortInfo;s.order&&r.order!==s.order&&(j.pageNumber=1,this.setState({sortInfo:s},()=>{this.getUserList(this.props.postId)}))},this.headerTitle=()=>{var e=this.props.t;return t().createElement("div",{className:"top-operate-container"},t().createElement("div",{className:"top-operate-btn-wrapper"},this.props.postType==="create"?t().createElement(x.Z,{type:"primary",className:"add-user-btn",disabled:!this.props.postId,onClick:this.addUser},t().createElement(X.Z,{iconClass:"icon-icon_addx"}),e("setting.addUser")):null,this.props.postType==="create"?t().createElement(x.Z,{type:"default",disabled:!this.props.postId,className:"delete-user-btn",onClick:this.showDeleteUser},t().createElement(X.Z,{iconClass:"icon-icon_delex"}),e("setting.multipleDelete")):null,this.state.orgDialogVisible?t().createElement(Ee.Z,{onOk:this.savePostUser,onCancel:this.cancelOrg,tabs:["user"],visible:this.state.orgDialogVisible,title:e("setting.addUser")}):null))},this.toolBarRender=()=>{var e=this.props.t;return t().createElement(it.Z,{onRef:a=>{this.mySearch=a},onSearch:this.handleSearch,prefixCls:"top-operate-search",placeholder:e("searchInputPlaceholder.userName")})},this.getUserInfoColumnConfig=(0,V.Z)(Z().mark(function e(){var a,s,r,o,n;return Z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,le.Kb)((0,Ue.h)());case 2:if(a=c.sent,s=(0,q.Z)(a,2),r=s[0],o=s[1],!r){c.next=8;break}return c.abrupt("return");case 8:n=o.data,i.setState({extendFields:n.slice(6)});case 10:case"end":return c.stop()}},e)})),this.state={postInfo:{},leaderList:[],userList:[],userTotal:0,orgDialogVisible:!1,deleteConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.deletePostChargeTip")},deleteUserConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.deleteCheckedUser")},currentDeleteLeader:"",checkedUser:[],faceImgUrl:"",faceModalVisible:!1,loading:!1,sortInfo:{order:""},searchType:"user_name",extendFields:[]}}componentDidMount(){this.getUserInfoColumnConfig(),this.getLeader(this.props.postId),this.getUserList(this.props.postId),this.setState({checkedUser:[]})}UNSAFE_componentWillUpdate(l){l.postId!==this.props.postId&&(this.getLeader(l.postId),this.getUserList(l.postId),this.setState({checkedUser:[]}))}render(){var l=this.props,i=l.t,e=l.tabStatus,a=e===void 0?"":e,s=this.state,r=s.sortInfo,o=s.userList,n=s.extendFields,d=(0,_.Z)((0,_.Z)({},y.XE.INITIAL_PAGINATION),{},{defaultPageSize:20,current:j.pageNumber,pageSize:j.pageSize,total:Number(this.state.userTotal),onChange:this.pageChange,onShowSizeChange:this.pageSizeChange}),c={selectedRowKeys:this.state.checkedUser,onChange:b=>{this.setState({checkedUser:b})}},u=[{title:i("common.userName"),dataIndex:"user_name",key:"user_name",width:100,fixed:this.props.appType==="wx_app"?!1:"left",render:(b,v)=>{var S=v.user_name;return S||"--"}},{title:i("personal.jobNumber"),dataIndex:"job_number",key:"job_number",width:100,render:(b,v)=>{var S=v.job_number;return S||"--"}},{title:i("common.department"),dataIndex:"department_names",key:"department_names",width:150,render:(b,v)=>{var S=v.department_infos;if(S){var U=()=>t().createElement(ae.Z,{list:S,displayAll:!0});return t().createElement(A.Z,{title:U()},t().createElement("div",{className:"cl-text-ellipsis",style:{width:150}},U()))}return t().createElement(A.Z,{title:b},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},b?b.join("\uFF0C"):"--"))}},{title:i("component.directSupervisor"),dataIndex:"reports_to",key:"reports_to",width:100,render:b=>b.name||"--"},{title:i("component.belongPost"),dataIndex:"post_names",key:"post_names",width:150,render:b=>t().createElement(A.Z,{title:b},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},b?b.join("\uFF0C"):"--"))},{title:i("marketing.loginEmail"),dataIndex:"login_email",key:"login_email",width:150,render:(b,v)=>{var S=v.login_email;return S||"--"}},{title:i("setting.lastLoginTime"),dataIndex:"recent_login_time",key:"recent_login_time",width:130,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:r&&r.field==="recent_login_time"&&r.order,render:b=>b&&(0,z.p6)(b,"yyyy-MM-dd hh:mm:ss")||"--"},{title:i("setting.facePhoto"),dataIndex:"face_url",key:"face_url",width:80,render:b=>{var v=b?"face-icon":"hide-img";return t().createElement("img",{onClick:()=>this.showFaceImg(b),className:v,src:b,alt:""})}},{title:i("setting.joinTime"),dataIndex:"timeLabel",key:"timeLabel",width:120,render:(b,v)=>{var S=v.timeLabel;return S||"--"}}],m=(0,Ne.Z)(n),p;try{for(m.s();!(p=m.n()).done;){var f=p.value,w=function(v){f.hasOwnProperty(v)&&u.push({title:f[v],dataIndex:v,key:v,width:150,render:(S,U)=>U[v]||"--"})};for(var N in f)w(N)}}catch(b){m.e(b)}finally{m.f()}return u.push({title:i("setting.activeStatus"),dataIndex:"active",key:"active",width:100,fixed:"right",render:b=>i(b==="true"?"setting.activeLabel":"setting.unActiveLabel")}),t().createElement("div",{className:"post-display-table"},t().createElement("span",{className:"post-name"},this.state.postInfo.name),t().createElement("div",{className:"post-user-table"},t().createElement("div",{className:"post-user-content-list",style:a?{minHeight:"calc(100vh - 412px"}:{}},t().createElement(ge.f,{key:"post-table",rowSelection:c,dataSource:o,columns:u,rowKey:b=>b.id,pagination:!1,onChange:this.handleChangeSort,loading:this.state.loading,scroll:{y:"100%",x:"max-content"},headerTitle:this.headerTitle(),toolBarRender:this.toolBarRender,tableUUID:"03c63f0b-5d73-49f6-8c0e-8fc8111a98ee"})),t().createElement("div",{className:"post-user-pagination-wrapper"},t().createElement(ue.Z,(0,R.Z)({},d,{className:"post-user-pagination"})))),t().createElement(H.Z,{title:"\u4EBA\u8138",visible:this.state.faceModalVisible,footer:null,onCancel:this.hideFaceModal,className:"face-modal-width"},t().createElement("img",{src:this.state.faceImgUrl,className:"face-img",alt:""})))}componentWillUnmount(){j.pageNumber=1,j.pageSize=20}}var qt=(0,K.$j)(Qt)((0,D.Z)()(Jt)),ea=h(84391),ta=h(97593),B={pageNumber:1,pageSize:20},aa=g=>({groupId:g.organization.activeGroupId,groupTitle:g.organization.activeGroupTitle,createUserName:g.organization.createUserName,appType:g.user.appType,keyword:g.organization.groupSearch.keyword,only_see_me:g.organization.groupSearch.only_see_me,qyShield:g.user.qyShield,user:g.user});class sa extends k.Component{constructor(l){var i;super(l);i=this,this.getUserList=function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(!!e){i.setState({loading:!0});var r=y.ZP.Organization.getGroupUserList({groupId:e}),o=i.state,n=o.sortInfo,d=o.searchType,c="";n.order&&(n.order==="descend"?c="desc":n.order==="ascend"&&(c="asc"));var u={user_name:a,type:d,page_number:B.pageNumber,page_size:B.pageSize,filter_auth:!0,sort:c,userIds:s};E.WY.get({url:r,params:u}).then(m=>{m.data.list&&m.data.list.forEach(p=>{p.timeLabel=(0,z.p6)(p.create_time,"yyyy-MM-dd"),p.recent_login_time?p.lastLoginTime=(0,z.p6)(p.recent_login_time,"yyyy-MM-dd hh:mm:ss"):p.lastLoginTime="",p.extend_list&&p.extend_list.map(f=>{p[f.column_key]=f.protect_value})}),i.setState({userList:m.data.list||[],userTotal:m.data.total,loading:!1})})}},this.handleSearch=(e,a)=>{var s=a===""?e:"";B.pageNumber=1,this.getUserList(this.props.groupId,s,a)},this.pageChange=e=>{var a=this.mySearch.state.searchValue;B.pageNumber=e,this.getUserList(this.props.groupId,a)},this.pageSizeChange=(e,a)=>{var s=this.mySearch.state.searchValue;B.pageNumber=1,B.pageSize=a,this.getUserList(this.props.groupId,s)},this.showDeleteUser=()=>{var e=this.props.t;if(this.state.checkedUser.length===0)C.default.warn(e("setting.deleteUserTip"));else{var a=this.state.deleteUserConfirmConfig,s=a.title,r=a.content;H.Z.confirm({title:s,content:r,onOk:()=>{this.sureDeleteUser()}})}},this.sureDeleteUser=()=>{var e=this.props.t,a=[...this.state.checkedUser],s=y.ZP.Organization.deleteGroupUser(),r={access_token:window.localStorage.getItem("token"),groupId:this.props.groupId,id:this.props.groupId,userIds:a.join(",")};E.qg.post({url:s,data:r}).then(o=>{o.data.code===0&&(C.default.success(e("cart.deleteSuccess")),this.getUserList(this.props.groupId),this.setState({checkedUser:[]}),this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.props.keyword,only_see_me:this.props.only_see_me,changeActive:!1}}))})},this.saveGroupUser=e=>{var a=this.props.t,s=this.state.qyWeChatVo,r=e.users.map(d=>d.id),o=y.ZP.Organization.addGroupUser(),n={access_token:window.localStorage.getItem("token"),groupId:this.props.groupId,id:this.props.groupId,userIds:r.join(","),qy_we_chat_vo:s};E.qg.post({url:o,data:n}).then(d=>{d.data.code===0?(this.checkAuthUser(e.users),this.getUserList(this.props.groupId),this.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:this.props.keyword,only_see_me:this.props.only_see_me,changeActive:!1}})):C.default.error(a("setting.addUserFail"))}),this.setState({orgDialogVisible:!1})},this.cancelOrg=()=>{this.setState({orgDialogVisible:!1})},this.handleSelectWx=()=>{var e=this.props.user;(0,fe.Sk)({}).then(a=>{(0,fe.$f)({result:a,user:e,hasDefault:!1}).then(s=>{var r=s.qyWeChatVo,o=s.rangeList;this.setState({qyWeChatVo:r},()=>{this.saveGroupUser((0,_.Z)((0,_.Z)({},o),{},{users:o.user}))})})}).catch(()=>{this.setState({orgDialogVisible:!1})})},this.addUser=()=>{var e=localStorage.getItem("authorityType"),a=this.props.user.loginMode;a==="WE_COM"&&e==="1"?this.handleSelectWx():this.setState({orgDialogVisible:!0})},this.showExportUserModal=e=>{this.setState({exportUserModalVisible:!0,exportType:e})},this.hideExportUserModal=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";i.setState({exportUserModalVisible:!1}),e==="success"&&(i.getUserList(i.props.groupId),i.props.dispatch({type:"organization/getGroupTreeData",payload:{keyword:i.props.keyword,only_see_me:i.props.only_see_me,changeActive:!1}}))},this.handleAllChange=()=>{var e=this.state,a=e.userList,s=e.checkedUser;if(a.length===s.length)this.handleRowSelectChange([]);else{var r=[];a.forEach(o=>{r.push(o.id)}),this.handleRowSelectChange(r)}},this.handleRowSelectChange=e=>{var a=this.state.userList;a.length===e.length?this.setState({checkedUser:e}):this.setState({checkedUser:e})},this.showFaceImg=e=>{this.setState({faceImgUrl:e,faceModalVisible:!0})},this.hideFaceModal=()=>{this.setState({faceModalVisible:!1,faceImgUrl:""})},this.handleChangeSort=(e,a,s)=>{var r=this.state.sortInfo;s.order&&r.order!==s.order&&(B.pageNumber=1,this.setState({sortInfo:s},()=>{this.getUserList(this.props.groupId)}))},this.renderExportBtn=()=>{var e=this.props.t,a=[...this.state.checkedUser],s=t().createElement(oe.Z,null,t().createElement(oe.Z.Item,{key:"0",disabled:!a.length},t().createElement("div",{onClick:()=>{a.length&&this.exportBelleUser({all:!1})}},e("common.exportData")+e("common.checked")+e("tutorial.student"))),t().createElement(oe.Z.Item,{key:"0"},t().createElement("div",{onClick:()=>{this.exportBelleUser({all:!0})}},e("common.exportData")+e("common.all")+e("tutorial.student"))));return t().createElement(_e.Z,{overlay:s},t().createElement(x.Z,{type:"primary",icon:t().createElement(ea.Z,null),disabled:!this.props.groupId,style:{marginLeft:"8px"}},e("common.exportData")))},this.exportBelleUser=e=>{var a=e.all,s=a===void 0?!1:a,r=this.props,o=r.groupId,n=r.t,d=[...this.state.checkedUser],c={userGroupId:o,userIds:s?[]:d};(0,ta.N)({page:"exportBelleGroupUsers",props:this.props,query:c,sendType:"post",rest:{},fail:u=>{C.default.error(n(u.msg||u.data.msg||"community.isError"))}})},this.headerTitle=()=>{var e=this.props,a=e.t,s=e.organizationType,r=this.state.whiteList;return t().createElement("div",{className:"top-operate-container"},t().createElement("div",{className:"top-operate-btn-wrapper"},t().createElement(x.Z,{type:"primary",disabled:!this.props.groupId,onClick:this.addUser,className:"top-operate-btn-add"},t().createElement(X.Z,{iconClass:"icon-icon_addx"}),a("setting.addUser")),t().createElement(x.Z,{type:"default",disabled:!this.props.groupId,className:"delete-user-btn",onClick:this.showDeleteUser},t().createElement(X.Z,{iconClass:"icon-icon_delex"}),a("common.delete")),r.belleFlag&&["app","ding"].includes(s)&&this.renderExportBtn()),this.state.orgDialogVisible&&t().createElement(Ee.Z,{onOk:this.saveGroupUser,onCancel:this.cancelOrg,tabs:["user"],visible:this.state.orgDialogVisible,title:a("setting.addUser")}),this.state.exportUserModalVisible?t().createElement(Ze.Z,{onHideModal:this.hideExportUserModal,exportUserModalVisible:this.state.exportUserModalVisible,groupId:this.props.groupId,exportType:this.state.exportType,organizationType:s}):null)},this.toolBarRender=()=>{var e=this.props.t;return t().createElement(it.Z,{onRef:a=>{this.mySearch=a},onSearch:this.handleSearch,prefixCls:"top-operate-search",placeholder:e("searchInputPlaceholder.userName")})},this.getUserInfoColumnConfig=(0,V.Z)(Z().mark(function e(){var a,s,r,o,n;return Z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,le.Kb)((0,Ue.h)());case 2:if(a=c.sent,s=(0,q.Z)(a,2),r=s[0],o=s[1],!r){c.next=8;break}return c.abrupt("return");case 8:n=o.data,i.setState({extendFields:n.slice(6)});case 10:case"end":return c.stop()}},e)})),this.state={userList:[],userTotal:0,orgDialogVisible:!1,deleteUserConfirmConfig:{title:l.t("common.delete"),content:l.t("setting.deleteCheckedUser")},checkedUser:[],exportUserModalVisible:!1,exportType:"",faceImgUrl:"",faceModalVisible:!1,loading:!1,sortInfo:{order:""},searchType:"user_name",extendFields:[],qyWeChatVo:"",whiteList:{belleFlag:(0,le.UI)("BELLE_CUSTOMER_WHITE")}}}componentDidMount(){this.getUserInfoColumnConfig(),this.getUserList(this.props.groupId),this.setState({checkedUser:[]})}UNSAFE_componentWillUpdate(l){!!l.groupId&&l.groupId!==this.props.groupId&&(this.getUserList(l.groupId),this.setState({checkedUser:[]}))}componentWillUnmount(){B.pageNumber=1,B.pageSize=20}checkAuthUser(l){var i=this.props.t,e=this.state.qyWeChatVo,a=[...l],s={},r=!1;e&&(s=JSON.parse(e),s.selectedUserCount>a.length&&(r=!0)),r||C.default.success(i("setting.addUserSuccess"))}render(){var l=this.props,i=l.t,e=l.tabStatus,a=e===void 0?"":e,s=this.state,r=s.sortInfo,o=s.userList,n=s.extendFields,d=s.whiteList,c=(0,_.Z)((0,_.Z)({},y.XE.INITIAL_PAGINATION),{},{defaultPageSize:20,current:B.pageNumber,pageSize:B.pageSize,total:Number(this.state.userTotal),onChange:this.pageChange,onShowSizeChange:this.pageSizeChange}),u={selectedRowKeys:this.state.checkedUser,onChange:this.handleRowSelectChange},m=[{title:i("common.userName"),dataIndex:"user_name",key:"user_name",width:100,fixed:this.props.appType==="wx_app"?!1:"left",render:(v,S)=>{var U=S.user_name,I=S.user_id,O=S.source_type;return t().createElement(ee.Z,{dataType:"userName",value:I,name:U||"--",type:O})}},{title:i("personal.jobNumber"),dataIndex:"job_number",key:"job_number",width:100,render:(v,S)=>{var U=S.job_number;return U||"--"}},{title:i("common.department"),dataIndex:"department_names",key:"department_names",width:150,render:(v,S)=>{var U=S.leaf_department_ids,I=S.source_type,O=S.department_infos;if(O){var te=()=>t().createElement(ae.Z,{list:O,displayAll:!0});return t().createElement(A.Z,{title:te()},t().createElement("div",{className:"cl-text-ellipsis",style:{width:150}},te()))}return t().createElement(A.Z,{title:t().createElement(ae.Z,{sourceType:I,list:U,nameList:v})},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},v?t().createElement(ae.Z,{sourceType:I,list:U,nameList:v||"--"}):"--"))}},{title:i("component.directSupervisor"),dataIndex:"reports_to",key:"reports_to",width:100,render:v=>t().createElement(ee.Z,{type:v.sync_source_type,value:v.sync_user_id,dataType:"userName",name:v.name||"--"})},{title:i("component.belongPost"),dataIndex:"post_names",key:"post_names",width:150,render:v=>t().createElement(A.Z,{title:v},t().createElement("div",{className:"cl-text-ellipsis",style:{width:140}},v?v.join("\uFF0C"):"--"))},{title:i("marketing.loginEmail"),dataIndex:"login_email",key:"login_email",width:150,render:(v,S)=>{var U=S.login_email;return U||"--"}},{title:i("setting.lastLoginTime"),dataIndex:"recent_login_time",key:"recent_login_time",width:130,sorter:!0,sortDirections:["ascend","descend","ascend"],sortOrder:r&&r.field==="recent_login_time"&&r.order,render:v=>v&&(0,z.p6)(v,"yyyy-MM-dd hh:mm:ss")||"--"},{title:i("setting.facePhoto"),dataIndex:"face_url",key:"face_url",width:100,render:v=>{var S=v?"face-icon":"hide-img";return t().createElement("img",{onClick:()=>this.showFaceImg(v),className:S,src:v,alt:""})}},{title:i("setting.joinTime"),dataIndex:"timeLabel",key:"timeLabel",width:150,render:(v,S)=>{var U=S.timeLabel;return U||"--"}}],p=(0,Ne.Z)(n),f;try{for(p.s();!(f=p.n()).done;){var w=f.value,N=function(S){w.hasOwnProperty(S)&&m.push({title:w[S],dataIndex:S,key:S,width:150,render:(U,I)=>I[S]||"--"})};for(var b in w)N(b)}}catch(v){p.e(v)}finally{p.f()}return m.push({title:i("setting.activeStatus"),dataIndex:"active",key:"active",width:150,fixed:"right",render:v=>i(v==="true"?"setting.activeLabel":"setting.unActiveLabel")}),t().createElement("div",{className:"group-display-table"},t().createElement("span",{className:"group-name"},this.props.groupTitle),d.belleFlag&&t().createElement("div",{className:"create-user-name"},"".concat(i("common.creator"),"\uFF1A ").concat(this.props.createUserName||"--")),t().createElement("div",{className:"group-user-table"},t().createElement("div",{className:"group-user-content-list",style:a?{minHeight:"calc(100vh - 412px"}:{}},t().createElement(ge.f,{key:"group-table",rowSelection:u,dataSource:o,columns:m,rowKey:v=>v.id,pagination:!1,onChange:this.handleChangeSort,loading:this.state.loading,scroll:{y:"100%",x:"max-content"},headerTitle:this.headerTitle(),toolBarRender:this.toolBarRender,tableUUID:"95f43025-99f5-4ece-a7d2-f4485339e25e"})),t().createElement("div",{className:"group-user-pagination-wrapper"},t().createElement(ue.Z,(0,R.Z)({},c,{className:"group-user-pagination"})))),t().createElement(H.Z,{title:"\u4EBA\u8138",visible:this.state.faceModalVisible,footer:null,onCancel:this.hideFaceModal,className:"face-modal-width"},t().createElement("img",{src:this.state.faceImgUrl,className:"face-img",alt:""})))}}var ra=(0,K.$j)(aa)((0,D.Z)()(sa));class ot extends t().Component{constructor(l){var i;super(l);i=this,this.getSetting=(0,V.Z)(Z().mark(function e(){var a,s,r,o;return Z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,E.WY.get({url:y.ZP.advancedSetting.getSetting(),params:{page_size:9999,page_number:1}});case 2:a=d.sent,s=a.data,r=!1,o=i.props.t,s.list&&s.list.forEach(c=>{c.action_list&&c.action_list.length>0&&c.action_list.forEach(u=>{u.param&&u.param.keyValue&&u.param.keyValue.length>0&&u.param.keyValue.forEach(m=>{m.columnValue===o("searchInputPlaceholder.mobileOp")&&(r=m.columnKey)})})}),i.setState({isMobile:r});case 8:case"end":return d.stop()}},e)})),this.changeDisplayType=e=>{var a=e.activeTab;this.setState({displayTable:a})},this.onSelectNode=e=>{var a=e.type,s=e.activeId,r=e.title;!s||a==="dept"&&this.setState({activeDeptId:s,activeDeptTitle:r})},this.onFinishSync=()=>{this.setState(e=>({isRefresh:!e.isRefresh}))},this.renderDisplayTable=()=>{var e=this.props,a=e.organizationType,s=e.tabStatus,r=s===void 0?"":s,o=e.hasRestPermission,n=this.state.isMobile;return t().createElement("div",{className:"organization-table-container"},this.state.displayTable==="dept"?t().createElement("div",{className:"organization-table-one"},t().createElement(Xt,{deptId:this.state.activeDeptId,deptTitle:this.state.activeDeptTitle,organizationType:a,isRefresh:this.state.isRefresh,tabStatus:r,isMobile:n,hasRestPermission:o})):null,this.state.displayTable==="post"?t().createElement("div",{className:"organization-table-one"},t().createElement(qt,{organizationType:a,tabStatus:r})):null,this.state.displayTable==="group"?t().createElement("div",{className:"organization-table-one"},t().createElement(ra,{organizationType:a,tabStatus:r})):null)},this.state={displayTable:"dept",activeDeptId:1,activeDeptTitle:"",isRefresh:!1,isMobile:!1}}componentDidMount(){this.getSetting()}render(){var l=this.props,i=l.prefixCls,e=l.prefixClsContent,a=l.organizationType,s=l.tabStatus,r=s===void 0?"":s,o=l.isOpenThirdOaSync;return t().createElement("div",{className:i},t().createElement("div",{className:"".concat(i,"__content ").concat(e)},t().createElement("div",{className:"organization-left"},t().createElement(At,{changeDisplayType:this.changeDisplayType,onSelectNode:this.onSelectNode,organizationType:a,isOpenThirdOaSync:o,onFinishSync:this.onFinishSync,tabStatus:r})),t().createElement("div",{className:"organization-right"},this.renderDisplayTable())))}}ot.defaultProps={prefixCls:"organization-container-wrapper",prefixClsContent:"organization-container"};var Q=(0,D.Z)()(ot),nt=h(65971),ia=h(11449),oa=h(4408);function lt(g){var l=g.prefixCls,i=g.t,e=g.appType,a=(0,k.useState)(0),s=(0,q.Z)(a,2),r=s[0],o=s[1],n=(0,k.useState)([]),d=(0,q.Z)(n,2),c=d[0],u=d[1],m=(0,k.useState)(!1),p=(0,q.Z)(m,2),f=p[0],w=p[1],N=(0,k.useState)(!1),b=(0,q.Z)(N,2),v=b[0],S=b[1],U=(0,k.useState)(!1),I=(0,q.Z)(U,2),O=I[0],te=I[1];(0,k.useEffect)(()=>{(0,ie.X$)().then(G=>{S(G.data.data)})},[]),(0,k.useEffect)(()=>((0,ie.c8)().then(function(){var G=(0,V.Z)(Z().mark(function T(P){var L,J,ce,he,Oe,we;return Z().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return L=P.data,J=L.sync_organizes,ce=L.status,localStorage.getItem("loginMode")==="YONGYOU"&&J.push("app"),Y.prev=2,Y.next=5,(0,ie.bo)();case 5:he=Y.sent,Oe=he.data,Oe.code==="200000"&&Oe.data.toString()==="true"&&(te(!0),J.push("third_oa_app")),Y.next=13;break;case 10:Y.prev=10,Y.t0=Y.catch(2),console.warn(Y.t0);case 13:we=J.map(se=>{switch(se){case"ding":return{key:se,tab:(0,le.UI)("REGISTER_LOGIN_DING_TALK_BAIYING")?i("registerLogin.baiyingTalk"):i("registerLogin.dingTalk")};case"third_oa_app":return{key:se,tab:localStorage.getItem("loginMode")==="YONGYOU"?i("registerLogin.yongYou"):i("registerLogin.thirdOa")};case"weixin":return{key:se,tab:i("registerLogin.weChat")};case"app":return{key:se,tab:i("registerLogin.customize")};case"fs":return{key:se,tab:i("registerLogin.feishu")};case"lenovo":return{key:se,tab:i("registerLogin.baiyingTalk")};default:break}return{}}),w(ce==="true"),u(we),de(we[0].key);case 17:case"end":return Y.stop()}},T,null,[[2,10]])}));return function(T){return G.apply(this,arguments)}}()),()=>{g.dispatch({type:"organization/setOrganizationType",payload:{organizationType:""}})}),[]);function de(G){g.dispatch({type:"organization/setOrganizationType",payload:{organizationType:G}}),o(G)}function pe(){return r==="ding"?t().createElement(Q,{organizationType:"ding",hasRestPermission:v,isOpenThirdOaSync:O}):r==="third_oa_app"?t().createElement(Q,{organizationType:"third_oa_app",hasRestPermission:v,isOpenThirdOaSync:O}):r==="weixin"?t().createElement(Q,{organizationType:"weixin",hasRestPermission:v,isOpenThirdOaSync:O}):r==="app"?t().createElement(nt.default,{organizationType:"app",hasRestPermission:v,isOpenThirdOaSync:O}):r==="fs"?t().createElement(Q,{organizationType:"fs",hasRestPermission:v,isOpenThirdOaSync:O}):r==="lenovo"?t().createElement(Q,{organizationType:"lenovo_sync",hasRestPermission:v,isOpenThirdOaSync:O}):null}function ke(){var G=f&&e!=="seeyon_app";return t().createElement("div",{className:"".concat(l,"__content__tabs")},e!=="seeyon_app"?t().createElement("div",{className:"".concat(l,"__content__tabs__content")},r==="ding"&&t().createElement(Q,{organizationType:"ding",tabStatus:G,hasRestPermission:v}),r==="weixin"&&t().createElement(Q,{organizationType:"weixin",tabStatus:G,hasRestPermission:v}),r==="third_oa_app"&&t().createElement(Q,{organizationType:"third_oa_app",tabStatus:G,hasRestPermission:v,isOpenThirdOaSync:O}),r==="app"&&t().createElement(nt.default,{goStudentMenu:!0,organizationType:"app",tabStatus:G,hasRestPermission:v}),r==="fs"&&t().createElement(Q,{organizationType:"fs",tabStatus:G,hasRestPermission:v})):t().createElement("div",{className:"".concat(l,"__content__tabs__content")},t().createElement(Q,{organizationType:"",hasRestPermission:v,isOpenThirdOaSync:O})))}return t().createElement(ia.Z,{pageContainerParams:{header:{title:g.t("setting.studentManage")},tabList:f&&e!=="seeyon_app"?c:[],onTabChange:G=>{de(G)}}},t().createElement(oa.Z,{title:g.t("documentTitle.studentManagement")}),t().createElement("div",{className:l},t().createElement("div",{className:"".concat(l,"__content")},f?ke():pe())))}lt.defaultProps={prefixCls:"multi-organization-container"};var na=(0,K.$j)(g=>({appType:g.user.appType}))((0,D.Z)()(lt))}}]);
