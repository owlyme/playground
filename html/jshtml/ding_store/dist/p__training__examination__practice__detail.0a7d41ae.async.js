(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[6529],{3276:function(X,T,e){"use strict";e.r(T),e.d(T,{default:function(){return Y}});var f=e(62029),w=e(20228),R=e(11382),q=e(34792),k=e(48086),g=e(88986),S=e(12924),t=e.n(S),Z=e(91768),C=e(57068),p=e(80991),_=e(57663),B=e(71577),$=e(76651),Q=e(60211),j=e(30179),y=e(62615),V=e(52670),G=e(7584),A=e(2396);class O extends t().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var a=this.props.handleSubmit;a()},this.renderRandomModeContent=()=>{var a=this.props.values;return t().createElement(p.gN,{component:Q.B,displayType:"Custom",name:"randomQuestion",required:!0,defaultFieldList:a.randomQuestion,validate:i=>(0,j.j)(i,a)})},this.handleCancel=()=>{$.m8.push("/talentedDevelopment/practiceMenu/practice")}}render(){var a=this.props,i=a.values,o=a.isSubmitting,l=o===void 0?!1:o,n=a.t,d=a.tagGroupInit,c={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};return t().createElement(t().Fragment,null,t().createElement(p.l0,{className:"cl-form"},t().createElement("p",{className:"cl-form__sectitle"},n("exam.basicInformation")),t().createElement(p.gN,(0,f.Z)({component:G.Z,name:"title",label:n("exam.itemBankDetailName"),required:!0,type:"text",defaultValue:i.title,validate:v=>(0,A.QK)(v,n("exam.itemBankDetailTitlePlaceholder")),style:{width:"350px"},maxLength:60,placeholder:n("exam.itemBankDetailTitlePlaceholder")},c)),t().createElement(p.gN,(0,f.Z)({label:n("exam.itemBankDetailCover"),component:Q.e,name:"cover",defaultValue:i.cover},c)),t().createElement(p.gN,(0,f.Z)({component:y.QS,displayType:"Custom",name:"tagGroup",label:n("common.detailTag"),defaultFieldList:d},c)),t().createElement("p",{className:"cl-form__divide"}),this.renderRandomModeContent(),t().createElement("p",{className:"cl-form__divide"}),t().createElement(p.gN,{component:y.ww,displayType:"Custom",name:"employeeRange",mode:["part"],orgProps:{title:n("exam.choosePracticeObject")},secTitle:n("exam.itemBankDetailObject"),defaultFieldList:i.employeeRange,validate:V.FI}),t().createElement(y.I,null),t().createElement("footer",{className:"cl-form-fixed-footer"},t().createElement("div",{className:"cl-form-fixed-footer__container"},t().createElement(B.Z,{onClick:this.handleCancel},n("common.cancel")),t().createElement(B.Z,{type:"primary",disabled:l,loading:l,onClick:this.handlePropsSubmit},n("common.release"))))))}}var M=(0,Z.Z)()(O),I=e(10237),x=e(37055),N=e(28531),W=e(4408),E={queryPractice:x.ZP.QuestionBankPractice.queryPractice,add:x.ZP.QuestionBankPractice.addPractice,edit:x.ZP.QuestionBankPractice.editPractice},D="".concat("https://oss.coolcollege.cn","/1826326069121257472.png");class b extends S.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},randomQuestion:{bankQuesitonVoList:[],bankQuesitonInfo:{fillBlankCount:0,multipleCount:0,shortAnswerCount:0,singleCount:0,trueOrFalseCount:0,totalCount:0}},cover:[{uid:"123",url:D,name:"",status:"done"}]},isLoading:!0},this.getDetail=a=>{I.WY.get({url:E.queryPractice(a),params:{id:a}}).then(i=>{var o=i.data,l=o.title,n=o.cover,d=o.visible_range,c=o.department_list,v=o.post_list,r=o.group_list,h=o.user_list,u=o.question_bank_list,s=[];u instanceof Array&&u.length&&u.forEach(m=>{var L=m.fill_blank_count,P=m.multiple_count,J=m.short_answer_count,K=m.single_count,H=m.total_count,U=m.true_or_false_count,F={fillBlankCount:L,shortAnswerCount:J,multipleCount:P,singleCount:K,totalCount:H,trueOrFalseCount:U};s.push((0,g.Z)((0,g.Z)((0,g.Z)({},m),F),{},{data:(0,g.Z)({},F)}))}),this.setState({initialParams:{title:l,cover:[{uid:"123",url:n,name:"",status:"done"}],employeeRange:{rangeType:d==="all"?1:2,rangeList:{dept:c||[],post:v||[],group:r||[],user:h||[]}},randomQuestion:{bankQuesitonVoList:s,bankQuesitonInfo:{fillBlankCount:s.fillBlankCount||0,multipleCount:s.multipleCount||0,shortAnswerCount:s.shortAnswerCount||0,singleCount:s.singleCount||0,trueOrFalseCount:s.trueOrFalseCount||0}}},isLoading:!1})})},this.handleSubmit=(a,i)=>{var o=a.title,l=a.randomQuestion,n=a.employeeRange,d=a.cover,c=a.tagGroup,v={title:o,cover:d[0]?d[0].url:D,question_bank_list:l.bankQuesitonVoList.map(s=>s.id),visible_range:n.rangeType===1?"all":"part",user_ids:n.rangeList.user.map(s=>s.id).join(","),department_ids:n.rangeList.dept.map(s=>s.id).join(","),group_ids:n.rangeList.group.map(s=>s.id).join(","),post_ids:n.rangeList.post.map(s=>s.id).join(",")},r=c?c.tagsNameList:[],h=C.parse(this.props.location.search),u=h.id;I.WY.post({url:u?E.edit(u):E.add(),data:(0,g.Z)((0,g.Z)({},v),{},{id:u})}).then(s=>{var m=this.props.t("common.releaseSuccess");if(u){var L={tags:r,resourceId:u,resourceType:"practice"};(0,N.tB)(L)}else if(r&&r.length){var P={tags:r,resourceId:s.data.id,resourceType:"practice"};(0,N.tB)(P)}k.default.success(m),setTimeout(()=>{i.setSubmitting(!1),this.props.history.push("/talentedDevelopment/practiceMenu/practice")},1e3)}).catch(()=>{i.setSubmitting(!1)})}}componentDidMount(){var a=C.parse(this.props.location.search),i=a.id;i?this.getDetail(i):this.setState({isLoading:!1})}render(){var a=this.props,i=a.prefixCls,o=a.location,l=a.t,n=this.state,d=n.initialParams,c=n.isLoading;if(c)return t().createElement(R.Z,{size:"large"});var v=C.parse(o.search),r=v.id,h={resourceType:"practice",resourceId:r},u=l(r?"documentTitle.editExercises":"documentTitle.addExercises");return t().createElement("div",{className:"practice-add"},t().createElement(W.Z,{title:u}),t().createElement("div",{className:"".concat(i,"__content")},r?t().createElement("h5",null,"".concat(l("common.edit")).concat(l("exam.itemBankDetailTitle"))):t().createElement("h5",null,"".concat(l("common.add")).concat(l("exam.itemBankDetailTitle"))),t().createElement(p.J9,{initialValues:d,onSubmit:this.handleSubmit,render:s=>t().createElement(M,(0,f.Z)({},s,{tagGroupInit:h,isEdit:!!r}))})))}}b.defaultProps={prefixCls:"practice-add"};var Y=(0,Z.Z)()(b)}}]);
