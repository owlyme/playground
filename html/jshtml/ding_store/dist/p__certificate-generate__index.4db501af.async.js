(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[4874],{60667:function($,N,s){"use strict";s.d(N,{Z:function(){return x}});var M=s(33565),y=s(12924),v=s.n(y),k=s(28216);function a(i){var I=i.type,W=i.openid,h=i.from,E=(0,y.useRef)(null);return(0,y.useLayoutEffect)(()=>{h==="vue"?window.parent.WWOpenData.bind(E.current):WWOpenData.bind(E.current)}),v().createElement("ww-open-data",{ref:E,type:I,openid:W})}var U=i=>{var I=i.wxWorkApiFlag,W=i.appType,h=i.from,E=(0,y.useState)(!1),u=(0,M.Z)(E,2),e=u[0],c=u[1];(0,y.useEffect)(()=>{var d=localStorage.getItem("qyWechatBook");(W!=="wx_app"||I||d==="false"||h==="vue"||h==="taro")&&c(!0)},[I,W,h]);var m=(0,y.useCallback)(()=>{var d=i.type,t=i.value,n=i.name,o=n===void 0?"":n;switch(console.warn(i,"props"),d){case"wx_sync":{var f=i.dataType;return t?v().createElement(a,{from:h,type:f,openid:t}):o}default:return o}},[i]),p=()=>{var d=i.name,t=i.dataType,n=localStorage.getItem("qyWechatBook");if(t===""||n==="false")return d;if(h==="vue"||h==="taro")return m();switch(i.appType){case"wx_app":return m();default:return d}};return e?p():i.name};U.defaultProps={value:"",name:"",type:"",dataType:"",from:""};var T=i=>({appType:i.user.appType,wxWorkApiFlag:i.user.wxWorkApiFlag}),x=(0,k.$j)(T)(U)},47983:function($,N,s){"use strict";s.r(N),s.d(N,{default:function(){return h}});var M=s(57361),y=s(9754),v=s.n(y),k=s(12924),a=s.n(k),U=s(91768),T=s(10237);function x(E){var u=E.enterpriseId,e=E.userCertificateId,c=E.accessToken,m="".concat("https://app123492.eapps.dingtalkcloud.com","/incentive-api/v2/").concat(u,"/user_certificate/").concat(e,"/query");return T.WY.get({url:m,params:{access_token:c}})}var i=s(60667),I=s(26885);class W extends a().Component{constructor(u){var e;super(u);e=this,this.init=()=>{var c=window.location.href.match(/enterpriseId=(\w*)/)[1],m=window.location.href.match(/from=(\w*)/)[1];m==="vue"?this.getCertificate():(0,I.kr)(c,()=>{this.getCertificate()})},this.getCertificate=(0,M.Z)(v().mark(function c(){var m,p,d,t,n,o;return v().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return m=window.location.href.match(/enterpriseId=(\w*)/)[1],p=window.location.href.match(/certificateId=(\w*)/)[1],d=window.location.href.match(/accessToken=(\w*)/)[1],t=window.location.href.match(/from=(\w*)/)[1],r.next=6,x({enterpriseId:m,userCertificateId:p,accessToken:d});case 6:n=r.sent,o=n.data,e.setState({content:o,from:t||"",show:!0},()=>{document.getElementById("root").style.minWidth="auto"});case 9:case"end":return r.stop()}},c)})),this.fontRender=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=c.font_size,p=c.font_family,d=c.color,t=c.line_height;return{fontSize:"".concat(m,"px"),fontFamily:"".concat(p,", '\u601D\u6E90\u9ED1\u4F53'"),color:d,lineHeight:t}},this.state={show:!1,content:{},from:""}}componentDidMount(){sessionStorage.setItem("CL_E_APP_ID","9005"),this.init()}setStyle(){var u=this.state.content;if(u.layout_id==="horizontalLeft"||u.layout_id==="horizontalCenter"){var e=window.innerWidth,c=(e-40)/2598,m=2598-c*2598,p=1795-c*1795;return{transform:"scale(".concat(c,")"),margin:"0 -".concat(m,"px -").concat(p,"px 0")}}if(u.layout_id==="verticalLeft"||u.layout_id==="verticalCenter"){var d=window.innerHeight,t=(d-40)/2598,n=2598-t*2598,o=1795-t*1795;return{transform:"scale(".concat(t,")"),margin:"0 -".concat(o,"px -").concat(n,"px 0")}}return{}}render(){var u=this.state,e=u.content,c=u.show,m=u.from;return a().createElement("div",{className:"certificate-generate"},c&&a().createElement("div",{style:this.setStyle(),className:"certificate ".concat(e.layout_id,"-certificate")},a().createElement("img",{className:"certificate-img",src:e.image_url,alt:"picture"}),a().createElement("div",{className:"content ".concat(e.layout_id,"-content")},e.logo_url&&e.display.logo_url.checked&&a().createElement("div",{className:"logo ".concat(e.layout_id,"-logo")},a().createElement("img",{className:"logo-img",src:e.logo_url,alt:""})),e.display.title.checked&&a().createElement("div",{className:"title ".concat(e.layout_id,"-title"),style:this.fontRender(e.display.title.settings)},e.title),a().createElement("div",{className:"user-content ".concat(e.layout_id,"-user-content")},e.display.picture.checked&&a().createElement("img",{className:"picture ".concat(e.layout_id,"-picture"),src:e.picture,alt:""}),a().createElement("div",{className:"user-info ".concat(e.layout_id,"-user-info ").concat(e.display.picture.checked?"haspicture-user-info":"nopicture-user-info")},a().createElement("div",{className:"name-container ".concat(e.layout_id,"-name-container")},a().createElement("h2",{className:"name"},a().createElement(i.Z,{from:m,type:e.sync_source_type,dataType:"userName",value:e.sync_user_id,name:e.user_name})),e.display.department.checked&&a().createElement("p",{className:"department"},e.departments&&e.departments.map((p,d)=>a().createElement("span",{key:d.toString()},a().createElement(i.Z,{from:m,type:p.source_type,dataType:"departmentName",value:p.id,name:p.name}),d<e.departments.length-1&&"/")))),e.display.summary.checked&&e.layout_id==="horizontalLeft"&&a().createElement("p",{className:"name-info-summary",style:this.fontRender(e.display.summary.settings)},e.summary))),e.display.summary.checked&&e.layout_id!=="horizontalLeft"&&a().createElement("div",{className:"summary ".concat(e.layout_id,"-summary"),style:this.fontRender(e.display.summary.settings)},e.summary),a().createElement("div",{className:"certificate-info ".concat(e.layout_id,"-certificate-info")},a().createElement("div",{className:"list ".concat(e.layout_id,"-list"),style:this.fontRender(e.display.custom_field.settings)},e.display.certificate_code.checked&&a().createElement("p",{className:"list-item ".concat(e.layout_id,"-list-item")},e.language_type==="chinese"?"\u8BC1\u4E66\u7F16\u53F7:":"No:"," ",e.certificate_code),e.display.custom_field.field.map((p,d)=>a().createElement("p",{key:d.toString(),className:"list-item ".concat(e.layout_id,"-list-item")},p.name,": ",p.value))),e.display.common_seal.checked&&a().createElement("div",{className:"seal ".concat(e.layout_id,"-seal")},a().createElement("span",{className:"seal-tip"},e.language_type==="chinese"?"\u7B7E\u540D/\u76D6\u7AE0: ":"Stamp: "),a().createElement("div",{className:"stamp ".concat(e.layout_id,"-stamp")},e.common_seal_url&&a().createElement("img",{className:"stamp-img",src:e.common_seal_url,alt:""}),e.company_name&&a().createElement("img",{className:"stamp-img",src:"https://sdn.coolcollege.cn/assets/kuxueyuan/certificate/seal-".concat(e.language_type==="chinese"?"zh":"en",".png"),alt:""}),e.company_name&&a().createElement("div",{className:"stamp-text",style:this.fontRender(e.display.common_seal.settings)},a().createElement("svg",{className:"stamp-svg",xmlns:"http://www.w3.org/2000/svg",version:"1.1",xmlnsXlink:"http://www.w3.org/1999/xlink"},a().createElement("defs",null,a().createElement("path",{id:"stamp",d:"M250,250 m-130,70 a150,150 0 1,1 260,0"})),a().createElement("text",{textAnchor:"middle"},a().createElement("textPath",{fill:e.display.common_seal.settings.color,xlinkHref:"#stamp",startOffset:"50%"}," ",e.company_name))))))))))}}var h=(0,U.Z)()(W)},26885:function($,N,s){"use strict";s.d(N,{mw:function(){return u},kr:function(){return e},w8:function(){return c},Sk:function(){return p},$f:function(){return d}});var M=s(34792),y=s(48086),v=s(88986),k=s(57361),a=s(9754),U=s.n(a),T=s(76651),x=s(78001),i=s(37055),I=s(10237),W=localStorage.getItem("corpId"),h=(t,n)=>{wx.config({beta:!0,debug:!1,appId:t.corpId||localStorage.getItem("corpId"),timestamp:t.timeStamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["openDefaultBrowser","innerSaveWebPerformance"]}),wx.ready(()=>{n&&e()}),wx.error(o=>{console.log("error",o)})},E=(t,n)=>{wx.agentConfig({corpid:t.corpId,agentid:t.agentId,timestamp:t.timeStamp,nonceStr:t.nonceStr,signature:t.signature,jsApiList:["openDefaultBrowser","selectExternalContact","selectEnterpriseContact","selectPrivilegedContact","createChatWithMsg","openEnterpriseChat","openExistedChatWithMsg"],success:()=>{n("success"),(0,T.Qm)()._store.dispatch({type:"user/setWxWorkApiFlag",payload:{wxWorkApiFlag:(0,T.Qm)()._store.getState().user.wxWorkApiFlag+=1}})},fail:o=>{o.errMsg.indexOf("function not exist")>-1&&alert("\u7248\u672C\u8FC7\u4F4E\u8BF7\u5347\u7EA7")}})},u=(t,n,o)=>{window.wx.openEnterpriseChat({userIds:t.join(";"),groupName:n.title,chatId:"",success:function(r){var g=r.chatId;window.wx.invoke("openExistedChatWithMsg",{chatId:g,msg:{msgtype:"link",link:{title:n.title,desc:n.desc,url:n.url,imgUrl:n.imgUrl}}},function(C){C.err_msg=="openExistedChatWithMsg:ok"&&o&&o(g)})},fail:function(r){r.errMsg.indexOf("function not exist")>-1&&alert("\u7248\u672C\u8FC7\u4F4E\u8BF7\u5347\u7EA7")}})},e=function(){var t=(0,k.Z)(U().mark(function n(o){var f,r,g,C,P,w,_=arguments;return U().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return f=_.length>1&&_[1]!==void 0?_[1]:()=>{},r=i.ZP.util.getAppSignature(),g=window.location.href.split("#")[0],C=o||i.ZP.enterpriseId,D.next=6,I.WY.get({url:r,params:{enterprise_id:C,url:g,batch_id:""}});case 6:P=D.sent,w=P.data,E(w,f);case 9:case"end":return D.stop()}},n)}));return function(o){return t.apply(this,arguments)}}(),c=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(navigator.userAgent.toLowerCase().indexOf("wxwork")>-1){var f=i.ZP.util.getCorpSignature(),r=window.location.href.split("#")[0];I.WY.get({url:f,params:{enterprise_id:i.ZP.enterpriseId,url:r,batch_id:o}}).then(g=>{var C=g.data;h(C,n)})}else n&&e()},m=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=CONFIG.util.getSignature(),f=window.location.href;request.get({url:o,params:{corpId:W,url:f,uuid:""}}).then(r=>{var g=r.data;h(g,n)})},p=t=>{var n=t.userIds,o=n===void 0?[]:n,f=t.deptIds,r=f===void 0?[]:f,g=t.mode,C=g===void 0?"multi":g;return new Promise((P,w)=>{window.wx.invoke("selectPrivilegedContact",{fromDepartmentId:0,mode:C,selectedContextContact:0,selectedOpenUserIds:o||[],selectedTickets:r||[]},_=>{_.err_msg==="selectPrivilegedContact:ok"?(typeof _.result=="string"&&(_.result=JSON.parse(_.result)),P(_.result)):_.err_msg==="selectPrivilegedContact:cancel"&&w("cancel")})})},d=t=>{var n=t.type,o=n===void 0?"employeeRange":n,f=t.result,r=f===void 0?{}:f,g=t.user,C=g===void 0?{}:g,P=t.reserveUser,w=P===void 0?[]:P,_=t.rangeType,F=_===void 0?"all":_,D=t.hasDefault,K=D===void 0?!0:D;return new Promise(L=>{var z=r.userList,R=z===void 0?[]:z,H=r.selectedUserCount,O=R||[];if(o==="employeeRange"){var S=C.unionid,A="";!R.length&&H?(K&&(O.push({id:S,unionid:S,openUserId:S}),r.userList=[{id:S,unionid:S,openUserId:S}],r.selectedUserCount+=1),A=!0):A=!1;var Z={dept:[],post:[],group:[],user:O.map(l=>(0,v.Z)((0,v.Z)({},l),{},{unionid:l.openUserId,id:l.openUserId,user_id:l.openUserId,source_type:"wx_sync"})),classes:[],cluster:[]};F==="onlyDeptUser"&&(Z={dept:[],user:O.map(l=>(0,v.Z)((0,v.Z)({},l),{},{unionid:l.openUserId,id:l.openUserId,user_id:l.openUserId,source_type:"wx_sync"}))});var Y={isShowType:A,qyWeChatVo:JSON.stringify(r),rangeList:Z},B=r.selectedUserCount-Z.user.length;B>0&&(A&&K?y.default.warning(x.Z.t("component.selectedErrorTips",{count:B})):y.default.warning(x.Z.t("component.selectedErrorTips2",{count:B}))),L(Y)}if(o==="supervision"){R&&(O.find(l=>l.openUserId===(w[0].unionid||w[0].user_id||w[0].name))&&(r.selectedUserCount-=1),O=O.filter(l=>l.openUserId!==w[0].unionid&&l.openUserId!==w[0].user_id&&l.openUserId!==w[0].name).map(l=>l));var J=O.map(l=>(0,v.Z)((0,v.Z)({},l),{},{unionid:l.openUserId,id:l.openUserId,user_id:l.openUserId,source_type:"wx_sync"})),Q={qyWeChatVo:JSON.stringify(r),user:J},j=r.selectedUserCount-J.length;j>0&&y.default.warning(x.Z.t("component.selectedErrorTips2",{count:j})),L(Q)}if(o==="normal"){var G=O.map(l=>(0,v.Z)((0,v.Z)({},l),{},{unionid:l.openUserId,id:l.openUserId,user_id:l.openUserId,source_type:"wx_sync",qyWeChatVo:JSON.stringify(r)})),X={qyWeChatVo:JSON.stringify(r),user:G},V=r.selectedUserCount-G.length;V>0&&y.default.warning(x.Z.t("component.selectedErrorTips2",{count:V})),L(X)}})}}}]);
