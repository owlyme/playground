(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[1792,7462],{22316:function(ue,M,o){"use strict";o.r(M),o.d(M,{default:function(){return Ue}});var C=o(62029),V=o(20228),N=o(11382),q=o(34792),A=o(48086),m=o(88986),ae=o(12924),r=o.n(ae),he=o(91768),f=o(80991),de=o(57068),z=o(76651),we=o(28216),mt=o(57663),fe=o(71577),pt=o(71194),Ie=o(57016),be=o(57119),S=o(59434),B=o(16381),I={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},J=o(62615),ge=o(52670),Ce=o(86726),H=o(38642),ee=(0,H.UI)("EXAM_BANK_CONFIG"),Fe=["singleCount","multipleCount","fillBlankCount","trueOrFalseCount","shortAnswerCount"],Te=(x,e)=>{if(e)return"".concat(x,"Choose");var a=x.split(""),t=a.reduce((s,n)=>{var i=n.charCodeAt();return i>=65&&i<=90?s+="_".concat(n.toLowerCase()):s+=n,s},"");return"".concat(t,"_choose")},_e=function(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!ee)return e;var s=a.questionsMode,n=a.randomQuestion,i=a.totalScore,d=a.chooseBankCount,l=s===1;return l||(Fe.forEach(u=>{var b=Te(u,t);e[b]=l?"":n.bankQuesitonInfo["".concat(u,"Choose")]}),e.questionBankId=n.bankQuesitonVoList.filter(u=>u.data.isRequired).map(u=>u.id).join(","),e.questionBankIdChoose=n.bankQuesitonVoList.filter(u=>!u.data.isRequired).map(u=>u.id).join(","),e.totalScore=i,e.chooseBankCount=d,e.enterpriseId=window.localStorage.getItem("enterpriseId"),e.accessToken=window.localStorage.getItem("token")),e},Le=(x,e)=>{if(!ee||!e)return x.randomQuestion;var a=x.randomQuestion,t=x.questionBankIdChoose,s=t===void 0?[]:t;return a.bankQuesitonVoList=a.bankQuesitonVoList.map(n=>{if(n.data.isRequired!==void 0)return n;var i=s.map(d=>d.id);return(0,m.Z)((0,m.Z)({},n),{},{data:(0,m.Z)((0,m.Z)({},n.data),{},{isRequired:!i.includes(n.id)})})}),a},Qe=(x,e)=>{var a=e.trueOrFalseCountChoose,t=e.singleCountChoose,s=e.shortAnswerCountChoose,n=e.fillBlankCountChoose,i=e.multipleCountChoose,d=e.chooseBankCount,l=e.questionBankIdChoose,u=e.questionBankId,b=e.isChooseErrorAnalysis,k=function(){var U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return U.map(T=>{var X=T.fill_blank_count,W=T.multiple_count,G=T.short_answer_count,$=T.single_count,L=T.total_count,K=T.true_or_false_count,j=T.name,c={name:j,fillBlankCount:X,shortAnswerCount:G,multipleCount:W,singleCount:$,totalCount:L,trueOrFalseCount:K};return(0,m.Z)((0,m.Z)((0,m.Z)({},T),c),{},{data:(0,m.Z)({},c)})})},E=_.cloneDeep(x),F=k(u),g=k(l),v=E.initialParams.randomQuestion.bankQuesitonInfo,Z=v.singleCount,w=v.multipleCount,D=v.fillBlankCount,P=v.shortAnswerCount,h=v.trueOrFalseCount;return E.initialParams=(0,m.Z)((0,m.Z)({},E.initialParams),{},{chooseBankCount:d,questionBankIdChoose:l,randomQuestion:(0,m.Z)((0,m.Z)({},E.initialParams.randomQuestion),{},{bankQuesitonInfo:(0,m.Z)((0,m.Z)({},E.initialParams.randomQuestion.bankQuesitonInfo),{},{trueOrFalseCountChoose:a||0,singleCountChoose:t||0,shortAnswerCountChoose:s||0,fillBlankCountChoose:n||0,multipleCountChoose:i||0,singleUnitCount:(t||0)+(Z||0),multipleUnitCount:(i||0)+(w||0),trueOrFalseUnitCount:(a||0)+(h||0),fillBlankUnitCount:(n||0)+(D||0),shortAnswerUnitCount:(s||0)+(P||0)}),bankQuesitonVoList:F.concat(g)})}),b&&(E.initialParams.reExam.allowed.viewRule=3),E},Oe=o(7584),Me=o(70075),Ne=o(2396);class Ae extends r().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var e=this.props,a=e.handleSubmit,t=e.t,s=e.values,n=s===void 0?{}:s,i=n.markType,d=i===void 0?{}:i,l=d.checkedValue,u=l===void 0?1:l;u&&u===1?Ie.Z.confirm({icon:r().createElement(be.Z,{style:{color:"#516AE6"}}),title:t("common.tip"),content:t("learning.isModalReplyUploadWaringContent"),okText:t("common.ok"),cancelText:t("common.cancel"),onOk:()=>{a()}}):a()},this.renderQuestionsContent=()=>{var e=this.props.values,a=e.questionsMode===1;return a?this.renderFixedModeContent():this.renderRandomModeContent()},this.renderDrawQuestions=()=>{var e=this.props,a=e.values,t=e.t,s=e.disabled,n=e.canEditFields,i=a.randomQuestion.bankQuesitonVoList&&a.randomQuestion.bankQuesitonVoList.length>0,d=a.questionsMode!==1;if((0,H.UI)("EXAM_BANK_CONFIG"))return null;if(d&&i){var l=this.getAllQuestionsNumber(a.randomQuestion.bankQuesitonInfo);return r().createElement(f.gN,(0,C.Z)({component:S.p7,displayType:"Custom",name:"DrawQuestionsSwitch",label:t("exam.weightedQuestions"),defaultValue:a.isOpenDrawQuestions,questionsNumber:l,disabled:s||n.indexOf("drawQuestionsSwitch")===-1},I))}return null},this.renderWeightInput=()=>{var e=this.props,a=e.values,t=e.disabled,s=e.canEditFields,n=a.questionsMode!==1;return a.isOpenDrawQuestions&&n&&a.randomQuestion.bankQuesitonVoList.length>0?r().createElement(f.gN,(0,C.Z)({component:S.CZ,displayType:"Custom",name:"proportional",required:!0,defaultFieldList:a.proportional,validate:B.RE,disabled:t||s.indexOf("weightInput")===-1},I)):null},this.getAllQuestionsNumber=e=>{var a=e.fillBlankCount,t=e.multipleCount,s=e.shortAnswerCount,n=e.singleCount,i=e.trueOrFalseCount;return a+t+s+n+i},this.renderFixedModeContent=()=>{var e=this.props,a=e.values,t=e.disabled,s=e.canEditFields,n=s===void 0?[]:s,i=e.t;return r().createElement(f.gN,(0,C.Z)({component:S.xE,displayType:"Custom",name:"fixedQuestion",label:i("exam.paper"),required:!0,defaultFieldList:a.fixedQuestion,validate:d=>(0,B.dy)(d,a),disabled:t||n.indexOf("questionsMode")===-1},I))},this.renderBankConfigContent=()=>{var e=this.props,a=e.values,t=e.t,s=e.disabled,n=e.canEditFields,i=a.questionsMode===1;return(0,H.UI)("EXAM_BANK_CONFIG")&&!i?r().createElement(r().Fragment,null,r().createElement(f.gN,(0,C.Z)({component:S.R4,displayType:"Custom",name:"chooseBankCount",label:t("exam.numberOfOptional"),required:!0,validate:d=>(0,B.pm)(d,a.randomQuestion),disabled:s||n.indexOf("questionsMode")===-1},I)),r().createElement(f.gN,(0,C.Z)({component:S.LE,displayType:"Custom",name:"totalScore",label:t("exam.totalScoreOfTest"),defaultFieldList:a.randomQuestion,disabled:s||n.indexOf("questionsMode")===-1},I))):null},this.renderRandomModeContent=()=>{var e=this.props,a=e.values,t=e.disabled,s=e.canEditFields,n=s===void 0?[]:s,i=e.t,d=e.isEdit,l=(0,H.UI)("EXAM_BANK_CONFIG");return r().createElement(f.gN,(0,C.Z)({component:l?S.wr:S.B$,displayType:"Custom",name:"randomQuestion",label:i("exam.bank"),multipleMissedScore:this.props.multipleMissedScore,required:!0,customError:!0,defaultFieldList:Le(a,d),validate:l?u=>(0,B.jx)(u,a):u=>(0,B.cT)(u,a),disabled:t||n.indexOf("questionsMode")===-1,privateCustom:l?"maiTian":""},I))},this.renderFooter=()=>{var e=this.props,a=e.disabled,t=a===void 0?!1:a,s=e.isSubmitting,n=s===void 0?!1:s,i=e.onCancel,d=e.t;return r().createElement("footer",{className:"cl-form-fixed-footer"},r().createElement("div",{className:"cl-form-fixed-footer__container"},t?null:r().createElement(fe.Z,{type:"primary",disabled:n,loading:n,onClick:this.handlePropsSubmit},d("common.release")),r().createElement(fe.Z,{onClick:i},d("common.cancel"))))}}render(){var e=this.props,a=e.values,t=e.disabled,s=t===void 0?!1:t,n=e.canEditFields,i=n===void 0?[]:n,d=e.title,l=e.t,u=e.tagGroupInit,b=(0,Ce.V9)("classify",JSON.parse(localStorage.getItem("modules")));return r().createElement(r().Fragment,null,r().createElement(f.l0,{className:"cl-form"},this.renderFooter(),r().createElement("h1",{className:"cl-form-htitle"},d),r().createElement("p",{className:"cl-form__sectitle"},l("exam.selectPaper")),r().createElement(f.gN,(0,C.Z)({component:S.G2,displayType:"Custom",name:"questionsMode",label:l("exam.paperMode"),required:!0,defaultFieldList:a.questionsMode,disabled:s||i.indexOf("questionsMode")===-1},I)),this.renderQuestionsContent(),this.renderDrawQuestions(),this.renderBankConfigContent(),this.renderWeightInput(),r().createElement(f.gN,(0,C.Z)({component:S.Fz,displayType:"Custom",name:"passLine",label:l("exam.passLine"),required:!0,defaultFieldList:a.passLine,validate:B.QL,disabled:s||i.indexOf("passLine")===-1},I)),r().createElement("p",{className:"cl-form__divide"}),r().createElement("p",{className:"cl-form__sectitle"},l("learning.basicInformation")),r().createElement(f.gN,(0,C.Z)({component:Oe.Z,name:"title",label:l("exam.taskName"),required:!0,type:"text",defaultValue:a.title,validate:k=>(0,Ne.QK)(k,l("exam.taskNamePlaceholder")),style:{width:"350px"},maxLength:60,className:"qa-mission-name-field",placeholder:l("exam.taskNamePlaceholder"),isPreview:s||i.indexOf("title")===-1},I)),r().createElement(f.gN,(0,C.Z)({component:J.C0,displayType:"Custom",name:"dateRange",label:l("exam.validityPeriod"),required:!0,defaultFieldList:a.dateRange,validate:ge.V5,disabled:s||i.indexOf("dateRange")===-1,onlyChangeEndTime:!s&&i.indexOf("dateRange-end")!==-1},I)),r().createElement(f.gN,(0,C.Z)({component:S.Xk,displayType:"Custom",name:"examDuration",label:l("exam.examinationTime"),required:!0,defaultFieldList:a.examDuration,validate:B.$1,disabled:s||i.indexOf("examDuration")===-1},I)),r().createElement(f.gN,(0,C.Z)({name:"classify",label:l("learning.learningProjectAddCategory"),displayType:"Custom",defaultValue:a.classify,classifyName:a.classifyName,component:J.O,unclassified:!0,showAdd:(0,Ce.H3)("add",b)},I)),r().createElement(f.gN,(0,C.Z)({component:Me.Z,name:"summary",label:l("examing.examDesc"),type:"text",required:!1,defaultValue:a.summary,LimitLength:1e3,char:!0,disabled:s,rows:4,placeholder:l("exam.examInstructionLimitPlaceholder")},I)),r().createElement(f.gN,(0,C.Z)({component:J.QS,displayType:"Custom",name:"tagGroup",label:l("common.detailTag"),defaultFieldList:u},I)),r().createElement("p",{className:"cl-form__divide"}),r().createElement(f.gN,{component:J.ww,displayType:"Custom",secTitle:l("common.assignRange"),name:"employeeRange",defaultFieldList:a.employeeRange,mode:["part"],validate:ge.FI,disabled:s||i.indexOf("employeeRange")===-1,qwTicketShow:!0}),r().createElement("p",{className:"cl-form__divide"}),r().createElement("p",{className:"cl-form__sectitle"},l("exam.settings")),r().createElement(f.gN,{component:S.wu,displayType:"Custom",name:"cheatFlag",defaultFieldList:a.cheatFlag,disabled:s||i.indexOf("cheatFlag")===-1,faceKnowDisabled:s}),r().createElement(f.gN,{component:S.Sm,displayType:"Custom",name:"reExam",defaultFieldList:a.reExam,disabled:s||i.indexOf("reExam")===-1,canShowErrorAnalysis:(0,H.UI)("EXAM_BANK_CONFIG")&&a.questionsMode!==1}),r().createElement(f.gN,{component:S.ZU,anonymousMarking:this.props.anonymousMarking,displayType:"Custom",name:"markType",defaultFieldList:a.markType,papers:a.questionsMode===1?a.fixedQuestion.tableList:a.randomQuestion.bankQuesitonInfo,validate:B._F,disabled:s||i.indexOf("markType")===-1}),r().createElement(f.gN,{component:S.Vu,displayType:"Custom",name:"knowledgePoints",defaultFieldList:a.knowledgePoints,disabled:s||i.indexOf("knowledgePoints")===-1}),r().createElement(f.gN,{component:S.Qp,displayType:"Custom",name:"reward",defaultFieldList:a.reward,validate:B.JJ,customError:!0,disabled:s||i.indexOf("reward")===-1}),r().createElement(f.gN,{component:J.i0,displayType:"Custom",name:"supervisor",defaultFieldList:a.supervisor,disabled:s||i.indexOf("supervisor")===-1,createUserId:a.createUserId,qwTicketShow:!0}),r().createElement(J.I,null)))}}var Be=(0,he.Z)()(Ae),Pe=o(4408),O=o(37055),ne=o(10237),Re=o(17994),te=o(6793),ve=o(28531),Ze=o(18681),se={getScoreRule:O.ZP.ExaminationPlanDetail.getScoreRule,getPlanInfo:O.ZP.ExaminationPlanDetail.getPlanInfo,getPrePlanInfo:O.ZP.ExaminationPlanDetail.preGetPlanInfo,add:x=>x?O.ZP.ExaminationPlanDetail.add:ee?O.ZP.ExaminationPlanDetail.preAdd:O.ZP.ExaminationPlanDetail.add,edit:x=>x?O.ZP.ExaminationPlanDetail.edit:ee?O.ZP.ExaminationPlanDetail.preEdit:O.ZP.ExaminationPlanDetail.edit};class ke extends ae.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",dateRange:{startTime:null,endTime:null},createUserId:"",examDuration:"",employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},cheatFlag:{isChecked:!1,switchNum:null,faceRecognition:"off"},reExam:{show_result:!0,isChecked:!0,notAllowed:{end:2},allowed:{reRule:0,record:0,end:5,reNum:1,viewRule:1}},markType:{checkedValue:1,artificialDisabled:!0,fillBlank:{checked:!0,disabled:!1},shortAnswer:{checked:!0,disabled:!1}},reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:0},flunk:{isChecked:!1,score:0},miss:{isChecked:!1,score:0}},questionsMode:1,knowledgePoints:1,passLine:"",fixedQuestion:{id:"",name:"",tableList:{fillBlankCount:0,fillBlankScore:0,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,singleCount:0,singleScore:0,totalCount:0,totalScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},chooseBankCount:"",totalScore:"",randomQuestion:{bankQuesitonVoList:[],bankQuesitonInfo:{fillBlankCount:0,fillBlankScore:0,fillBlankType:1,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,shortAnswerType:1,singleCount:0,singleScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},supervisor:{supervisorUserList:[],isChecked:!0,visibleAuthScope:!0,authScopeIsChecked:!1},summary:"",isOpenDrawQuestions:!1,proportional:[],classify:"",classifyName:""},isLoading:!0,canEditFields:["title","dateRange","examDuration","questionsMode","knowledgePoints","passLine","employeeRange","cheatFlag","reExam","markType","reward","supervisor","drawQuestionsSwitch","weightInput"],taskStatus:""},this.computedCanEditFields=(e,a)=>{var t=new Date().getTime(),s=[],n="";return e>t?(s=["title","dateRange","examDuration","questionsMode","knowledgePoints","passLine","employeeRange","cheatFlag","reExam","markType","reward","supervisor","drawQuestionsSwitch","weightInput"],n="unstarted"):e<=t&&t<=a?(s=["employeeRange","dateRange-end","supervisor"],n="unfinished"):(s=["dateRange-end","supervisor"],n="finished"),{canEditFields:s,taskStatus:n}},this.getScoreRule=()=>{ne.WY.get({url:se.getScoreRule()}).then(e=>{var a=e.data.data.examScore;this.setState(t=>({initialParams:(0,m.Z)((0,m.Z)({},t.initialParams),{},{reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:a&&a[0]?a[0].passScore:0},flunk:{isChecked:!1,score:a&&a[0]?a[0].unPassScore:0},miss:{isChecked:!1,score:a&&a[0]?a[0].missScore:0}}}),isLoading:!1}))})},this.getDetail=e=>{ne.WY.get({url:se.getPlanInfo({examId:e})}).then(a=>{var t=a.data,s=t.title,n=t.begin_time,i=t.end_time,d=t.creator_id,l=t.exam_duration,u=t.is_all_in,b=t.department_list,k=t.post_list,E=t.group_list,F=t.user_list,g=t.cheat_flag,v=t.face_recognition,Z=t.cut_screen_count,w=t.mark_type,D=t.anonymous_marking,P=t.repeat_exam,h=t.answer_parsing,Q=t.re_exam_rule,U=t.re_exam_number,T=t.view_rule,X=t.score_rule,W=t.exam_certificate_id,G=t.exam_certificate_name,$=t.plan_exam_score,L=$===void 0?{}:$,K=t.question_mode,j=t.show_knowledge,c=t.pass_line,$e=t.supervisors,Ve=t.supervisor_paper,qe=t.authority_range,ce=t.bank_quesiton_vo_list,ie=t.fill_blank_count,We=t.fill_blank_unit_score,Ge=t.fill_blank_type,oe=t.short_answer_count,Ke=t.short_answer_unit_score,je=t.short_answer_type,Je=t.single_count,Xe=t.single_unit_score,Ye=t.true_or_false_count,ze=t.true_or_false_unit_score,He=t.multiple_count,et=t.multiple_missed_score,tt=t.multiple_unit_score,ye=t.paper_vo,y=ye===void 0?{}:ye,at=t.summary,Y=t.proportional_exam_vos,nt=t.classify_id,st=t.classify_name,it=t.show_result,p=K===1,re=[];ce instanceof Array&&ce.length&&ce.forEach(R=>{var me=R.fill_blank_count,pe=R.multiple_count,lt=R.short_answer_count,ut=R.single_count,dt=R.total_count,ct=R.true_or_false_count,Se={fillBlankCount:me,shortAnswerCount:lt,multipleCount:pe,singleCount:ut,totalCount:dt,trueOrFalseCount:ct};re.push((0,m.Z)((0,m.Z)((0,m.Z)({},R),Se),{},{data:(0,m.Z)({},Se)}))});var xe=this.computedCanEditFields(n,i),ot=xe.canEditFields,rt=xe.taskStatus,le;Y&&Y.length>0?le=this.computedProportional(Y,re):p?le=[]:le=this.computedQuesiton(re);var Ee={initialParams:{title:s,dateRange:{startTime:(0,te.p6)(n,"yyyy-MM-dd hh:mm:ss"),endTime:(0,te.p6)(i,"yyyy-MM-dd hh:mm:ss")},createUserId:d,examDuration:l,employeeRange:{rangeType:u==="true"?1:2,rangeList:{dept:b||[],post:k||[],group:E||[],user:F||[]}},cheatFlag:{isChecked:!!g,switchNum:Z===-1?null:Z,faceRecognition:v},reExam:{show_result:it==="true",isChecked:P==="true",notAllowed:{end:P==="true"?2:h},allowed:{reRule:Q,record:X,end:P==="true"?h:5,reNum:Q===2?U:1,viewRule:T}},markType:{checkedValue:w===1?1:2,anonymousMarking:D===!0||D==="true",artificialDisabled:p?!(y.fill_blank_count||y.short_answer_count):!(ie||oe),fillBlank:{checked:p?(w===2||w===3)&&y.fill_blank_count:(w===2||w===3)&&ie,disabled:p?!y.fill_blank_count:!ie},shortAnswer:{checked:p?(w===2||w===4)&&y.short_answer_count:(w===2||w===4)&&oe,disabled:p?!y.short_answer_count:!oe}},reward:{certificate:{isChecked:W!=="0",id:W==="0"?"":W,name:G},pass:{isChecked:!!parseInt(L.pass_score),score:parseInt(L.pass_score||0)},flunk:{isChecked:!!parseInt(L.un_pass_score),score:parseInt(L.un_pass_score||0)},miss:{isChecked:!!parseInt(L.miss_score),score:parseInt(L.miss_score||0)}},questionsMode:K,knowledgePoints:j==="show"?1:2,passLine:c,fixedQuestion:{id:p?y.id:"",name:p?y.title:"",tableList:{fillBlankCount:p&&y.fill_blank_count||0,fillBlankScore:p&&y.fill_blank_score||0,multipleCount:p&&y.multiple_count||0,multipleScore:p&&y.multiple_score||0,shortAnswerCount:p&&y.short_answer_count||0,shortAnswerScore:p&&y.short_answer_score||0,singleCount:p&&y.single_count||0,singleScore:p&&y.single_score||0,totalCount:p&&y.total_count||0,totalScore:p&&y.total_score||0,trueOrFalseCount:p&&y.true_or_false_count||0,trueOrFalseScore:p&&y.true_or_false_score||0}},randomQuestion:{bankQuesitonVoList:p?[]:re,bankQuesitonInfo:{fillBlankCount:p?0:ie||0,fillBlankScore:p?0:We||0,fillBlankType:p?1:+Ge||1,multipleCount:p?0:He||0,multipleScore:p?0:tt||0,multipleMissedScore:p?0:et||0,shortAnswerCount:p?0:oe||0,shortAnswerScore:p?0:Ke||0,shortAnswerType:p?1:+je||1,singleCount:p?0:Je||0,singleScore:p?0:Xe||0,trueOrFalseCount:p?0:Ye||0,trueOrFalseScore:p?0:ze}},supervisor:{supervisorUserList:$e,isChecked:Ve==="true",visibleAuthScope:!0,authScopeIsChecked:qe==="true"},summary:at||"",isOpenDrawQuestions:Y&&Y.length>0,proportional:Y&&le||[],classify:nt,classifyName:st},isLoading:!1,canEditFields:ot,taskStatus:rt};ee&&!p?ne.WY.get({url:O.ZP.ExaminationPlanDetail.preGetPlanInfo(),params:{examId:e,enterpriseId:window.localStorage.getItem("enterpriseId")}}).then(R=>{var me=R.data,pe=Qe(Ee,me.data);this.setState(pe)}):this.setState(Ee)})},this.computedQuesiton=e=>e.map(a=>({name:a.name,id:a.id,proportion:0,disabled:a.data.totalCount===0})),this.computedProportional=(e,a)=>a.map((t,s)=>(0,m.Z)((0,m.Z)({},e[s]),{},{disabled:t.data.totalCount===0})),this.getParams=e=>{var a=e.title,t=e.dateRange,s=e.examDuration,n=e.employeeRange,i=e.cheatFlag,d=e.reExam,l=e.markType,u=e.reward,b=e.questionsMode,k=e.knowledgePoints,E=e.passLine,F=e.fixedQuestion,g=e.randomQuestion,v=e.supervisor,Z=e.summary,w=e.isOpenDrawQuestions,D=e.proportional,P=e.classify,h=b===1,Q=0,U=l.checkedValue,T=l.fillBlank,X=l.shortAnswer,W=l.anonymousMarking;U===2?T.checked&&!X.checked?Q=3:!T.checked&&X.checked?Q=4:Q=2:Q=1;var G="",$="",L=localStorage.getItem("authorityType"),K=this.props.user.loginMode;K==="WE_COM"&&!v.qyWeChatVo&&(L==="0"?G=JSON.stringify({userList:v.supervisorUserList.map(c=>(0,m.Z)((0,m.Z)({},c),{},{unionid:c.openUserid||c.unionid||c.user_id||c.name,openUserid:c.openUserid||c.unionid||c.user_id||c.name})),departmentList:[]}):L==="1"&&(G=JSON.stringify({userList:v.supervisorUserList.map(c=>(0,m.Z)((0,m.Z)({},c),{},{unionid:c.user_id||c.unionid||c.name,openUserid:c.user_id||c.unionid||c.name})),selectedUserCount:1,selectedTicket:"0"}))),K==="WE_COM"&&!n.qyWeChatVo&&(L==="0"?$=JSON.stringify({userList:n.rangeList.user.map(c=>({openUserId:c.unionid})),departmentList:[]}):L==="1"&&($=JSON.stringify({userList:n.rangeList.user.map(c=>({openUserId:c.unionid})),selectedUserCount:n.rangeList.user.length,selectedTicket:"0",expiresIn:"604800"})));var j={questionMode:b,showKnowledge:k===1?"show":"hide",passLine:E,totalScore:h?F.tableList.totalScore:"",singleCount:h?"":g.bankQuesitonInfo.singleCount,singleUnitScore:h?"":g.bankQuesitonInfo.singleScore,multipleCount:h?"":g.bankQuesitonInfo.multipleCount,multipleUnitScore:h?"":g.bankQuesitonInfo.multipleScore,multipleMissedScore:h?"":g.bankQuesitonInfo.multipleMissedScore,trueOrFalseCount:h?"":g.bankQuesitonInfo.trueOrFalseCount,trueOrFalseUnitScore:h?"":g.bankQuesitonInfo.trueOrFalseScore,fillBlankCount:h?"":g.bankQuesitonInfo.fillBlankCount,fillBlankUnitScore:h?"":g.bankQuesitonInfo.fillBlankScore,fillBlankType:h?1:g.bankQuesitonInfo.fillBlankType,shortAnswerCount:h?"":g.bankQuesitonInfo.shortAnswerCount,shortAnswerUnitScore:h?"":g.bankQuesitonInfo.shortAnswerScore,shortAnswerType:h?1:g.bankQuesitonInfo.shortAnswerType,questionBankId:h?"":g.bankQuesitonVoList.map(c=>c.id).join(","),answerParsing:d.isChecked?d.allowed.end:d.notAllowed.end,showResult:(0,S.hi)(d),title:(0,te.fy)(a),beginTime:t.startTime,endTime:t.endTime,isAllIn:n.rangeType===1,groupIds:n.rangeList.group.map(c=>c.id).join(","),userIds:n.rangeList.user.map(c=>c.id).join(","),departmentIds:n.rangeList.dept.map(c=>c.id).join(","),postIds:n.rangeList.post.map(c=>c.id).join(","),paperId:h?F.id:"",examDuration:s,cheatFlag:i.isChecked?1:0,faceRecognition:i.faceRecognition,repeatExam:d.isChecked,markType:Q,anonymousMarking:"".concat(W),examCertificateId:u.certificate.isChecked?u.certificate.id:0,passingScore:h?(0,te.Yz)(F.tableList.totalScore*E/100):E,cutScreenCount:i.switchNum!==null?i.switchNum:-1,reExamRule:d.allowed.reRule,reExamNumber:d.allowed.reRule===2?d.allowed.reNum:0,scoreRule:d.allowed.record,viewRule:d.allowed.viewRule,isChooseErrorAnalysis:d.allowed.viewRule===3,examScore:u.pass.isChecked||u.miss.isChecked||u.flunk.isChecked?JSON.stringify({missScore:u.miss.isChecked?u.miss.score:0,passScore:u.pass.isChecked?u.pass.score:0,unPassScore:u.flunk.isChecked?u.flunk.score:0}):JSON.stringify({}),isGetScore:u.pass.isChecked||u.miss.isChecked||u.flunk.isChecked,supervisorPaper:v.isChecked,supervisorId:v.supervisorUserList.map(c=>c.id).join(","),authorityRange:v.authScopeIsChecked,summary:(0,te.fy)(Z),proportional:JSON.stringify(!h&&w?D:[]),classifyId:P||999,qy_we_supe_vo:v.qyWeChatVo||G,qy_we_chat_vo:n.qyWeChatVo||$};return j=_e(j,e),j},this.handleSubmit=(e,a)=>{var t=e.tagGroup,s=e.questionsMode,n=e.randomQuestion,i=e.fixedQuestion,d=t?t.tagsNameList:[],l=s===1,u=this.getParams(e),b=de.parse(z.m8.location.search),k=b.id,E=this.state.taskStatus;ne.qg.post({url:k?se.edit(l)():se.add(l)(),data:(0,m.Z)((0,m.Z)({},u),{},{id:k,planStatus:E})}).then(F=>{a.setSubmitting(!1);var g=F.data,v=g.code,Z=g.msg;if(v===0){if(A.default.success(k?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess")),k){(0,Ze.e)({examId:k,publishStatus:"published"});var w={tags:d,resourceId:k,resourceType:"examTask"};(0,ve.tB)(w)}else if(d&&d.length){var D={tags:d,resourceId:F.data.data,resourceType:"examTask"};(0,ve.tB)(D)}z.m8.push("/training/examination/plan")}else if(v===111){var P=F.data.data.stageError[0].resourceIds,h=[];l||n.bankQuesitonVoList.forEach(U=>{P.includes(U.id)&&h.push(U.name)});var Q=l?"".concat(i.name," ").concat(this.props.t("common.rsNonExistent")):"".concat(h.join(",")," ").concat(this.props.t("common.rsNonExistent"));(0,Re.R)({name:l?"fixedQuestion":"randomQuestion",errMsg:Q,actions:a})}else{if(v===1)return;A.default.error(Z)}}).catch(()=>{a.setSubmitting(!1)})},this.handleCancel=()=>{z.m8.push("/training/examination/plan")}}componentDidMount(){var e=de.parse(z.m8.location.search),a=e.id;a?this.getDetail(a):this.getScoreRule()}render(){var e=this.props,a=e.prefixCls,t=e.preview,s=t===void 0?!1:t,n=e.t,i=this.state,d=i.initialParams,l=i.isLoading,u=i.canEditFields;if(l)return r().createElement(N.Z,{size:"large"});var b=de.parse(z.m8.location.search),k=b.id,E={resourceType:"examTask",resourceId:k},F="".concat(n(s?"common.preview":k?"common.edit":"common.add")).concat(n("exam.examTaskTitle")),g=n(k?"documentTitle.EditTestTask":"documentTitle.AddTestTask");return r().createElement("div",{className:a},r().createElement(Pe.Z,{title:g}),r().createElement("div",{className:"".concat(a,"__content")},r().createElement(f.J9,{initialValues:d,onSubmit:this.handleSubmit,render:v=>r().createElement(Be,(0,C.Z)({},v,{disabled:s,multipleMissedScore:!0,anonymousMarking:!0,tagGroupInit:E,canEditFields:u,title:F,isEdit:!!k,onCancel:this.handleCancel}))})))}}ke.defaultProps={prefixCls:"plan-add"};var De=x=>({user:x.user}),Ue=(0,we.$j)(De)((0,he.Z)()(ke))},42393:function(ue,M,o){"use strict";o.r(M);var C=o(12924),V=o.n(C),N=o(22316),q=()=>V().createElement(N.default,{preview:!0});M.default=q},18681:function(ue,M,o){"use strict";o.d(M,{T:function(){return N},e:function(){return q}});var C=o(37055),V=o(10237);function N(A){var m=A.examId;return V.WY.get({url:C.ZP.ExaminationPlanList.getExaminationInfo({examId:m}),params:{examId:m}})}function q(A){var m=A.examId,ae=A.publishStatus;return V.WY.post({url:C.ZP.ExaminationPlanList.changePublish(),params:{examId:m,publishStatus:ae}})}},17994:function(ue,M,o){"use strict";o.d(M,{R:function(){return V}});var C=o(62615),V=N=>{var q=N.name,A=N.errMsg,m=N.actions;m.setFieldError(q,A),m.setSubmitting(!1),C.I.scrollTo(q)}}}]);
