(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[8961],{11449:function(oe,F,e){"use strict";e.d(F,{Z:function(){return _}});var Z=e(88986),R=e(33565),P=e(12924),y=e.n(P),J=e(3115),x=e(49111),Q=e(19650),D=e(62029),Y=e(57663),a=e(71577),I=e(91768),$=e(28216),H=e(37055),z=e(10237);function E(g){var C=H.ZP.getHelpContentByMenuKey(),f={key:g};return z.WY.get({url:C,params:f})}var M=e(74228),A=e.n(M),B=e(1164),U=e(76466),V=e(38642);class X extends y().Component{constructor(C){var f;super(C);f=this,this.getHelpContentByMenuKey=()=>{var h=this.props.defaultMenuKey;E(h).then(N=>{var b=N.data,T=b.help_url,j=b.video_url;this.setState({videoUrl:j,helpUrl:T})})},this.handleOpenHelpUrl=h=>{if((0,V.ve)()){window.open(h,"_blank");return}B.Z.targetTo({path:h,isExternalLink:!0})},this.handleOpenVideo=function(h){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f.props.t("helpCenter.video");f.setState(b=>({resourcePlayInfo:(0,Z.Z)((0,Z.Z)({},b.resourcePlayInfo),{},{resourceInfo:{originUrl:h,source:{FD:h,OD:h},contentType:"mp4"}}),previewInfo:(0,Z.Z)((0,Z.Z)({},b.previewInfo),{},{title:N,visible:!0,onCancel:f.handleCancelPreview})}))},this.handleCancelPreview=()=>{var h=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,Z.Z)((0,Z.Z)({},h),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:C.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var C=this.state,f=C.helpUrl,h=C.resourcePlayInfo,N=C.previewInfo,b=C.videoUrl,T=this.props.t;return y().createElement("div",{className:A().helpCenter},b&&y().createElement(a.Z,{type:"link",className:A()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(b)},T("helpCenter.video")),f&&y().createElement(a.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(f)},T("helpCenter.tutorial")),y().createElement(U.Z,(0,D.Z)({},h,{previewInfo:N})))}}var K=g=>({defaultMenuKey:g.currentRoute.menuKey});X.defaultProps={defaultMenuKey:""};var se=(0,$.$j)(K)((0,I.Z)()(X));function w(g){var C=g.extra,f=localStorage.getItem("dingPersonnel"),h=sessionStorage.getItem("dingPersonnel");return y().createElement(Q.Z,null,C,f!=="dingPersonnel"&&h!=="dingPersonnel"&&(0,V.eY)("COMMONEXTRA_HELP_CENTER")&&y().createElement(se,null))}var q=w,k=e(4408);function ne(g){var C=(0,P.useState)({helpCenter:(0,V.eY)("HEAD_HELP_CENTER_BUT")}),f=(0,R.Z)(C,1),h=f[0],N=g.pageContainerParams,b=N===void 0?{}:N,T=g.noPadding,j=T===void 0?!1:T,ee=g.isPersonal,G=ee===void 0?!1:ee,L=g.pageTitle,W=g.className,te=W===void 0?"":W,ae={extra:h.helpCenter?y().createElement(q,{extra:b.extra}):b.extra},le=(0,Z.Z)((0,Z.Z)({},b),ae);return y().createElement("div",{className:"page-container-content ".concat(j?"page-container-noPadding":""," ").concat(G?"page-container-content_personal_background":""," ").concat(te)},L&&y().createElement(k.Z,{title:L}),G?y().createElement(J.Z,null,g.children):y().createElement(J.Z,le,g.children))}var _=ne},55032:function(oe,F,e){"use strict";e.r(F),e.d(F,{default:function(){return ge},formFieldLayout:function(){return O}});var Z=e(57663),R=e(71577),P=e(62029),y=e(57361),J=e(34792),x=e(48086),Q=e(9754),D=e.n(Q),Y=e(12924),a=e.n(Y),I=e(76651),$=e(91768),H=e(78001),z=e(57068),E=e(80991),M=e(56075),A=e(28216),B=e(54549),U=e(49101),V=e(43859),X=e(13254),K=e(14277),se=e(63185),w=e(9676),q=e(33565),k=e(93485),ne=e(47673),_=e(4107),g=e(18329),C=_.Z.Search;class f extends a().Component{constructor(t){super(t);this.onOk=()=>{var s=this.props.onOk,l=this.state.value,i=[],n=(0,k.Z)(l),o;try{for(n.s();!(o=n.n()).done;){var d=o.value;i.push({name:d.label,value:d.value})}}catch(v){n.e(v)}finally{n.f()}s&&s(i)},this.onCancel=()=>{var s=this.props.onCancel;s&&s()},this.initGetData=()=>{var s=this.state.searchVal;(0,M.m_)({page_number:1,page_size:1e4,name:s,source:"self"}).then(l=>{this.setState({checkBoxs:l.data.list.map(i=>({label:i.ability_name,value:i.id,ability_type:i.ability_type}))})})},this.clickType=s=>{this.setState({activeType:s.value})},this.changeCheckBox=(s,l)=>{var i=this.props.t,n=this.state.value;if(n.length+1>100){x.default.error(i("evaluation.multAbilitys"));return}var o=[...n];if(l)o.push(s);else{var d=(0,k.Z)(o.entries()),v;try{for(d.s();!(v=d.n()).done;){var m=v.value,c=(0,q.Z)(m,2),p=c[0],r=c[1];if(r.value===s.value){o.splice(p,1);break}}}catch(u){d.e(u)}finally{d.f()}}this.setState({value:o})},this.handleSearch=s=>{this.setState({searchVal:s},()=>{this.initGetData()})},this.state={prefixCls:"test-capability-modal",typeList:[{name:t.t("evaluation.professional"),value:"special"},{name:t.t("evaluation.generalAbility"),value:"common"}],activeType:"special",checkBoxs:[],searchVal:"",value:[]}}UNSAFE_componentWillReceiveProps(t){t.visible!==this.props.visible&&t.visible&&this.setState({activeType:"special",value:t.value.map(s=>({label:s.name,value:s.value}))},()=>{this.initGetData(t)}),t.visible!==this.props.visible&&!t.visible&&this.setState({searchVal:""})}render(){var t=this.state,s=t.prefixCls,l=t.typeList,i=t.activeType,n=t.checkBoxs,o=t.value,d=this.props,v=d.t,m=d.visible,c=d.title,p=d.themeColor;return a().createElement(g.ZP,{className:"".concat(s),visible:m,title:c||v("evaluation.selectItem"),onCancel:this.onCancel,onOk:this.onOk},a().createElement("div",{className:"select-test-capability-modal"},a().createElement("div",{className:"select-test-capability-modal-search"},a().createElement("span",{className:"select-test-capability-modal-tip"},v("personnelDevelope.addCapabilityTip")),a().createElement(C,{allowClear:!0,placeholder:v("searchInputPlaceholder.name"),className:"search",onSearch:this.handleSearch})),a().createElement("div",{className:"select-test-capability-modal-content"},a().createElement("div",{className:"select-test-capability-modal-content-left"},a().createElement("span",null,v("study.type")),l.map(r=>a().createElement("span",{key:r.value,className:"type-item",style:i===r.value?{color:p}:{},onClick:()=>this.clickType(r)},r.name))),a().createElement("div",{className:"select-test-capability-modal-content-right"},a().createElement("span",{className:"select-label"},v("evaluation.abilityStudy")),n.length>0?n.filter(r=>r.ability_type===i).map(r=>a().createElement(w.Z,{key:r.index,onChange:u=>this.changeCheckBox(r,u.target.checked),value:r.value,checked:o.map(u=>u.value).includes(r.value)},r.label)):a().createElement(K.Z,{image:K.Z.PRESENTED_IMAGE_SIMPLE})))))}}f.defaultProps={visible:!1,onCancel:()=>{},onOk:()=>{},value:[]};var h=S=>{var t=S.advancedSetting;return{themeColor:t.themeColor}},N=(0,A.$j)(h)((0,$.Z)()(f)),b=S=>{var t=S.advancedSetting;return{themeColor:t.themeColor}};class T extends a().Component{constructor(t){super(t);this.delItem=(s,l)=>{var i=this.props.value,n=[...i];n.splice(l,1),this.props.onChange(n)},this.renderItem=(s,l)=>a().createElement("div",{className:"select-test-capability-content-item"},a().createElement("span",null,s.name),a().createElement(B.Z,{className:"item-close",onClick:()=>this.delItem(s.value,l)})),this.sureSelectData=s=>{var l=this.props.onChange;l(s),this.setState({visible:!1})},this.state={visible:!1}}componentDidMount(){}render(){var t=this.props,s=t.t,l=t.themeColor,i=t.value,n=this.state.visible;return a().createElement("div",{className:"select-test-capability"},a().createElement("div",{className:"select-test-capability-btn",onClick:()=>this.setState({visible:!0}),style:{color:l,borderColor:l}},a().createElement(U.Z,null),a().createElement("span",{className:"label"},s("evaluation.selectItem"))),a().createElement("div",{className:"select-test-capability-content"},i.map((o,d)=>this.renderItem(o,d))),a().createElement(N,{visible:n,value:i,onOk:this.sureSelectData,onCancel:()=>this.setState({visible:!1})}))}}var j=(0,A.$j)(b)((0,E.$j)((0,V.Z)((0,$.Z)()(T)))),ee=e(22385),G=e(31097),L=e(88986),W=e(68628),te=e(88311);class ae extends a().Component{constructor(t){var s;super(t);s=this,this.onOrgDialogOk=function(){var l=(0,y.Z)(D().mark(function i(n){var o,d,v,m,c;return D().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.post,d=s.props,v=d.onChange,m=d.t,!(o.length>1)){r.next=5;break}return x.default.warning(m("personnelDevelope.positionSelected")),r.abrupt("return",!1);case 5:return r.next=7,s.checkAbilityModel(o[0].id);case 7:if(c=r.sent,c.status){r.next=11;break}return x.default.error(c.msg),r.abrupt("return",!1);case 11:return c.data&&s.setState({abilityData:c.data}),v(o),s.props.formik.setFieldValue("ability_ids",c.data),s.onOrgDialogCancel(),r.abrupt("return",!0);case 16:case"end":return r.stop()}},i)}));return function(i){return l.apply(this,arguments)}}(),this.onOrgDialogCancel=()=>{var l=this.state.orgModalConfig;this.setState({orgModalConfig:(0,L.Z)((0,L.Z)({},l),{},{visible:!1})})},this.onShowOrgDialog=()=>{var l=this.state.orgModalConfig;this.setState({orgModalConfig:(0,L.Z)((0,L.Z)({},l),{},{visible:!0})})},this.checkAbilityModel=function(){var l=(0,y.Z)(D().mark(function i(n){var o,d,v;return D().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=s.props.t,c.next=3,(0,M._u)({post_ids:[n]});case 3:if(d=c.sent,d.data.code!==0){c.next=13;break}if(d.data.data.length!==0){c.next=7;break}return c.abrupt("return",{msg:o("personnelDevelope.noCompetencyItems"),status:!1});case 7:return c.next=9,(0,M.DF)(n);case 9:if(v=c.sent,v.data.msg==="SUCCESS"){c.next=12;break}return c.abrupt("return",{msg:v.data.msg||o("personnelDevelope.positionAssociatedModel"),status:!1});case 12:return c.abrupt("return",{data:d.data.data,status:!0});case 13:return c.abrupt("return",!1);case 14:case"end":return c.stop()}},i)}));return function(i){return l.apply(this,arguments)}}(),this.delItem=l=>{var i=this.props.value,n=[...i];n.splice(l,1),this.props.onChange(n),this.setState({abilityData:[]}),this.props.formik.setFieldValue("ability_ids","")},this.state={orgModalConfig:{visible:!1,title:t.t("course.jobs"),onlyDept:!0,onlyChoosePost:!0,onlyPost:!0,displayType:["post",""],onOk:this.onOrgDialogOk,onCancel:this.onOrgDialogCancel},abilityData:[]}}componentDidMount(){var t=this.props.ability_items;t&&this.setState({abilityData:t})}render(){var t=this.props,s=t.value,l=t.assessType,i=t.modalId,n=t.t,o=this.state,d=o.orgModalConfig,v=o.abilityData;return a().createElement("div",null,a().createElement("div",{className:"select-post-list"},s.map((m,c)=>a().createElement(R.Z,{disabled:i&&l,key:m.id},a().createElement("span",null,m.name),i&&l?"":a().createElement(B.Z,{onClick:()=>this.delItem(c)})))),a().createElement(R.Z,{disabled:i&&l,onClick:this.onShowOrgDialog},a().createElement(U.Z,null),a().createElement("span",{className:"label"},n("personnelDevelope.RelatedJobs"))),a().createElement("div",{className:"assess-label-content"},a().createElement("span",{className:"assess-label"},n("evaluation.testCapability"),":"),a().createElement("div",{className:"assess-ability"},a().createElement(G.Z,{placement:"top",title:n("personnelDevelope.capabilityQualification")},a().createElement("span",null,a().createElement(W.Z,null)))),a().createElement("div",{className:"assess-label-list-content"},v.map(m=>a().createElement("div",{className:"assess-label-list-content-item",key:m.ability_id},a().createElement("span",null,m.ability_name))))),a().createElement(te.Z,d))}}var le=(0,V.Z)((0,E.$j)((0,$.Z)()(ae))),de=e(11449),ce=e(7584),me=e(4408),ve=e(70075),ie=e(62615),re=e(28531),ue=e(52670),pe=e(2396),he=e(86726),O={labelCol:{xs:{span:23},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:21}}};class ye extends Y.Component{constructor(t){var s;super(t);s=this,this.onSubmit=(l,i)=>{var n=this.state,o=n.id,d=n.type,v=n.isNewEvaluationModel,m=this.props.t,c=l.tagGroup,p;c?p=c.tagsNameList===null?[]:c.tagsNameList:p=[];var r={model_name:l.model_name,id:o,model_desc:l.model_desc,group_ids:l.employeeRange.rangeList.group.map(u=>u.id).join(","),post_ids:l.employeeRange.rangeList.post.map(u=>u.id).join(","),user_ids:l.employeeRange.rangeList.user.map(u=>u.id).join(","),department_ids:l.employeeRange.rangeList.dept.map(u=>u.id).join(","),model_type:d?"post":"ability"};d?(r.link_post_id=l.selectPost[0].id,r.visible_range="all",r.ability_ids=l.ability_ids.map(u=>u.ability_id)):(r.ability_ids=l.ability_ids.map(u=>u.value),r.visible_range={1:"all",2:"part"}[l.employeeRange.rangeType]||"myself"),(0,M.sE)(r).then(u=>{if(i.setSubmitting(!1),u.data.code===11){x.default.success(m("evaluation.cantEdit"));return}if(u.data.code===0){if(x.default.success(m("personal.publishSuccess")),o){var fe={tags:p,resourceId:o,resourceType:"evaluation"};(0,re.tB)(fe)}else if(p&&p.length){var Ce={tags:p,resourceId:u.data.data,resourceType:"evaluation"};(0,re.tB)(Ce)}v?I.m8.push("/talentedDevelopment/abilityEvaluation/evaluationModel"):I.m8.push("/talentedDevelopment/evaluationMenu/evaluationModel")}}).catch(()=>{i.setSubmitting(!1)})},this.getModelInfo=()=>{var l=this.state,i=l.id,n=l.type;(0,M.lo)(i).then(function(){var o=(0,y.Z)(D().mark(function d(v){var m,c;return D().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(v.data.code!==0){r.next=11;break}if(m=v.data.data,s.initialValues={model_name:m.model_name,model_desc:m.model_desc,ability_ids:m.ability_items.map(u=>({name:u.ability_name,value:u.ability_id})),employeeRange:{rangeType:{all:1,part:2,myself:3}[m.visible_range]||1,rangeList:{dept:m.visible_depts||[],post:m.visible_posts||[],group:m.visible_groups||[],user:m.visible_users||[]}}},!n){r.next=10;break}return m.post_name&&m.link_post_id&&(s.initialValues.selectPost=[{id:m.link_post_id,name:m.post_name}]),s.initialValues.employeeRange.rangeType=1,r.next=8,(0,M._u)({post_ids:[m.link_post_id]});case 8:c=r.sent,c.data.code===0&&(s.initialValues.ability_ids=c.data.data);case 10:s.setState({requested:!0});case 11:case"end":return r.stop()}},d)}));return function(d){return o.apply(this,arguments)}}())},this.validateAbility=l=>{var i=this.props.t,n;return l.length===0&&(n=i("evaluation.evaluationNotNull")),n},this.validatePost=l=>{var i=this.props.t,n;return l.length===0&&(n=i("personnelDevelope.validation.postNotEmpty")),n},this.renderTitle=()=>{var l=this.state,i=l.id,n=l.type,o=this.props.t,d="";return n?(i?d=o("common.edit")+o("personnelDevelope.PostCapabilityModel"):d=o("common.add")+o("personnelDevelope.PostCapabilityModelposition"),d):(i?d=o("common.edit")+o("personnelDevelope.capabilityModel"):d=o("common.add")+o("personnelDevelope.capabilityModelgeneral"),d)},this.state={id:"",requested:!1,isNewEvaluationModel:(0,he.F)("evaluationModel",t.modules)==="856363557683978410"},this.initialValues={model_name:"",model_desc:"",ability_ids:[],employeeRange:{rangeType:3,rangeList:{dept:[],post:[],group:[],user:[]}},selectPost:[],type:""}}componentDidMount(){var t=z.parse(I.m8.location.search),s=t.id,l=t.type;s?this.setState({id:s,type:l},this.getModelInfo):this.setState({requested:!0,type:l}),l&&(this.initialValues.employeeRange.rangeType=1)}render(){var t=this.props.t,s=this.state,l=s.id,i=s.requested,n=s.type,o=s.isNewEvaluationModel,d=H.Z.language==="en_us"?" ".concat(t("evaluation.modelNames")):t("evaluation.modelNames"),v=H.Z.language==="en_us"?" ".concat(t("evaluation.modelDescs")):t("evaluation.modelDescs"),m={resourceType:"evaluation",resourceId:null};l&&(m={resourceType:"evaluation",resourceId:l});var c="evaluationMenu";return o&&(c="abilityEvaluation"),a().createElement(de.Z,{pageContainerParams:{header:{title:this.renderTitle()}}},a().createElement(me.Z,{title:l?t("common.edit")+t("evaluation.evaluationModel"):t("common.add")+t("evaluation.evaluationModel")}),a().createElement("div",{className:"ability-model-add"},a().createElement("div",{className:"ability-model-add-content"},i?a().createElement(E.J9,{ref:this.initRef,initialValues:this.initialValues,onSubmit:this.onSubmit,render:p=>a().createElement(E.l0,{className:"cl-form"},a().createElement("div",{className:"cl-form__sectitle no-margin-top"},t("learning.basicInformation")),a().createElement(E.gN,(0,P.Z)({name:"model_name",label:t("evaluation.modelName"),required:!0,component:ce.Z,validate:r=>(0,pe.QK)(r,t("validation.pleaseEnter")+t("evaluation.modelName")),maxLength:30,type:"text",defaultValue:p.values.title,placeholder:"".concat(t("validation.pleaseEnter")).concat(d)},O)),a().createElement(E.gN,(0,P.Z)({name:"model_desc",label:a().createElement("span",{className:"model-label"},t("evaluation.modelDesc")),component:ve.Z,maxLength:80,type:"text",defaultValue:p.values.title,placeholder:"".concat(t("validation.pleaseEnter")).concat(v)},O)),a().createElement(E.gN,(0,P.Z)({name:"tagGroup",label:a().createElement("span",{className:"model-label"},t("course.label")),component:ie.QS,displayType:"Custom",defaultFieldList:m},O)),n?a().createElement(E.gN,(0,P.Z)({name:"selectPost",required:!0,label:t("personnelDevelope.RelatedJobs"),component:le,validate:this.validatePost,ability_items:p.values.ability_ids,assessType:n,modalId:l},O)):a().createElement(E.gN,(0,P.Z)({name:"ability_ids",required:!0,label:t("evaluation.testCapabilityed"),component:j,defaultFieldList:p.values.itemList,validate:this.validateAbility},O)),a().createElement(E.gN,(0,P.Z)({name:"employeeRange",label:a().createElement("span",{className:"model-label"},t("common.visibleRange")),displayType:"Custom",mode:n?["all"]:["all","part","private"],orgProps:{title:t("component.chooseVisibleScope")},showSectitle:!1,component:ie.ww,noBorder:!0,validate:ue.FI,resourceViewRange:!!n,defaultFieldList:p.values.employeeRange},O)),a().createElement("div",{className:"ability-model-add-content-footer-btn"},a().createElement(R.Z,{className:"form-page-container-bottom-btn",type:"primary",loading:p.isSubmitting,htmlType:"submit",onClick:this.cancelEdit},t("common.save")),a().createElement(R.Z,{className:"cancel-btn",onClick:()=>I.m8.push("/talentedDevelopment/".concat(c,"/evaluationModel"))},t("common.cancel"))))}):null)))}}var ge=(0,I.$j)(S=>({modules:S.user.modules,userLng:S.user,versionType:S.user.versionType}))((0,$.Z)()(ye))}}]);
