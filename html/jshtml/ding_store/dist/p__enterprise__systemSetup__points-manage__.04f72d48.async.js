(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[5346],{72711:function(he,W,e){"use strict";var f=e(77883),T=e(21888),H=e(12924),R=e.n(H),A=e(43859),ee=B=>R().createElement(T.Z,B);W.Z=(0,A.Z)(ee)},11449:function(he,W,e){"use strict";e.d(W,{Z:function(){return J}});var f=e(88986),T=e(33565),H=e(12924),R=e.n(H),A=e(3115),ee=e(49111),B=e(19650),ie=e(62029),i=e(57663),m=e(71577),o=e(91768),N=e(28216),I=e(37055),c=e(10237);function L(w){var x=I.ZP.getHelpContentByMenuKey(),P={key:w};return c.WY.get({url:x,params:P})}var z=e(74228),S=e.n(z),X=e(1164),s=e(76466),Y=e(38642);class K extends R().Component{constructor(x){var P;super(x);P=this,this.getHelpContentByMenuKey=()=>{var D=this.props.defaultMenuKey;L(D).then(G=>{var U=G.data,te=U.help_url,ae=U.video_url;this.setState({videoUrl:ae,helpUrl:te})})},this.handleOpenHelpUrl=D=>{if((0,Y.ve)()){window.open(D,"_blank");return}X.Z.targetTo({path:D,isExternalLink:!0})},this.handleOpenVideo=function(D){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.props.t("helpCenter.video");P.setState(U=>({resourcePlayInfo:(0,f.Z)((0,f.Z)({},U.resourcePlayInfo),{},{resourceInfo:{originUrl:D,source:{FD:D,OD:D},contentType:"mp4"}}),previewInfo:(0,f.Z)((0,f.Z)({},U.previewInfo),{},{title:G,visible:!0,onCancel:P.handleCancelPreview})}))},this.handleCancelPreview=()=>{var D=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,f.Z)((0,f.Z)({},D),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:x.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var x=this.state,P=x.helpUrl,D=x.resourcePlayInfo,G=x.previewInfo,U=x.videoUrl,te=this.props.t;return R().createElement("div",{className:S().helpCenter},U&&R().createElement(m.Z,{type:"link",className:S()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(U)},te("helpCenter.video")),P&&R().createElement(m.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(P)},te("helpCenter.tutorial")),R().createElement(s.Z,(0,ie.Z)({},D,{previewInfo:G})))}}var M=w=>({defaultMenuKey:w.currentRoute.menuKey});K.defaultProps={defaultMenuKey:""};var O=(0,N.$j)(M)((0,o.Z)()(K));function b(w){var x=w.extra,P=localStorage.getItem("dingPersonnel"),D=sessionStorage.getItem("dingPersonnel");return R().createElement(B.Z,null,x,P!=="dingPersonnel"&&D!=="dingPersonnel"&&(0,Y.eY)("COMMONEXTRA_HELP_CENTER")&&R().createElement(O,null))}var j=b,$=e(4408);function re(w){var x=(0,H.useState)({helpCenter:(0,Y.eY)("HEAD_HELP_CENTER_BUT")}),P=(0,T.Z)(x,1),D=P[0],G=w.pageContainerParams,U=G===void 0?{}:G,te=w.noPadding,ae=te===void 0?!1:te,ue=w.isPersonal,de=ue===void 0?!1:ue,pe=w.pageTitle,ce=w.className,ge=ce===void 0?"":ce,me={extra:D.helpCenter?R().createElement(j,{extra:U.extra}):U.extra},se=(0,f.Z)((0,f.Z)({},U),me);return R().createElement("div",{className:"page-container-content ".concat(ae?"page-container-noPadding":""," ").concat(de?"page-container-content_personal_background":""," ").concat(ge)},pe&&R().createElement($.Z,{title:pe}),de?R().createElement(A.Z,null,w.children):R().createElement(A.Z,se,w.children))}var J=re},89380:function(he,W,e){"use strict";e.d(W,{Z:function(){return fe}});var f=e(62029),T=e(88986),H=e(57361),R=e(71194),A=e(57016),ee=e(9754),B=e.n(ee),ie=e(12924),i=e.n(ie),m=e(91768),o=e(80991),N=e(27010),I=e(6793),c=e(3407),L=(0,I.me)(),z=c.Z[L].employeeSummary,S=Q=>{var d;return Q||(d=z.certificateGetTime),d},X=Q=>{var d;return Q||(d=z.certificateInvalidScore),d},s=Q=>{var d;return Q.length===0&&(d=z.chooseTeacher),d},Y=e(84874),K=e(31151),M=e(43859);class O extends i().Component{constructor(){super(...arguments);this.state={visible:!1,teacher:[]},this.handleSelectTeacher=()=>{this.setState({visible:!0})},this.handleCancel=()=>{this.setState({visible:!1})},this.handleOk=d=>{this.handleSetData(d),this.setState({visible:!1})},this.handleDelete=(d,E)=>{d.splice(E,1),this.handleSetData(d)},this.handleSetData=d=>{var E=this.props.defaultFieldList,h=E.rangeList,v=(0,T.Z)((0,T.Z)({},E),{},{rangeList:(0,T.Z)((0,T.Z)({},h),{},{user:d})});this.props.formik.setFieldValue("employeeRange",v)}}componentWillReceiveProps(d){var E=d.defaultFieldList,h=E.rangeList.user;this.setState({teacher:h})}render(){var d=this.state.teacher,E=this.props.prefixCls;return i().createElement("div",{className:E},d.map((h,v)=>i().createElement("div",{className:"".concat(E,"__name"),key:h.id},h.name,i().createElement("span",{className:"".concat(E,"__name__delete"),onClick:()=>this.handleDelete(d,v)},i().createElement(Y.Z,{iconClass:"icon-guanbi1"})))),i().createElement("span",{className:"".concat(E,"__add"),onClick:this.handleSelectTeacher},i().createElement(Y.Z,{iconClass:"iconf-add-man"})),i().createElement(K.Z,{visible:this.state.visible,selectedArr:d,onOk:this.handleOk,onCancel:this.handleCancel,showTab:!0,multiple:!0}))}}O.defaultProps={prefixCls:"teacher-selector",defaultFieldList:{rangeType:2,rangeList:{dept:[],post:[],group:[],user:[]}}};var b=(0,M.Z)((0,o.$j)(O)),j=e(43358),$=e(34041),re=$.Z.Option;class J extends i().Component{render(){var d=this.props,E=d.options,h=d.onCateGoryChange,v=d.integralType,u=d.placeholder,Z=d.disabled;return i().createElement("div",{className:"modify-type"},i().createElement("div",{className:"modify-type-value"},i().createElement($.Z,{style:{width:200},placeholder:u,onChange:h,value:v,disabled:Z},E&&E.map(k=>i().createElement(re,{value:k.name,key:k.value},k.value)))))}}var w=(0,M.Z)((0,m.Z)()((0,o.$j)(J))),x=e(88983),P=e(47933);class D extends i().Component{render(){var d=this.props,E=d.modifyType,h=d.onTypeChange,v=d.t,u=d.hideReduce,Z=u===void 0?!1:u;return i().createElement("div",{className:"modify-type"},i().createElement("div",{className:"modify-type-value"},i().createElement(P.ZP.Group,{onChange:h,value:E},i().createElement(P.ZP,{value:"award"},v("setting.rewardPoints")),!Z&&i().createElement(P.ZP,{value:"reduce"},v("setting.reducePoints")),E==="reduce"&&i().createElement("span",null,v("scoreRankingList.minusPointsTips")))))}}var G=(0,M.Z)((0,m.Z)()((0,o.$j)(D)));class U extends i().Component{render(){var d=this.props,E=d.label,h=d.defaultFieldList,v=h===void 0?{}:h,u=v.rangeList.user,Z=u===void 0?[]:u;return i().createElement("div",{className:"single-object"},i().createElement("div",{className:"single-object-label"},E),i().createElement("div",{className:"single-object-value"},Z.map(k=>i().createElement("div",{className:"single-object-item",key:k.id},k.name))))}}var te=(0,M.Z)((0,m.Z)()((0,o.$j)(U))),ae=e(62615),ue=e(52670),de=e(70075),pe=e(72711),ce=e(2396),ge=e(18329),me=e(34773),se={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};class ve extends i().Component{constructor(d){var E;super(d);E=this,this.componentDidMount=()=>{this.getPointsCategory()},this.handleOptions=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=arguments.length>1?arguments[1]:void 0,u=E.props.type;return v==="award"?u==="lecture"?h.filter(Z=>Z.type==="award"&&Z.name==="contributionAndHelp"):h.filter(Z=>Z.type==="award"):u==="lecture"?h.filter(Z=>Z.type==="deduct"&&Z.name==="lowAndContent"):h.filter(Z=>Z.type==="deduct")},this.handleBeforeCreate=()=>{var h=this.props,v=h.t,u=h.type;this.refFormik.submitForm(),this.refFormik.runValidations().then(Z=>{if(!Object.keys(Z).length)var k=A.Z.warning({title:v("setting.modifyTitle"),content:v("setting.modifyContent"),okText:v("component.iKnow"),onOk:()=>{k.destroy();var F=this.refFormik.state.values,_=F.employeeRange,V=F.reason,oe=F.datePicker,Ce=F.modifyType,le=F.integralType,r=F.points,t=(0,me.b)(_.rangeList),a={time:new Date(oe).getTime(),behavior:V,points:Ce==="award"?r.toString():parseInt(r*-1).toString(),integral_type:le};u==="single"?a.user_ids=t.userIds.join(","):u==="lecture"?a.teacherIds=t.userIds.join(","):(a.group_ids=_.rangeType===2?t.groupIds.join(","):"",a.department_ids=_.rangeType===2?t.deptIds.join(","):"",a.user_ids=_.rangeType===2?t.userIds.join(","):"",a.post_ids=_.rangeType===2?t.postIds.join(","):""),this.props.onCreate(a)}})})},this.handleBeforeCancel=()=>{var h=this.props.onCancel;h()},this.getPointsCategory=(0,H.Z)(B().mark(function h(){var v,u,Z;return B().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,N.fV)();case 2:v=F.sent,u=v.data,Z=v.success,Z==="true"&&E.setState({pointsOptions:u.list||[]});case 6:case"end":return F.stop()}},h)})),this.handleTypeChange=h=>{var v=this.state.pointsOptions,u=this.handleOptions(v,h.target.value);this.setState({options:u},()=>{this.setValues({modifyType:h.target.value,integralType:u[0]&&u[0].name})})},this.handleOptionChange=h=>{this.setValues({integralType:h})},this.setValues=h=>{var v=this.refFormik.state.values,u=(0,T.Z)((0,T.Z)({},v),h);this.refFormik.setValues(u),this.setState({initialParams:u},()=>{})},this.handleNumChange=h=>{this.setValues({points:parseInt(h)})},this.state={initialParams:{employeeRange:{rangeType:2,rangeList:{dept:[],post:[],group:[],user:[]}},reason:"",points:"0",modifyType:"award",datePicker:null,integralType:0},pointsOptions:[]}}componentWillReceiveProps(d){if(this.props.visible!==d.visible&&d.visible){var E=this.handleOptions(this.state.pointsOptions,"award"),h={employeeRange:d.employeeRange,reason:"",points:"",datePicker:(0,I.k7)(new Date),modifyType:"award",integralType:E[0]&&E[0].name};this.setState({initialParams:h,options:E},()=>{this.refFormik.setValues(h)})}}render(){var d=this.props,E=d.prefixCls,h=d.visible,v=d.type,u=d.t,Z=this.state,k=Z.initialParams,F=Z.options;return h?i().createElement(ge.ZP,{wrapClassName:E,visible:h,title:this.props.t("setting.pointsModify"),onCancel:this.handleBeforeCancel,onOk:this.handleBeforeCreate},i().createElement(o.J9,{ref:_=>{this.refFormik=_},initialValues:k,render:_=>{var V=_.values;return i().createElement(o.l0,{className:"cl-form modify-points-form"},i().createElement(o.gN,(0,f.Z)({component:v==="mutiple"?ae.ww:v==="single"?te:b,displayType:"Custom",showSectitle:!1,name:"employeeRange",label:u("setting.modifyObject"),defaultFieldList:V.employeeRange,validate:ue.FI,mode:["part"],orgProps:{title:u("employeeSummary.chooseRegisteredObject")},required:!0,onlyUser:!0},se)),i().createElement(o.gN,(0,f.Z)({component:G,name:"modifyType ",label:u("setting.modifyType"),required:!0,hideReduce:v==="lecture",type:"Custom",onTypeChange:this.handleTypeChange,modifyType:V.modifyType},se)),i().createElement(o.gN,(0,f.Z)({component:w,name:"integralType",label:V.modifyType==="award"?u("setting.addType"):u("setting.reduceType"),required:!0,disabled:v==="lecture",integralType:V.integralType,type:"Custom",placeholder:u("setting.selectPointsType",{type:V.modifyType==="award"?u("setting.reward"):u("setting.reduce")}),validate:oe=>(0,ce.QK)(oe?String(oe):"",u("setting.selectPointsType",{type:V.modifyType==="award"?u("setting.reward"):u("setting.reduce")})),onCateGoryChange:this.handleOptionChange,options:F},se)),i().createElement(o.gN,(0,f.Z)({component:pe.Z,name:"points",label:u("setting.modifyNum"),required:!0,min:0,max:99999,precision:0,onChange:this.handleNumChange,value:Number(V.points),validate:X},se)),i().createElement(o.gN,(0,f.Z)({component:ae.Mt,displayType:"Custom",name:"datePicker",label:u("setting.modifyDate"),required:!0,currentDay:!0,defaultFieldList:V.datePicker,validate:S},se)),i().createElement(o.gN,(0,f.Z)({component:de.Z,name:"reason",label:u("personal.pointsBehavior"),required:!0,type:"text",char:!0,defaultValue:V.reason,validate:oe=>(0,ce.QK)(oe,u("employeeSummary.limitReasonWords")),placeholder:u("employeeSummary.limitReasonWords"),maxLength:30},se)))}})):null}}ve.defaultProps={type:"mutiple",employeeRange:{rangeType:2,rangeList:{dept:[],post:[],group:[],user:[]}}};var fe=(0,m.Z)()(ve)},14810:function(he,W,e){"use strict";e.r(W),e.d(W,{default:function(){return Ce}});var f=e(62029),T=e(17462),H=e(1474),R=e(49111),A=e(19650),ee=e(22385),B=e(31097),ie=e(57663),i=e(71577),m=e(34792),o=e(48086),N=e(71194),I=e(57016),c=e(88986),L=e(57361),z=e(9754),S=e.n(z),X=e(12924),s=e.n(X),Y=e(84391),K=e(90631),M=e(91768),O=e(28216),b=e(27010),j=e(89380),$=e(14781),re=e(53431),J=e(66456),w=e(55313),x=e(6793),P=e(37055),D=(0,x.me)();class G extends s().Component{constructor(){super(...arguments);this.onSelectChange=(r,t)=>{this.props.onSelectChange(r,t)},this.columns=[{title:this.props.t("setting.pointsRecordTime"),dataIndex:"createTime",width:150,render:(r,t)=>"".concat((0,x.p6)(+t.create_time))},{title:this.props.t("setting.rewardAndReduce"),dataIndex:"integral_type_name",width:150},{title:this.props.t("scoreRankingList.pointsBehavior"),dataIndex:"event_content",width:300,render:r=>s().createElement(B.Z,{title:r},s().createElement("div",{className:"cl-text-ellipsis"},r))},{title:this.props.t("personal.scores"),dataIndex:"final_score",width:88,render:r=>s().createElement("span",null,r+this.props.t("common.examScoreUnit"))},{title:this.props.t("setting.changeReason"),dataIndex:"update_reason_name",width:D==="zh_cn"?100:180,fixed:"right"}],this.handleTableChange=r=>{this.props.onTableChange(r)}}render(){var r=this.props,t=r.list,a=t===void 0?[]:t,n=r.loading,l=r.paginationParams,p=l===void 0?{}:l,C=r.selectedRowKeys,y={onChange:this.onSelectChange,selectedRowKeys:C,getCheckboxProps:q=>({disabled:q.can_back_out!==1,awardOrDeduct:q.awardOrDeduct})},g=(0,c.Z)((0,c.Z)({},P.XE.INITIAL_PAGINATION),p);return s().createElement("section",{className:"points-record__content__table"},s().createElement(w.Z,{bordered:!0,size:"middle",columns:this.columns,rowKey:"id",dataSource:a,pagination:g,loading:n,scroll:{x:883},onChange:this.handleTableChange,rowSelection:y}))}}var U=(0,M.Z)()(G),te=e(43358),ae=e(34041),ue=e(87722),de=ae.Z.Option;class pe extends s().Component{constructor(r){super(r);this.handleTimeRange=t=>{var a=t.startTime,n=t.endTime,l=t.dateStrings;if(!l.filter(p=>p).length){this.props.onFilterChange({begin_time:"",end_time:""});return}this.props.onFilterChange({begin_time:a,end_time:n})},this.handleExport=()=>{this.props.handleExport()},this.handleDelete=()=>{this.props.handleDelete()},this.renderActionBtn=()=>{var t=this.props,a=t.selectedRowKeys,n=t.t;return s().createElement(A.Z,{className:"points-record__queryrow__action"},s().createElement(i.Z,{onClick:this.handleDelete,disabled:a.length===0},n("scoreRankingList.withdrawInBatch")),s().createElement(i.Z,{type:"primary",onClick:this.handleExport},s().createElement(Y.Z,null)," ",n("common.exportData")))},this.renderFilterBtn=()=>{var t=this.props,a=t.t,n=t.pointsOptions,l=t.integral_type,p=t.update_reason,C=t.onFilterChange,y=t.changeReason;return s().createElement(A.Z,{className:"points-record__queryrow__action"},s().createElement(ue.Z,{timestamp:!0,showTime:!0,format:"YYYY-MM-DD HH:mm:ss",onCustomChange:this.handleTimeRange}),s().createElement("div",{className:"filter-item"},s().createElement("div",{className:"label-action"},a("setting.rewardAndReduce"),"\uFF1A"),s().createElement("div",{className:"value-action"},s().createElement(ae.Z,{style:{width:150},onChange:g=>C({integral_type:g}),value:l,allowClear:!0},n&&n.map(g=>s().createElement(de,{value:g.name,key:g.value},g.value))))),s().createElement("div",{className:"filter-item"},s().createElement("div",{className:"label-action"},a("setting.changeReason"),"\uFF1A"),s().createElement("div",{className:"value-action"},s().createElement(ae.Z,{style:{width:100},onChange:g=>C({update_reason:g}),value:p,allowClear:!0},y&&y.map(g=>s().createElement(de,{value:g.name,key:g.value},g.value))))))},this.state={}}render(){return s().createElement("header",{className:"points-record__queryrow"},this.renderFilterBtn(),this.renderActionBtn())}}pe.defaultProps={prefixCls:"cl-listQueryRow",wrapCls:"",showCheckbox:!0,showSearch:!0,showBtn:!0,defaultRadioValue:"",radioList:[],onRadiosChange:()=>{},onSearch:()=>{},onCheckboxChange:()=>{}};var ce=(0,M.Z)()(pe),ge=e(10237),me=e(97593),se=e(18329);class ve extends s().Component{constructor(r){var t;super(r);t=this,this.onCancel=()=>{this.setState({selectedRowKeys:[]}),this.props.onCancelRecord()},this.onSelectChange=(a,n)=>{this.setState({selectedRowKeys:n})},this.getPointsOptions=(0,L.Z)(S().mark(function a(){var n,l,p;return S().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,b.fV)();case 2:n=y.sent,l=n.data,p=n.success,p==="true"&&t.setState({pointsOptions:l.list||[]});case 6:case"end":return y.stop()}},a)})),this.getChangeReason=(0,L.Z)(S().mark(function a(){var n,l,p;return S().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,b.c4)();case 2:n=y.sent,l=n.data,p=n.success,p==="true"&&t.setState({changeReason:l.list||[]});case 6:case"end":return y.stop()}},a)})),this.initTableList=(0,L.Z)(S().mark(function a(){var n,l,p,C,y,g,q;return S().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return n=t.props,l=n.isLecturer,p=n.userId,t.setState({tableLoading:!0}),C=(0,c.Z)({},t.state.params),l&&(C.type=8),ne.next=6,(0,b.Pt)(p,C);case 6:y=ne.sent,g=y.data,q=y.success,q==="true"&&t.setState({tableList:g.list||[],tableTotal:g.total}),t.setState({tableLoading:!1});case 11:case"end":return ne.stop()}},a)})),this.getCurrentRecord=()=>{var a=this.props.isLecturer,n={};a&&(n.type=8),ge.WY.get({url:P.ZP.points.myIntegral(this.props.userId),params:n}).then(l=>{this.setState({currentRecord:l.data})})},this.handleChangePagination=a=>{var n=a.current,l=a.pageSize;this.setState(p=>({params:(0,c.Z)((0,c.Z)({},p.params),{},{page_number:n,page_size:l})}),()=>{this.initTableList()})},this.resetPagination=()=>new Promise(a=>{this.setState(n=>({params:(0,c.Z)((0,c.Z)({},n.params),{},{page_number:1,page_size:20})}),()=>{a()})}),this.handleFilter=a=>{this.setState(n=>({params:(0,c.Z)((0,c.Z)({},n.params),a)}),()=>{this.initTableList()})},this.exportPointsDetail=()=>{var a=this.props,n=a.t,l=a.isLecturer,p=this.state.params;I.Z.confirm({title:n("common.tip"),content:n("employeeSummary.exportPerPointsConfirm"),onOk:()=>{var C={begin_time:p.begin_time,end_time:p.end_time,integral_type:p.integral_type,update_reason:p.update_reason};l?(0,me.N)({page:"teacherImportPoints",props:this.props,query:C,rest:{lecturerId:this.props.id},sendType:"post"}):(0,me.N)({page:"exportPointsDetail",props:this.props,query:C,rest:{userId:this.props.userId},sendType:"post"})}})},this.showDeleteConfirm=()=>{var a=this.props.t,n=this;I.Z.confirm({title:a("scoreRankingList.pointsConfirmTip"),content:"",okText:a("common.ok"),cancelText:a("common.cancel"),onOk(){n.deleteScores()}})},this.deleteScores=()=>{var a=P.ZP.points.revocation(),n=this.state.selectedRowKeys,l=this.props,p=l.t,C=l.isLecturer,y={list:n,user_id:C?this.props.id:this.props.userId};ge.WY.post({url:a,data:y}).then(g=>{g.data.code==="success"?(o.default.success(p("certificateRankingList.cancelSuccess")),this.initTableList(),this.getCurrentRecord(),this.props.initScoreRank(),this.setState({selectedRowKeys:[]})):o.default.error(p("study.operateFailed"))})},this.state={params:{begin_time:"",end_time:"",page_number:1,page_size:20,integral_type:"",update_reason:""},changeReason:[],tableLoading:!0,tableList:[],tableTotal:0,selectedRowKeys:[],currentRecord:{},pointsOptions:[]}}componentDidMount(){this.getPointsOptions(),this.getChangeReason()}componentDidUpdate(r){this.props.visible&&this.props.visible!==r.visible&&this.props.userId&&this.setState({params:{begin_time:"",end_time:"",page_number:1,page_size:20},tableList:[],tableTotal:0,selectedRowKeys:[],currentRecord:{}},()=>{this.initTableList(),this.getCurrentRecord()})}render(){var r=this.props.visible,t=this.state,a=t.tableTotal,n=t.pointsOptions,l=t.tableList,p=t.tableLoading,C=t.params,y=t.selectedRowKeys,g=t.currentRecord,q=t.changeReason,ye={total:a,current:C.page_number,pageSize:C.page_size},ne=y.map(Ee=>Ee.id);return s().createElement(se.ZP,{visible:r,title:this.props.t("personal.scoresDetails"),onCancel:this.onCancel,footer:null,destroyOnClose:!0,size:"large"},r?s().createElement("div",{className:"points-record"},s().createElement(ce,(0,f.Z)({onFilterChange:this.handleFilter,handleExport:this.exportPointsDetail,handleDelete:this.showDeleteConfirm,selectedRowKeys:ne,currentRecord:g},C,{pointsOptions:n,changeReason:q})),s().createElement("div",{className:"score-record__content"},s().createElement(U,{loading:p,paginationParams:ye,list:l,selectedRowKeys:ne,onTableChange:this.handleChangePagination,onSelectChange:this.onSelectChange}))):null)}}var fe=(0,O.$j)()((0,M.Z)()(ve)),Q=e(55285),d=(0,x.me)();class E extends s().Component{constructor(){super(...arguments);this.state={recordProps:{userId:"",visible:!1}},this.onCancelRecord=()=>{this.setState(r=>({recordProps:(0,c.Z)((0,c.Z)({},r.recordProps),{},{visible:!1,userId:""})}))},this.headExtra=[{title:this.props.t("common.ranking"),dataIndex:"index",key:"index",width:80,fixed:"left"}],this.columns=[{title:this.props.t("scoreRankingList.accumulatedPoints"),dataIndex:"accumulate_score",key:"accumulate_score",width:d==="zh_hk"?96:150},{title:this.props.t("scoreRankingList.getPoints"),dataIndex:"acquirement_score",key:"acquirement_score",width:96},{title:this.props.t("setting.reducePoints"),dataIndex:"deduction_score",key:"deduction_score",width:d==="zh_hk"?96:150},{title:this.props.t("setting.consumpPoints"),dataIndex:"consumption_score",key:"consumption_score",width:d==="zh_hk"?96:150},{title:this.props.t("scoreRankingList.pointsAvailable"),dataIndex:"balance_score",key:"balance_score",width:d==="zh_hk"?88:150},{title:this.props.t("common.operate"),width:d==="zh_hk"?100:150,key:"operate",dataIndex:"operate",fixed:"right",render:(r,t)=>{var a=this.props.showModifyBtn;return s().createElement("div",{className:"table-operate"},s().createElement("span",{className:"cl-pointer",onClick:()=>this.getRecord(t)},this.props.t("common.viewDetails")),a&&s().createElement("span",{className:"modify-btn cl-pointer",onClick:()=>this.props.onModify(t)},this.props.t("setting.modify")))}}],this.getRecord=r=>{this.setState(t=>({recordProps:(0,c.Z)((0,c.Z)({},t.recordProps),{},{visible:!0,userId:r.user_id})}))},this.handleTableChange=(r,t)=>{this.props.onTableChange({current:r,pageSize:t})},this.initScoreRank=()=>{this.props.initScoreRank()}}render(){var r=this.state.recordProps,t=this.props,a=t.list,n=a===void 0?[]:a,l=t.loading,p=t.paginationParams,C=p===void 0?{}:p,y=t.headerTitle,g=t.toolBarRender,q=(0,c.Z)((0,c.Z)({},P.XE.INITIAL_PAGINATION),C);return s().createElement("div",{className:"points-manage-table"},s().createElement("div",{className:"points-manage-table-content"},s().createElement(Q.Z,{headExtra:this.headExtra,columns:this.columns,rowKey:"userId",dataSource:n,loading:l,headerTitle:y(),toolBarRender:g,pagination:!1,tableUUID:"C890776E-F65B-1EDE-7204-BD90D99CEEDD"})),s().createElement("div",{className:"points-manage-table-bottom"},s().createElement(re.Z,(0,f.Z)({},q,{onChange:this.handleTableChange,className:"credit-ranking-pagination"}))),s().createElement(fe,(0,f.Z)({},r,{onCancelRecord:this.onCancelRecord,initScoreRank:this.initScoreRank})))}}var h=(0,M.Z)()(E),v=e(86726),u=e(48479),Z=e(53701),k=e(96172),F=e(11449),_=e(4408),V=le=>({userInfo:le.user});class oe extends s().Component{constructor(){var r;super(...arguments);r=this,this.state={allowActions:(0,v.V9)("integrals",this.props.userInfo.modules),params:{department_id:"",key_word:"",page_number:1,page_size:20},tableLoading:!0,tableList:[],tableTotal:0,showHeaderTip:!1,manualProps:{type:"mutiple",visible:!1,employeeRange:{rangeType:2,rangeList:{dept:[],post:[],group:[],user:[]}}},templateProps:{visible:!1},commitLoading:!1},this.initTableList=(0,L.Z)(S().mark(function t(){var a,n,l,p;return S().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return a=r.state.params,r.setState({tableLoading:!0}),y.next=4,(0,b.WN)(a);case 4:n=y.sent,l=n.data,p=n.success,p==="true"&&r.setState({tableList:l.list,tableTotal:l.total}),r.setState({tableLoading:!1});case 9:case"end":return y.stop()}},t)})),this.handleChangePagination=t=>{var a=t.current,n=t.pageSize;this.setState(l=>({params:(0,c.Z)((0,c.Z)({},l.params),{},{page_number:a,page_size:n})}),()=>{this.initTableList()})},this.resetPagination=()=>new Promise(t=>{this.setState(a=>({params:(0,c.Z)((0,c.Z)({},a.params),{},{page_number:1,page_size:20})}),()=>{t()})}),this.handleTreeSelectChange=t=>{this.setState(a=>({params:(0,c.Z)((0,c.Z)({},a.params),{},{page_number:1,department_id:t})}),()=>{this.initTableList()})},this.handleSearch=t=>{this.setState(a=>({params:(0,c.Z)((0,c.Z)({},a.params),{},{page_number:1,key_word:t})}),()=>{this.initTableList()})},this.handleExport=()=>{var t=this.props.t,a="",n=this.state.params;I.Z.confirm({title:t("common.tip"),content:t("employeeSummary.exportPointsConfirm"),onOk:()=>{Object.keys(n).forEach(p=>{a+="".concat(p,"=").concat(n[p],"&")});var l="?".concat(a);(0,me.N)({page:"exportPointsList",props:this.props,query:l})}})},this.handleManualScore=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.state.manualProps,n=t.user_id,l=t.user_info,p=l===void 0?{}:l;a.type=n?"single":"mutiple";var C={rangeType:2,rangeList:{dept:[],post:[],group:[],user:n?[{id:n,name:p.name}]:[]}};r.setState({manualProps:(0,c.Z)((0,c.Z)({},a),{},{visible:!0,employeeRange:C})})},this.handleManualCancel=()=>{this.setState({manualProps:{visible:!1}})},this.handleManualOk=function(){var t=(0,L.Z)(S().mark(function a(n){var l,p,C;return S().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l=r.props.t,g.next=3,(0,b.T7)(n);case 3:p=g.sent,C=p.data,C.result==="true"?(o.default.success(l("employeeSummary.succeedManual")),r.initTableList(),r.handleManualCancel(),r.setState({showHeaderTip:!0})):o.default.error(l("employeeSummary.timeToMuch"));case 6:case"end":return g.stop()}},a)}));return function(a){return t.apply(this,arguments)}}(),this.handleTemplateScore=()=>{this.setState({templateProps:(0,c.Z)((0,c.Z)({},this.state.templateProps),{},{visible:!0})})},this.handleTemplateCancel=()=>{this.setState({templateProps:(0,c.Z)((0,c.Z)({},this.state.templateProps),{},{visible:!1})})},this.handleTemplateOk=function(){var t=(0,L.Z)(S().mark(function a(n){var l,p,C;return S().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l=r.props.t,r.setState({commitLoading:!0}),g.next=4,(0,b.lT)(n);case 4:p=g.sent,C=p.success,C==="true"?(o.default.success(l("employeeSummary.succeedImportPoints")),r.handleTemplateCancel(),r.initTableList(),r.setState({showHeaderTip:!0})):o.default.error(l("employeeSummary.importFail")),r.setState({commitLoading:!1});case 8:case"end":return g.stop()}},a)}));return function(a){return t.apply(this,arguments)}}(),this.classifyChange=t=>{this.setState(a=>({params:(0,c.Z)((0,c.Z)({},a.params),{},{page_number:1,classify_id:t.join(",")})}),()=>{this.initTableList()})},this.renderProTableHeaderTitle=()=>{var t=this.state.allowActions,a=(0,v.H3)("export",t),n=(0,v.H3)("import_integral",t),l=(0,v.H3)("batch_adjustment",t),p=this.props.t;return s().createElement("div",{className:"action"},s().createElement(A.Z,null,a&&s().createElement(i.Z,{type:"primary",onClick:this.handleExport,style:{marginRight:"8px"}},s().createElement(Y.Z,null),p("common.exportData")),n&&s().createElement(B.Z,{placement:"topLeft",title:p("setting.noLimitTip")},s().createElement(i.Z,{type:"primary",ghost:!0,onClick:this.handleTemplateScore},s().createElement(K.Z,null),p("pointsSetting.importPoints"))),l&&s().createElement(B.Z,{placement:"topLeft",title:p("setting.noLimitTip")},s().createElement(i.Z,{type:"primary",ghost:!0,onClick:this.handleManualScore},p("setting.mutipleModify")))))},this.renderProTableToolBarRender=()=>{var t=this.props.t;return s().createElement("div",{className:"search"},s().createElement(u.Z,{onSearch:this.handleSearch,width:"272px",placeholder:t("setting.nameAndJobNum"),maxLength:50}))},this.handleTipHide=()=>{this.setState({showHeaderTip:!1})}}componentDidMount(){this.initTableList()}render(){var r=this.state,t=r.tableTotal,a=r.tableList,n=r.tableLoading,l=r.params,p=r.manualProps,C=r.templateProps,y=r.commitLoading,g=r.allowActions,q=r.showHeaderTip,ye={total:t,current:l.page_number,page_size:l.page_size},ne=(0,v.H3)("adjustment",g);return s().createElement(F.Z,{pageContainerParams:{header:{title:this.props.t("setting.pointsManage")}}},s().createElement(_.Z,{title:this.props.t("setting.pointsManage")}),s().createElement("div",{className:"points-manage-page"},q&&s().createElement("div",null," ",s().createElement(H.Z,{message:this.props.t("setting.modifyPointsTip"),type:"success",showIcon:!0,closable:!0,onClose:this.handleTipHide})),s().createElement("div",{className:"points-manage-page-container"},s().createElement(Z.Z,{handleTreeSelectChange:this.handleTreeSelectChange,isPoints:!0,showDateFilter:!1}),s().createElement("div",{className:"score-list__content"},s().createElement(h,{headerTitle:this.renderProTableHeaderTitle,toolBarRender:this.renderProTableToolBarRender,loading:n,paginationParams:ye,list:a,onTableChange:this.handleChangePagination,initScoreRank:this.initTableList,showModifyBtn:ne,onModify:this.handleManualScore,classifyId:l.classify_id})),s().createElement(j.Z,(0,f.Z)({},p,{onCancel:this.handleManualCancel,onCreate:this.handleManualOk})),s().createElement(k.Z,(0,f.Z)({},C,{onCancel:this.handleTemplateCancel,onCreate:this.handleTemplateOk,loading:y})))))}}var Ce=(0,O.$j)(V)((0,M.Z)()(oe))},27010:function(he,W,e){"use strict";e.d(W,{fV:function(){return H},c4:function(){return R},lT:function(){return ee},WN:function(){return B},Pt:function(){return ie},T7:function(){return i}});var f=e(10237),T=e(37055);function H(){var m=T.ZP.points.getPointsCategory();return f.WY.get({url:m})}function R(){var m=T.ZP.points.getChangeReason();return f.WY.get({url:m})}function A(m){var o=m.integral_type,N=m.update_reason,I=m.begin_time,c=m.end_time,L=CONFIG.points.exportPointsDetail();return request.post({url:L,params:{integral_type:o,update_reason:N,begin_time:I,end_time:c}})}function ee(m){var o=T.ZP.points.submitPointsImport();return f.qg.post({url:o,data:m})}function B(m){var o=m.department_id,N=m.key_word,I=m.page_number,c=m.page_size,L=T.ZP.points.getPointsTableList();return f.WY.get({url:L,params:{department_id:o,key_word:N,page_number:I,page_size:c}})}function ie(m,o){var N=o.begin_time,I=o.end_time,c=o.page_number,L=o.page_size,z=o.integral_type,S=o.update_reason,X=T.ZP.points.getUserPointsDetail(m);return f.WY.get({url:X,params:{begin_time:N,end_time:I,page_number:c,page_size:L,integral_type:z,update_reason:S}})}function i(m){var o=m.user_ids,N=m.department_ids,I=m.group_ids,c=m.post_ids,L=m.time,z=m.teacherIds,S=m.points,X=m.behavior,s=m.integral_type,Y=T.ZP.points.manualPoints();return f.WY.post({url:Y,data:{user_ids:o,department_ids:N,group_ids:I,post_ids:c,time:L,teacherIds:z,points:S,behavior:X,integral_type:s}})}},53701:function(he,W,e){"use strict";var f=e(12924),T=e.n(f),H=e(91768),R=e(64262),A=e(87722),ee=e(12378);class B extends T().Component{constructor(){super(...arguments);this.handleTreeSelectChange=i=>{this.props.handleTreeSelectChange(i)},this.handleTimeRange=i=>{var m=i.startTime,o=i.endTime,N=i.dateStrings;if(!N.filter(c=>c).length){this.props.handleChangeDataRange({startTime:"",endTime:""});return}var I={startTime:m,endTime:o};this.props.handleChangeDataRange(I)},this.classifyChange=i=>{this.props.classifyChange&&this.props.classifyChange(i)}}render(){var i=this.props,m=i.showclassifyTree,o=i.defaultValue,N=i.showDateFilter,I=N===void 0?!0:N;return T().createElement("div",{className:"employee-file-extra"},T().createElement("div",{className:"select-org-tree cl-search-normal-width"},T().createElement(R.Z,{className:"cl-search-normal-width",parentId:"",checkable:!1,asyncLoad:!0,treeSelect:!0,handleTreeSelectChange:this.handleTreeSelectChange})),I&&T().createElement("div",{className:"date-range"},T().createElement(A.Z,{defaultValue:o,showTime:!0,format:"YYYY-MM-DD HH:mm",className:"cl-search-date-width",onCustomChange:this.handleTimeRange,timestamp:!0})),m&&T().createElement("div",{className:"classify-tree-select-ghk-only"},T().createElement(ee.Z,{multiple:!0,allowClear:!0,onChange:this.classifyChange,showArrow:!0,defaultValue:[]})))}}B.defaultProps={showDateFilter:!0},W.Z=(0,H.Z)()(B)},96172:function(he,W,e){"use strict";var f=e(66456),T=e(55313),H=e(43185),R=e(53251),A=e(62029),ee=e(57663),B=e(71577),ie=e(34792),i=e(48086),m=e(12924),o=e.n(m),N=e(91768),I=e(28216),c=e(84874),L=e(37055),z=e(18329),S=e(97593),X={size:"large",destroyOnClose:!0,bodyStyle:{padding:"0"},maskClosable:!1};class s extends o().Component{constructor(K){super(K);this.onCancel=()=>{this.props.onCancel()},this.onOk=()=>{var O=this.props.t,b=this.state,j=b.importedList,$=b.checkTemplate;if($==="false"){i.default.error(O("upload.typeError"));return}var re={access_token:window.localStorage.getItem("token"),new_file_name:j.map(J=>J.new_file_name).join(","),original_file_name:j.map(J=>J.original_file_name).join(",")};this.props.onCreate(re)},this.fileUpload=O=>{var b=this.props.t;O.file&&O.file.response&&(O.file.response.error_messages?this.setState({checkTemplate:O.file.response.check,importedList:[O.file.response],uploadErrMsg:O.file.response.error_messages}):i.default.error(b("upload.typeError")))},this.downloadTemplate=()=>{var O=this.props,b=O.islecturer,j=O.isScore;b?window.location.href="".concat(L.ZP.points.downloadImport(),"?access_token=").concat(window.localStorage.getItem("token")):j?window.location.href="".concat(L.ZP.ScoreList.downloadTemplate(),"?access_token=").concat(window.localStorage.getItem("token")):(0,S.N)({page:"downloadPointsTemplate",props:this.props,rest:{},sendType:"get"})};var M;K.isScore?M=L.ZP.ScoreList.uploadTemplateScore():K.islecturer?M=L.ZP.points.teacherPointsImport():M=L.ZP.points.uploadPointsTemplate(),this.state={importedList:[],uploadConfig:{name:"file",action:M,showUploadList:!1,headers:{"Enterprise-Id":localStorage.getItem("enterpriseId")},data:{access_token:window.localStorage.getItem("token")},onChange:this.fileUpload},uploadErrMsg:[],checkTemplate:""}}componentDidUpdate(K){K.visible!==this.props.visible&&this.props.visible&&this.setState({importedList:[],uploadErrMsg:[]})}render(){var K=this.state,M=K.importedList,O=K.uploadConfig,b=K.uploadErrMsg,j=this.props,$=j.t,re=j.visible,J=j.isScore,w=j.loading,x=[{title:$("component.fileName"),dataIndex:"file_name",key:"newfileName"},{title:$("component.successLabel"),dataIndex:"success_count"},{title:$("component.failedLabel"),dataIndex:"failed_count"}];return o().createElement(z.ZP,(0,A.Z)({},X,{title:$(J?"employeeSummary.multipleImportScore":"scoreRankingList.multipleImportPoints"),visible:re,confirmLoading:w,onCancel:this.onCancel,onOk:this.onOk}),o().createElement("div",{className:"import-score"},o().createElement("div",{className:"import-score-import"},o().createElement(B.Z,{className:"import-score-import-btn",onClick:this.downloadTemplate},o().createElement(c.Z,{iconClass:"icon-icon_donwloadx1"}),$("component.downloadTem")),o().createElement("span",{className:"import-score-import-tip"},$(J?"employeeSummary.multipleImportScoreTips":"scoreRankingList.multipleImportPointsTips")),o().createElement(R.Z,(0,A.Z)({className:"import-score-import-btn right"},O),o().createElement(B.Z,{type:"primary"},o().createElement(c.Z,{iconClass:"icon-import"}),M.length===0?$("component.importLabel"):$("employeeSummary.reImport")))),o().createElement("div",{className:"import-score-table"},o().createElement(T.Z,{dataSource:M,columns:x,bordered:!0,rowKey:P=>P.new_file_name,size:"middle",pagination:!1})),b.length>0?o().createElement("div",{className:"import-score-tip"},o().createElement("p",null,o().createElement(c.Z,{iconClass:"icon-tishi"}),$("component.errorTips"),":"),b.map((P,D)=>o().createElement("p",{key:D},P))):null))}}s.defaultProps={visible:!1,onCancel:()=>{},onOk:()=>{}},W.Z=(0,I.$j)()((0,N.Z)()(s))}}]);
