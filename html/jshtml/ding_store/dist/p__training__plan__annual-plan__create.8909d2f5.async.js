(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[2221],{69496:function($e,_,i){"use strict";i.r(_),i.d(_,{StoreCtx:function(){return K},default:function(){return De},useStore:function(){return z}});var $=i(88986),A=i(57361),O=i(33565),ce=i(9754),f=i.n(ce),y=i(12924),r=i.n(y),B=i(91768),Y=i(76651),R=i(96486),q=i(57482),M=i(92954),me=i(78138),ee=i.n(me),b=i(9142),te=i(2396),ne={labelCol:{xs:{span:12},sm:{span:3}},wrapperCol:{xs:{span:12},sm:{span:12}}},ge=e=>{var n=s=>(0,te.QK)(s,e("common.requiredNotBlank")),d=(0,M.hP)(e),u=[{name:"name",label:e("training.planName"),type:"text",required:!0,validate:s=>s?(0,b.w)(s,e):n(s),config:{maxLength:60},placeholder:e("training.annual_plan"),layout:ne},{name:"plan_year",label:e("training.plan_year"),type:"select",layout:ne,config:{defaultValue:parseInt(ee()(new Date).format("YYYY"))},placeholder:e("training.please_select_training_year"),options:d}];return[{fields:u,title:e("training.base_info"),category:"base_info"}]},ae=e=>{var n={span:24,labelCol:{xs:{span:8},sm:{span:4}},wrapperCol:{xs:{span:12},sm:{span:16}}},d={span:8,labelCol:{xs:{span:24},sm:{span:12}},wrapperCol:{xs:{span:24},sm:{span:12}}},u=a=>(0,te.QK)(a,e("common.requiredNotBlank")),s=[{name:"name",label:e("training.training_topics"),type:"text",required:!0,validate:a=>a?(0,b.w)(a,e):u(a),config:{maxLength:60},placeholder:e("training.please_enter_training_requirements"),layout:n},{name:"category",label:e("training.category"),type:"text",config:{maxLength:60},placeholder:e("training.please_enter_a_category"),layout:n,validate:a=>a?(0,b.w)(a,e):""},{name:"form",label:e("training.training_form"),type:"select",placeholder:e("training.please_select_training_category"),config:{getPopupContainer:()=>document.getElementById("trainingAnnualForm"),defaultValue:"online"},options:[{label:e("training.on_line"),value:"online"},{label:e("training.offline"),value:"offline"},{label:e("training.blend"),value:"blend"},{label:e("training.other_training"),value:"other"}],layout:n},{name:"target",label:e("training.training_purpose"),type:"textArea",config:{maxLength:1e3},validate:a=>a?(0,b.w)(a,e):"",placeholder:e("training.please_enter_training_purpose"),layout:n},{name:"plan_user_quantity",label:e("training.planned_number"),type:"number",config:{addonAfter:e("training.person_time"),min:0,max:9999999,defaultValue:0,precision:0},validate:a=>a?(0,b.m)(a,e):"",layout:d},{name:"estimated_cost",label:e("training.estimated_cost"),config:{addonAfter:e("training.element"),min:0,max:9999999,step:.1,defaultValue:0,precision:1},validate:a=>a?(0,b.m)(a,e):"",type:"number",layout:d},{name:"class_hours",label:e("training.estimated_class_hours"),type:"number",config:{addonAfter:e("training.class_hour"),min:0,max:9999999,defaultValue:0,precision:0},validate:a=>a?(0,b.m)(a,e):"",layout:(0,$.Z)({offset:8},d)},{name:"session_quantity",label:e("training.estimated_number_of_sessions"),type:"number",config:{addonAfter:e("training.frequency"),min:1,max:9999999,defaultValue:0,precision:0},validate:a=>a?(0,b.m)(a,e):"",layout:d},{name:"lecturer",label:e("training.training_institution_lecturer"),type:"text",placeholder:e("training.please_fill_in_instructor"),config:{maxLength:60},layout:n,validate:a=>a?(0,b.w)(a,e):""},{name:"training_object",label:e("training.training_object"),type:"text",placeholder:e("training.please_enter_the_training_object"),layout:n,validate:a=>a?(0,b.w)(a,e):"",config:{maxLength:60}},{name:"training_year",label:e("training.year_of_training"),type:"select",required:!0,placeholder:e("training.please_select_training_year"),config:{getPopupContainer:()=>document.getElementById("trainingAnnualForm"),defaultValue:parseInt(ee()(new Date).format("YYYY"))},validate:a=>a?"":e("common.requiredNotBlank"),layout:n,options:(0,M.hP)(e)},{name:"training_month",label:e("training.training_month"),type:"month",config:{mode:"multiple",showAll:!1,allowClear:!0,showSearch:!1},layout:n,placeholder:e("training.please_select_training_month")},{name:"address",label:e("training.training_location"),layout:n,placeholder:e("training.please_enter_the_training_location"),validate:a=>a?(0,b.w)(a,e):"",config:{maxLength:1e3}},{name:"department_id",label:e("training.executive_department"),type:"department",config:{treeSelect:!0},layout:n},{name:"directors",label:e("training.person_in_charge"),type:"users",config:{onlyUser:!0},required:!0,validate:a=>(0,R.reduce)(a,(w,S)=>w.concat(S),[]).length===0?e("common.requiredNotBlank"):"",layout:n},{name:"executors",label:e("training.executor"),type:"users",layout:n,config:{onlyUser:!0}}];return[{fields:s,title:"",category:"train_content"}]},re=i(56922),pe=e=>{var n=e.t,d=e.initialValue,u=ge(n),s=z(),a=s.basicRef;return r().createElement("div",null,r().createElement(re.Z,{initialValues:{base_info:d},forms:u,ref:a}))},fe=(0,B.Z)()(pe),Be=i(57663),N=i(71577),Me=i(71194),ie=i(57016),ve=i(7145),le=i.n(ve),he=i(36546),ye=i(44289),v=i(94532),be=i(62029),we=e=>{var n=e.t,d=e.onOk,u=e.initialValue,s=u===void 0?{}:u,a=e.contentRef,w={okText:n("common.ok"),cancelText:n("common.cancel"),size:"medium",destroyOnClose:!0,maskClosable:!1},S=ae(n),E=function(){var k=(0,A.Z)(f().mark(function x(){var j;return f().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,(0,M.Gy)(a.current);case 2:j=Z.sent,j||(d(a.current.state.values),e.onCancel());case 4:case"end":return Z.stop()}},x)}));return function(){return k.apply(this,arguments)}}();return r().createElement(ie.Z,(0,be.Z)({width:"60%",title:n("training.create_update_train_needs"),visible:e.visible},w,{onCancel:e.onCancel,onOk:E}),r().createElement("div",{id:"trainingAnnualForm"},r().createElement(re.Z,{initialValues:{train_content:s},forms:S,ref:a})))},Se=(0,B.Z)()(we),Ee=i(5080),oe=i.n(Ee),Ze=i(60667),Ie=i(36202),Ce=i(86458),Te=i(84874),ke=Ce.Z.DragTableRow,xe=e=>{var n=e.t,d=z(),u=d.taskList,s=d.setTaskList,a=d.contentRef,w=(0,y.useState)({editIndex:-1,visible:!1,value:{}}),S=(0,O.Z)(w,2),E=S[0],k=E.visible,x=E.editIndex,j=E.value,D=S[1],Z=function(){var t=(0,A.Z)(f().mark(function o(l){return f().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(l.department_id&&l.department_id!==0&&l.department_id!=="0")){h.next=4;break}return h.next=3,U(l.department_id);case 3:l.department_name=h.sent;case 4:x>-1?s(m=>le()(m,{$splice:[[x,1,l]]})):s(m=>le()(m,{$push:[l]}));case 6:case"end":return h.stop()}},o)}));return function(l){return t.apply(this,arguments)}}(),P=(t,o)=>{var l=(0,R.cloneDeep)(u),c=l[t];l.splice(t,1),l.splice(o,0,c),s(l)},F=t=>{var o=u[t];D({visible:!0,value:o,editIndex:t})},U=function(){var t=(0,A.Z)(f().mark(function o(l){var c;return f().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,q.Yy)(l);case 2:return c=m.sent,m.abrupt("return",c.data.data?H(c.data.data):"-");case 4:case"end":return m.stop()}},o)}));return function(l){return t.apply(this,arguments)}}(),H=t=>r().createElement(Ze.Z,{type:t.source_type,value:t.id,name:t.name,dataType:"departmentName"}),Q=t=>{ie.Z.confirm({title:n("common.tip"),content:n("course.sureToDelete"),okText:n("common.ok"),cancelText:n("common.cancel"),onOk:()=>{s(o=>o.filter((l,c)=>c!==t))}})},J=()=>{},W=ae(n),G=[{title:n("training.training_content"),dataIndex:"name",key:"name",width:140,fixed:"left",render:t=>r().createElement(v.Z,{title:t||"-",width:140,placement:"topLeft",isCoolCopy:!0,copyTitle:t||"-"},t||"-")},{title:n("training.category"),dataIndex:"category",key:"category",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t||"-",width:140,placement:"topLeft"},t||"-")},{title:n("training.training_object"),dataIndex:"training_object",key:"training_object",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t||"-",width:140,placement:"topLeft"},t||"-")},{title:n("training.training_form"),dataIndex:"form",key:"form",width:140,align:"center",render:t=>{var o=W[0].fields.find(c=>{var h=c.name;return h==="form"}),l=o&&o.options.find(c=>c.value===t);return r().createElement("div",{className:"article-title"},l?l.label:"-")}},{title:n("training.training_purpose"),dataIndex:"target",key:"target",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t||"-",width:140,placement:"topLeft"},t||"-")},{title:n("training.training_location"),dataIndex:"address",key:"address",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t||"-",width:140,placement:"topLeft"},t||"-")},{title:n("training.estimated_number_of_sessions"),dataIndex:"session_quantity",key:"session_quantity",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t?t.toString():"1",width:140,placement:"topLeft"},t?t.toString():"1")},{title:n("training.estimated_class_hours"),dataIndex:"class_hours",key:"class_hours",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t?t.toString():"0",width:140,placement:"topLeft"},t?t.toString():"0")},{title:n("training.estimated_cost"),dataIndex:"estimated_cost",key:"estimated_cost",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t?t.toString():"0.0",width:140,placement:"topLeft"},t?t.toString():"0.0")},{title:n("training.planned_number"),dataIndex:"plan_user_quantity",key:"plan_user_quantity",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t?t.toString():"0",width:140,placement:"topLeft"},t?t.toString():"0")},{title:n("training.executive_department"),dataIndex:"department_id",key:"department_id",width:140,align:"center",render:(t,o)=>!t||t==="0"||t===0?"-":o.department_name},{title:n("training.person_in_charge"),dataIndex:"directors",key:"directors",width:140,align:"center",render:t=>{var o;return Object.keys(t).length>0&&t.user.length>0?o=(0,R.reduce)(t,(l,c)=>l.concat(c),[]).map(l=>l.name||l.user_name).join(","):o="",r().createElement(v.Z,{title:o||"-",width:140,placement:"topLeft"},o||"-")}},{title:n("training.executor"),dataIndex:"executors",key:"executors",width:140,align:"center",render:t=>{var o;return Object.keys(t).length>0&&t.user.length>0?o=(0,R.reduce)(t,(l,c)=>l.concat(c),[]).map(l=>l.name||l.user_name).join(","):o="",r().createElement(v.Z,{title:o||"-",width:140,placement:"topLeft"},o||"-")}},{title:n("training.year_of_training"),dataIndex:"training_year",key:"training_year",width:140,align:"center",render:t=>r().createElement("div",{className:"article-title"},t||"-")},{title:n("training.expected_training_month"),dataIndex:"training_month",key:"training_month",width:140,align:"center",render:t=>r().createElement(v.Z,{title:t.length>0?t.join(","):"-",width:140,placement:"topLeft"},t.length>0?t.join(","):"-")},{title:n("common.operate"),dataIndex:"operate",key:"operate",width:180,align:"center",fixed:"right",render:(t,o,l)=>r().createElement("div",{className:""},r().createElement(N.Z,{type:"link",onClick:()=>F(l)},n("common.edit")),r().createElement(N.Z,{type:"link",onClick:()=>Q(l)},n("common.delete")),localStorage.getItem("dingPersonnel")!=="dingPersonnel"&&r().createElement(Te.Z,{iconClass:"iconf-move"}))}];return r().createElement("div",{className:oe().training_content},r().createElement("h4",null,n("training.training_content")),r().createElement("div",{className:oe().add_train},r().createElement(N.Z,{onClick:()=>{D({visible:!0,value:{},editIndex:-1})}},n("common.addSome"))),r().createElement(Ie.f,{scroll:{y:"100%",x:"max-content"},dataSource:u,columns:G,rowKey:t=>t.id,pagination:!1,toolBarRender:J,onRow:(t,o)=>({index:o,record:t,keyName:"id",moveRow:P,onMouseEnter:()=>{},onMouseLeave:()=>{}}),components:{body:{row:localStorage.getItem("dingPersonnel")!=="dingPersonnel"?ke:!1}},options:{setting:!1,density:!1,fullScreen:!1,reload:!1},tableUUID:"9a4c3eda-143c-4609-8fe9-9741e547b6f8"}),r().createElement(Se,{visible:k,contentRef:a,onOk:Z,initialValue:j,onCancel:()=>{D({visible:!1,value:{},editIndex:-1})}}))},Le=(0,B.Z)()((0,he.Z5)(ye.ZP)(xe)),Re=e=>{var n=e.t,d=(0,y.useState)(!1),u=(0,O.Z)(d,2),s=u[0],a=u[1],w=z(),S=w.onSubmit,E=k=>()=>{switch(k){case"draft":a(!0),S("save"),a(!1);break;case"release":a(!0),S(),a(!1);break;case"cancel":Y.m8.push("/training/trainingPlan/annualPlan");break;default:break}};return r().createElement("footer",{className:"cl-form-fixed-footer"},r().createElement("div",{className:"cl-form-fixed-footer__container-screenful"},r().createElement(N.Z,{onClick:E("cancel")},n("common.cancel")),r().createElement(N.Z,{disabled:s,loading:s,onClick:E("draft")},n("common.draft")),r().createElement(N.Z,{type:"primary",disabled:s,loading:s,onClick:E("release")},n("common.release"))))},Pe=(0,B.Z)()(Re),Ve=i(73704),Ae=i(11449),Ne=i(4408),K=(0,y.createContext)({}),z=()=>(0,y.useContext)(K),je=e=>{var n=e.t,d=e.initialValue,u=e.onRef,s=u===void 0?(0,y.createRef)():u,a=(0,R.get)(d,"content_list",[]),w=(0,y.useRef)(null),S=(0,y.useRef)(null),E=(0,y.useState)(a),k=(0,O.Z)(E,2),x=k[0],j=k[1],D=(0,y.useState)({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),Z=(0,O.Z)(D,2),P=Z[0],F=Z[1],U=P.isShowApprovalModal,H=P.businessId,Q=P.bizType,J=P.approvalTitle,W=P.content,G=function(){var m=(0,A.Z)(f().mark(function V(){var C,g,L;return f().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return C=w&&w.current,I.next=3,(0,M.Gy)(C);case 3:if(g=I.sent,g){I.next=7;break}return L=(0,$.Z)((0,$.Z)({},C.state.values),{},{content_list:(0,M.eP)(x)}),I.abrupt("return",L);case 7:case"end":return I.stop()}},V)}));return function(){return m.apply(this,arguments)}}(),t=()=>{F({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),Y.m8.push("/training/trainingPlan/annualPlan")},o=m=>{F({isShowApprovalModal:m,businessId:"",bizType:"",approvalTitle:"",content:{}}),Y.m8.push("/training/trainingPlan/annualPlan")},l=function(){var m=(0,A.Z)(f().mark(function V(){var C,g,L,p,I,se,de,ue,X=arguments;return f().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return C=X.length>0&&X[0]!==void 0?X[0]:"commit",T.next=3,G();case 3:if(g=T.sent,g){T.next=6;break}return T.abrupt("return");case 6:return g.content_list=g.content_list.length===0?null:g.content_list,T.next=10,(0,q.B3)((0,$.Z)((0,$.Z)({},g),{},{submit_type:C}));case 10:L=T.sent,p=L.data.data,I=p.business_id,se=p.type,de=p.has_flow_template,ue=p.content,((0,R.get)(L,"data.code")===2e5||(0,R.get)(L,"data.code")==="200000")&&(de&&C==="commit"?F({isShowApprovalModal:!0,businessId:I,bizType:se,approvalTitle:g.name,content:ue}):Y.m8.push("/training/trainingPlan/annualPlan"));case 13:case"end":return T.stop()}},V)}));return function(){return m.apply(this,arguments)}}();(0,y.useImperativeHandle)(s,()=>({onSubmit:function(){var m=(0,A.Z)(f().mark(function C(){var g;return f().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,G();case 2:return g=p.sent,p.abrupt("return",g);case 4:case"end":return p.stop()}},C)}));function V(){return m.apply(this,arguments)}return V}()}));var c={basicRef:w,contentRef:S,onSubmit:l,taskList:x,setTaskList:j},h=r().createElement(r().Fragment,null,r().createElement("div",{className:"plan"},r().createElement(K.Provider,{value:c},r().createElement(fe,{initialValue:d}),r().createElement(Le,null),e.isEdit?"":r().createElement(Pe,null))),U&&r().createElement(Ve.Z,{content:W,show:U,setShow:o,submitRefresh:t,businessId:H,bizType:Q,title:J}));return e.isEdit?h:r().createElement(Ae.Z,{pageTitle:!e.isEdit&&n("training.new_plan"),pageContainerParams:{header:{title:!e.isEdit&&n("training.new_plan")}}},r().createElement(Ne.Z,{title:n("documentTitle.newPlan")}),h)},De=(0,B.Z)()(je)}}]);
