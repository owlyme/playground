(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[6165],{787:function(L,g,e){"use strict";e.r(g),e.d(g,{default:function(){return B}});var d=e(62029),y=e(20228),m=e(11382),f=e(34792),E=e(48086),v=e(88986),T=e(12924),a=e.n(T),N=e(91768),x=e(76651),c=e(80991),P=e(10237),b=e(4408),D=e(37055),h=e(6793),M=e(17994),X=e(57663),S=e(71577),O=e(3407),$=(0,h.me)(),I=O.Z[$].learning.validation,V=u=>{var t;if(!u||u.length===0)t=I.learningElectiveItemContentNull;else{var s=u.filter(l=>l.list.length===0);s.length>0&&(t=I.learningElectiveItemContentNull)}return t},A={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},C=e(62615),U=e(52670),G=e(7584),J=e(2396);class K extends a().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var t=this.props.handleSubmit;t()},this.renderFooter=()=>{var t=this.props,s=t.disabled,l=s===void 0?!1:s,i=t.isSubmitting,n=i===void 0?!1:i,r=t.onCancel,o=t.t;return a().createElement("footer",{className:"cl-form-fixed-footer"},a().createElement("div",{className:"cl-form-fixed-footer__container"},a().createElement(S.Z,{onClick:r},o("common.cancel")),l?null:a().createElement(S.Z,{type:"primary",disabled:n,loading:n,onClick:this.handlePropsSubmit},o("common.release"))))}}render(){var t=this.props,s=t.values,l=t.disabled,i=t.title,n=t.t;return a().createElement(a().Fragment,null,a().createElement(c.l0,{className:"cl-form"},this.renderFooter(),a().createElement("h1",{className:"cl-form-htitle"},i),a().createElement("p",{className:"cl-form__sectitle"},n("learning.basicInformation")),a().createElement(c.gN,(0,d.Z)({component:G.Z,name:"title",label:n("learning.learningElectiveAddName"),placeholder:n("learning.learningElectiveAddNamePlaceholder"),required:!0,style:{width:"350px"},type:"text",defaultValue:s.title,validate:r=>(0,J.QK)(r,n("learning.learningElectiveAddNamePlaceholder")),isPreview:l,id:"title",maxLength:60},A)),a().createElement(c.gN,(0,d.Z)({component:C.C0,displayType:"Custom",name:"dateRange",label:n("learning.learningElectiveAddValidity"),required:!0,defaultFieldList:s.dateRange,validate:U.V5,disabled:l},A)),a().createElement("p",{className:"cl-form__divide"}),a().createElement("p",{className:"cl-form__sectitle"},n("learning.learningElectiveAddContent")),a().createElement(c.gN,{component:C.Vi,displayType:"Custom",name:"stages",required:!0,validate:V,renderAsTabs:!1,resourceType:["courseware","course","imageTextCourse"],defaultFieldList:s.stages}),a().createElement("p",{className:"cl-form__attention"},n("learning.learningElectiveAddFormTip")),a().createElement(C.I,null)))}}var j=(0,N.Z)()(K),z={add:D.ZP.LearningMyObligatoryTask.add};class F extends T.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",dateRange:{startTime:null,endTime:null},stages:[{key:"".concat(new Date().getTime()),name:"".concat(this.props.t("formItem.stageTaskPanelTitle"),"1"),desc:"",list:[],inOrder:!1}],reward:{certificate:{isChecked:!1,id:"",name:""}}},isLoading:!1},this.handleSubmit=(t,s)=>{var l=t.title,i=t.dateRange,n=t.stages,r=t.reward,o={title:(0,h.fy)(l),beginTime:(0,h.p6)(i.startTime),endTime:(0,h.p6)(i.endTime),hasExam:0,isNoticeAll:0,groupIds:"",userIds:"",departmentIds:"",resourceSortInfoStr:this.compileResource(n[0].list),isPassThrough:n[0].inOrder,planCertificateId:r.certificate.isChecked?r.certificate.id:""};P.qg.post({url:z.add(),data:(0,v.Z)({},o)}).then(p=>{var R=p.data.code;if(R===0)E.default.success(this.props.t("common.releaseSuccess")),x.m8.push("/training/learning/task/elective");else if(R===111){var Q=p.data.data.stageError,Z=Q[0],W=Z.stageIndex,H=Z.resourceIndexs;(0,M.R)({name:"stages",errMsg:"".concat(n[W-1].list[H[0]].name," ").concat(this.props.t("common.rsNonExistent")),actions:s})}s.setSubmitting(!1)})},this.handleCancel=()=>{x.m8.push("/training/learning/task/elective")},this.compileResource=t=>{var s=[];return t.forEach((l,i)=>{var n={CoursewareSelector:2,CourseSelector:1,ClNewUpload:3};s.push({resourceId:l.id,sort:i,courseType:n[l.btnActionType]})}),JSON.stringify(s)}}componentDidMount(){}render(){var t=this.props,s=t.prefixCls,l=t.t,i=this.state,n=i.initialParams,r=i.isLoading;if(r)return a().createElement(m.Z,{size:"large"});var o="".concat(l("common.add")).concat(l("learning.learningElectiveAddTitle"));return a().createElement("div",{className:s},a().createElement(b.Z,{title:l("documentTitle.myElectiveTasksDetails")}),a().createElement("div",{className:"".concat(s,"__content")},a().createElement(c.J9,{initialValues:n,onSubmit:this.handleSubmit,render:p=>a().createElement(j,(0,d.Z)({},p,{title:o,onCancel:this.handleCancel}))})))}}F.defaultProps={prefixCls:"my-obligatory-task-detail"};var B=(0,N.Z)()(F)},17994:function(L,g,e){"use strict";e.d(g,{R:function(){return y}});var d=e(62615),y=m=>{var f=m.name,E=m.errMsg,v=m.actions;v.setFieldError(f,E),v.setSubmitting(!1),d.I.scrollTo(f)}}}]);
