(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[8306],{57941:function(Ie,$,s){"use strict";s.r($);var ve=s(20228),te=s(11382),R=s(62029),Pe=s(57663),re=s(71577),se=s(57361),Ce=s(34792),ae=s(48086),ne=s(9754),w=s.n(ne),ie=s(12924),a=s.n(ie),oe=s(91768),p=s(76651),le=s(28216),y=s(57068),de=s(67724),ce=s(73340),T=s(28336),_e=s(80359),ue=s(85816),he=s(79860),pe=s(84984),b=s(90753),Z=s(39147),me=s(37055),N=s(38642),ge=s(4408),B=s(76466),ye=s(21594),G,V,z,O,F,J,Ee=(G=(0,le.$j)(H=>{var v=H.subsidyCourseInfo;return{isSubsidyCourse:v.isSubsidyCourse}}),V=Reflect.metadata("design:type",Function),z=Reflect.metadata("design:paramtypes",[void 0]),G(O=V(O=z(O=(J=F=class extends a().Component{constructor(v){var g;super(v);g=this,this.onRef=e=>{this.child=e},this.onCSCECPlay=()=>{this.getResource()},this.onCSCECPlayFunc=()=>{var e=this.state.expire_time,i=y.parse(p.m8.location.search),t=i.CSCECSource;t==="ZHONG_JIAN"&&new Date>new Date(e)&&this.onCSCECPlay()},this.onTellCurrentTime=e=>{this.knowledgeSome.setCurrentTime(e)},this.queryEnvDetail=()=>{var e=y.parse(p.m8.location.search),i=e.courseId,t=e.resourceId,r=e.planId;i&&r&&(0,T.dg)({project_course_id:r,course_id:i,resource_id:t}).then(l=>{this.setState({labInfo:l.data})})},this.setRecord=e=>{var i=y.parse(p.m8.location.search),t=i.planId,r=i.courseId,l=i.resourceId,o=i.studyType,n=i.fromPage;if(n!=="myElectiveTask"){clearTimeout(this.time),this.time=null;var _={action_type:e,plan_id:t,course_id:r,resource_id:l,plan_type:o==="study_project"?"project":"study"};t&&r&&l&&(0,T._T)(_).then(()=>{e==="study"&&(this.time=setTimeout(()=>{this.setRecord(e)},3e4))}).catch(()=>{e==="study"&&(this.time=setTimeout(()=>{this.setRecord(e)},3e4))})}},this.getResource=()=>{var e=y.parse(p.m8.location.search),i=e.planId,t=e.courseId,r=e.resourceId,l=e.studyType,o=l===void 0?"":l,n=e.CSCECSource,_=e.videoId,c={planId:i,courseId:t,resourceId:r,studyType:o};(0,T.yJ)(c).then(E=>{var d=E.data,u=d.data,h=u===void 0?{}:u,m=d.code,P=d.msg;n==="ZHONG_JIAN"&&m===0?(0,T.Bu)(t,{third_resource_id:_}).then(D=>{var C=D.data,f=C.learning_url,I=C.expire_time,L=C.learning_url_fd;h.url=L,h.path=f,h.expire_time=I,this.setState({expire_time:I}),this.updateState(h)}):m!==0?ae.default.error(P):this.updateState(h)})},this.dealWatchType=e=>e==="picture"?"image":e,this.updateState=function(){var e=(0,se.Z)(w().mark(function i(t){var r,l,o,n,_,c,E,d,u,h,m,P,D,C,f,I,L,W,U,j,k,S,A,K,Y,Q,X,q,ee,M;return w().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:r=y.parse(p.m8.location.search),l=r.watchType,o=l===void 0?"video":l,n=r.planId,_=r.courseId,c=r.resourceId,E=r.fromPage,d=E===void 0?"":E,u=r.taskId,o==="h5"||o==="graphic"?(h=t.name,m=t.id,P=t.contentType,D=t.link_switch,D==="true"?g.setState({isLoading:!1,isGraphicExternalLink:!0,name:h,h5Props:{id:m,type:d==="courseProject"?"project":"study",saveProgressInfo:{studyId:n,courseId:_,resourceId:c},isExternalLink:!0}}):o==="h5"?g.setState({isLoading:!1,name:h,h5Props:{id:m,type:d==="courseProject"?"project":"study",saveProgressInfo:{studyId:n,courseId:_,resourceId:c},isExternalLink:P==="h5/link"}}):g.setState({isLoading:!1,name:h,graphicProps:{type:d==="courseProject"?"project":"study",saveProgressInfo:{studyId:n,courseId:_,resourceId:c}}})):(C=t.name,f=t.type,I=t.url,L=t.path,W=t.recentStart,U=t.studyProgress,j=t.duration,k=t.contentType,S=t.storage_type,A=t.videoId,K=t.studyTimeLimit,Y=t.studyTime,Q=me.Ss.indexOf(k)>-1,X=(0,ye.pu)(d),q=g.dealWatchType(o),ee=o==="video"?{source:{FD:I,OD:L},draggable:d==="courseProject",playingVideo:{recentStart:p.m8.location.search.startTime||W,progress:U,duration:j},contentType:k,type:d==="courseProject"?"project":"study",saveStudyProgressInfo:{studyId:n,courseId:_,resourceId:c},storage_type:S,videoId:A}:{},M={from:d==="courseProject"?"project":"study",watchType:q,mode:"learn",studyInfo:{courseId:_,studyId:n,resourceId:c,studyType:X,projectId:d==="courseProject"?u:""}},o==="video"&&Object.assign(M,{resourceInfo:{source:{FD:I,OD:L},originUrl:I,contentType:Q?"mp3":k,playId:A,storageType:S},autoPlay:!0,draggable:d==="courseProject",needCurrentTime:!0,playingVideo:{recentStart:p.m8.location.search.startTime||W,progress:U,duration:j}}),o==="doc"&&Object.assign(M,{resourceInfo:{type:d==="courseProject"?"project":"study",docType:f,aliUrl:L,url:I,docTitle:C,studyTimeLimit:K,studyTime:K>0?Y:W,progress:U,storageType:S,playId:A}}),o==="picture"&&Object.assign(M,{resourceInfo:{url:I,storageType:S,playId:A}}),(o==="html"||o==="scorm")&&Object.assign(M,{resourceInfo:{url:I}}),g.setState({isLoading:!1,name:C,resourcePlayInfo:M,videoResource:ee}));case 2:case"end":return x.stop()}},i)}));return function(i){return e.apply(this,arguments)}}(),this.getKnowledge=()=>{var e=p.m8.location.query,i=e.planId,t=e.resourceId;(0,T._J)({planId:i,resourceId:t}).then(r=>{this.setState({knowledge:{knowledge_graphs:r.data.knowledge_graphs?r.data.knowledge_graphs:[],segmentation_list:r.data.segmentation_list?r.data.segmentation_list:[],text_list:r.data.text_list?r.data.text_list:[]}})})},this.goBack=()=>{var e=y.parse(this.props.location.search),i=e.planId,t=e.fromPage,r=e.taskId,l,o;switch(t){case"myElectiveTask":l="/training/learning/task/myElectiveTaskView";break;case"courseProject":l="/training/trainingProject/traineeView",o="student";break;default:l="/training/learning/task/myObligatoryTaskView",o="student";break}var n={id:i};t==="courseProject"?(n.taskId=r,n.tab=1):n.fromPage=t,(0,N.eJ)({url:"".concat(l,"?").concat(y.stringify(n)),projectType:o||"manage",actionType:"replace"})},this.playWhere=e=>{this.child.play.seek(e)},this.renderTitle=()=>{var e=y.parse(p.m8.location.search),i=e.taskId,t=e.courseId,r=e.resourceId,l=e.planId,o=this.props,n=o.prefixCls,_=o.t,c=this.state,E=c.name,d=c.labInfo,u=c.whiteList,h=d.labResourceId,m="".concat(n,"__header"),P={taskId:i,courseId:t,resourceId:r,planId:l,labInfo:d};return a().createElement("header",{className:m},a().createElement("div",null,a().createElement(re.Z,{type:"link",onClick:this.goBack},a().createElement(de.Z,null),_("course.returnCourse")),a().createElement("span",{className:"".concat(m,"__name")},E)),u.taskLaboratory&&h?a().createElement(he.Z,(0,R.Z)({},P,{queryEnvDetail:this.queryEnvDetail})):null)},this.getKnowledgeGraph=e=>{this.knowledgeSome=e},this.renderContent=()=>{var e=this.props,i=e.prefixCls,t=e.isSubsidyCourse,r="".concat(i,"__bottom"),l=y.parse(p.m8.location.search),o=l.watchType,n=o===void 0?"video":o,_=l.taskId,c=l.courseId,E=l.isSubsidy,d=p.m8.location.query.exitAiUpdate,u=this.state,h=u.isLoading,m=u.videoResource,P=u.h5Props,D=u.graphicProps,C=u.isGraphicExternalLink,f=u.resourcePlayInfo;return h?a().createElement(te.Z,{type:"large"}):n==="video"&&d==="true"?a().createElement("div",{className:r},a().createElement("div",{className:"".concat(r,"__player")},t||E==="true"?a().createElement(b.Z,(0,R.Z)({goBack:this.goBack,taskId:_,courseId:c,onRef:this.onRef,needPlayWhere:!0},m,{onTellCurrentTime:this.onTellCurrentTime,needCurrentTime:!0})):a().createElement(B.Z,(0,R.Z)({},f,{onRef:this.onRef,onPlay:this.onCSCECPlayFunc,onCurrentTime:this.onTellCurrentTime}))),(this.state.knowledge.knowledge_graphs.length>0||this.state.knowledge.segmentation_list.length>0||this.state.knowledge.text_list.length>0)&&a().createElement("div",{className:"".concat(r,"__right")},a().createElement(ue.Z,{ref:this.getKnowledgeGraph,knowledge:this.state.knowledge,watchType:n,playWhere:this.playWhere}))):n==="video"&&d!=="true"?a().createElement("div",{className:r},t||E==="true"?a().createElement(b.Z,(0,R.Z)({taskId:_,goBack:this.goBack,courseId:c,onRef:this.onRef,needPlayWhere:!0},m)):a().createElement(B.Z,(0,R.Z)({},f,{onPlay:this.onCSCECPlayFunc}))):n==="doc"||n==="picture"||n==="html"||n==="scorm"?a().createElement("div",{className:r},a().createElement(B.Z,f)):n==="h5"?a().createElement("div",{className:r},a().createElement(Z.Z,P)):n==="graphic"?a().createElement("div",{className:r},C?a().createElement(Z.Z,P):a().createElement(_e.default,{courseId:c,graphicProps:D})):null},this.state={isLoading:!0,name:"",videoResource:{},h5Props:{},graphicProps:{},knowledge:{knowledge_graphs:[],segmentation_list:[],text_list:[]},labInfo:{},isGraphicExternalLink:!1,whiteList:{taskLaboratory:(0,N.UI)("WATCH_TASK_LABORATORY")},resourcePlayInfo:{mode:"learn",watchType:"",autoPlay:!0,draggable:!0}}}componentDidMount(){var v=y.parse(p.m8.location.search),g=v.exitAiUpdate,e=v.CSCECSource,i=this.state.whiteList;i.taskLaboratory&&this.queryEnvDetail(),this.getResource(),this.setRecord("study"),g==="true"&&this.getKnowledge(),e==="ZHONG_JIAN"&&(this.timer_zhongjian&&window.clearInterval(this.timer_zhongjian),this.timer_zhongjian=setInterval(()=>{var t=this.state.expire_time;t&&new Date>new Date(t)&&this.onCSCECPlay()},1e3)),(0,T.t2)({planId:p.m8.location.query.planId})}componentWillUnmount(){window.clearInterval(this.timer_zhongjian)}render(){var v=this.props,g=v.prefixCls,e=v.t,i=this.state,t=i.labInfo,r=i.whiteList,l=t.labResourceId,o=t.hasVirtual,n=t.againCreate;return a().createElement("div",{className:g},a().createElement(ge.Z,{title:e("documentTitle.courseware")}),a().createElement(ce.NL,{message:()=>(this.setRecord("stop"),!0)}),a().createElement("div",{className:"".concat(g,"__content")},r.taskLaboratory&&l&&o==="true"&&n!=="true"?a().createElement(pe.Z,t):null,this.renderTitle(),this.renderContent()))}},F.defaultProps={prefixCls:"new-watch-task-page"},J))||O)||O)||O);$.default=(0,oe.Z)()(Ee)}}]);
