(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[372,7510],{61170:function(ve,F,n){"use strict";n.r(F),n.d(F,{default:function(){return Ee}});var g=n(62029),le=n(20228),H=n(11382),oe=n(34792),ue=n(48086),b=n(88986),de=n(12924),a=n.n(de),X=n(57068),me=n(91768),u=n(80991),N=n(76651),et=n(57663),ce=n(71577),tt=n(71194),ye=n(57016),ke=n(57119),q=n(52670),Q=n(62615),pe=n(86726),_e=n(7584),Ce=n(70075),xe=n(2396),T=n(16381),v=n(59434),C={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};class be extends a().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var t=this.props,s=t.handleSubmit,e=t.t,o=t.values,i=o===void 0?{}:o,c=i.markType,l=c===void 0?{}:c,y=l.checkedValue,d=y===void 0?1:y;d&&d===1?ye.Z.confirm({icon:a().createElement(ke.Z,{style:{color:"#516AE6"}}),title:e("common.tip"),content:e("learning.isModalReplyUploadWaringContent"),okText:e("common.ok"),cancelText:e("common.cancel"),onOk:()=>{s()}}):s()},this.renderQuestionsContent=()=>{var t=this.props.values,s=t.questionsMode===1;return s?this.renderFixedModeContent():this.renderRandomModeContent()},this.renderFixedModeContent=()=>{var t=this.props,s=t.values,e=t.disabled,o=t.t;return a().createElement(u.gN,(0,g.Z)({component:v.xE,displayType:"Custom",name:"fixedQuestion",label:o("exam.paper"),required:!0,defaultFieldList:s.fixedQuestion,validate:i=>(0,T.dy)(i,s),disabled:e},C))},this.renderRandomModeContent=()=>{var t=this.props,s=t.values,e=t.disabled,o=t.t;return a().createElement(u.gN,(0,g.Z)({component:v.B$,displayType:"Custom",name:"randomQuestion",customError:!0,label:o("exam.bank"),multipleMissedScore:this.props.multipleMissedScore,required:!0,defaultFieldList:s.randomQuestion,validate:i=>(0,T.cT)(i,s),disabled:e},C))},this.renderFooter=()=>{var t=this.props,s=t.disabled,e=s===void 0?!1:s,o=t.isSubmitting,i=o===void 0?!1:o,c=t.onCancel,l=t.t,y=t.isEdit;return a().createElement("footer",{className:"cl-form-fixed-footer"},a().createElement("div",{className:"cl-form-fixed-footer__container"},e?null:a().createElement(ce.Z,{type:"primary",disabled:i,loading:i,onClick:this.handlePropsSubmit},l(y?"common.save":"common.release")),a().createElement(ce.Z,{onClick:c},l("common.cancel"))))},this.renderDrawQuestions=()=>{var t=this.props,s=t.values,e=t.t,o=t.disabled,i=s.randomQuestion.bankQuesitonVoList&&s.randomQuestion.bankQuesitonVoList.length>0,c=s.questionsMode!==1;if(c&&i){var l=this.getAllQuestionsNumber(s.randomQuestion.bankQuesitonInfo);return a().createElement(u.gN,(0,g.Z)({component:v.p7,displayType:"Custom",name:"DrawQuestionsSwitch",label:e("exam.weightedQuestions"),defaultValue:s.isOpenDrawQuestions,questionsNumber:l,disabled:o},C))}return null},this.renderWeightInput=()=>{var t=this.props,s=t.values,e=t.disabled,o=s.questionsMode!==1;return s.isOpenDrawQuestions&&o&&s.randomQuestion.bankQuesitonVoList.length>0?a().createElement(u.gN,(0,g.Z)({component:v.CZ,displayType:"Custom",name:"proportional",required:!0,defaultFieldList:s.proportional,validate:T.RE,disabled:e},C)):null},this.getAllQuestionsNumber=t=>{var s=t.fillBlankCount,e=t.multipleCount,o=t.shortAnswerCount,i=t.singleCount,c=t.trueOrFalseCount;return s+e+o+i+c}}render(){var t=this.props,s=t.values,e=t.disabled,o=t.title,i=t.t,c=(0,pe.V9)("classify",JSON.parse(localStorage.getItem("modules")));return a().createElement(a().Fragment,null,a().createElement(u.l0,{className:"cl-form"},this.renderFooter(),a().createElement("h1",{className:"cl-form-htitle"},o),a().createElement("p",{className:"cl-form__sectitle"},i("exam.selectPaper")),a().createElement(u.gN,(0,g.Z)({component:v.G2,displayType:"Custom",name:"questionsMode",label:i("exam.paperMode"),required:!0,defaultFieldList:s.questionsMode,disabled:e},C)),this.renderQuestionsContent(),this.renderDrawQuestions(),this.renderWeightInput(),a().createElement(u.gN,(0,g.Z)({component:v.Fz,displayType:"Custom",name:"passLine",label:i("exam.passLine"),required:!0,defaultFieldList:s.passLine,validate:T.QL,disabled:e},C)),a().createElement("p",{className:"cl-form__divide"}),a().createElement("p",{className:"cl-form__sectitle"},i("exam.basicInformation")),a().createElement(u.gN,(0,g.Z)({component:_e.Z,name:"title",label:i("exam.taskName"),required:!0,type:"text",style:{width:"350px"},className:"qa-mission-name-field",placeholder:i("exam.taskNamePlaceholder"),defaultValue:s.title,validate:l=>(0,xe.QK)(l,i("exam.taskNamePlaceholder")),isPreview:e,maxLength:60},C)),a().createElement(u.gN,(0,g.Z)({component:Q.en,displayType:"Custom",name:"term",label:i("exam.validityPeriod"),required:!0,defaultFieldList:s.term,validate:q.EU,disabled:e},C)),a().createElement(u.gN,(0,g.Z)({component:v.Xk,displayType:"Custom",name:"examDuration",label:i("exam.examinationTime"),required:!0,defaultFieldList:s.examDuration,validate:T.$1,disabled:e},C)),a().createElement(u.gN,(0,g.Z)({name:"classify",label:i("learning.learningProjectAddCategory"),displayType:"Custom",defaultValue:s.classify,classifyName:s.classifyName,component:Q.O,unclassified:!0,showAdd:(0,pe.H3)("add",c)},C)),a().createElement(u.gN,(0,g.Z)({component:Ce.Z,name:"summary",label:i("examing.examDesc"),type:"text",required:!1,defaultValue:s.summary,rows:4,maxLength:150,placeholder:i("exam.examInstructionPlaceholder"),disabled:e},C)),a().createElement("p",{className:"cl-form__divide"}),a().createElement(u.gN,{component:Q.ww,displayType:"Custom",name:"employeeRange",mode:["part"],defaultFieldList:s.employeeRange,validate:q.FI,disabled:e}),a().createElement("p",{className:"cl-form__divide"}),a().createElement(u.gN,{component:Q.q6,displayType:"Custom",name:"timer",defaultFieldList:s.timer,validate:q.oN,disabled:e,scopeType:"exam"}),a().createElement("p",{className:"cl-form__divide"}),a().createElement("p",{className:"cl-form__sectitle"},i("exam.settings")),a().createElement(u.gN,{component:v.wu,displayType:"Custom",name:"cheatFlag",defaultFieldList:s.cheatFlag,disabled:e,faceKnowDisabled:e}),a().createElement(u.gN,{component:v.Sm,displayType:"Custom",name:"reExam",defaultFieldList:s.reExam,disabled:e}),a().createElement(u.gN,{component:v.ZU,anonymousMarking:this.props.anonymousMarking,displayType:"Custom",name:"markType",validate:T._F,defaultFieldList:s.markType,papers:s.questionsMode===1?s.fixedQuestion.tableList:s.randomQuestion.bankQuesitonInfo,disabled:e}),a().createElement(u.gN,{component:v.Vu,displayType:"Custom",name:"knowledgePoints",defaultFieldList:s.knowledgePoints,disabled:e}),a().createElement(u.gN,{component:v.Qp,displayType:"Custom",name:"reward",defaultFieldList:s.reward,validate:T.JJ,disabled:e,customError:!0}),a().createElement(u.gN,{component:Q.i0,displayType:"Custom",name:"supervisor",defaultFieldList:s.supervisor,disabled:e,createUserId:s.createUserId}),a().createElement(Q.I,null)))}}var we=(0,me.Z)()(be),ee=n(10237),P=n(37055),M=n(6793),Se=n(4408),V={getScoreRule:P.ZP.TimingTemplateDetail.getScoreRule,getPlanInfo:P.ZP.TimingTemplateDetail.getPlanInfo,add:P.ZP.TimingTemplateDetail.add,edit:P.ZP.TimingTemplateDetail.edit};class he extends de.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",examDuration:"",employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},createUserId:"",cheatFlag:{isChecked:!1,switchNum:null,faceRecognition:"off"},reExam:{show_result:!0,isChecked:!0,notAllowed:{end:2},allowed:{reRule:0,record:0,end:5,reNum:1,viewRule:1}},markType:{checkedValue:1,artificialDisabled:!0,fillBlank:{checked:!0,disabled:!1},shortAnswer:{checked:!0,disabled:!1}},reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:0},flunk:{isChecked:!1,score:0},miss:{isChecked:!1,score:0}},questionsMode:1,knowledgePoints:1,passLine:"",fixedQuestion:{id:"",name:"",tableList:{fillBlankCount:0,fillBlankScore:0,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,singleCount:0,singleScore:0,totalCount:0,totalScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},randomQuestion:{bankQuesitonVoList:[],bankQuesitonInfo:{fillBlankCount:0,fillBlankScore:0,fillBlankType:1,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,shortAnswerType:1,singleCount:0,singleScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},supervisor:{supervisorUserList:[],isChecked:!0,visibleAuthScope:!0,authScopeIsChecked:!1},term:{number:0,type:"D"},timer:{shouldRendered:!1,type:2,interval:0,times:0,startTime:Date.parse(new Date)},scheduleId:"",summary:"",isOpenDrawQuestions:!1,proportional:[],classify:"",classifyName:""},isLoading:!0},this.getScoreRule=()=>{ee.WY.get({url:V.getScoreRule()}).then(t=>{this.setState(s=>({initialParams:(0,b.Z)((0,b.Z)({},s.initialParams),{},{reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:t.data.data.examScore[0].passScore},flunk:{isChecked:!1,score:t.data.data.examScore[0].unPassScore},miss:{isChecked:!1,score:t.data.data.examScore[0].missScore}}}),isLoading:!1}))})},this.getDetail=t=>{ee.WY.get({url:V.getPlanInfo({templateId:t})}).then(s=>{var e=s.data,o=e.title,i=e.exam_duration,c=e.create_user,l=e.is_all_in,y=e.department_list,d=e.post_list,E=e.group_list,A=e.user_list,x=e.cheat_flag,L=e.face_recognition,h=e.cut_screen_count,k=e.mark_type,Z=e.anonymous_marking,w=e.s_repeat_exam,U=e.answer_parsing,j=e.re_exam_rule,te=e.re_exam_number,se=e.score_rule,ae=e.view_rule,R=e.exam_certificate_id,D=e.exam_certificate_name,m=e.get_score_info,_=m===void 0?{}:m,W=e.question_mode,J=e.show_knowledge,K=e.pass_line,ie=e.supervisor_id,ne=e.supervisor_user_name,f=e.supervisor_paper,Y=e.authority_range,O=e.bank_quesiton_list,I=e.fill_blank_count,Le=e.fill_blank_unit_score,Qe=e.fill_blank_type,z=e.short_answer_count,Ie=e.short_answer_unit_score,Fe=e.short_answer_type,Ne=e.single_count,Me=e.single_unit_score,Ae=e.true_or_false_count,Ze=e.true_or_false_unit_score,Re=e.multiple_count,De=e.multiple_missed_score,Oe=e.multiple_unit_score,fe=e.paper_vo,p=fe===void 0?{}:fe,$e=e.term_type,Be=e.plan_term,$=e.scheduler_json,Pe=e.schedule_id,Ve=e.summary,B=e.proportionalExamVos,Ue=e.classify_id,je=e.classify_name,We=e.show_result,Je=ie.split(","),Ke=ne.split(","),Ye=Je.map((S,re)=>({id:S,name:Ke[re]})),r=W===1,G=[];O instanceof Array&&O.length&&O.forEach(S=>{var re=S.fill_blank_count,ze=S.multiple_count,Ge=S.short_answer_count,He=S.single_count,Xe=S.total_count,qe=S.true_or_false_count,ge={fillBlankCount:re,shortAnswerCount:Ge,multipleCount:ze,singleCount:He,totalCount:Xe,trueOrFalseCount:qe};G.push((0,b.Z)((0,b.Z)((0,b.Z)({},S),ge),{},{data:(0,b.Z)({},ge)}))}),this.setState({initialParams:{title:o,examDuration:i,createUserId:c,employeeRange:{rangeType:l===!0?1:2,rangeList:{dept:l===!0?[]:y||[],post:l===!0?[]:d||[],group:l===!0?[]:E||[],user:l===!0?[]:A||[]}},cheatFlag:{isChecked:!!x,switchNum:h===-1?null:h,faceRecognition:L},reExam:{show_result:We,isChecked:w==="true",notAllowed:{end:w==="true"?2:U},allowed:{reRule:j,record:se,end:w==="true"?U:5,reNum:j===2?te:1,viewRule:ae}},markType:{checkedValue:k===1?1:2,anonymousMarking:Z===!0||Z==="true",artificialDisabled:r?!(p.fill_blank_count||p.short_answer_count):!(I||z),fillBlank:{checked:r?(k===2||k===3)&&p.fill_blank_count:(k===2||k===3)&&I,disabled:r?!p.fill_blank_count:!I},shortAnswer:{checked:r?(k===2||k===4)&&p.short_answer_count:(k===2||k===4)&&z,disabled:r?!p.short_answer_count:!z}},reward:{certificate:{isChecked:R!=="0",id:R==="0"?"":R,name:D},pass:{isChecked:!!parseInt(_.pass_score,10),score:parseInt(_.pass_score||0,10)},flunk:{isChecked:!!parseInt(_.un_pass_score,10),score:parseInt(_.un_pass_score||0,10)},miss:{isChecked:!!parseInt(_.miss_score,10),score:parseInt(_.miss_score||0,10)}},questionsMode:W,knowledgePoints:J==="show"?1:2,passLine:K,fixedQuestion:{id:r?p.id:"",name:r?p.title:"",tableList:{fillBlankCount:r&&p.fill_blank_count||0,fillBlankScore:r&&p.fill_blank_score||0,multipleCount:r&&p.multiple_count||0,multipleScore:r&&p.multiple_score||0,shortAnswerCount:r&&p.short_answer_count||0,shortAnswerScore:r&&p.short_answer_score||0,singleCount:r&&p.single_count||0,singleScore:r&&p.single_score||0,totalCount:r&&p.total_count||0,totalScore:r&&p.total_score||0,trueOrFalseCount:r&&p.true_or_false_count||0,trueOrFalseScore:r&&p.true_or_false_score||0}},randomQuestion:{bankQuesitonVoList:r?[]:G,bankQuesitonInfo:{fillBlankCount:r?0:I||0,fillBlankScore:r?0:Le||0,fillBlankType:r?1:+Qe||1,multipleCount:r?0:Re||0,multipleScore:r?0:Oe||0,multipleMissedScore:r?0:De||0,shortAnswerCount:r?0:z||0,shortAnswerScore:r?0:Ie||0,shortAnswerType:r?1:+Fe||1,singleCount:r?0:Ne||0,singleScore:r?0:Me||0,trueOrFalseCount:r?0:Ae||0,trueOrFalseScore:r?0:Ze}},supervisor:{supervisorUserList:Ye,isChecked:f===!0,visibleAuthScope:!0,authScopeIsChecked:Y==="true"},term:{number:Be,type:$e},timer:{shouldRendered:!0,type:$.type==="once"?1:2,interval:$.interval,times:$.remain_times,startTime:$.next_time?(0,M.jZ)($.next_time):""},scheduleId:Pe,summary:Ve||"",isOpenDrawQuestions:B&&B.length>0,proportional:B&&(B.length>0?this.computedProportional(B,G):r?[]:this.computedQuesiton(G))||[],classify:Ue,classifyName:je}},()=>{this.setState({isLoading:!1})})})},this.computedQuesiton=t=>t.map(s=>({name:s.name,id:s.id,proportion:0,disabled:s.data.totalCount===0})),this.computedProportional=(t,s)=>s.map((e,o)=>(0,b.Z)((0,b.Z)({},t[o]),{},{disabled:e.data.totalCount===0})),this.handleSubmit=(t,s)=>{var e=t.title,o=t.examDuration,i=t.employeeRange,c=t.cheatFlag,l=t.reExam,y=t.markType,d=t.reward,E=t.questionsMode,A=t.knowledgePoints,x=t.passLine,L=t.fixedQuestion,h=t.randomQuestion,k=t.supervisor,Z=t.term,w=t.timer,U=t.scheduleId,j=t.summary,te=t.isOpenDrawQuestions,se=t.proportional,ae=t.classify,R=X.parse(N.m8.location.search),D=R.id,m=E===1,_=0,W=y.checkedValue,J=y.fillBlank,K=y.shortAnswer,ie=y.anonymousMarking;W===2?J.checked&&!K.checked?_=3:!J.checked&&K.checked?_=4:_=2:_=1;var ne={question_mode:E,show_knowledge:A===1?"show":"hide",pass_line:x,total_score:m?L.tableList.totalScore:"",single_count:m?"":h.bankQuesitonInfo.singleCount,single_unit_score:m?"":h.bankQuesitonInfo.singleScore,multiple_count:m?"":h.bankQuesitonInfo.multipleCount,multiple_unit_score:m?"":h.bankQuesitonInfo.multipleScore,multiple_missed_score:m?"":h.bankQuesitonInfo.multipleMissedScore,true_or_false_count:m?"":h.bankQuesitonInfo.trueOrFalseCount,true_or_false_unit_score:m?"":h.bankQuesitonInfo.trueOrFalseScore,fill_blank_count:m?"":h.bankQuesitonInfo.fillBlankCount,fill_blank_unit_score:m?"":h.bankQuesitonInfo.fillBlankScore,fill_blank_type:m?1:h.bankQuesitonInfo.fillBlankType,short_answer_count:m?"":h.bankQuesitonInfo.shortAnswerCount,short_answer_unit_score:m?"":h.bankQuesitonInfo.shortAnswerScore,short_answer_type:m?1:h.bankQuesitonInfo.shortAnswerType,paper_ids:m?L.id:"",question_bank_list:m?"":h.bankQuesitonVoList.map(f=>f.id).join(","),answer_parsing:l.isChecked?l.allowed.end:l.notAllowed.end,title:(0,M.fy)(e),is_all_in:i.rangeType===1,group_ids:i.rangeList.group.map(f=>f.id).join(","),user_ids:i.rangeList.user.map(f=>f.id).join(","),department_ids:i.rangeList.dept.map(f=>f.id).join(","),postIds:i.rangeList.post.map(f=>f.id).join(","),post_ids:i.rangeList.post.map(f=>f.id).join(","),exam_duration:o,cheat_flag:c.isChecked?1:0,face_recognition:c.faceRecognition,s_repeat_exam:l.isChecked,mark_type:_,anonymousMarking:"".concat(ie),exam_certificate_id:d.certificate.isChecked?d.certificate.id:0,passing_score:m?(0,M.Yz)(L.tableList.totalScore*x/100):x,cut_screen_count:c.switchNum!==null?c.switchNum:-1,re_exam_rule:l.allowed.reRule,re_exam_number:l.allowed.reRule===2?l.allowed.reNum:0,score_rule:l.allowed.record,view_rule:l.allowed.viewRule,get_score_info:d.pass.isChecked||d.miss.isChecked||d.flunk.isChecked?{missScore:d.miss.isChecked?d.miss.score:0,passScore:d.pass.isChecked?d.pass.score:0,unPassScore:d.flunk.isChecked?d.flunk.score:0}:{},get_score:d.pass.isChecked||d.miss.isChecked||d.flunk.isChecked,supervisor_paper_str:k.isChecked.toString(),supervisor_id:k.supervisorUserList.map(f=>f.id).join(","),authority_range:k.authScopeIsChecked,status:"on",term_type:Z.type,plan_term:Z.number,scheduler_json:{interval:w.interval,next_time:(0,M.p6)(w.startTime),start_time:(0,M.p6)(w.startTime),times:w.times,type:w.type===1?"once":"period",scheduler_id:U},summary:j,proportional:!m&&te?se:[],classify_id:ae||999,show_result:(0,v.hi)(l)};ee.WY.post({url:D?V.edit({templateId:D}):V.add(),data:(0,b.Z)({},ne)}).then(()=>{ue.default.success(D?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess")),setTimeout(()=>{s.setSubmitting(!1),N.m8.push("/training/examination/examTemplate")},1e3)}).catch(f=>{var Y=f.response.data,O=Y.code,I=Y.message;O==="enterpriseapi.542003"||(ue.default.error(I),s.setSubmitting(!1))})},this.handleCancel=()=>{N.m8.push("/training/examination/examTemplate")}}componentDidMount(){var t=X.parse(N.m8.location.search),s=t.id;s?this.getDetail(s):this.getScoreRule()}render(){var t=this.props,s=t.prefixCls,e=t.preview,o=e===void 0?!1:e,i=t.t,c=this.state,l=c.initialParams,y=c.isLoading;if(y)return a().createElement(H.Z,{size:"large"});var d=X.parse(N.m8.location.search),E=d.id,A="".concat(i(o?"common.preview":E?"common.edit":"common.add")).concat(i("exam.examTemplateTaskTitle")),x="";return o?x=i("documentTitle.viewTimedExam"):E?x=i("documentTitle.editTimedExam"):x=i("documentTitle.addTimedExam"),a().createElement("div",{className:s},a().createElement(Se.Z,{title:x}),a().createElement("div",{className:"".concat(s,"__content")},a().createElement(u.J9,{initialValues:l,onSubmit:this.handleSubmit,render:L=>a().createElement(we,(0,g.Z)({},L,{multipleMissedScore:!0,anonymousMarking:!0,disabled:o,title:A,isEdit:!!E,onCancel:this.handleCancel}))})))}}he.defaultProps={prefixCls:"timing-template-add"};var Ee=(0,me.Z)()(he)},20112:function(ve,F,n){"use strict";n.r(F);var g=n(12924),le=n.n(g),H=n(61170),oe=()=>le().createElement(H.default,{preview:!0});F.default=oe}}]);
