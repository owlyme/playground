(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[5796],{17635:function(Ce,A,n){"use strict";n.r(A),n.d(A,{default:function(){return ye}});var c=n(62029),Ze=n(20228),z=n(11382),Se=n(34792),b=n(48086),F=n(88986),V=n(12924),t=n.n(V),l=n(80991),h=n(91768),I=n(57068),O=n(28531),J=n(4408),$=n(37055),M=n(10237),K=n(34773),Z=n(6793),Ne=n(57663),S=n(71577),De=n(47673),U=n(4107),H=n(49101),X=n(80007);class k extends t().Component{constructor(){super(...arguments);this.state={visible:!1},this.handleClick=()=>{this.setState({visible:!0})},this.handleOk=e=>{this.setState({visible:!1});var a=e[0];this.props.formik.setFieldValue("questionnaire",(0,F.Z)((0,F.Z)({},this.props.formik.values.questionnaire),{},{id:a.id,name:a.name}))},this.handleCancel=()=>{this.setState({visible:!1})},this.compileData=e=>e.id?[{id:e.id,name:e.name}]:[]}render(){var e=this.props,a=e.defaultFieldList,s=e.t,i=this.state.visible,r=a.name,d=a.disabled,m=this.compileData(a);return t().createElement(t().Fragment,null,t().createElement("div",null,t().createElement(U.Z,{value:r,disabled:!0,style:{width:260}}),d?null:t().createElement(S.Z,{type:"link",icon:t().createElement(H.Z,null),onClick:this.handleClick},s("questionn.investigateDetailBtn")),t().createElement(X.Z,{visible:i,defaultChecked:m,onOk:this.handleOk,onCancel:this.handleCancel})))}}var w=(0,l.$j)((0,h.Z)()(k)),Le=n(88983),P=n(47933);class q extends t().Component{constructor(){super(...arguments);this.handleChange=e=>{this.props.formik.setFieldValue("termType",e.target.value)}}render(){var e=this.props,a=e.defaultFieldList,s=e.t;return t().createElement(P.ZP.Group,{value:a,onChange:this.handleChange},t().createElement(P.ZP,{value:1},s("questionn.investigateDetailPermanent")),t().createElement(P.ZP,{value:2},s("questionn.investigateDetailCustom")))}}q.defaultProps={prefixCls:"termtype"};var _=(0,l.$j)((0,h.Z)()(q)),Re=n(13062),Q=n(71230),xe=n(89032),B=n(15746),Fe=n(77576),W=n(59314);class ee extends t().Component{constructor(){super(...arguments);this.handleSwitch=e=>{this.props.formik.setFieldValue("anonymous",e)}}render(){var e=this.props,a=e.defaultFieldList,s=e.t;return t().createElement("section",{className:"cl-form__secbox"},t().createElement("header",{className:"cl-form__secbox__header"},s("questionn.investigateDetailAnonymousTitle")),t().createElement("div",{className:"cl-form__secbox__content"},t().createElement(Q.Z,null,t().createElement(B.Z,{span:24},t().createElement(W.Z,{checked:a,onChange:this.handleSwitch}),t().createElement("span",{className:"infotext"},s("questionn.investigateDetailAnonymousTitleTip"))))))}}var te=(0,l.$j)((0,h.Z)()(ee));class ae extends t().Component{constructor(){super(...arguments);this.handleSwitch=e=>{this.props.formik.setFieldValue("openResult",e)}}render(){var e=this.props,a=e.defaultFieldList,s=e.t;return t().createElement("section",{className:"cl-form__secbox"},t().createElement("header",{className:"cl-form__secbox__header"},s("questionn.investigateDetailResultTitle")),t().createElement("div",{className:"cl-form__secbox__content"},t().createElement(Q.Z,null,t().createElement(B.Z,{span:24},t().createElement(W.Z,{checked:a,onChange:this.handleSwitch}),t().createElement("span",{className:"infotext"},s("questionn.investigateDetailResultTitleTip"))))))}}var se=(0,l.$j)((0,h.Z)()(ae)),N=n(43859),ne=(0,N.Z)(w),ie=(0,N.Z)(_),le=(0,N.Z)(te),re=(0,N.Z)(se),oe=n(3407),me=(0,Z.me)(),D=oe.Z[me].questionn.validation,Ie=o=>trim(o)?trim(o).length>60?D.investigateTitleLimit:"":D.investigateTitleNull,de=o=>o.id?"":D.investigateDetailSelectNull,ue=(o,e)=>{var a;return e.termType===2&&(!o.startTime||!o.endTime)&&(a=D.investigateDetailValidityNull),a},T={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},L=n(62615),pe=n(52670),ce=n(7584),he=n(2396);class ve extends t().Component{constructor(){super(...arguments);this.handlePropsSubmit=e=>{var a=this.props,s=a.handleSubmit,i=a.onTypeChange;i(e),s()},this.renderFooter=()=>{var e=this.props,a=e.isSubmitting,s=a===void 0?!1:a,i=e.onCancel,r=e.t;return t().createElement("footer",{className:"cl-form-fixed-footer"},t().createElement("div",{className:"cl-form-fixed-footer__container"},t().createElement(S.Z,{onClick:i},r("common.cancel")),t().createElement(S.Z,{disabled:s,loading:s,onClick:()=>this.handlePropsSubmit("draft")},r("common.draft")),t().createElement(S.Z,{type:"primary",disabled:s,loading:s,onClick:()=>this.handlePropsSubmit("release")},r("common.release"))))},this.renderDateRange=()=>{var e=this.props,a=e.values,s=e.t;return a.termType===1?null:t().createElement(l.gN,(0,c.Z)({component:L.C0,displayType:"Custom",name:"dateRange",label:s("questionn.investigateDetailValidity"),required:!0,defaultFieldList:a.dateRange,validate:i=>ue(i,a)},T))}}render(){var e=this.props,a=e.values,s=e.title,i=e.t,r=e.tagGroupInit;return t().createElement(t().Fragment,null,t().createElement(l.l0,{className:"cl-form"},this.renderFooter(),t().createElement("h1",{className:"cl-form-htitle"},s),t().createElement("p",{className:"cl-form__sectitle"},i("exam.basicInformation2")),t().createElement(l.gN,(0,c.Z)({component:ce.Z,name:"title",label:i("questionn.investigateDetailName"),required:!0,type:"text",defaultValue:a.title,style:{width:"350px"},maxLength:60,placeholder:i("questionn.investigateDetailPlaceholder"),validate:d=>(0,he.QK)(d,i("questionn.investigateDetailPlaceholder"))},T)),t().createElement(l.gN,(0,c.Z)({component:ne,displayType:"Custom",name:"questionnaire",label:i("questionn.investigateDetailSelect"),required:!0,defaultFieldList:a.questionnaire,validate:de},T)),t().createElement(l.gN,(0,c.Z)({component:ie,displayType:"Custom",name:"termType",label:i("questionn.investigateDetailTerm"),required:!0,defaultFieldList:a.termType},T)),t().createElement(l.gN,(0,c.Z)({component:L.QS,displayType:"Custom",name:"tagGroup",label:i("common.detailTag"),defaultFieldList:r},T)),this.renderDateRange(),t().createElement("p",{className:"cl-form__divide"}),t().createElement(l.gN,{component:L.ww,displayType:"Custom",name:"employeeRange",mode:["part"],defaultFieldList:a.employeeRange,validate:pe.FI}),t().createElement("p",{className:"cl-form__divide"}),t().createElement("p",{className:"cl-form__sectitle"},i("questionn.investigateDetailSecSetting")),t().createElement(l.gN,{component:le,displayType:"Custom",name:"anonymous",defaultFieldList:a.anonymous}),t().createElement(l.gN,{component:re,displayType:"Custom",name:"openResult",defaultFieldList:a.openResult}),t().createElement(L.I,null)))}}var ge=(0,h.Z)()(ve),G={getInfo:$.ZP.InvestigateDetail.getInfo,add:$.ZP.InvestigateDetail.add,edit:$.ZP.InvestigateDetail.edit};class Y extends V.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",questionnaire:{id:"",name:"",disabled:!1},termType:1,dateRange:{startTime:null,endTime:null},employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},anonymous:!0,openResult:!1},saveType:"release",isLoading:!0},this.getDetail=e=>{M.WY.get({url:G.getInfo({investigateId:e})}).then(a=>{var s=a.data,i=s.actor_type,r=s.anonymous,d=s.department_list,m=s.end_time,v=s.group_list,p=s.open_result,g=s.post_list,E=s.questionnaire_edit,u=s.questionnaire_id,y=s.questionnaire_title,f=s.start_time,C=s.term_type,R=s.title,x=s.user_list,j=s.type;this.setState({initialParams:{title:R,questionnaire:{id:u,name:y,disabled:E!=="true"},termType:C==="permanent"?1:2,dateRange:{startTime:C==="permanent"?null:(0,Z.p6)(f,"yyyy-MM-dd hh:mm:ss"),endTime:C==="permanent"?null:(0,Z.p6)(m,"yyyy-MM-dd hh:mm:ss")},employeeRange:{rangeType:i==="all"?1:2,rangeList:{dept:i==="all"?[]:d,post:i==="all"?[]:g,group:i==="all"?[]:v,user:i==="all"?[]:x}},anonymous:r==="true",openResult:p==="true"},saveType:j,isLoading:!1})})},this.handleTypeChange=e=>{this.setState({saveType:e})},this.handleSubmit=(e,a)=>{var s=e.title,i=e.termType,r=e.questionnaire,d=e.openResult,m=e.employeeRange,v=e.dateRange,p=e.anonymous,g=e.tagGroup,E=I.parse(this.props.history.location.search),u=E.id,y=g?g.tagsNameList:[],f=(0,K.b)(m.rangeList),C={actor_type:m.rangeType===1?"all":"part",anonymous_string:p?"true":"false",open_result_string:d?"true":"false",group_ids:m.rangeType==2?f.groupIds.join(","):"",department_ids:m.rangeType==2?f.deptIds.join(","):"",user_ids:m.rangeType==2?f.userIds.join(","):"",post_ids:m.rangeType==2?f.postIds.join(","):"",questionnaire_id:r.id,term_type:i===1?"permanent":"custom",start_time:i===1?"":v.startTime,stop_time:i===1?"":v.endTime,type:this.state.saveType,title:(0,Z.fy)(s)};M.WY.post({url:u?G.edit({investigateId:u}):G.add(),data:(0,F.Z)({},C)}).then(R=>{var x=R.data,j=x.status,fe=x.message;if(j==="true"){if(b.default.success("".concat(this.state.saveType==="release"?u?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess"):this.props.t("common.draftSuccess"))),u){var Te={tags:y,resourceId:u,resourceType:"investigateTask"};(0,O.tB)(Te)}else if(y&&y.length){var Ee={tags:y,resourceId:R.data.id,resourceType:"investigateTask"};(0,O.tB)(Ee)}setTimeout(()=>{a.setSubmitting(!1),this.props.history.push("/training/questionn/investigate")},1e3)}else b.default.warning(fe),a.setSubmitting(!1)})},this.handleCancel=()=>{this.props.history.push("/training/questionn/investigate")}}componentDidMount(){var e=I.parse(this.props.history.location.search),a=e.id;a?this.getDetail(a):this.setState({isLoading:!1})}render(){var e=this.props,a=e.prefixCls,s=e.history,i=e.t,r=this.state,d=r.initialParams,m=r.isLoading;if(m)return t().createElement(z.Z,{size:"large"});var v=I.parse(s.location.search),p=v.id,g="".concat(i(p?"common.edit":"common.add")).concat(i("questionn.investigateDetailTitle")),E={resourceType:"investigateTask",resourceId:p};return t().createElement("div",{className:a},t().createElement(J.Z,{title:i(p?"documentTitle.editResearchTask":"documentTitle.addResearchTask")}),t().createElement("div",{className:"".concat(a,"__content")},t().createElement(l.J9,{initialValues:d,onSubmit:this.handleSubmit,render:u=>t().createElement(ge,(0,c.Z)({},u,{title:g,isEdit:!!p,tagGroupInit:E,onCancel:this.handleCancel,onTypeChange:this.handleTypeChange}))})))}}Y.defaultProps={prefixCls:"investigate-detail-page"};var ye=(0,h.Z)()(Y)}}]);
