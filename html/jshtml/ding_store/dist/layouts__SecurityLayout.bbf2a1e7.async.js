(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[2231],{37356:function(V,U,n){"use strict";n.r(U);var Z=n(88986),C=n(57361),g=n(9754),O=n.n(g),A=n(12924),y=n.n(A),h=n(76651),D=n(73340),f=n(17780),M=n(26885),w=n(84717);class x extends y().Component{componentWillMount(){var a=this;return(0,C.Z)(O().mark(function c(){var _,l;return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.xX)()){e.next=17;break}if(_=sessionStorage.getItem("coolCollegeTicket"),l=sessionStorage.getItem("coolCollegeLoginType"),l!=="ticket"){e.next=11;break}return e.next=6,a.props.dispatch({type:"user/fetchUserInfo",loginType:"OA",payload:{token:_}});case 6:return e.next=8,a.props.dispatch({type:"user/getManageMenuData"});case 8:h.m8.push(window.location.hash.slice(1)),e.next=17;break;case 11:if(l!=="super"){e.next=17;break}return e.next=14,a.props.dispatch({type:"user/fetchUserInfo",loginType:"ADMIN",payload:{enterpriseId:_}});case 14:return e.next=16,a.props.dispatch({type:"user/getManageMenuData"});case 16:h.m8.push(window.location.hash.slice(1));case 17:case"end":return e.stop()}},c)}))()}componentDidMount(){var a=this;return(0,C.Z)(O().mark(function c(){var _,l;return O().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_=a.props.appType,_!=="wx_app"){e.next=6;break}return e.next=4,(0,w.GI)();case 4:l=e.sent,a.props.dispatch({type:"user/setQyWechatBook",payload:{qyWechatBook:l.data.data}});case 6:case"end":return e.stop()}},c)}))()}render(){var a=this.props,c=a.children,_=a.wxWorkApiFlag,l=a.appType,W=a.isLogin,e=localStorage.getItem("token"),r=JSON.parse(localStorage.getItem("customInfo"));if((0,f.xX)()&&!W)return null;if(!(0,f.xX)()&&!e)if(r&&r.isCustom)this.props.dispatch({type:"user/logoutCustom",payload:(0,Z.Z)({},r)});else return y().createElement(D.l_,{to:"/landing"});return l==="wx_app"&&!_&&((0,M.w8)(!0),sessionStorage.setItem("CL_E_APP_ID",localStorage.getItem("appId"))),c}}var S=L=>{var a=L.user,c=a.appType,_=a.wxWorkApiFlag,l=a.isLogin;return{appType:c,wxWorkApiFlag:_,isLogin:l}};U.default=(0,h.$j)(S)(x)},26885:function(V,U,n){"use strict";n.d(U,{mw:function(){return L},kr:function(){return a},w8:function(){return c},Sk:function(){return l},$f:function(){return W}});var Z=n(34792),C=n(48086),g=n(88986),O=n(57361),A=n(9754),y=n.n(A),h=n(76651),D=n(78001),f=n(37055),M=n(10237),w=localStorage.getItem("corpId"),x=(e,r)=>{wx.config({beta:!0,debug:!1,appId:e.corpId||localStorage.getItem("corpId"),timestamp:e.timeStamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["openDefaultBrowser","innerSaveWebPerformance"]}),wx.ready(()=>{r&&a()}),wx.error(i=>{console.log("error",i)})},S=(e,r)=>{wx.agentConfig({corpid:e.corpId,agentid:e.agentId,timestamp:e.timeStamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["openDefaultBrowser","selectExternalContact","selectEnterpriseContact","selectPrivilegedContact","createChatWithMsg","openEnterpriseChat","openExistedChatWithMsg"],success:()=>{r("success"),(0,h.Qm)()._store.dispatch({type:"user/setWxWorkApiFlag",payload:{wxWorkApiFlag:(0,h.Qm)()._store.getState().user.wxWorkApiFlag+=1}})},fail:i=>{i.errMsg.indexOf("function not exist")>-1&&alert("\u7248\u672C\u8FC7\u4F4E\u8BF7\u5347\u7EA7")}})},L=(e,r,i)=>{window.wx.openEnterpriseChat({userIds:e.join(";"),groupName:r.title,chatId:"",success:function(s){var o=s.chatId;window.wx.invoke("openExistedChatWithMsg",{chatId:o,msg:{msgtype:"link",link:{title:r.title,desc:r.desc,url:r.url,imgUrl:r.imgUrl}}},function(m){m.err_msg=="openExistedChatWithMsg:ok"&&i&&i(o)})},fail:function(s){s.errMsg.indexOf("function not exist")>-1&&alert("\u7248\u672C\u8FC7\u4F4E\u8BF7\u5347\u7EA7")}})},a=function(){var e=(0,O.Z)(y().mark(function r(i){var u,s,o,m,I,p,d=arguments;return y().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=d.length>1&&d[1]!==void 0?d[1]:()=>{},s=f.ZP.util.getAppSignature(),o=window.location.href.split("#")[0],m=i||f.ZP.enterpriseId,v.next=6,M.WY.get({url:s,params:{enterprise_id:m,url:o,batch_id:""}});case 6:I=v.sent,p=I.data,S(p,u);case 9:case"end":return v.stop()}},r)}));return function(i){return e.apply(this,arguments)}}(),c=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(navigator.userAgent.toLowerCase().indexOf("wxwork")>-1){var u=f.ZP.util.getCorpSignature(),s=window.location.href.split("#")[0];M.WY.get({url:u,params:{enterprise_id:f.ZP.enterpriseId,url:s,batch_id:i}}).then(o=>{var m=o.data;x(m,r)})}else r&&a()},_=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=CONFIG.util.getSignature(),u=window.location.href;request.get({url:i,params:{corpId:w,url:u,uuid:""}}).then(s=>{var o=s.data;x(o,r)})},l=e=>{var r=e.userIds,i=r===void 0?[]:r,u=e.deptIds,s=u===void 0?[]:u,o=e.mode,m=o===void 0?"multi":o;return new Promise((I,p)=>{window.wx.invoke("selectPrivilegedContact",{fromDepartmentId:0,mode:m,selectedContextContact:0,selectedOpenUserIds:i||[],selectedTickets:s||[]},d=>{d.err_msg==="selectPrivilegedContact:ok"?(typeof d.result=="string"&&(d.result=JSON.parse(d.result)),I(d.result)):d.err_msg==="selectPrivilegedContact:cancel"&&p("cancel")})})},W=e=>{var r=e.type,i=r===void 0?"employeeRange":r,u=e.result,s=u===void 0?{}:u,o=e.user,m=o===void 0?{}:o,I=e.reserveUser,p=I===void 0?[]:I,d=e.rangeType,b=d===void 0?"all":d,v=e.hasDefault,$=v===void 0?!0:v;return new Promise(B=>{var j=s.userList,k=j===void 0?[]:j,Q=s.selectedUserCount,E=k||[];if(i==="employeeRange"){var P=m.unionid,T="";!k.length&&Q?($&&(E.push({id:P,unionid:P,openUserId:P}),s.userList=[{id:P,unionid:P,openUserId:P}],s.selectedUserCount+=1),T=!0):T=!1;var R={dept:[],post:[],group:[],user:E.map(t=>(0,g.Z)((0,g.Z)({},t),{},{unionid:t.openUserId,id:t.openUserId,user_id:t.openUserId,source_type:"wx_sync"})),classes:[],cluster:[]};b==="onlyDeptUser"&&(R={dept:[],user:E.map(t=>(0,g.Z)((0,g.Z)({},t),{},{unionid:t.openUserId,id:t.openUserId,user_id:t.openUserId,source_type:"wx_sync"}))});var X={isShowType:T,qyWeChatVo:JSON.stringify(s),rangeList:R},K=s.selectedUserCount-R.user.length;K>0&&(T&&$?C.default.warning(D.Z.t("component.selectedErrorTips",{count:K})):C.default.warning(D.Z.t("component.selectedErrorTips2",{count:K}))),B(X)}if(i==="supervision"){k&&(E.find(t=>t.openUserId===(p[0].unionid||p[0].user_id||p[0].name))&&(s.selectedUserCount-=1),E=E.filter(t=>t.openUserId!==p[0].unionid&&t.openUserId!==p[0].user_id&&t.openUserId!==p[0].name).map(t=>t));var N=E.map(t=>(0,g.Z)((0,g.Z)({},t),{},{unionid:t.openUserId,id:t.openUserId,user_id:t.openUserId,source_type:"wx_sync"})),Y={qyWeChatVo:JSON.stringify(s),user:N},F=s.selectedUserCount-N.length;F>0&&C.default.warning(D.Z.t("component.selectedErrorTips2",{count:F})),B(Y)}if(i==="normal"){var J=E.map(t=>(0,g.Z)((0,g.Z)({},t),{},{unionid:t.openUserId,id:t.openUserId,user_id:t.openUserId,source_type:"wx_sync",qyWeChatVo:JSON.stringify(s)})),z={qyWeChatVo:JSON.stringify(s),user:J},G=s.selectedUserCount-J.length;G>0&&C.default.warning(D.Z.t("component.selectedErrorTips2",{count:G})),B(z)}})}}}]);
