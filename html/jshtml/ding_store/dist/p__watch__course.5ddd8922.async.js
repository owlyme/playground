(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[3381],{25067:function(Ee,N,d){"use strict";d.r(N);var Ie=d(20228),q=d(11382),D=d(62029),ve=d(57663),ee=d(71577),te=d(57361),Ce=d(34792),K=d(48086),L=d(88986),ae=d(9754),Z=d.n(ae),re=d(12924),s=d.n(re),v=d(76651),f=d(57068),se=d(28216),ie=d(67724),oe=d(65425),ne=d(98244),le=d(91768),k=d(84984),ce=d(79860),O=d(28336),ue=d(85816),_e=d(80359),$=d(38642),S=d(37055),b=d(76466),de=d(90753),j=d(39147),pe=d(21594),V=d(84874),he=d(4408),me=d(6793);class H extends s().Component{constructor(){var E;super(...arguments);E=this,this.state={isLoading:!0,viewSrc:"/coolcollege-interactive-video/pc/index.html",name:"",videoResource:{},h5Props:{},expire_time:"",currentVideoId:"",graphicProps:{},coursewareList:[],hideCatalog:!1,recommendParams:{page_number:1,page_size:4,position:"course_finish"},recommendCourses:[],currentPlayId:"",knowledge:{knowledge_graphs:[],segmentation_list:[],text_list:[]},labInfo:{},whiteList:{courseLaboratory:(0,$.UI)("WATCH_COURSE_LABORATORY")},resourcePlayInfo:{mode:"learn",watchType:"",autoPlay:!0,draggable:!0}},this.onRef=e=>{this.child=e},this.onCSCECPlayFunc=()=>{var e=this.state.expire_time,a=f.parse(v.m8.location.search),t=a.CSCECSource;t==="ZHONG_JIAN"&&new Date>new Date(e)&&this.onCSCECPlay()},this.onCSCECPlay=()=>{var e=this.state,a=e.currentPlayId,t=e.coursewareList,n=e.currentVideoId,o=f.parse(v.m8.location.search),l=o.courseId,i=o.videoId,c=o.source,u=c==="enterprise"?(0,O.Qq)({courseId:l}):(0,O.L5)({courseId:l});u.then(r=>{c!=="enterprise"&&r.data.forEach(_=>{_.title=_.name}),this.setState({coursewareList:c==="enterprise"?r.data.resources:r.data},()=>{t.forEach(_=>{a===_.id&&(0,O.Bu)(l,{third_resource_id:n||i}).then(I=>{var h=I.data||{},p=h.learning_url,m=h.expire_time,C=h.learning_url_fd;_.url=C,_.path=p,_.expire_time=m,this.setState({expire_time:m}),this.updateState(_)})})})})},this.onTellCurrentTime=e=>{var a=v.m8.location.query.exitAiUpdate;a==="true"&&this.knowledge&&this.knowledge.setCurrentTime(e)},this.queryEnvDetail=()=>{var e=f.parse(v.m8.location.search),a=e.courseId,t=e.resourceId,n=e.planId;a&&n&&(0,O.dg)({project_course_id:n,course_id:a,resource_id:t}).then(o=>{this.setState({labInfo:o.data})})},this.collectCourseEventsCount=()=>{var e=f.parse(v.m8.location.search),a=e.courseId,t={source_id:"",source_type:"normal",event_type:"play",order_id:"",courseId:a};(0,O.Wd)(a,t)},this.getCSCECCourseFunc=(e,a,t,n)=>{(0,O.Bu)(a,{third_resource_id:t||n}).then(o=>{var l=o.data||{},i=l.learning_url_fd,c=l.learning_url,u=l.expire_time;e.url=i,e.path=c,e.expire_time=u,this.setState({expire_time:u}),this.updateState(e)})},this.playCourseware=(e,a)=>{this.setState({hideCatalog:!1});var t=this.state.currentPlayId;if(t!==e){var n=f.parse(v.m8.location.search),o=n.source,l=n.courseId,i=n.videoId,c=n.CSCECSource;o==="enterprise"?(0,O.Qq)({courseId:l}).then(u=>{this.setState({isLoading:!0,currentPlayId:e,coursewareList:u.data.resources.map(r=>{var _=r.max_progress||{};return(0,L.Z)((0,L.Z)({},r),_)})},()=>{var r=this.state.coursewareList;e?r.forEach(_=>{if(e===_.id)if(o==="platform"){var I=_.officialPrice,h=_.auditionType,p=_.status;(I===0||h===1||h===2)&&p===3?this.updateState(_):K.default.info(this.props.t("course.purchaseTips"))}else c==="ZHONG_JIAN"&&_.type==="mp4"?this.getCSCECCourseFunc(_,l,a,i):this.updateState(_)}):c==="ZHONG_JIAN"&&r[0]&&r[0].type==="mp4"?this.getCSCECCourseFunc(r[0],l,a,i):this.updateState(r[0])})}):this.setState({isLoading:!0,currentPlayId:e},()=>{var u=this.state.coursewareList;e?u.forEach(r=>{if(e===r.id)if(o==="platform"){var _=r.officialPrice,I=r.auditionType,h=r.status;(_===0||I===1||I===2)&&h===3?this.updateState(r):K.default.info(this.props.t("course.purchaseTips"))}else c==="ZHONG_JIAN"&&r.type==="mp4"?this.getCSCECCourseFunc(r,l,a,i):this.updateState(r)}):c==="ZHONG_JIAN"&&u[0]&&u[0].type==="mp4"?this.getCSCECCourseFunc(u[0],l,a,i):this.updateState(u[0])})}},this.dealWatchType=(e,a)=>{var t="",n=a==="doc"||S.Yq.findIndex(r=>e.toLowerCase().includes(r))>-1,o=e==="mp4"||e==="mp3",l=S.Ss.indexOf(a)>-1,i=a==="html",c=a==="picture",u=a==="scorm";return n?t="doc":o||l?t="video":c?t="image":i?t="html":u&&(t="scorm"),t},this.updateState=function(){var e=(0,te.Z)(Z().mark(function a(t){var n,o,l,i,c,u,r,_,I,h,p,m,C,g,y,P,x,A,G,R,M,w,U,F,z,J,Q,Y,W,X,T;return Z().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:n=f.parse(v.m8.location.search),o=n.planId,l=n.courseId,i=n.source,c=n.exitAiUpdate,i==="purchased"||i==="platform"?E.collectCourseEventsCount():(0,O.t2)({planId:l}),u=(0,pe.pu)(i),r=t.title,_=t.url,I=t.path,h=t.recent_start,p=t.study_time_limit,m=t.progress,C=t.duration,g=t.id,y=t.type,P=t.contentType,x=t.auditionType,A=t.auditionLength,G=t.link_switch,R=t.isInteract,M=t.storage_type,w=t.videoId,U=y==="mp4"||y==="mp3",F=P==="doc"||S.Yq.findIndex(ge=>y.toLowerCase().includes(ge))>-1,z=S.Ss.indexOf(P)>-1,J=P==="html",Q=P==="picture",Y=P==="scorm",P.indexOf("h5/")>-1?E.setState({currentPlayId:g,watchType:"h5",isLoading:!1,name:r,graphicProps:{type:"course",saveProgressInfo:{courseId:l,resourceId:g}},h5Props:{id:g,type:"course",saveProgressInfo:{courseId:l,resourceId:g},isExternalLink:P==="h5/link"}}):y==="article"?G==="true"?E.setState({currentPlayId:g,watchType:"link",isLoading:!1,name:r,h5Props:{id:g,type:"course",saveProgressInfo:{courseId:l,resourceId:g},isExternalLink:!0}}):E.setState({currentPlayId:g,watchType:"h5",isLoading:!1,name:r,graphicProps:{type:"course",saveProgressInfo:{courseId:l,resourceId:g}},h5Props:{id:g,type:"course",saveProgressInfo:{courseId:l,resourceId:g},isExternalLink:P==="h5/link"}}):(W=E.dealWatchType(y,P),X=U?{source:{FD:_,OD:I},draggable:!0,playingVideo:{recentStart:i==="platform"?0:v.m8.location.query.startTime||h,progress:i==="platform"?t.progess:m,isInteract:R,duration:C,auditionType:i==="platform"?x:0,auditionLength:i==="platform"?A:0},contentType:P,storage_type:M,videoId:w,type:i,saveCourseProgressInfo:{courseId:l,resourceId:g}}:{},T={from:"course",mode:"learn",watchType:W,studyInfo:{courseId:l,studyId:o,resourceId:g,studyType:u,evaluationId:c==="true"?null:o}},U&&Object.assign(T,{resourceInfo:{source:{FD:_,OD:I},originUrl:_,contentType:z?"mp3":P,playId:w,storageType:M},autoPlay:!0,draggable:!0,needCurrentTime:!0,playingVideo:{recentStart:i==="platform"?0:v.m8.location.query.startTime||h,progress:i==="platform"?t.progess:m,isInteract:R,duration:C,auditionType:i==="platform"?x:0,auditionLength:i==="platform"?A:0}}),F&&Object.assign(T,{resourceInfo:{type:i,docType:y,aliUrl:I,url:_,docTitle:r,studyTimeLimit:p,studyTime:h,progress:m,storageType:M,playId:w}}),Q&&Object.assign(T,{resourceInfo:{url:_,storageType:M,playId:w}}),(J||Y)&&Object.assign(T,{resourceInfo:{url:_}}),E.setState({currentPlayId:g,watchType:W,isLoading:!1,name:r,resourcePlayInfo:T,videoResource:X})),c==="true"&&E.getKnowledge();case 12:case"end":return B.stop()}},a)}));return function(a){return e.apply(this,arguments)}}(),this.goBack=()=>{var e=f.parse(v.m8.location.search),a=e.source,t=e.courseId,n=e.taskId,o=e.isSubsidy,l=e.courseType,i=e.planId,c=e.fromPage,u=e.evaluationId,r=e.id,_=e.isBeta,I=e.isOpen,h=e.type,p,m;a==="enterprise"?l==="imageText"?(p="/course/management",m="student"):c==="myTestTask"?(p="/talentedDevelopment/evaluationMenu/myTestTask/trainingTaskDetail",m="student"):c==="myEvaluationReport"?(p="/training/questionn/postTalentAssessment/myEvaluationReport",m="student"):p="/course/enterpriseCourse":a==="purchased"?(p="/course/purchasedCourse",m="student"):(p="/course/platformCourse",m="student");var C={courseId:t,taskId:n,planId:i};o==="true"&&(C.taskId=n,C.isSubsidy=o,C.id=r),c==="myTestTask"?C={id:i,fromPage:"myTestTask",type:h}:c==="myEvaluationReport"&&(C={evaluationId:u,id:r,isBeta:_,isOpen:I,type:h}),(0,$.eJ)({projectType:m||"manage",url:"".concat(p,"?").concat(f.stringify(C)),actionType:"replace"})},this.handleHideCatalog=()=>{var e=this.state.hideCatalog;this.setState({hideCatalog:!e})},this.handleShowCatalog=()=>{this.setState({hideCatalog:!1})},this.playWhere=e=>{this.child.play.seek(e)},this.getKnowledge=()=>{var e=v.m8.location.query,a=e.courseId,t=e.resourceId,n=this.state.currentPlayId;this.knowledge&&this.knowledge.setIndex(),(0,O._J)({planId:a,resourceId:n||t}).then(o=>{this.setState({knowledge:{knowledge_graphs:o.data.knowledge_graphs?o.data.knowledge_graphs:[],segmentation_list:o.data.segmentation_list?o.data.segmentation_list:[],text_list:o.data.text_list?o.data.text_list:[]}})})},this.renderTitle=()=>{var e=v.m8.location.query,a=e.exitAiUpdate,t=e.taskId,n=e.courseId,o=e.resourceId,l=e.planId,i=this.props,c=i.prefixCls,u=i.t,r=this.state,_=r.name,I=r.hideCatalog,h=r.labInfo,p=r.whiteList,m=h.labResourceId,C={taskId:t,courseId:n,resourceId:o,planId:l,labInfo:h},g=a==="true"?"".concat(c,"__content__header"):"".concat(c,"__left__header"),y=a==="true"?"".concat(g,"__content"):"".concat(g,"__left");return s().createElement("header",{className:g},s().createElement("div",{className:y},s().createElement(ee.Z,{type:"link",onClick:this.goBack},s().createElement(ie.Z,null),u("course.returnCourse")),s().createElement("span",{className:"".concat(g,"__name")},_)),s().createElement("div",{className:p.courseLaboratory?"laboratory_right":""},p.courseLaboratory&&m?s().createElement(ce.Z,(0,D.Z)({},C,{queryEnvDetail:this.queryEnvDetail})):null,a!=="true"&&I?s().createElement("div",{className:"".concat(g,"__arrow"),onClick:this.handleShowCatalog},s().createElement(oe.Z,null)):null))},this.getIframeSrc=()=>{var e=f.parse(v.m8.location.search),a=e.courseId,t=this.state,n=t.currentPlayId,o=t.viewSrc,l=localStorage.getItem("enterpriseId"),i=localStorage.getItem("uid"),c=localStorage.getItem("token"),u="&enterprise_api=".concat("https://app123492.eapps.dingtalkcloud.com","&enterprise_id=").concat(l,"&course_id=").concat(a,"&user_id=").concat(i,"&access_token=").concat(c,"&language=").concat((0,me.me)());return"".concat("https://sdn.coolcollege.cn").concat(o,"?loglvl=0&video_id=").concat(n).concat(u)},this.renderContent=()=>{var e=f.parse(v.m8.location.search),a=e.planId,t=e.exitAiUpdate,n=e.courseType,o=e.isSubsidy,l=e.courseId,i=e.taskId,c=this.props.prefixCls,u=t==="true"?"".concat(c,"__content__bottom__player"):"".concat(c,"__left__player"),r=this.state,_=r.isLoading,I=r.videoResource,h=r.h5Props,p=r.graphicProps,m=r.watchType,C=r.recommendCourses,g=r.currentPlayId,y=r.resourcePlayInfo,P=r.coursewareList;return _?s().createElement("div",{className:u},s().createElement(q.Z,{type:"large"})):m==="video"?s().createElement("div",{className:"".concat(u)},o==="true"&&s().createElement(de.Z,(0,D.Z)({goBack:this.goBack,currentPlayId:g,taskId:i,courseId:l,evaluationId:t==="true"?null:a,onRef:this.onRef},I,{tellCurrentTime:this.tellCurrentTime,canShowRecommendCourses:C.length>0,needPlayWhere:!0,needCurrentTime:!0})),y.playingVideo.isInteract&&y.playingVideo.progress!==100&&s().createElement("iframe",{className:"interfaceEditor",style:{width:"80vw",height:"45vw",overflow:"visible"},src:this.getIframeSrc(),scrolling:"no",frameBorder:"0"}),(!y.playingVideo.isInteract||y.playingVideo.progress===100)&&o!=="true"&&s().createElement(b.Z,(0,D.Z)({},y,{onRef:this.onRef,onPlay:this.onCSCECPlayFunc,onCurrentTime:this.onTellCurrentTime}))):m==="doc"||m==="image"||m==="html"||m==="scorm"?s().createElement("div",{className:u},s().createElement(b.Z,y)):m==="h5"?s().createElement("div",{className:u},n==="imageText"?s().createElement(_e.default,{courseId:l,graphicProps:p}):s().createElement(j.Z,(0,D.Z)({evaluationId:t==="true"?null:a},h))):m==="link"?s().createElement("div",{className:u},s().createElement(j.Z,(0,D.Z)({evaluationId:t==="true"?null:a},h))):null},this.getSvgIconClass=e=>{var a=(0,L.Z)({},S.e1),t="";return e.contentType&&e.contentType.indexOf("audio")>-1?t=a.mp3:e.contentType.indexOf("h5/")>-1?t=a.h5:t=a[e.type],t},this.renderCourseList=()=>{var e=this.props,a=e.prefixCls,t=e.t,n=this.state,o=n.coursewareList,l=n.currentPlayId,i=n.hideCatalog,c=f.parse(v.m8.location.search),u=c.source;return s().createElement("div",{className:"".concat(a,"__course__list")},s().createElement("div",{className:"".concat(a,"__course__list__title"),onClick:this.handleHideCatalog},s().createElement("span",null,t("course.directory")),s().createElement("span",null,t(i?"common.collapse":"common.expand"))),i&&s().createElement("div",{className:"".concat(a,"__course__list__catalog")},o.map(r=>s().createElement("div",{className:["".concat(a,"__course__list__catalog__item"),r.id===l?"active":""].join(" "),key:r.id,onClick:()=>this.playCourseware(r.id,r.videoId)},s().createElement(V.Z,{iconClass:this.getSvgIconClass(r),size:"20px"}),s().createElement("span",{className:"".concat(a,"__course__list__catalog__item__name")}," ",u==="platform"?r.name:r.title)))))},this.getKnowledgeGraph=e=>{this.knowledge=e}}componentDidMount(){var E=f.parse(v.m8.location.search),e=E.courseId,a=E.resourceId,t=E.source,n=E.startTime,o=E.CSCECSource,l=this.state.whiteList;l.courseLaboratory&&this.queryEnvDetail();var i=t==="enterprise"?(0,O.Qq)({courseId:e}):(0,O.L5)({courseId:e});i.then(c=>{t!=="enterprise"&&c.data.forEach(u=>{u.title=u.name}),this.setState({coursewareList:t==="enterprise"?c.data.resources.map(u=>{var r=u.max_progress||{};return(0,L.Z)((0,L.Z)({},u),r)}):c.data},()=>{this.playCourseware(a)})}),o==="ZHONG_JIAN"&&(this.timer_zhongjian&&window.clearInterval(this.timer_zhongjian),this.timer_zhongjian=setInterval(()=>{var c=this.state.expire_time;c&&new Date>new Date(c)&&this.onCSCECPlay()},1e3)),n&&this.playWhere(n)}componentWillUnmount(){window.clearInterval(this.timer_zhongjian)}renderOldList(){var E=this.props,e=E.prefixCls,a=E.t,t=this.state,n=t.coursewareList,o=t.currentPlayId,l=t.hideCatalog,i=t.labInfo,c=t.whiteList,u=f.parse(v.m8.location.search),r=u.source,_=i.labResourceId,I=i.hasVirtual,h=i.againCreate;return s().createElement("div",{className:e},s().createElement(he.Z,{title:a("documentTitle.courseViewing")}),s().createElement("div",{className:"".concat(e,"__left")},c.courseLaboratory&&_&&I==="true"&&h!=="true"?s().createElement(k.Z,i):null,this.renderTitle(),this.renderContent()),s().createElement("div",{className:"".concat(e,"__right"),style:l?{width:0}:{}},s().createElement("div",{className:"".concat(e,"__right__title")},s().createElement("span",{onClick:this.handleHideCatalog},s().createElement(ne.Z,null),a("course.directory"))),s().createElement("div",{className:"".concat(e,"__right__catalog")},n.map(p=>s().createElement("div",{className:["".concat(e,"__right__catalog__item"),p.id===o?"active":""].join(" "),key:p.id,onClick:()=>this.playCourseware(p.id,p.videoId)},s().createElement(V.Z,{iconClass:this.getSvgIconClass(p),size:"20px"}),s().createElement("span",{className:"".concat(e,"__right__catalog__item__name")}," ",r==="platform"?p.name:p.title))))))}render(){var E=f.parse(v.m8.location.search),e=E.exitAiUpdate,a=this.props.prefixCls,t="".concat(a,"__content__bottom");if(e!=="true")return this.renderOldList();var n=this.state,o=n.labInfo,l=n.whiteList,i=o.labResourceId,c=o.hasVirtual,u=o.againCreate;return s().createElement("div",{className:a},s().createElement("div",{className:"".concat(a,"__content")},l.courseLaboratory&&i&&c==="true"&&u!=="true"?s().createElement(k.Z,o):null,this.renderTitle(),s().createElement("div",{className:"".concat(t,"__box")},this.renderContent(),s().createElement("div",{className:"".concat(t,"__right")},this.renderCourseList(),e==="true"&&(this.state.knowledge.knowledge_graphs.length>0||this.state.knowledge.segmentation_list.length>0||this.state.knowledge.text_list.length>0)&&s().createElement(ue.Z,{ref:this.getKnowledgeGraph,knowledge:this.state.knowledge,watchType:this.state.watchType,playWhere:this.playWhere})))))}}H.defaultProps={prefixCls:"new-watch-course-page"},N.default=(0,le.Z)()((0,se.$j)()(H))}}]);
