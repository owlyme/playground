(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[6546],{29063:function(H,b,e){"use strict";e.r(b),e.d(b,{default:function(){return tt},formFieldLayout:function(){return v}});var D=e(57663),m=e(71577),l=e(62029),M=e(34792),L=e(48086),E=e(12924),t=e.n(E),y=e(76651),h=e(91768),p=e(80991),S=e(57068),P=e(91705),V=e(77883),s=e(21888),i=e(43859);class d extends t().Component{constructor(){super(...arguments);this.handleChange=r=>{this.props.formik.setFieldValue("trainDuration",r)}}render(){var r=this.props.t;return t().createElement(t().Fragment,null,t().createElement(s.Z,{precision:0,min:1,max:99999,disabled:this.props.disabled,value:this.props.defaultValue,onChange:this.handleChange}),t().createElement("span",{style:{marginLeft:"10px"}},r("common.minutes")))}}var K=(0,i.Z)((0,p.$j)((0,h.Z)()(d))),nt=e(47673),J=e(4107),Q=e(49101),U=e(84874);class z extends t().Component{constructor(r){super(r);this.showAddInput=()=>{this.setState({isAdd:!0})},this.addPrincipal=o=>{var a=o.target.value,u=this.props.value;!a.trim()||(u.push(a),this.props.onFieldChange(u),this.setState({isAdd:!1}))},this.removePrincipal=o=>{var a=this.props.value;a.splice(o,1),this.props.onFieldChange(a)},this.state={isAdd:!1}}render(){var r=this.state.isAdd,o=this.props,a=o.value,u=o.t;return t().createElement("div",{className:"principal"},t().createElement("div",null,a.map((c,n)=>t().createElement("span",{className:"principal-item",key:c},c,t().createElement("span",{className:"principal-item-remove",onClick:()=>this.removePrincipal(n)},t().createElement(U.Z,{iconClass:"icon-guanbi1",size:"12px"}))))),r&&t().createElement(J.Z,{className:"principal-input",maxLength:20,onPressEnter:this.addPrincipal,onBlur:this.addPrincipal}),t().createElement(m.Z,{className:"principal-add",onClick:this.showAddInput,icon:t().createElement(Q.Z,null),disabled:a.length>=5},u("submitReport.trainPrincipal")))}}var G=(0,i.Z)((0,h.Z)()(z)),j=e(62615),X=e(52670),Y=e(6793),B=e(7584),w=e(4408),k=e(70075),$=e(3233),T=e(2396),q=e(38642),v={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};class _ extends E.Component{constructor(r){var o;super(r);o=this,this.submit=function(a,u){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"submitted",n=a.title,f=a.datePicker,F=a.classify,C=a.trainDuration,g=a.principal,O=a.address,N=a.content,R=a.attachment,x=o.props.t,A=o.state,I=A.id,et=A.status,rt={title:n,participation_time:(0,Y.jZ)(f),classify_id:F,duration:C,head:g&&g.length>0?g.join(","):"",address:O,content:N,resource_ids:R&&R.length>0?R.map(W=>W.id).join(","):"",submit_status:c,id:I},at=et==="reject"&&c==="submitted";(0,P.a9)(rt,at).then(W=>{W.data.code===0&&(L.default.success(x(c==="draft"?"common.saveSuccess":"common.releaseSuccess")),o.nextJump()),u.setSubmitting(!1)}).catch(()=>{u.setSubmitting(!1)})},this.nextJump=()=>{(0,q.eJ)({url:"/personal/profile?tab=reportRecord"})},this.saveDraft=()=>{var a=this.formRef.state.values,u=this.formRef;this.formRef.setSubmitting(!0),this.formRef.validateForm().then(c=>{Object.keys(c).length===0?this.submit(a,u,"draft"):(this.dealNormalError(c),this.formRef.setSubmitting(!1))})},this.dealNormalError=a=>{for(var u in a)a[u]&&this.formRef.setFieldTouched(u,!0)},this.initRef=a=>{this.formRef=a},this.state={id:"",requesting:!1,status:""},this.initialValues={title:"",datePicker:"",classify:"",trainDuration:"",principal:[],address:"",content:"",attachment:[],submit_status:""}}componentDidMount(){this.getReportInfo()}getReportInfo(){var r=S.parse(y.m8.location.search),o=r.id,a=r.isPreview,u=a===void 0?!1:a;if(!o){this.setState({requesting:!0});return}(0,P.ON)(o).then(c=>{if(c.data.code===0){var n=c.data.data,f=n.title,F=n.participation_time,C=n.classify_id,g=n.classifyName,O=n.duration,N=n.head,R=n.address,x=n.content,A=n.resources,I=n.status;this.initialValues={title:f,datePicker:new Date(Number(F)),classify:C===0?"":C,classifyName:g,trainDuration:O,principal:N?N.split(","):[],address:R,content:x,attachment:A||[]},this.setState({requesting:!0,id:o,isPreview:u,status:I})}})}render(){var r=this.props.t,o=this.state,a=o.requesting,u=o.isPreview,c=o.id;return t().createElement("div",{className:"apply-report"},t().createElement(w.Z,{title:r("submitReport.applyReport")}),t().createElement("div",{className:"apply-report__content"},a&&t().createElement(p.J9,{ref:this.initRef,initialValues:this.initialValues,onSubmit:this.submit,render:n=>t().createElement(p.l0,{className:"cl-form"},t().createElement("h1",{className:"cl-form-htitle"},u?r("common.preview"):"",c&&!u?r("common.edit"):"",r("submitReport.applyReport")),t().createElement(p.gN,(0,l.Z)({name:"title",label:t().createElement("span",{className:"label-word"},r("submitReport.reportTitle")),required:!0,component:B.Z,validate:f=>(0,T.QK)(f,r("submitReport.reportTitlePlaceHolder")),maxLength:60,width:"500px",defaultValue:n.values.title,placeholder:r("submitReport.reportTitlePlaceHolder"),type:"text"},v)),t().createElement(p.gN,(0,l.Z)({component:j.Mt,displayType:"Custom",name:"datePicker",label:r("pk.participationTime"),required:!0,normalDisplay:!0,defaultFieldList:n.values.datePicker,validate:X.Pe},v)),t().createElement(p.gN,(0,l.Z)({name:"classify",label:r("learning.learningProjectAddCategory"),displayType:"Custom",defaultValue:n.values.classify,component:j.O,unclassified:!0,classifyName:n.values.classifyName,showAdd:!1},v)),t().createElement(p.gN,(0,l.Z)({name:"trainDuration",label:r("submitReport.trainDuration"),component:K,defaultValue:n.values.trainDuration},v)),t().createElement(p.gN,(0,l.Z)({name:"principal",label:r("submitReport.trainPrincipal"),displayType:"Custom",value:n.values.principal,component:G},v)),t().createElement(p.gN,(0,l.Z)({name:"address",label:t().createElement("span",{className:"label-word"},r("submitReport.participatingAddress")),required:!0,component:B.Z,validate:f=>(0,T.QK)(f,r("submitReport.participatingAddressPlaceHolder")),maxLength:50,width:"500px",defaultValue:n.values.address,placeholder:r("submitReport.participatingAddressPlaceHolder"),type:"text"},v)),t().createElement(p.gN,(0,l.Z)({name:"content",label:t().createElement("span",{className:"label-word"},r("submitReport.reportContent")),required:!0,component:k.Z,maxLength:1200,validate:f=>(0,T.QK)(f,r("submitReport.reportContentPlaceHolder")),defaultValue:n.values.content,placeholder:r("submitReport.reportContentPlaceHolder"),type:"text"},v)),t().createElement(p.gN,(0,l.Z)({name:"attachment",label:r("component.practiceAttachment"),component:$.Z,displayType:"Custom",removeable:!0,notLibrary:!0,canSelectCourse:!1,maxFilesCount:50,uploadComponentId:"aead50ed-12d8-40ee-9c26-bf6151db340d",uploadTips:(0,Y.ZT)(r("submitReport.uploadFileReportTip"),50)},v)),t().createElement("div",{className:"cl-form-fixed-footer"},t().createElement("div",{className:"cl-form-fixed-footer__container"},u?null:t().createElement(m.Z,{className:"form-page-container-bottom-btn",loading:n.isSubmitting,onClick:n.submitForm,type:"primary"},r("common.release")),u?null:t().createElement(m.Z,{className:"form-page-container-bottom-btn",loading:n.isSubmitting,onClick:this.saveDraft},r("common.draft")),t().createElement(m.Z,{className:"form-page-container-bottom-btn",onClick:this.nextJump},r("common.cancel")))))})))}}var tt=(0,y.$j)(Z=>({userLng:Z.user}))((0,h.Z)()(_))},91705:function(H,b,e){"use strict";e.d(b,{Bw:function(){return M},CM:function(){return L},L_:function(){return E},m5:function(){return t},dB:function(){return y},P8:function(){return h},Ad:function(){return p},mr:function(){return S},a9:function(){return P},ON:function(){return V}});var D=e(88986),m=e(37055),l=e(10237);function M(s,i){var d=m.ZP.submitReport.reportRecordList();return l.WY.get({url:d,params:(0,D.Z)((0,D.Z)({},s),i)})}function L(s){var i=m.ZP.submitReport.deleteReportRecord(s);return l.WY.post({url:i})}function E(s){var i=m.ZP.submitReport.reportApprove();return l.WY.get({url:i,params:s})}function t(s,i){var d=m.ZP.submitReport.getApproveRecord(s,i);return l.WY.get({url:d})}function y(s){var i=m.ZP.submitReport.approveDraft(s);return l.WY.get({url:i})}function h(s,i){var d=m.ZP.submitReport.submitApprove(s);return l.WY.post({url:d,data:i})}function p(s){var i=m.ZP.submitReport.reportManageList();return l.WY.get({url:i,params:s})}function S(s){var i="".concat(m.ZP.submitReport.sureToImportReport());return l.WY.post({url:i,params:s})}function P(s,i){var d=i?m.ZP.submitReport.reSubmit():m.ZP.submitReport.addOrEdit();return l.WY.post({url:d,data:s})}function V(s){var i=m.ZP.submitReport.getDetails(s);return l.WY.get({url:i})}}}]);
