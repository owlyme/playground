(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[9508],{7065:function(Te,K,o){"use strict";o.r(K),o.d(K,{default:function(){return ht}});var Ce=o(57663),S=o(71577),q=o(62029),Y=o(71194),oe=o(57016),F=o(34792),V=o(48086),w=o(57068),X=o(12924),n=o.n(X),re=o(15873),x=o(80991),B=o(36546),c=o(44289),Z=o(91768),W=o(50361),_=o.n(W),le=o(44970),l=o(18329);class A extends n().Component{constructor(s){super(s);this.setQuestionValue=(e,t)=>{var i=this.state.questionnaireInfo;i.questions[e].value=t,this.setState({questionnaireInfo:i})},this.onCancel=()=>{this.props.onCancel()},this.state={questionnaireInfo:{title:"",description:"",questions:[]}}}componentDidUpdate(s){if(s.visible!==this.props.visible&&this.props.visible){var e=this.props.questionnaireInfo,t=e.title,i=e.description,a=e.questions;this.setState({questionnaireInfo:{title:t,description:i,questions:a.map(r=>{var p={title:r.title,type:r.type,is_must:""+r.must};return r.type==="single"||r.type==="multiple"?(p.other=r.other.hasOther,p.options=r.options.map(m=>({title:m.title,other:m.other})),r.other.hasOther&&p.options.push({title:this.props.t("leftMenuLists.other"),other:!0})):r.type==="input"?p.is_multiple_rows=""+r.multiple_rows:r.type==="score"&&(r.options.forEach(m=>m.key=m.order_id),p.options=r.options,p.instruction=r.instruction,p.instruction_must=r.instruction_must),p})}})}}render(){var s=this.state.questionnaireInfo,e=this.props.t,t={title:"".concat(e("common.questionnaire")).concat(e("component.preview")),footer:null,size:"large",destroyOnClose:!0,bodyStyle:{padding:"30px"},maskClosable:!1};return n().createElement(l.ZP,(0,q.Z)({},t,{visible:this.props.visible,onCancel:this.onCancel}),n().createElement(le.Z,{questionnaireInfo:s,setQuestionValue:this.setQuestionValue}))}}var P=(0,Z.Z)()(A),$=o(43859),T=o(20560);class Q extends n().Component{constructor(){super(...arguments);this.handleChange=s=>{this.props.onFieldChange(s)}}render(){var s=this.props,e=s.value,t=s.classifyName;return n().createElement(T.Z,{className:"qa-select-classify-drop-down",onFieldChange:this.handleChange,classifyName:t,value:e,questionnaire:!0})}}var C=(0,$.Z)(Q),D=o(86458),k=o(84874);class xe extends n().Component{constructor(){super(...arguments);this.handleDND=(s,e)=>{console.log(12,s,e)},this.renderItem=(s,e)=>n().createElement(D.Z,{id:s.id,key:s.type,title:s.name,index:e,onDND:this.handleDND},n().createElement("div",{className:"question-component-item",key:s.type,onClick:()=>this.props.addQuestion(s.type)},n().createElement("div",{className:"question-component-item-icon"},n().createElement(k.Z,{iconClass:"icon-".concat(s.icon),size:"20px"})),n().createElement("div",{className:"question-component-item-name"},s.label)))}render(){var s=this.props,e=s.questionComponentList,t=s.t;return n().createElement("div",{className:"questionnaire-edit-components"},n().createElement("div",{className:"questionnaire-edit-components-title"},t("learning.questionnaireAddToolTitle")),n().createElement("div",{className:"questionnaire-edit-components-list qa-question-selector"},e.map((i,a)=>this.renderItem(i,a))))}}var Ne=(0,Z.Z)()(xe),dt=o(88983),ee=o(47933),mt=o(63185),z=o(9676),vt=o(22385),L=o(31097),gt=o(47673),U=o(4107),Ie=o(53792),Qe=o.n(Ie),De=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"CARD",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["CARD"],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function(){var a={beginDrag(d){return{index:d.index}}},r={canDrop(d,u){return e.indexOf(u.getItemType())!==-1},hover(d,u,O){if(!d.disabled){var y=document.getElementById("$Cl_drag_".concat(d.id));if(!O||!y)return null;var v=u.getItem().index,g=u.getItemType(),h=g!==e[0];if(h)return null;var I=d.index;if(v===d.lastIndex||I===d.lastIndex||v===I)return null;d.onDND(v,I),u.getItem().index=I}},drop(d,u,O){if(!d.disabled){var y=document.getElementById("$Cl_drag_".concat(d.id));if(!O||!y)return null;var v=u.getItem().index,g=u.getItemType(),h=g!==e[0];if(!!t){var I=d.index;d.onDND(v,I,h),u.getItem().index=I}}}};function p(d,u){return{connectDropTarget:d.dropTarget(),isOver:u.isOver(),isOverCurrent:u.isOver({shallow:!0}),canDrop:u.canDrop(),itemType:u.getItemType()}}function m(d,u){return{connectDragSource:d.dragSource(),isDragging:u.isDragging()}}class f extends X.Component{render(){var u=this.props,O=u.isDragging,y=u.connectDragSource,v=u.connectDropTarget,g=u.wrapperInTable,h=O?.7:1;return y(v(g?n().createElement("tr",{id:"$Cl_drag_".concat(this.props.id),style:{opacity:h}},this.props.children):n().createElement("div",{id:"$Cl_drag_".concat(this.props.id),style:{opacity:h}},this.props.children)))}}return f.defaultProps={wrapperInTable:!1,disabled:!1},Qe()((0,B.Ej)(s,a,m),(0,B.GR)(e,r,p))(f)}},ce=De,qe=ce("OPTION",["OPTION"],!1)(),pe=U.Z.TextArea;class Se extends n().Component{constructor(s){super(s);this.selectText=e=>{e.currentTarget.select()},this.setOptionValue=e=>{var t=this.state.optionValue,i=this.props.multiple,a=t.indexOf(e);i?a!==-1?t.splice(a,1):t.push(e):t=[e],this.setState({optionValue:t})},this.renderOptions=(e,t)=>{var i=this.state.optionValue,a=this.props,r=a.other,p=a.multiple,m=a.options,f=a.t;return n().createElement(qe,{id:"",key:t,title:e.title,index:t,onDND:this.props.handleDND},n().createElement("div",{className:"question-item-options-item"},n().createElement(L.Z,{title:f("learning.questionnaireAddQusDragTip"),placement:"left"},n().createElement("span",{className:"drag-icon drag-handle ".concat(p?"":"radio-option-drag")},n().createElement(k.Z,{iconClass:"icon-yidong",size:"16px"}))),p?n().createElement(z.Z,{checked:i.indexOf(t)!==-1,onClick:()=>this.setOptionValue(t),className:"option-item-radio"},n().createElement("div",{className:"option-item-label"},n().createElement(pe,{className:"option-item-input",onFocus:this.selectText,autoSize:!0,value:e.title,maxLength:150,onInput:d=>this.props.handleOptionTitleInput(d,t)}))):n().createElement(ee.ZP,{checked:i[0]===t,onClick:()=>this.setOptionValue(t),className:"option-item-radio"},n().createElement("div",{className:"option-item-label"},n().createElement(pe,{className:"option-item-input radio-input",onFocus:this.selectText,autoSize:!0,value:e.title,maxLength:150,onInput:d=>this.props.handleOptionTitleInput(d,t)}))),m.length>1||r.hasOther?n().createElement("span",{className:"option-item-delete",onClick:()=>this.props.removeOption(t)},n().createElement(k.Z,{iconClass:"icon-icon_close",size:"16px"})):null))},this.renderOtherOption=()=>{var e=this.props,t=e.other,i=e.multiple,a=e.options,r=this.state.optionValue;return n().createElement("div",{className:"question-item-options-item other-option"},i?n().createElement(z.Z,{checked:r.indexOf(-1)!==-1,onClick:()=>this.setOptionValue(-1),className:"option-item-radio"},n().createElement("div",{className:"option-item-label"},n().createElement("span",{className:"option-label"},t.title),n().createElement("input",{className:"other-option-input"}))):n().createElement(ee.ZP,{checked:r[0]===-1,onClick:()=>this.setOptionValue(-1),className:"option-item-radio"},n().createElement("div",{className:"option-item-label"},n().createElement("span",{className:"option-label"},t.title),n().createElement("input",{className:"other-option-input"}))),a.length>=1?n().createElement("span",{className:"option-item-delete",onClick:this.props.removeOtherOption},n().createElement(k.Z,{iconClass:"icon-icon_close",size:"16px"})):null)},this.state={optionValue:[]}}render(){var s=this.props,e=s.options,t=s.other,i=s.t,a=localStorage.getItem("themeColor")||"#465dcd";return n().createElement(n().Fragment,null,n().createElement("div",{className:"question-item-options"},e.map((r,p)=>r.other?null:this.renderOptions(r,p)),t.hasOther?this.renderOtherOption():null),n().createElement("div",{className:"question-item-option-operate"},e.length<30?n().createElement("span",{className:"operate-span",style:{color:a},onClick:this.props.addOption},i("learning.questionnaireAddQusOptionAdd")):null,e.length<30&&!t.hasOther?n().createElement("span",null,"|"):null,t.hasOther?null:n().createElement("span",{className:"operate-span",style:{color:a},onClick:this.props.addOther},i("learning.questionnaireAddQusOtherAdd"))))}}var ue=(0,Z.Z)()(Se),Ze=U.Z.TextArea;class Me extends n().Component{constructor(){super(...arguments);this.selectText=s=>{s.currentTarget.select()}}render(){var s=this.props,e=s.title,t=s.t;return n().createElement("div",{className:"question-item-title"},n().createElement(Ze,{className:"question-item-title-input",autoSize:!0,onFocus:this.selectText,value:e,maxLength:300,onInput:this.props.handleTitleInput}),n().createElement("div",{className:"drag-icon question-item-handle"},n().createElement(L.Z,{title:t("learning.questionnaireAddQusDragTip"),placement:"top"},n().createElement(k.Z,{iconClass:"icon-yidong",size:"16px"}))))}}var j=(0,Z.Z)()(Me),Et=o(62350),Ae=o(75443);class we extends n().Component{render(){var s=this.props,e=s.must,t=s.withMultipleRow,i=s.multiple_rows,a=s.t;return n().createElement("div",{className:"question-item-operate"},n().createElement("div",{className:"left-operate"},n().createElement(z.Z,{checked:e,onClick:this.props.changeMust},a("learning.questionnaireAddQusRequired")),t?n().createElement(z.Z,{checked:i,onClick:this.props.changeMultipleRow},a("learning.questionnaireAddQusMulrow")):null),n().createElement("div",{className:"right-operate"},n().createElement(Ae.Z,{title:a("common.confirmDeleteTitle"),onConfirm:this.props.removeQuestion},n().createElement("span",{className:"operate-span"},a("common.delete"))),n().createElement("span",{className:"operate-span",onClick:this.props.copyQuestion},a("learning.questionnaireAddQusCopy"))))}}var G=(0,Z.Z)()(we);class Pe extends n().Component{constructor(){super(...arguments);this.handleDND=(s,e)=>{var t=this.props.index;this.props.sortOption(t,s,e)},this.handleTitleInput=s=>{var e=s.target.value,t=this.props.index;this.props.changeTitle(t,e)},this.handleOptionTitleInput=(s,e)=>{var t=s.target.value,i=this.props.index;this.props.changeOptionTitle(i,e,t)},this.selectText=s=>{s.currentTarget.select()},this.removeOption=s=>{var e=this.props.index;this.props.removeOption(e,s)},this.removeOtherOption=()=>{var s=this.props.index;this.props.removeOtherOption(s)},this.copyQuestion=s=>{s.stopPropagation();var e=this.props.index;this.props.copyQuestion(e)}}render(){var s=this.props,e=s.options,t=s.other,i=s.active,a=s.title,r=s.must,p=s.index,m=localStorage.getItem("themeColor")||"#516ae6";return n().createElement("div",{className:"question-item-container radio-question ".concat(i?"active":""),style:i?{borderTopColor:m}:{},onClick:()=>this.props.changeActive(p)},n().createElement(j,{handleTitleInput:this.handleTitleInput,title:a}),n().createElement(ue,{options:e,other:t,handleDND:this.handleDND,handleOptionTitleInput:this.handleOptionTitleInput,removeOption:this.removeOption,removeOtherOption:this.removeOtherOption,addOption:()=>this.props.addOption(p),addOther:()=>this.props.addOther(p)}),n().createElement(G,{must:r,changeMust:()=>this.props.changeMust(p),copyQuestion:this.copyQuestion,removeQuestion:()=>this.props.removeQuestion(p)}))}}var Le=Pe;class Re extends n().Component{constructor(){super(...arguments);this.handleDND=(s,e)=>{var t=this.props.index;this.props.sortOption(t,s,e)},this.handleTitleInput=s=>{var e=s.target.value,t=this.props.index;this.props.changeTitle(t,e)},this.handleOptionTitleInput=(s,e)=>{var t=s.target.value,i=this.props.index;this.props.changeOptionTitle(i,e,t)},this.selectText=s=>{s.currentTarget.select()},this.removeOption=s=>{var e=this.props.index;this.props.removeOption(e,s)},this.copyQuestion=s=>{s.stopPropagation();var e=this.props.index;this.props.copyQuestion(e)},this.removeOtherOption=()=>{var s=this.props.index;this.props.removeOtherOption(s)}}render(){var s=this.props,e=s.options,t=s.other,i=s.active,a=s.title,r=s.must,p=s.index,m=localStorage.getItem("themeColor")||"#516ae6";return n().createElement("div",{className:"question-item-container multiple-question ".concat(i?"active":""),style:i?{borderTopColor:m}:{},onClick:()=>this.props.changeActive(p)},n().createElement(j,{handleTitleInput:this.handleTitleInput,title:a}),n().createElement(ue,{multiple:!0,options:e,other:t,handleDND:this.handleDND,handleOptionTitleInput:this.handleOptionTitleInput,removeOption:this.removeOption,removeOtherOption:this.removeOtherOption,addOption:()=>this.props.addOption(p),addOther:()=>this.props.addOther(p)}),n().createElement(G,{must:r,changeMust:()=>this.props.changeMust(p),copyQuestion:this.copyQuestion,removeQuestion:()=>this.props.removeQuestion(p)}))}}var be=Re,Fe=U.Z.TextArea;class Ve extends n().Component{constructor(s){super(s);this.handleDND=(e,t)=>{var i=this.props.index;this.props.sortOption(i,e,t)},this.handleTitleInput=e=>{var t=e.target.value,i=this.props.index;this.props.changeTitle(i,t)},this.handleOptionTitleInput=(e,t)=>{var i=e.target.value,a=this.props.index;this.props.changeOptionTitle(a,t,i)},this.selectText=e=>{e.currentTarget.select()},this.setOptionValue=e=>{this.setState({optionValue:e})},this.removeOption=e=>{var t=this.props.index;this.props.removeOption(t,e)},this.copyQuestion=e=>{e.stopPropagation();var t=this.props.index;this.props.copyQuestion(t)},this.state={optionValue:""}}render(){var s=this.props,e=s.active,t=s.title,i=s.must,a=s.index,r=s.multiple_rows,p=localStorage.getItem("themeColor")||"#516ae6";return n().createElement("div",{className:"question-item-container input-question ".concat(e?"active":""),style:e?{borderTopColor:p}:{},onClick:()=>this.props.changeActive(a)},n().createElement(j,{handleTitleInput:this.handleTitleInput,title:t}),n().createElement("div",{className:"question-item-input"},r?n().createElement(Fe,{rows:2,disabled:!0}):n().createElement(U.Z,{disabled:!0})),n().createElement(G,{must:i,multiple_rows:r,withMultipleRow:!0,changeMust:()=>this.props.changeMust(a),copyQuestion:this.copyQuestion,removeQuestion:()=>this.props.removeQuestion(a),changeMultipleRow:()=>this.props.changeMultipleRow(a)}))}}var Be=Ve,ft=o(77576),We=o(59314),yt=o(66456),$e=o(55313),Ot=o(96433),ke=o(33304),Tt=o(49111),te=o(19650),Ct=o(77883),Ue=o(21888),Ke=o(81211),ne=o(95742),ze=o(80454),je=o.n(ze),Ge=o(42762),he=o(49101),Je=o(1058),He=o(30988),N=o.n(He),Ye=(0,ne.W6)(()=>n().createElement(Ge.Z,{style:{cursor:"grab",color:"#999"}})),Xe=(0,ne.W8)(E=>n().createElement("tr",E)),_e=(0,ne.JN)(E=>n().createElement("tbody",E));class et extends n().Component{constructor(s){super(s);this.dataSource=()=>{var e=this.props.options;return e.map(t=>({key:t.key,title:t.title,score:t.score,index:t.key}))},this.selectText=e=>{e.currentTarget.select()},this.onSortEnd=e=>{var t=e.oldIndex,i=e.newIndex,a=this.props,r=a.index,p=a.reSortScoreOption,m=this.dataSource();if(t!==i){var f=je()([].concat(m),t,i).filter(d=>!!d);p(r,f)}},this.DraggableContainer=e=>n().createElement(_e,(0,q.Z)({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:this.onSortEnd},e)),this.DraggableBodyRow=e=>{var t=e.className,i=e.style,a=(0,Ke.Z)(e,["className","style"]),r=this.dataSource(),p=r.findIndex(m=>m.index===a["data-row-key"]);return n().createElement(Xe,(0,q.Z)({index:p},a))},this.handleChangeList=(e,t)=>{var i=this.props.options;if(e==="add"&&i.length>=10)return V.default.info(this.props.t("learning.scoreMax")),!1;var a=this.props.index;this.props.addScoreOption(e,a,t)},this.state={radioOptions:[{label:s.t("learning.optional"),value:!1},{label:s.t("learning.required"),value:!0}]}}render(){var s=this.dataSource(),e=this.props,t=e.handleTitleInput,i=e.title,a=e.changeScoreText,r=e.index,p=e.instruction,m=e.instruction_must,f=e.changeInstruction,d=e.changeInstructionMust,u=e.t,O=[{title:u("learning.optionalText"),dataIndex:"title",width:434,render:(y,v,g)=>n().createElement("div",{className:N()["input-box"]},n().createElement(U.Z,{className:"".concat(!y&&N()["input-box-err"]," ").concat(N()["input-box-input"]),defaultValue:y,maxLength:240,showCount:!0,onChange:h=>{a("title",h.target.value,r,g)},status:!!y||"warning"}))},{title:u("learning.score"),dataIndex:"score",width:310,render:(y,v,g)=>n().createElement(te.Z,{size:12},n().createElement(Ue.Z,{className:N()["score-input"],min:0,max:999,defaultValue:y,onChange:h=>{a("score",h,r,g)},formatter:h=>h?parseInt(h):0}),n().createElement(L.Z,{title:s.length>=10?u("learning.scoreMax"):u("learning.scoreAddUnder")},n().createElement(S.Z,{className:N()["score-button"],size:"small",shape:"circle",disabled:s.length>=10,onClick:()=>{this.handleChangeList("add",g)},icon:n().createElement(he.Z,{style:{color:"rgba(0, 0, 0, 0.15)",fontSize:"11px"}})})),s.length>2&&n().createElement(L.Z,{title:u("learning.scoreDeleteTip")},n().createElement(S.Z,{className:N()["score-button"],size:"small",shape:"circle",onClick:()=>{this.handleChangeList("minues",g)},icon:n().createElement(Je.Z,{style:{color:"rgba(0, 0, 0, 0.15)",fontSize:"11px"}})})))},{title:"",dataIndex:"sort",width:30,className:"drag-visible",render:()=>n().createElement(Ye,null)}];return n().createElement("div",{className:N()["rate-extend"]},n().createElement("div",{className:N()["rate-extend-box"]},n().createElement(te.Z,{direction:"vertical"},n().createElement("div",{className:N()["rate-extend-box-title"]},i),n().createElement("div",{className:N()["score-box"]},n().createElement(L.Z,{title:s[0].title},n().createElement("div",{className:N()["score-title"]},s[0].title)),n().createElement("div",{className:N()["score-rate"]},n().createElement(ke.Z,{className:N()["rate-extend-box-rate"],disabled:!0,value:0,count:s.length})),n().createElement(L.Z,{title:s[s.length-1].title},n().createElement("div",{className:N()["score-title"]},s[s.length-1].title))))),n().createElement(j,{handleTitleInput:t,title:i}),n().createElement("div",{className:N()["rate-extend-table"]},n().createElement($e.Z,{pagination:!1,dataSource:s,columns:O,rowKey:"index",components:{body:{wrapper:this.DraggableContainer,row:this.DraggableBodyRow}}})),n().createElement("div",null,n().createElement(L.Z,{title:s.length>=10?u("learning.scoreMax"):u("learning.scoreAddUnder")},n().createElement(S.Z,{onClick:()=>{this.handleChangeList("add",s.length-1)},type:"link",shape:"circle",icon:n().createElement(he.Z,null),disabled:s.length>=10},u("learning.addOption")))),n().createElement(te.Z,null,n().createElement("span",null,u("learning.studentExplanation")),n().createElement("div",{className:N()["rate-extend-switch"]},n().createElement(We.Z,{checked:p,onChange:y=>{f(r,y)}})),p&&n().createElement(ee.ZP.Group,{options:this.state.radioOptions,onChange:y=>{d(r,y.target.value)},value:m,optionType:"button",buttonStyle:"solid"})))}}var tt=(0,Z.Z)()(et);class nt extends n().Component{constructor(s){super(s);this.handleDND=(e,t)=>{var i=this.props.index;this.props.sortOption(i,e,t)},this.handleTitleInput=e=>{var t=e.target.value,i=this.props.index;this.props.changeTitle(i,t)},this.handleOptionTitleInput=(e,t)=>{var i=e.target.value,a=this.props.index;this.props.changeOptionTitle(a,t,i)},this.selectText=e=>{e.currentTarget.select()},this.removeOption=e=>{var t=this.props.index;this.props.removeOption(t,e)},this.copyQuestion=e=>{e.stopPropagation();var t=this.props.index;this.props.copyQuestion(t)},this.state={}}render(){var s=this.props,e=s.active,t=s.title,i=s.must,a=s.index,r=s.multiple_rows,p=s.options,m=p===void 0?[]:p,f=s.addScoreOption,d=s.reSortScoreOption,u=s.changeScoreText,O=s.changeInstruction,y=s.changeInstructionMust,v=s.instruction,g=s.instruction_must,h=localStorage.getItem("themeColor")||"#516ae6";return n().createElement("div",{className:"question-item-container score-question ".concat(e?"active":""),style:e?{borderTopColor:h}:{},onClick:()=>this.props.changeActive(a)},n().createElement("div",{className:"question-item-score"},n().createElement(tt,{options:m,addScoreOption:f,reSortScoreOption:d,changeScoreText:u,changeInstruction:O,changeInstructionMust:y,instruction:v,instruction_must:g,index:a,handleTitleInput:this.handleTitleInput,title:t})),n().createElement(G,{must:i,multiple_rows:r,changeMust:()=>this.props.changeMust(a),copyQuestion:this.copyQuestion,removeQuestion:()=>this.props.removeQuestion(a)}))}}var st=nt,it={Single:Le,Multiple:be,Input:Be,Score:st},J=it,de=ce("QUESTION",["QUESTION","CARD"],!0)();class at extends n().Component{constructor(s){super(s);this.changeActive=e=>{this.setState({active:e})},this.changeTitle=(e,t)=>{var i=this.props.value;i[e].title=t,this.props.onFieldChange(i)},this.changeOptionTitle=(e,t,i)=>{var a=this.props.value;a[e].options[t].title=i,this.props.onFieldChange(a)},this.addOption=e=>{var t=this.props,i=t.value,a=t.t,r=i[e];r.options.push({value:"".concat(a("learning.questionnaireAddQusOption")).concat(r.options.length+1),title:"".concat(a("learning.questionnaireAddQusOption")).concat(r.options.length+1),other:!1}),this.props.onFieldChange(i)},this.addScoreOption=(e,t,i)=>{var a=this.props.value,r=a[t];e==="minues"?r.options.splice(i,1):r.options.splice(i+1,0,{title:"",score:r.options.length+1,key:new Date().getTime()}),this.props.onFieldChange(a)},this.changeInstruction=(e,t)=>{var i=this.props.value,a=i[e];a.instruction=t,t||this.changeInstructionMust(e,!1),this.props.onFieldChange(i)},this.changeInstructionMust=(e,t)=>{var i=this.props.value,a=i[e];a.instruction_must=t,this.props.onFieldChange(i)},this.reSortScoreOption=(e,t)=>{var i=this.props.value,a=i[e];a.options=t,this.props.onFieldChange(i)},this.changeScoreText=(e,t,i,a)=>{var r=this.props.value,p=r[i];p.options[a][e]=t,this.props.onFieldChange(r)},this.changeMust=e=>{var t=this.props.value;t[e].must=!t[e].must,this.props.onFieldChange(t)},this.addOther=e=>{var t=this.props.value;t[e].other.hasOther=!0,this.props.onFieldChange(t)},this.removeOtherOption=e=>{var t=this.props.value;t[e].other.hasOther=!1,this.props.onFieldChange(t)},this.removeQuestion=e=>{var t=this.props.value;t.splice(e,1),this.props.onFieldChange(t)},this.removeOption=(e,t)=>{var i=this.props.value;i[e].options.splice(t,1),this.props.onFieldChange(i)},this.sortOption=(e,t,i)=>{var a=this.props.value,r=a[e],p=r.options[t];r.options.splice(t,1),r.options.splice(i,0,p),this.props.onFieldChange(a)},this.copyQuestion=e=>{var t=this.props.value,i=t[e],a=i.type,r=i.must,p=i.title,m=i.instruction,f=i.instruction_must,d={type:a,must:r,title:p};a==="single"||a==="multiple"?(d.options=t[e].options.map(u=>Object.assign({},u)),d.other=Object.assign({},t[e].other)):a==="input"?d.multiple_rows=t[e].multiple_rows:a==="score"&&(d.instruction=!!m,d.instruction_must=!!f,d.options=t[e].options.map(u=>Object.assign({},u))),d.componentId="component".concat(new Date().getTime()),t.splice(e+1,0,d),this.props.onFieldChange(t),this.changeActive(e+1)},this.changeMultipleRow=e=>{var t=this.props.value;t[e].multiple_rows=!t[e].multiple_rows,this.props.onFieldChange(t)},this.sortQuestion=(e,t,i)=>{var a=this.props.value;if(i)this.props.addQuestion("",t,e);else{var r=a[e];a.splice(e,1),a.splice(t,0,r),this.props.onFieldChange(a)}this.changeActive(t)},this.renderQuestionItem=(e,t)=>{var i=this.state.active;switch(e.type){case"single":return n().createElement(J.Single,(0,q.Z)({key:e.componentId},e,{index:t,active:i===t,changeActive:this.changeActive,changeTitle:this.changeTitle,changeOptionTitle:this.changeOptionTitle,addOption:this.addOption,changeMust:this.changeMust,removeQuestion:this.removeQuestion,addOther:this.addOther,removeOption:this.removeOption,sortOption:this.sortOption,copyQuestion:this.copyQuestion,removeOtherOption:this.removeOtherOption}));case"multiple":return n().createElement(J.Multiple,(0,q.Z)({key:e.componentId},e,{index:t,active:i===t,changeActive:this.changeActive,changeTitle:this.changeTitle,changeOptionTitle:this.changeOptionTitle,addOption:this.addOption,changeMust:this.changeMust,removeQuestion:this.removeQuestion,addOther:this.addOther,removeOption:this.removeOption,sortOption:this.sortOption,copyQuestion:this.copyQuestion,removeOtherOption:this.removeOtherOption}));case"input":return n().createElement(J.Input,(0,q.Z)({key:e.componentId},e,{index:t,active:i===t,changeActive:this.changeActive,changeTitle:this.changeTitle,changeMust:this.changeMust,removeQuestion:this.removeQuestion,copyQuestion:this.copyQuestion,changeMultipleRow:this.changeMultipleRow}));case"score":return n().createElement(J.Score,(0,q.Z)({key:e.componentId},e,{index:t,active:i===t,changeActive:this.changeActive,changeTitle:this.changeTitle,changeMust:this.changeMust,removeQuestion:this.removeQuestion,copyQuestion:this.copyQuestion,addScoreOption:this.addScoreOption,reSortScoreOption:this.reSortScoreOption,changeScoreText:this.changeScoreText,changeInstruction:this.changeInstruction,changeInstructionMust:this.changeInstructionMust}));default:break}},this.state={active:0}}render(){var s=this.props,e=s.value,t=s.t;return n().createElement("div",{className:"questionnaire-question-list"},e.length===0?n().createElement(de,{id:"drag-question-tip",key:0,title:"",index:0,onDND:this.sortQuestion},n().createElement("div",{className:"drag-tip"},t("learning.questionnaireAddBtn"))):null,e.map((i,a)=>n().createElement(de,{id:i.componentId,key:a,title:i.title,index:a,onDND:this.sortQuestion},this.renderQuestionItem(i,a))))}}var ot=(0,$.Z)((0,Z.Z)()(at)),me=o(6793),ve=o(3407),ge=(0,me.me)(),Ee={classify:E=>{var s;return(!E||E.length===0)&&(s=ve.Z[ge].validation.checkClassify),s},questions:E=>{var s;return(!E||E.length===0)&&(s=ve.Z[ge].exam.validation.itemPaperQus),s}},rt=o(7584),lt=o(70075),se=o(62615),ct=o(52670),pt=o(4408),ie=o(37055),fe=o(10237),ye=o(2396),Oe=o(28531),H={labelCol:{xs:{span:3},sm:{span:3}},wrapperCol:{xs:{span:16},sm:{span:16}}},R=!1;class ut extends n().Component{constructor(s){var e;super(s);e=this,this.questionComponentList=[{icon:"danxuangongneng",label:this.props.t("learning.questionnaireAddToolSingle"),type:"single"},{icon:"duoxuangongneng",label:this.props.t("learning.questionnaireAddToolMul"),type:"multiple"},{icon:"shurukuanggongneng",label:this.props.t("learning.questionnaireAddToolInput"),type:"input"},{icon:"pingfengongneng",label:this.props.t("learning.questionnaireAddToolScore"),type:"score"}],this.defaultComponentConfig={single:{type:"single",must:!1,title:this.props.t("learning.questionnaireAddToolSingle"),options:[{value:"".concat(this.props.t("learning.questionnaireAddQusOption"),"1"),title:"".concat(this.props.t("learning.questionnaireAddQusOption"),"1"),other:!1}],other:{hasOther:!1,title:this.props.t("learning.questionnaireAddQusOptionOther")}},multiple:{type:"multiple",must:!1,title:this.props.t("learning.questionnaireAddToolMul"),options:[{value:"".concat(this.props.t("learning.questionnaireAddQusOption"),"1"),title:"".concat(this.props.t("learning.questionnaireAddQusOption"),"1"),other:!1}],other:{hasOther:!1,title:this.props.t("learning.questionnaireAddQusOptionOther")}},input:{type:"input",must:!1,title:this.props.t("learning.questionnaireAddToolInput"),multiple_rows:!1},score:{type:"score",must:!1,options:[{title:this.props.t("learning.veryDisgruntled"),score:1,key:1,other:"false"},{title:this.props.t("learning.dissatisfaction"),score:2,key:2,other:"false"},{title:this.props.t("component.questionGeneral"),score:3,key:3,other:"false"},{title:this.props.t("learning.satisfaction"),score:4,key:4,other:"false"},{title:this.props.t("learning.quiteSatisfied"),score:5,key:5,other:"false"}],title:this.props.t("learning.scoreTitle"),instruction:!1,instruction_must:!1}},this.initRef=t=>{this.formRef=t},this.saveDraft=()=>{this.setState({saveType:"draft"},()=>{this.formRef.submitForm()})},this.saveRelease=()=>{this.setState({saveType:"release"},()=>{this.formRef.submitForm()})},this.submit=(t,i)=>{var a=this.props.t,r=t.questions,p=!1;if(r.forEach(h=>{h.type==="score"&&h.options.forEach(I=>{I.score===null&&(I.score=0),I.title===""&&(p=!0)})}),p)return V.default.warning(this.props.t("learning.scoreNoFill")),i.setSubmitting(!1),!1;var m=R?ie.ZP.EditQuestionnaire.editQuestioninaire(this.state.questionnaireId):ie.ZP.EditQuestionnaire.addQuestionnaire(),f=this.state.saveType,d=t.employeeRange,u=d.rangeType,O=d.rangeList,y=d.qyWeChatVo,v={title:(0,me.fy)(t.title),course_classifys:[t.classify],description:t.description,type:f,visible_range:u===1?"all":u===2?"part":"myself",department_ids:O.dept.map(h=>h.id).join(","),post_ids:O.post.map(h=>h.id).join(","),group_ids:O.group.map(h=>h.id).join(","),user_ids:O.user.map(h=>h.id).join(","),questions:t.questions.map((h,I)=>{var M={title:h.title,type:h.type,order_id:I+1,must:"".concat(h.must)};return h.type==="single"||h.type==="multiple"?(M.other=h.other.hasOther,M.options=h.options.map((b,ae)=>({order_id:ae+1,title:b.title,other:!1})),h.other.hasOther&&M.options.push({order_id:h.options.length+1,title:a("learning.questionnaireAddQusOptionOther"),other:!0})):h.type==="input"?M.multiple_rows="".concat(h.multiple_rows):h.type==="score"&&(h.options.forEach((b,ae)=>{b.order_id=ae+1,b.other="false"}),M.options=h.options,M.instruction=h.instruction,M.instruction_must=h.instruction_must),M}),qy_we_chat_vo:y};R&&(v.id=this.state.questionnaireId);var g=t.tagGroup?t.tagGroup.tagsNameList?t.tagGroup.tagsNameList:[]:[];fe.WY.post({url:m,data:v}).then(h=>{if(h.data.code===0){if(i.setSubmitting(!1),f!=="draft"&&V.default.success(a(R?"common.saveSuccess":"common.releaseSuccess")),this.state.questionnaireId){var I={tags:g,resourceId:this.state.questionnaireId,resourceType:"questionnaire"};(0,Oe.tB)(I)}else if(g&&g.length){var M={tags:g,resourceId:h.data.data,resourceType:"questionnaire"};(0,Oe.tB)(M)}if(f==="draft"){var b=this;oe.Z.confirm({title:a("common.draftSuccess"),icon:n().createElement(re.Z,{style:{color:"#29c881"}}),content:"",okText:a("shareInfo.returnTable"),cancelText:a("course.continueEdit"),onOk(){b.linkToList({publishStatus:"draft"})}})}else this.linkToList()}}).catch(()=>{i.setSubmitting(!1),V.default.error(R?f==="draft"?this.props.t("common.draftFailure"):this.props.t("common.saveFailure"):f==="draft"?this.props.t("common.draftFailure"):this.props.t("common.releaseFailure"))})},this.cancelEdit=()=>{this.linkToList()},this.linkToList=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.props.history.push("/knowledgeBase/questionnaireResources/questionnaire?".concat(w.stringify(t)))},this.addQuestion=(t,i,a)=>{var r=this.formRef.getFormikBag().values.questions;typeof i!="undefined"?t=this.questionComponentList[a].type:i=r.length;var p=JSON.parse(JSON.stringify(this.defaultComponentConfig[t]));p.componentId="component".concat(new Date().getTime()),r.splice(i,0,p),this.formRef.setFieldValue("questions",r)},this.showViewModal=()=>{var t=this.state.viewModalConfig;t.visible=!0,t.questionnaireInfo=_()(this.formRef.getFormikBag().values),this.setState({viewModalConfig:t})},this.hiddenViewModal=()=>{var t=this.state.viewModalConfig;t.visible=!1,this.setState({viewModalConfig:t})},this.state={questionnaireId:"",saveType:"release",viewModalConfig:{visible:!1,questionnaireInfo:{title:"",description:"",questions:[]},onCancel:this.hiddenViewModal},initialValues:{title:"",classify:"",description:"",employeeRange:{rangeType:1,rangeList:{dept:[],post:[],group:[],user:[]}},questions:[]},isLoading:!0}}componentDidMount(){var s=w.parse(this.props.history.location.search),e=s.id;if(e){var t=ie.ZP.EditQuestionnaire.getQuestionnaireInfo(e);R=!0,fe.WY.get({url:t}).then(i=>{var a=i.data,r=a.title,p=a.description,m=a.course_classifys,f=a.questions,d=a.visible_range,u=a.scopes,O=a.classify_name,y={title:r,description:p,classify:m[m.length-1],classifyName:O,employeeRange:{rangeType:d==="all"?1:d==="part"?2:3,rangeList:{dept:u.department_list,post:u.post_list,group:u.group_list,user:u.user_list}},questions:f.map(v=>{var g={componentId:v.id,type:v.type,must:v.is_must==="true",title:v.title,options:[],other:{hasOther:!1,title:this.props.t("learning.questionnaireAddQusOptionOther")}};return v.type==="single"||v.type==="multiple"?(g.other={hasOther:!1,title:this.props.t("learning.questionnaireAddQusOptionOther")},v.options.map(h=>{if(h.other){g.other.hasOther=!0;return}g.options.push({value:"",title:h.title,other:!1})})):v.type==="input"?g.multiple_rows=v.is_multiple_rows==="true":v.type==="score"&&(v.options.forEach(h=>h.key=h.order_id),g.options=v.options,g.instruction=v.instruction,g.instruction_must=v.instruction_must),g})};this.formRef.setValues(y),this.setState({questionnaireId:e,isLoading:!1})})}else this.setState({isLoading:!1})}componentWillUnmount(){R=!1}render(){var s=this.props.t,e=this.state,t=e.viewModalConfig,i=e.initialValues,a=e.isLoading,r=e.saveType,p=w.parse(this.props.history.location.search),m=p.id,f={resourceType:"questionnaire",resourceId:m},d=m?"".concat(s("documentTitle.editPaper2")):"".concat(s("documentTitle.addPaper2"));return n().createElement("div",{className:"questionnaire-edit"},n().createElement(pt.Z,{title:d}),n().createElement("div",{className:"questionnaire-edit-container"},n().createElement("div",{className:"form-page-container"},n().createElement("h1",{className:"form-page-container-title"},R?"".concat(s("common.edit")).concat(s("learning.questionnaireAddTitle")):"".concat(s("common.add")).concat(s("learning.questionnaireAddTitle"))),n().createElement(x.J9,{ref:this.initRef,initialValues:i,onSubmit:this.submit,render:u=>n().createElement(x.l0,{className:"cl-form"},n().createElement("div",{className:"top-field-container"},n().createElement(x.gN,(0,q.Z)({name:"title",className:"qa-questionnaire-title",label:s("learning.questionnaireAddName"),required:!0,type:"text",defaultValue:u.values.title,validate:O=>(0,ye.QK)(O,s("learning.questionnaireAddNamePlaceholder")),component:rt.Z,maxLength:60,placeholder:s("learning.questionnaireAddNamePlaceholder")},H)),n().createElement(x.gN,(0,q.Z)({name:"classify",label:s("learning.questionnaireAddCategory"),required:!0,classifyName:u.values.classifyName,displayType:"Custom",validate:Ee.classify,component:C},H)),n().createElement(x.gN,(0,q.Z)({name:"description",className:"qa-questionnaire-description",required:!0,defaultValue:u.values.description,validate:O=>(0,ye.QK)(O,s("learning.questionnaireAddDescPlaceholder")),label:s("learning.questionnaireAddDesc"),component:lt.Z,type:"text",maxLength:500,placeholder:s("learning.questionnaireAddDescPlaceholder")},H)),n().createElement(x.gN,(0,q.Z)({component:se.QS,displayType:"Custom",name:"tagGroup",label:n().createElement("span",{style:{paddingLeft:"10px"}},s("common.detailTag")),defaultFieldList:f},H)),a?null:n().createElement(x.gN,{component:se.ww,required:!0,displayType:"Custom",name:"employeeRange",rangeAuth:!0,defaultFieldList:u.values.employeeRange,secTitle:"".concat(s("authentication.abilityDetailSecAssignTitled"),":"),validate:ct.FI,mode:["all","part","private"],orgProps:{title:s("component.chooseVisibleScope")},onlyChooseDept:!0,qwTicketShow:!0})),n().createElement(x.gN,{name:"questions",label:"",required:!0,displayType:"Custom",component:ot,addQuestion:this.addQuestion,validate:Ee.questions}),n().createElement(se.I,null),n().createElement("div",{className:"cl-form-fixed-footer"},n().createElement("div",{className:"cl-form-fixed-footer__container"},n().createElement("div",{className:"form-page-container-bottom"},n().createElement(S.Z,{className:"form-page-container-bottom-btn",onClick:this.cancelEdit},s("common.cancel")),n().createElement(S.Z,{className:"form-page-container-bottom-btn",onClick:this.showViewModal,disabled:!u.isValid},s("common.preview")),n().createElement(S.Z,{className:"form-page-container-bottom-btn",disabled:!u.isValid,loading:r==="draft"?u.isSubmitting:!1,onClick:this.saveDraft},s("common.draft")),n().createElement(S.Z,{className:"form-page-container-bottom-btn",loading:r==="release"?u.isSubmitting:!1,type:"primary",disabled:!u.isValid,onClick:this.saveRelease},s("common.release")," ")))))}),n().createElement("div",{style:{height:"100px"}})),n().createElement(Ne,{addQuestion:this.addQuestion,questionComponentList:this.questionComponentList})),n().createElement(P,t))}}var ht=(0,B.Z5)(c.ZP)((0,Z.Z)()(ut))},44970:function(Te,K,o){"use strict";var Ce=o(49111),S=o(19650),q=o(96433),Y=o(33304),oe=o(22385),F=o(31097),V=o(88983),w=o(47933),X=o(63185),n=o(9676),re=o(47673),x=o(4107),B=o(12924),c=o.n(B),Z=o(91768),W=x.Z.TextArea;class _ extends c().Component{constructor(){super(...arguments);this.setQuestionValue=(l,A)=>{this.props.setQuestionValue(l,A)},this.renderQuestionItem=(l,A)=>{var P=!1,$=this.props,T=$.isPreview,Q=$.t;return(l.type==="single"||l.type==="multiple")&&(P=l.options.find(C=>C.is_other==="true")),c().createElement("div",{key:A,className:"questionnaire-view-question"},c().createElement("div",{className:"questionnaire-view-question-title"},l.is_must==="true"?c().createElement("span",{className:"question-must-icon"},"*"):null,l.type==="single"?"\u3010".concat(Q("learning.questionnaireAddToolSingle"),"\u3011"):l.type==="multiple"?"\u3010".concat(Q("learning.questionnaireAddToolMul"),"\u3011"):null,l.title),l.type==="multiple"?c().createElement("div",{className:"questionnaire-view-question-option"},l.options.map((C,D)=>C.is_other==="true"?null:T?c().createElement(n.Z,{checked:l.answer.normal.indexOf(C.id)!==-1,disabled:T,key:D,className:"option-item"},c().createElement("span",{style:{whiteSpace:"normal",wordBreak:"break-all"}},C.title)):c().createElement(n.Z,{key:D,className:"option-item"},c().createElement("span",{style:{whiteSpace:"normal",wordBreak:"break-all"}},C.title))),P?T?c().createElement(n.Z,{disabled:T,checked:!!l.answer.other,className:"option-item"},Q("learning.questionnaireAddQusOptionOther"),l.answer.other?c().createElement(x.Z,{value:l.answer.other,disabled:T,className:"other-input"}):c().createElement(x.Z,{disabled:T,className:"other-input"})):c().createElement(n.Z,{className:"option-item"},Q("learning.questionnaireAddQusOptionOther"),c().createElement(x.Z,{className:"other-input"})):null):null,l.type==="single"?c().createElement("div",{className:"questionnaire-view-question-option"},l.options.map((C,D)=>C.is_other==="true"?null:T?c().createElement(w.ZP,{disabled:T,key:D,checked:l.answer.normal.indexOf(C.id)!==-1,className:"option-item"},c().createElement("span",{style:{whiteSpace:"normal",wordBreak:"break-all"}},C.title)):c().createElement(w.ZP,{key:D,checked:D===l.value,onClick:()=>this.setQuestionValue(A,D),className:"option-item"},c().createElement("span",{style:{whiteSpace:"normal",wordBreak:"break-all"}},C.title))),P?T?c().createElement(w.ZP,{disabled:T,checked:!!l.answer.other,className:"option-item"},Q("learning.questionnaireAddQusOptionOther"),l.answer.other?c().createElement(x.Z,{value:l.answer.other,disabled:T,className:"other-input"}):c().createElement(x.Z,{disabled:T,className:"other-input"})):c().createElement(w.ZP,{checked:l.value===-1,onClick:()=>this.setQuestionValue(A,-1),className:"option-item"},Q("learning.questionnaireAddQusOptionOther"),c().createElement(x.Z,{className:"other-input"})):null):null,l.type==="score"?c().createElement("div",{className:"questionnaire-view-question-score"},T?c().createElement(S.Z,{direction:"vertical"},c().createElement("div",{className:"questionnaire-view-question-score-box"},c().createElement(F.Z,{title:l.options[0].title},c().createElement("div",{className:"questionnaire-view-question-score-title"},l.options[0].title)),c().createElement("div",{className:"questionnaire-view-question-score-rate"},c().createElement(Y.Z,{disabled:!0,value:l.answer.normal[0],tooltips:l.options.map((C,D)=>c().createElement("div",{className:"questionnaire-view-question-score-rate-tip",key:D.toString},c().createElement("div",{className:"ellipsis"},C.title),c().createElement("div",null,Q("learning.score"),"\uFF1A",C.score))),count:l.options.length})),c().createElement(F.Z,{title:l.options[l.options.length-1].title},c().createElement("div",{className:"questionnaire-view-question-score-title"},l.options[l.options.length-1].title))),l.instruction==!0&&c().createElement(W,{disabled:!0,value:l.answer.instructionContent?l.answer.instructionContent:l.answer.instruction_content,className:"questionnaire-view-question-score-textarea",rows:4,placeholder:"".concat(Q("learning.scoringExplanation")).concat(l.must&&l.instruction_must?"\uFF08".concat(Q("learning.required"),"\uFF09"):""),maxLength:300})):c().createElement(S.Z,{direction:"vertical"},c().createElement("div",{className:"questionnaire-view-question-score-box"},c().createElement(F.Z,{title:l.options[0].title},c().createElement("div",{className:"questionnaire-view-question-score-title"},l.options[0].title)),c().createElement("div",{className:"questionnaire-view-question-score-rate"},c().createElement(Y.Z,{tooltips:l.options.map((C,D)=>c().createElement("div",{className:"questionnaire-view-question-score-rate-tip",key:D.toString},c().createElement("div",null,C.title),c().createElement("div",null,Q("learning.score"),"\uFF1A",C.score))),count:l.options.length})),c().createElement(F.Z,{title:l.options[l.options.length-1].title},c().createElement("div",{className:"questionnaire-view-question-score-title"},l.options[l.options.length-1].title))),l.instruction==!0&&c().createElement(W,{className:"questionnaire-view-question-score-textarea",rows:4,placeholder:"".concat(Q("learning.scoringExplanation")).concat(l.instruction_must?"\uFF08".concat(Q("learning.required"),"\uFF09"):""),maxLength:300}))):null,l.type==="input"?c().createElement("div",{className:"questionnaire-view-question-input"},l.is_multiple_rows==="1"||l.is_multiple_rows==="true"?c().createElement(W,{rows:3,value:T?l.answer.normal[0]:"",disabled:T}):c().createElement(x.Z,{value:T?l.answer.normal[0]:"",disabled:T})):null)}}render(){var l=this.props.questionnaireInfo;return c().createElement("div",null,c().createElement("div",{className:"questionnaire-view-title"},l.title),c().createElement("div",{className:"questionnaire-view-desc"},l.description),c().createElement("div",{className:"questionnaire-view-list"},l.questions.map((A,P)=>this.renderQuestionItem(A,P))))}}K.Z=(0,Z.Z)()(_)}}]);
