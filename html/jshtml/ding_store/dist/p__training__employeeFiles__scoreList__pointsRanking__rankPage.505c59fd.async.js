(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[9119],{11449:function(Q,x,e){"use strict";e.d(x,{Z:function(){return w}});var R=e(88986),s=e(33565),K=e(12924),m=e.n(K),y=e(3115),f=e(49111),o=e(19650),E=e(62029),p=e(57663),l=e(71577),d=e(91768),M=e(28216),c=e(37055),B=e(10237);function C(L){var Z=c.ZP.getHelpContentByMenuKey(),T={key:L};return B.WY.get({url:Z,params:T})}var b=e(74228),S=e.n(b),F=e(1164),Y=e(76466),k=e(38642);class O extends m().Component{constructor(Z){var T;super(Z);T=this,this.getHelpContentByMenuKey=()=>{var a=this.props.defaultMenuKey;C(a).then(r=>{var i=r.data,v=i.help_url,I=i.video_url;this.setState({videoUrl:I,helpUrl:v})})},this.handleOpenHelpUrl=a=>{if((0,k.ve)()){window.open(a,"_blank");return}F.Z.targetTo({path:a,isExternalLink:!0})},this.handleOpenVideo=function(a){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T.props.t("helpCenter.video");T.setState(i=>({resourcePlayInfo:(0,R.Z)((0,R.Z)({},i.resourcePlayInfo),{},{resourceInfo:{originUrl:a,source:{FD:a,OD:a},contentType:"mp4"}}),previewInfo:(0,R.Z)((0,R.Z)({},i.previewInfo),{},{title:r,visible:!0,onCancel:T.handleCancelPreview})}))},this.handleCancelPreview=()=>{var a=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,R.Z)((0,R.Z)({},a),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:Z.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var Z=this.state,T=Z.helpUrl,a=Z.resourcePlayInfo,r=Z.previewInfo,i=Z.videoUrl,v=this.props.t;return m().createElement("div",{className:S().helpCenter},i&&m().createElement(l.Z,{type:"link",className:S()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(i)},v("helpCenter.video")),T&&m().createElement(l.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(T)},v("helpCenter.tutorial")),m().createElement(Y.Z,(0,E.Z)({},a,{previewInfo:r})))}}var A=L=>({defaultMenuKey:L.currentRoute.menuKey});O.defaultProps={defaultMenuKey:""};var P=(0,M.$j)(A)((0,d.Z)()(O));function U(L){var Z=L.extra,T=localStorage.getItem("dingPersonnel"),a=sessionStorage.getItem("dingPersonnel");return m().createElement(o.Z,null,Z,T!=="dingPersonnel"&&a!=="dingPersonnel"&&(0,k.eY)("COMMONEXTRA_HELP_CENTER")&&m().createElement(P,null))}var W=U,D=e(4408);function $(L){var Z=(0,K.useState)({helpCenter:(0,k.eY)("HEAD_HELP_CENTER_BUT")}),T=(0,s.Z)(Z,1),a=T[0],r=L.pageContainerParams,i=r===void 0?{}:r,v=L.noPadding,I=v===void 0?!1:v,N=L.isPersonal,V=N===void 0?!1:N,j=L.pageTitle,X=L.className,te=X===void 0?"":X,ae={extra:a.helpCenter?m().createElement(W,{extra:i.extra}):i.extra},se=(0,R.Z)((0,R.Z)({},i),ae);return m().createElement("div",{className:"page-container-content ".concat(I?"page-container-noPadding":""," ").concat(V?"page-container-content_personal_background":""," ").concat(te)},j&&m().createElement(D.Z,{title:j}),V?m().createElement(y.Z,null,L.children):m().createElement(y.Z,se,L.children))}var w=$},53701:function(Q,x,e){"use strict";var R=e(12924),s=e.n(R),K=e(91768),m=e(64262),y=e(87722),f=e(12378);class o extends s().Component{constructor(){super(...arguments);this.handleTreeSelectChange=p=>{this.props.handleTreeSelectChange(p)},this.handleTimeRange=p=>{var l=p.startTime,d=p.endTime,M=p.dateStrings;if(!M.filter(B=>B).length){this.props.handleChangeDataRange({startTime:"",endTime:""});return}var c={startTime:l,endTime:d};this.props.handleChangeDataRange(c)},this.classifyChange=p=>{this.props.classifyChange&&this.props.classifyChange(p)}}render(){var p=this.props,l=p.showclassifyTree,d=p.defaultValue,M=p.showDateFilter,c=M===void 0?!0:M;return s().createElement("div",{className:"employee-file-extra"},s().createElement("div",{className:"select-org-tree cl-search-normal-width"},s().createElement(m.Z,{className:"cl-search-normal-width",parentId:"",checkable:!1,asyncLoad:!0,treeSelect:!0,handleTreeSelectChange:this.handleTreeSelectChange})),c&&s().createElement("div",{className:"date-range"},s().createElement(y.Z,{defaultValue:d,showTime:!0,format:"YYYY-MM-DD HH:mm",className:"cl-search-date-width",onCustomChange:this.handleTimeRange,timestamp:!0})),l&&s().createElement("div",{className:"classify-tree-select-ghk-only"},s().createElement(f.Z,{multiple:!0,allowClear:!0,onChange:this.classifyChange,showArrow:!0,defaultValue:[]})))}}o.defaultProps={showDateFilter:!0},x.Z=(0,K.Z)()(o)},29588:function(Q,x,e){"use strict";var R=e(47673),s=e(4107),K=e(77883),m=e(21888),y=e(43358),f=e(34041),o=e(12924),E=e.n(o),p=e(80991),l=e(91768),d=e(43859),M=f.Z.Option;class c extends E().Component{constructor(){super(...arguments);this.state={add:1,numberValue:this.props.defaultValue},this.handleNumberChange=C=>{this.setState({numberValue:C});var b=this.state.add;b===1?this.props.formik.setFieldValue("inputScore",Math.abs(C)):this.props.formik.setFieldValue("inputScore",-Math.abs(C))},this.onChangeSelect=C=>{this.setState({add:C},()=>{this.handleNumberChange(0)})}}render(){var C=this.props,b=C.t,S=C.selectDisabled,F=C.isPoints,Y=F===void 0?!1:F,k=this.state,O=k.add,A=k.numberValue;return E().createElement("div",null,E().createElement(s.Z.Group,{compact:!0},E().createElement(f.Z,{style:{width:60},defaultValue:O,onChange:this.onChangeSelect,disabled:S},E().createElement(M,{value:1},b("scoreRankingList.add")),E().createElement(M,{value:2},b("scoreRankingList.minus"))),E().createElement(m.Z,{min:0,max:99999,precision:0,value:A,onChange:this.handleNumberChange}),Y&&O===2&&E().createElement("div",{className:"minus-points-tips",title:b("scoreRankingList.minusPointsTips")},b("scoreRankingList.minusPointsTips"))))}}x.Z=(0,d.Z)((0,l.Z)()((0,p.$j)(c)))},65702:function(Q,x,e){"use strict";e.d(x,{I:function(){return R}});var R={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}}},36951:function(Q,x,e){"use strict";e.d(x,{Pe:function(){return y},xK:function(){return f},u9:function(){return o}});var R=e(6793),s=e(3407),K=(0,R.me)(),m=s.Z[K].employeeSummary,y=E=>{var p;return E||(p=m.certificateGetTime),p},f=E=>{var p;return E||(p=m.certificateInvalidScore),p},o=E=>{var p;return E.length===0&&(p=m.chooseTeacher),p}},96172:function(Q,x,e){"use strict";var R=e(66456),s=e(55313),K=e(43185),m=e(53251),y=e(62029),f=e(57663),o=e(71577),E=e(34792),p=e(48086),l=e(12924),d=e.n(l),M=e(91768),c=e(28216),B=e(84874),C=e(37055),b=e(18329),S=e(97593),F={size:"large",destroyOnClose:!0,bodyStyle:{padding:"0"},maskClosable:!1};class Y extends d().Component{constructor(O){super(O);this.onCancel=()=>{this.props.onCancel()},this.onOk=()=>{var P=this.props.t,U=this.state,W=U.importedList,D=U.checkTemplate;if(D==="false"){p.default.error(P("upload.typeError"));return}var $={access_token:window.localStorage.getItem("token"),new_file_name:W.map(w=>w.new_file_name).join(","),original_file_name:W.map(w=>w.original_file_name).join(",")};this.props.onCreate($)},this.fileUpload=P=>{var U=this.props.t;P.file&&P.file.response&&(P.file.response.error_messages?this.setState({checkTemplate:P.file.response.check,importedList:[P.file.response],uploadErrMsg:P.file.response.error_messages}):p.default.error(U("upload.typeError")))},this.downloadTemplate=()=>{var P=this.props,U=P.islecturer,W=P.isScore;U?window.location.href="".concat(C.ZP.points.downloadImport(),"?access_token=").concat(window.localStorage.getItem("token")):W?window.location.href="".concat(C.ZP.ScoreList.downloadTemplate(),"?access_token=").concat(window.localStorage.getItem("token")):(0,S.N)({page:"downloadPointsTemplate",props:this.props,rest:{},sendType:"get"})};var A;O.isScore?A=C.ZP.ScoreList.uploadTemplateScore():O.islecturer?A=C.ZP.points.teacherPointsImport():A=C.ZP.points.uploadPointsTemplate(),this.state={importedList:[],uploadConfig:{name:"file",action:A,showUploadList:!1,headers:{"Enterprise-Id":localStorage.getItem("enterpriseId")},data:{access_token:window.localStorage.getItem("token")},onChange:this.fileUpload},uploadErrMsg:[],checkTemplate:""}}componentDidUpdate(O){O.visible!==this.props.visible&&this.props.visible&&this.setState({importedList:[],uploadErrMsg:[]})}render(){var O=this.state,A=O.importedList,P=O.uploadConfig,U=O.uploadErrMsg,W=this.props,D=W.t,$=W.visible,w=W.isScore,L=W.loading,Z=[{title:D("component.fileName"),dataIndex:"file_name",key:"newfileName"},{title:D("component.successLabel"),dataIndex:"success_count"},{title:D("component.failedLabel"),dataIndex:"failed_count"}];return d().createElement(b.ZP,(0,y.Z)({},F,{title:D(w?"employeeSummary.multipleImportScore":"scoreRankingList.multipleImportPoints"),visible:$,confirmLoading:L,onCancel:this.onCancel,onOk:this.onOk}),d().createElement("div",{className:"import-score"},d().createElement("div",{className:"import-score-import"},d().createElement(o.Z,{className:"import-score-import-btn",onClick:this.downloadTemplate},d().createElement(B.Z,{iconClass:"icon-icon_donwloadx1"}),D("component.downloadTem")),d().createElement("span",{className:"import-score-import-tip"},D(w?"employeeSummary.multipleImportScoreTips":"scoreRankingList.multipleImportPointsTips")),d().createElement(m.Z,(0,y.Z)({className:"import-score-import-btn right"},P),d().createElement(o.Z,{type:"primary"},d().createElement(B.Z,{iconClass:"icon-import"}),A.length===0?D("component.importLabel"):D("employeeSummary.reImport")))),d().createElement("div",{className:"import-score-table"},d().createElement(s.Z,{dataSource:A,columns:Z,bordered:!0,rowKey:T=>T.new_file_name,size:"middle",pagination:!1})),U.length>0?d().createElement("div",{className:"import-score-tip"},d().createElement("p",null,d().createElement(B.Z,{iconClass:"icon-tishi"}),D("component.errorTips"),":"),U.map((T,a)=>d().createElement("p",{key:a},T))):null))}}Y.defaultProps={visible:!1,onCancel:()=>{},onOk:()=>{}},x.Z=(0,c.$j)()((0,M.Z)()(Y))},2310:function(Q,x,e){"use strict";e.d(x,{Z:function(){return Z}});var R=e(34792),s=e(48086),K=e(71194),m=e(57016),y=e(88986),f=e(12924),o=e.n(f),E=e(91768),p=e(28216),l=e(78138),d=e.n(l),M=e(57663),c=e(71577),B=e(84391),C=e(87722);class b extends o().Component{constructor(){super(...arguments);this.state={},this.handleTimeRange=a=>{var r=a.startTime,i=a.endTime,v=a.dateStrings;if(!v.filter(N=>N).length){this.props.handleChangeDataRange({startTime:"",endTime:""});return}var I={startTime:r,endTime:i};this.props.handleChangeDataRange(I)},this.handleExport=()=>{this.props.handleExport()},this.handleDelete=()=>{this.props.handleDelete()},this.renderActionBtn=()=>{var a=this.props,r=a.selectedRowKeys,i=a.t;return o().createElement("div",null,o().createElement(c.Z,{onClick:this.handleDelete,disabled:r.length===0},i("scoreRankingList.withdrawInBatch")),o().createElement(c.Z,{type:"primary",onClick:this.handleExport},o().createElement(B.Z,null)," ",i("common.exportData")))}}render(){var a=this.props,r=a.currentRecord,i=a.t,v=a.defaultValue;return o().createElement("header",{className:"score-record__queryrow"},o().createElement("div",{className:"score-record__queryrow__text"},i("personal.todayTotalScores"),"\uFF1A",o().createElement("span",{style:{marginRight:"18px"}},r.today||0,i("common.score")),i("scoreRankingList.accumulatedGetPoints"),"\uFF1A",r.total||0,i("common.score")),o().createElement("section",{className:"score-record__queryrow__action"},o().createElement(C.Z,{timestamp:!0,format:"YYYY-MM-DD",showTime:!1,onCustomChange:this.handleTimeRange,defaultValue:v}),this.renderActionBtn()))}}b.defaultProps={prefixCls:"cl-listQueryRow",wrapCls:"",showCheckbox:!0,showSearch:!0,showBtn:!0,defaultRadioValue:"",radioList:[],onRadiosChange:()=>{},onSearch:()=>{},onCheckboxChange:()=>{}};var S=(0,E.Z)()(b),F=e(66456),Y=e(55313),k=e(22385),O=e(31097),A=e(6793),P=e(37055);class U extends o().Component{constructor(){super(...arguments);this.columns=[{title:this.props.t("scoreRankingList.time"),dataIndex:"createTime",width:150,render:(a,r)=>"".concat((0,A.p6)(+r.create_time))},{title:this.props.t("scoreRankingList.pointsBehavior"),dataIndex:"event_content",width:586,render:a=>o().createElement(O.Z,{title:a},o().createElement("div",{className:"cl-text-ellipsis",style:{width:555}},a))},{title:this.props.t("personal.scores"),dataIndex:"final_score",width:88,render:a=>o().createElement("span",null,a+this.props.t("common.examScoreUnit"))}],this.handleTableChange=a=>{this.props.onTableChange(a)},this.onSelectChange=(a,r)=>{this.props.onSelectChange(a,r)}}render(){var a=this.props,r=a.list,i=r===void 0?[]:r,v=a.loading,I=a.paginationParams,N=I===void 0?{}:I,V=a.selectedRowKeys,j={onChange:this.onSelectChange,selectedRowKeys:V,getCheckboxProps:te=>({disabled:te.can_back_out!==1})},X=(0,y.Z)((0,y.Z)({},P.XE.INITIAL_PAGINATION),N);return o().createElement("section",{className:"score-record__content__table"},o().createElement(Y.Z,{bordered:!0,size:"middle",columns:this.columns,rowKey:"id",dataSource:i,pagination:X,loading:v,onChange:this.handleTableChange,rowSelection:j}))}}var W=(0,E.Z)()(U),D=e(10237),$=e(97593),w=e(18329);class L extends o().Component{constructor(){super(...arguments);this.state={params:{begin_time:this.props.timeValue&&this.props.timeValue.begin_time||"",end_time:this.props.timeValue&&this.props.timeValue.end_time||"",page_number:1,page_size:20},tableLoading:!0,tableList:[],tableTotal:0,selectedRowKeys:[],currentRecord:{}},this.onCancel=()=>{this.setState({selectedRowKeys:[]}),this.props.onCancelRecord()},this.onSelectChange=(a,r)=>{this.setState({selectedRowKeys:r})},this.initTableList=()=>{var a=this.props.isLecturer;this.setState({tableLoading:!0});var r=this.state.params,i=r.begin_time,v=i===void 0?0:i,I=r.end_time,N=I===void 0?0:I,V=this.state.params;v&&(V.begin_time=d()(v).startOf("day").valueOf()),N&&(V.end_time=d()(N).endOf("day").valueOf()),a&&(V.type=8),D.WY.get({url:P.ZP.points.integralDetails(this.props.userId),params:V}).then(j=>{setTimeout(()=>{this.setState({tableLoading:!1,tableList:j.data.list,tableTotal:j.data.total})},300)})},this.getCurrentRecord=()=>{var a=this.props.isLecturer,r={};a&&(r.type=8),D.WY.get({url:P.ZP.points.myIntegral(this.props.userId),params:r}).then(i=>{this.setState({currentRecord:i.data})})},this.handleChangePagination=a=>{var r=a.current,i=a.pageSize;this.setState(v=>({params:(0,y.Z)((0,y.Z)({},v.params),{},{page_number:r,page_size:i})}),()=>{this.initTableList()})},this.resetPagination=()=>new Promise(a=>{this.setState(r=>({params:(0,y.Z)((0,y.Z)({},r.params),{},{page_number:1,page_size:20})}),()=>{a()})}),this.handleChangeDataRange=a=>{this.setState(r=>({params:(0,y.Z)((0,y.Z)({},r.params),{},{begin_time:a.startTime,end_time:a.endTime})}),()=>{this.initTableList()})},this.exportScoreRecord=()=>{var a=this.props,r=a.t,i=a.isLecturer,v=this.state.params;m.Z.confirm({title:r("common.tip"),content:r("employeeSummary.exportPerPointsConfirm"),onOk:()=>{var I={begin_time:v.begin_time,end_time:v.end_time};i?(0,$.N)({page:"teacherImportPoints",props:this.props,query:I,rest:{lecturerId:this.props.id},sendType:"post"}):(0,$.N)({page:"integralRankingDetails",props:this.props,query:I,rest:{userId:this.props.userId},sendType:"post"})}})},this.showDeleteConfirm=()=>{var a=this.props.t,r=this;m.Z.confirm({title:a("scoreRankingList.pointsConfirmTip"),content:"",okText:a("common.ok"),cancelText:a("common.cancel"),onOk(){r.deleteScores()}})},this.deleteScores=()=>{var a=P.ZP.points.revocation(),r=this.state.selectedRowKeys,i=this.props,v=i.t,I=i.isLecturer,N={list:r,user_id:I?this.props.id:this.props.userId};D.WY.post({url:a,data:N}).then(V=>{V.data.code==="success"?(s.default.success(v("certificateRankingList.cancelSuccess")),this.initTableList(),this.getCurrentRecord(),this.props.initScoreRank(),this.setState({selectedRowKeys:[]})):s.default.error(v("study.operateFailed"))})}}componentDidUpdate(a){this.props.visible&&this.props.visible!==a.visible&&this.props.userId&&this.setState({params:{begin_time:this.props.timeValue&&this.props.timeValue.begin_time||"",end_time:this.props.timeValue&&this.props.timeValue.end_time||"",page_number:1,page_size:20},tableList:[],tableTotal:0,selectedRowKeys:[],currentRecord:{}},()=>{this.initTableList(),this.getCurrentRecord()})}render(){var a=this.props.visible,r=this.state,i=r.tableTotal,v=r.tableList,I=r.tableLoading,N=r.params,V=r.selectedRowKeys,j=r.currentRecord,X={total:i,current:N.page_number,pageSize:N.page_size},te=[N.begin_time,N.end_time],ae=V.map(se=>se.id);return o().createElement(w.ZP,{visible:a,title:this.props.t("scoreRankingList.pointsDetails"),onCancel:this.onCancel,footer:null,size:"large"},a?o().createElement("div",{className:"score-record"},o().createElement(S,{handleChangeDataRange:this.handleChangeDataRange,handleExport:this.exportScoreRecord,handleDelete:this.showDeleteConfirm,selectedRowKeys:ae,currentRecord:j,defaultValue:te}),o().createElement("div",{className:"score-record__content"},o().createElement(W,{loading:I,paginationParams:X,list:v,selectedRowKeys:ae,onTableChange:this.handleChangePagination,onSelectChange:this.onSelectChange}))):null)}}var Z=(0,p.$j)()((0,E.Z)()(L))},83455:function(Q,x,e){"use strict";e.r(x),e.d(x,{default:function(){return Ce}});var R=e(12924),s=e.n(R),K=e(91768),m=e(11449),y=e(4408),f=e(62029),o=e(57663),E=e(71577),p=e(34792),l=e(48086),d=e(71194),M=e(57016),c=e(88986),B=e(28216),C=e(84391),b=e(53701),S=e(80991),F=e(78138),Y=e.n(F),k=e(84874),O=e(31151),A=e(43859),P=e(60667);class U extends s().Component{constructor(){super(...arguments);this.state={visible:!1},this.handleSelectTeacher=()=>{this.setState({visible:!0})},this.handleCancel=()=>{this.setState({visible:!1})},this.handleOk=t=>{this.props.formik.setFieldValue("teacher",t),this.handleCancel()},this.handleDelete=(t,n)=>{t.splice(n,1),this.props.formik.setFieldValue("teacher",t)}}render(){var t=this.props,n=t.prefixCls,g=t.defaultFieldList;return s().createElement("div",{className:n},g.map((h,u)=>s().createElement("div",{className:"".concat(n,"__name"),key:h.id},h.type==="inside"?s().createElement(P.Z,{dataType:"userName",value:h.lecturer_sync_user_id,name:h.name,type:h.lecturer_source_type}):h.name,s().createElement("span",{className:"".concat(n,"__name__delete"),onClick:()=>this.handleDelete(g,u)},s().createElement(k.Z,{iconClass:"icon-guanbi1"})))),s().createElement("span",{className:"".concat(n,"__add"),onClick:this.handleSelectTeacher},s().createElement(k.Z,{iconClass:"iconf-add-man"})),s().createElement(O.Z,{visible:this.state.visible,selectedArr:g,onOk:this.handleOk,onCancel:this.handleCancel,showTab:!0,multiple:!0}))}}U.defaultProps={prefixCls:"teacher"};var W=(0,A.Z)((0,S.$j)(U)),D=e(29588),$=e(65702),w=e(36951),L=e(62615),Z=e(52670),T=e(7584),a=e(2396);class r extends s().Component{render(){var t=this.props,n=t.values,g=t.mode,h=t.reserveUser,u=t.t,z=t.islecturer,_=t.isPoints;return s().createElement(S.l0,{className:"cl-form course-add__content"},z?s().createElement(S.gN,(0,f.Z)({component:W,displayType:"Custom",showSectitle:!1,name:"teacher",label:u("employeeSummary.registrationObject"),defaultFieldList:n.teacher,validate:w.u9,mode:g,required:!0},$.I)):s().createElement(S.gN,(0,f.Z)({component:L.ww,displayType:"Custom",showSectitle:!1,name:"employeeRange",label:u("employeeSummary.registrationObject"),defaultFieldList:n.employeeRange,validate:Z.FI,mode:g,orgProps:{title:u("employeeSummary.chooseRegisteredObject")},required:!0,reserveUser:h,onlyUser:!0,qwTicketShow:!0},$.I)),s().createElement(S.gN,(0,f.Z)({component:T.Z,name:"reason",label:u("scoreRankingList.pointsBehavior"),required:!0,type:"text",defaultValue:n.reason,validate:G=>(0,a.QK)(G,u("employeeSummary.limitReasonWords")),placeholder:u("employeeSummary.limitReasonWords"),maxLength:30},$.I)),s().createElement(S.gN,(0,f.Z)({component:D.Z,name:"inputScore",label:u("scoreRankingList.getPoints"),required:!0,defaultValue:n.inputScore,validate:w.xK,selectDisabled:!_,isPoints:!0},$.I)),s().createElement(S.gN,(0,f.Z)({component:L.Mt,displayType:"Custom",name:"datePicker",label:u("employeeSummary.getTime"),required:!0,currentDay:!0,defaultFieldList:n.datePicker,validate:w.Pe},$.I)))}}var i=(0,K.Z)()(r),v=e(18329),I=e(34773),N=e(6793);class V extends s().Component{constructor(t){super(t);this.initRefFormik=n=>{this._refFormik=n},this.handleBeforeCreate=()=>{var n=this._refFormik;n.submitForm(),n.runValidations().then(g=>{if(!Object.keys(g).length){var h=n.state.values,u=h.employeeRange,z=h.reason,_=h.datePicker,G=h.inputScore,q=h.teacher,H=(0,I.b)(u.rangeList),ee=q.map(oe=>oe.id),ie={group_ids:u.rangeType==2?H.groupIds.join(","):"",department_ids:u.rangeType==2?H.deptIds.join(","):"",user_ids:u.rangeType==2?H.userIds.join(","):"",post_ids:u.rangeType==2?H.postIds.join(","):"",time:Y()(_).valueOf(),behavior:z,points:G,teacherIds:ee,qy_we_chat_vo:u.qyWeChatVo};this.props.onCreate(ie)}})},this.handleBeforeCancel=()=>{var n=this.props.onCancel;n()},this.state={initialParams:{employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},teacher:[],reason:"",inputScore:"",datePicker:null}}}componentDidUpdate(t){this.props.visible&&this.props.visible!==t.visible&&this.setState({initialParams:{employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},teacher:[],reason:"",inputScore:"",datePicker:(0,N.k7)(new Date)}})}render(){var t=this.props,n=t.prefixCls,g=t.visible,h=t.mode,u=h===void 0?["part"]:h,z=t.reserveUser,_=z===void 0?[]:z,G=t.islecturer,q=G===void 0?!1:G,H=t.isPoints,ee=H===void 0?!1:H,ie=this.state.initialParams;return g?s().createElement(v.ZP,{wrapClassName:n,visible:g,title:this.props.t("employeeSummary.manualScore"),onCancel:this.handleBeforeCancel,onOk:this.handleBeforeCreate},s().createElement(S.J9,{ref:this.initRefFormik,initialValues:ie,render:oe=>s().createElement(i,(0,f.Z)({},oe,{mode:u,isPoints:ee,reserveUser:_,islecturer:q}))})):null}}var j=(0,K.Z)()(V),X=e(96172),te=e(14781),ae=e(53431),se=e(2310),le=e(55285),ne=e(37055);class de extends s().Component{constructor(){super(...arguments);this.state={recordProps:{userId:"",visible:!1},topThreeRank:["".concat("https://oss.coolcollege.cn","/1790885468209025024.png"),"".concat("https://oss.coolcollege.cn","/1790885470117433344.png"),"".concat("https://oss.coolcollege.cn","/1790885470335537152.png")]},this.onCancelRecord=()=>{this.setState(t=>({recordProps:(0,c.Z)((0,c.Z)({},t.recordProps),{},{visible:!1,userId:""})}))},this.headExtra=[{title:this.props.t("common.ranking"),dataIndex:"index",key:"index",width:90,fixed:"left",render:t=>t>3?t:s().createElement("img",{className:"indent-level-img",src:this.state.topThreeRank[t-1],alt:""})}],this.columns=[{title:this.props.t("scoreRankingList.accumulatedPoints"),dataIndex:"accumulate_score",key:"accumulate_score",fixed:"right",width:96},{title:this.props.t("scoreRankingList.pointsAvailable"),dataIndex:"balance_score",key:"balance_score",fixed:"right",width:88},{title:this.props.t("common.operate"),width:120,key:"operate",fixed:"right",render:t=>s().createElement("span",{className:"cl-pointer",onClick:()=>this.getRecord(t)},this.props.t("common.viewDetails"))}],this.getRecord=t=>{this.setState(n=>({recordProps:(0,c.Z)((0,c.Z)({},n.recordProps),{},{visible:!0,userId:t.user_id})}))},this.handleTableChange=(t,n)=>{this.props.onTableChange({current:t,pageSize:n})},this.initScoreRank=()=>{this.props.initScoreRank()}}render(){var t=this.state.recordProps,n=this.props,g=n.list,h=g===void 0?[]:g,u=n.loading,z=n.paginationParams,_=z===void 0?{}:z,G=n.timeValue,q=n.headerTitle,H=n.toolBarRender,ee=(0,c.Z)((0,c.Z)({},ne.XE.INITIAL_PAGINATION),_);return s().createElement("section",{className:"score-list__content__table"},s().createElement("div",{className:"credit-ranking-content-list"},s().createElement(le.Z,{headExtra:this.headExtra,columns:this.columns,rowKey:"userId",dataSource:h,pagination:!1,loading:u,onChange:this.handleTableChange,headerTitle:q(),toolBarRender:H,tableUUID:"73c57b5e-eb73-4e61-a965-9d1df2846e63"})),s().createElement("div",{className:"credit-ranking-pagination-wrapper"},s().createElement(ae.Z,(0,f.Z)({},ee,{onChange:this.handleTableChange,className:"credit-ranking-pagination"}))),s().createElement(se.Z,(0,f.Z)({},t,{onCancelRecord:this.onCancelRecord,initScoreRank:this.initScoreRank,timeValue:G})))}}var ce=(0,K.Z)()(de),re=e(10237),me=e(86726),fe=e(60168),pe=e(48479),he=e(97593),ue=J=>({userInfo:J.user,qyShield:J.user.qyShield});class ve extends s().Component{constructor(){super(...arguments);this.state={allowActions:(0,me.V9)("integralRanking",this.props.userInfo.modules),params:{department_id:"",begin_time:"",end_time:"",name:"",page_number:1,page_size:20},tableLoading:!0,tableList:[],tableTotal:0,manualProps:{visible:!1},templateProps:{visible:!1},commitLoading:!1,defaultValue:["",""]},this.initTableList=()=>{this.setState({tableLoading:!0}),re.WY.get({url:ne.ZP.points.integralList(),params:this.state.params}).then(t=>{setTimeout(()=>{this.setState({tableLoading:!1,tableList:t.data.list,tableTotal:Number(t.data.total)})},300)})},this.handleChangePagination=t=>{var n=t.current,g=t.pageSize;this.setState(h=>({params:(0,c.Z)((0,c.Z)({},h.params),{},{page_number:n,page_size:g})}),()=>{this.initTableList()})},this.resetPagination=()=>new Promise(t=>{this.setState(n=>({params:(0,c.Z)((0,c.Z)({},n.params),{},{page_number:1,page_size:20})}),()=>{t()})}),this.handleTreeSelectChange=t=>{this.setState(n=>({params:(0,c.Z)((0,c.Z)({},n.params),{},{page_number:1,department_id:t})}),()=>{this.initTableList()})},this.handleChangeDataRange=t=>{this.setState(n=>({params:(0,c.Z)((0,c.Z)({},n.params),{},{page_number:1,begin_time:t.startTime,end_time:t.endTime})}),()=>{this.initTableList()})},this.handleSearch=(t,n)=>{var g={name:n===""?t:"",page_number:1,userIds:n};this.setState(h=>({params:(0,c.Z)((0,c.Z)({},h.params),g)}),()=>{this.initTableList()})},this.exportScoreRank=()=>{var t=this.props.t,n="",g=this.state.params;M.Z.confirm({title:t("common.tip"),content:t("employeeSummary.exportPointsConfirm"),onOk:()=>{Object.keys(g).forEach(u=>{n+="".concat(u,"=").concat(g[u],"&")});var h="?".concat(n);(0,he.N)({page:"integralRanking",props:this.props,query:h})}})},this.handleMenuClick=t=>{var n=t.key;switch(n){case"manual":this.handleManualScore();break;case"template":this.handleTemplateScore();break;default:break}},this.handleManualScore=()=>{this.setState({manualProps:{visible:!0}})},this.handleManualCancel=()=>{this.setState({manualProps:{visible:!1}})},this.handleManualOk=t=>{var n=this.props.t;re.WY.post({url:ne.ZP.points.manualPoints(),data:t}).then(g=>{g.data.result==="true"?(l.default.success(n("employeeSummary.succeedManualPoints")),this.initTableList()):l.default.error(n("employeeSummary.importFail"))}),this.handleManualCancel()},this.handleTemplateScore=()=>{this.setState({templateProps:{visible:!0}})},this.handleTemplateCancel=()=>{this.setState({templateProps:{visible:!1}})},this.handleTemplateOk=t=>{var n=this.props.t;this.setState({commitLoading:!0});var g=ne.ZP.points.saveImport();re.qg.post({url:g,data:t}).then(h=>{this.setState({commitLoading:!1}),h.data.result==="true"?(l.default.success(n("employeeSummary.succeedImportPoints")),this.handleTemplateCancel(),this.initTableList()):l.default.error(n("employeeSummary.importFail"))}).catch(()=>{this.setState({commitLoading:!1})})},this.renderLeftRow=()=>{var t=this.props.t;return s().createElement("div",{className:"action"},s().createElement(E.Z,{type:"primary",onClick:this.exportScoreRank,style:{marginRight:"8px"}},s().createElement(C.Z,null),t("common.exportData")))},this.renderRightRow=()=>{var t=this.props.t;return s().createElement("div",{className:"search"},s().createElement(pe.Z,{onSearch:this.handleSearch,width:"272px",placeholder:t("searchInputPlaceholder.userName"),maxLength:50}))}}componentDidMount(){this.initTableList()}render(){var t=this.state,n=t.tableTotal,g=t.tableList,h=t.tableLoading,u=t.params,z=t.manualProps,_=t.templateProps,G=t.commitLoading,q=t.defaultValue,H={total:n*1,current:u.page_number,pageSize:u.page_size},ee={begin_time:u.begin_time||"",end_time:u.end_time||""};return s().createElement("div",null,s().createElement(b.Z,{handleTreeSelectChange:this.handleTreeSelectChange,handleChangeDataRange:this.handleChangeDataRange,isPoints:!0,defaultValue:q}),s().createElement("div",{className:"score-list__content"},s().createElement(ce,{loading:h,paginationParams:H,list:g,onTableChange:this.handleChangePagination,initScoreRank:this.initTableList,timeValue:ee,headerTitle:this.renderLeftRow,toolBarRender:this.renderRightRow})),s().createElement(j,(0,f.Z)({},z,{isPoints:!0,onCancel:this.handleManualCancel,onCreate:this.handleManualOk})),s().createElement(X.Z,(0,f.Z)({},_,{onCancel:this.handleTemplateCancel,onCreate:this.handleTemplateOk,loading:G})))}}var ge=(0,B.$j)(ue)((0,K.Z)()(ve));class Ee extends s().Component{constructor(t){super(t);this.state={}}render(){return s().createElement(m.Z,{pageContainerParams:{header:{title:this.props.t("report.pointRanking")}}},s().createElement(y.Z,{title:this.props.t("report.pointsRanking")}),s().createElement("div",{className:"score-list sticky-table"},s().createElement("div",{className:"score-list__content",ref:t=>this.tableRef=t},s().createElement(ge,null))))}}var Ce=(0,K.Z)()(Ee)},60168:function(Q,x,e){"use strict";e.d(x,{C:function(){return p}});var R=e(37055),s=e(6793),K=e(78138),m=e.n(K),y=e(10237),f=l=>{var d=parseInt((Date.parse(new Date)-l.packageBeginDate)/864e5),M={isVip:l.isVip,dayValue:l.isVip===4?d:l.remainDays,packageBeginDate:(0,s.p6)(l.packageBeginDate,"yyyy-MM-dd"),packageEndDate:(0,s.p6)(l.packageEndDate,"yyyy-MM-dd"),storagePercent:l.usedCapacityGb/l.capacityGb*100,usedCapacityGb:l.usedCapacityGb,capacityGb:l.capacityGb,version:l.version,packageName:l.packageName,endTime:l.endTime?(0,s.p6)(l.endTime,"yyyy-MM-dd"):""};return M},o=()=>{var l=R.ZP.Dashboard.versionInfo();return y.WY.get({url:l})},E=l=>{o().then(d=>{l(f(d.data))}).catch(d=>{console.log(d)})},p=(l,d)=>{var M="",c=M.start,B=M.end;o().then(C=>{var b=m()(),S=m()().subtract(6,"month"),F=m()(f(C.data).packageBeginDate);B=d==="timestamp"?b.valueOf():b.format("yyyy-MM-DD"),S>F?c=d==="timestamp"?S.valueOf():S.format("yyyy-MM-DD"):c=d==="timestamp"?F.valueOf():F.format("yyyy-MM-DD"),l([c,B])}).catch(C=>{console.log(C)})}}}]);
