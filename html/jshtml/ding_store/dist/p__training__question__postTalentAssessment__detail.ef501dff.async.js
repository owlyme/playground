(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[3937],{11449:function(de,V,e){"use strict";e.d(V,{Z:function(){return q}});var c=e(88986),ne=e(33565),B=e(12924),h=e.n(B),O=e(3115),se=e(49111),A=e(19650),t=e(62029),le=e(57663),C=e(71577),p=e(91768),L=e(28216),Q=e(37055),I=e(10237);function b(i){var d=Q.ZP.getHelpContentByMenuKey(),m={key:i};return I.WY.get({url:d,params:m})}var D=e(74228),K=e.n(D),F=e(1164),oe=e(76466),T=e(38642);class P extends h().Component{constructor(d){var m;super(d);m=this,this.getHelpContentByMenuKey=()=>{var r=this.props.defaultMenuKey;b(r).then(g=>{var v=g.data,y=v.help_url,M=v.video_url;this.setState({videoUrl:M,helpUrl:y})})},this.handleOpenHelpUrl=r=>{if((0,T.ve)()){window.open(r,"_blank");return}F.Z.targetTo({path:r,isExternalLink:!0})},this.handleOpenVideo=function(r){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:m.props.t("helpCenter.video");m.setState(v=>({resourcePlayInfo:(0,c.Z)((0,c.Z)({},v.resourcePlayInfo),{},{resourceInfo:{originUrl:r,source:{FD:r,OD:r},contentType:"mp4"}}),previewInfo:(0,c.Z)((0,c.Z)({},v.previewInfo),{},{title:g,visible:!0,onCancel:m.handleCancelPreview})}))},this.handleCancelPreview=()=>{var r=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,c.Z)((0,c.Z)({},r),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:d.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var d=this.state,m=d.helpUrl,r=d.resourcePlayInfo,g=d.previewInfo,v=d.videoUrl,y=this.props.t;return h().createElement("div",{className:K().helpCenter},v&&h().createElement(C.Z,{type:"link",className:K()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(v)},y("helpCenter.video")),m&&h().createElement(C.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(m)},y("helpCenter.tutorial")),h().createElement(oe.Z,(0,t.Z)({},r,{previewInfo:g})))}}var w=i=>({defaultMenuKey:i.currentRoute.menuKey});P.defaultProps={defaultMenuKey:""};var k=(0,L.$j)(w)((0,p.Z)()(P));function $(i){var d=i.extra,m=localStorage.getItem("dingPersonnel"),r=sessionStorage.getItem("dingPersonnel");return h().createElement(A.Z,null,d,m!=="dingPersonnel"&&r!=="dingPersonnel"&&(0,T.eY)("COMMONEXTRA_HELP_CENTER")&&h().createElement(k,null))}var re=$,Z=e(4408);function W(i){var d=(0,B.useState)({helpCenter:(0,T.eY)("HEAD_HELP_CENTER_BUT")}),m=(0,ne.Z)(d,1),r=m[0],g=i.pageContainerParams,v=g===void 0?{}:g,y=i.noPadding,M=y===void 0?!1:y,H=i.isPersonal,Y=H===void 0?!1:H,G=i.pageTitle,z=i.className,_=z===void 0?"":z,J={extra:r.helpCenter?h().createElement(re,{extra:v.extra}):v.extra},U=(0,c.Z)((0,c.Z)({},v),J);return h().createElement("div",{className:"page-container-content ".concat(M?"page-container-noPadding":""," ").concat(Y?"page-container-content_personal_background":""," ").concat(_)},G&&h().createElement(Z.Z,{title:G}),Y?h().createElement(O.Z,null,i.children):h().createElement(O.Z,U,i.children))}var q=W},2615:function(de,V,e){"use strict";e.r(V),e.d(V,{default:function(){return me}});var c=e(62029),ne=e(20228),B=e(11382),h=e(34792),O=e(48086),se=e(88986),A=e(12924),t=e.n(A),le=e(64593),C=e(91768),p=e(80991),L=e(57068),Q=e(4408),I=e(37055),b=e(11449),D=e(10237),K=e(34773),F=e(6793),oe=e(57663),T=e(71577),P=e(62615),w=e(52670),k=e(7584),$=e(43859),re=e(88983),Z=e(47933);class W extends t().Component{constructor(){super(...arguments);this.handleChange=a=>{this.props.formik.setFieldValue("termType",a.target.value)}}render(){var a=this.props,n=a.defaultFieldList,s=a.t;return t().createElement(Z.ZP.Group,{value:n,onChange:this.handleChange},t().createElement(Z.ZP,{value:1},s("questionn.investigateDetailPermanent")),t().createElement(Z.ZP,{value:2},s("questionn.investigateDetailCustom")))}}W.defaultProps={prefixCls:"termtype"};var q=(0,p.$j)((0,C.Z)()(W)),i=e(13062),d=e(71230),m=e(89032),r=e(15746),g=e(77576),v=e(59314);class y extends t().Component{constructor(){super(...arguments);this.handleSwitch=a=>{this.props.formik.setFieldValue("openResult",a)}}render(){var a=this.props,n=a.defaultFieldList,s=a.t;return t().createElement("section",{className:"cl-form__secbox"},t().createElement("header",{className:"cl-form__secbox__header"},s("questionn.investigateDetailResultTitle")),t().createElement("div",{className:"cl-form__secbox__content"},t().createElement(d.Z,null,t().createElement(r.Z,{span:24},t().createElement(v.Z,{checked:n,onChange:this.handleSwitch}),t().createElement("span",{className:"infotext"},s("questionn.evaluationResultTitleTip"))))))}}var M=(0,p.$j)((0,C.Z)()(y));class H extends t().Component{constructor(){super(...arguments);this.state={tools:[],loading:!0},this.getEvaluationTools=()=>{D.WY.get({url:I.ZP.PostTalentEvaluation.getTools(),params:{}}).then(a=>{this.setState({tools:a.data,loading:!1},()=>{var n=this.props.isEdit;n||this.handleDefaultChange()})})},this.handleDefaultChange=()=>{var a=this.state.tools;this.props.formik.setFieldValue("evaluationTools",a[0].product_id)},this.handleChange=a=>{this.props.formik.setFieldValue("evaluationTools",a.target.value)}}componentDidMount(){this.getEvaluationTools()}render(){var a=this.state,n=a.tools,s=a.loading;if(!n.length)return null;var o=this.props.isEdit,u=this.props.defaultFieldList||n[0].product_id;return s||n.length&&!n[0].product_id?null:t().createElement("div",{className:"evaluation-tools"},t().createElement(Z.ZP.Group,{defaultValue:u},n.map(l=>t().createElement("div",{className:"evaluation-tools__item",key:l.id},t().createElement(Z.ZP.Button,{value:l.product_id,onChange:this.handleChange,disabled:o&&l.product_id!==u},l.product_name)))),t().createElement("div",{className:"evaluation-tools__propose"},n.map(l=>t().createElement("span",{key:l.id},u===l.product_id?l.product_purpose:null))))}}H.defaultProps={prefixCls:"termtype"};var Y=(0,p.$j)((0,C.Z)()(H)),G=(0,$.Z)(q),z=(0,$.Z)(M),_=(0,$.Z)(Y),J=e(50053),U={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};class ue extends t().Component{constructor(){super(...arguments);this.handlePropsSubmit=a=>{var n=this.props,s=n.handleSubmit,o=n.onTypeChange;o(a),s()},this.renderFooter=()=>{var a=this.props,n=a.isSubmitting,s=n===void 0?!1:n,o=a.onCancel,u=a.t,l=a.isEdit;return t().createElement("footer",{className:""},t().createElement("div",{className:"cl-form-fixed-footer__container"},t().createElement(T.Z,{disabled:s,loading:s,onClick:()=>this.handlePropsSubmit("draft")},u("common.draft")),t().createElement(T.Z,{onClick:o},u("common.cancel")),t().createElement(T.Z,{type:"primary",disabled:s,loading:s,onClick:()=>this.handlePropsSubmit("release")},u(l?"common.save":"common.release"))))},this.renderDateRange=()=>{var a=this.props,n=a.values,s=a.t;return n.termType===1?null:t().createElement(p.gN,(0,c.Z)({component:P.C0,displayType:"Custom",name:"dateRange",label:s("questionn.investigateDetailValidity"),required:!0,defaultFieldList:n.dateRange,validate:o=>(0,J.V5)(o,n)},U))}}render(){var a=this.props,n=a.values,s=a.t,o=a.isEdit;return t().createElement(t().Fragment,null,t().createElement(p.l0,{className:"cl-form"},t().createElement("p",{className:"cl-form__sectitle"},s("exam.basicInformation")),t().createElement(p.gN,(0,c.Z)({component:k.Z,name:"title",label:s("questionn.evaluationName"),required:!0,type:"text",defaultValue:n.title,style:{width:"100%"},placeholder:s("questionn.evaluationPlaceholder"),validate:J.eS},U)),t().createElement(p.gN,{label:s("questionn.selectEvaluationTools"),required:!0,component:_,displayType:"Custom",isEdit:o,name:"evaluationTools",defaultFieldList:n.evaluationTools}),t().createElement(p.gN,(0,c.Z)({component:G,displayType:"Custom",name:"termType",label:s("questionn.evaluationDuration"),required:!0,defaultFieldList:n.termType},U)),this.renderDateRange(),t().createElement("p",{className:"cl-form__divide"}),t().createElement(p.gN,{component:P.ww,displayType:"Custom",name:"employeeRange",mode:["part"],defaultFieldList:n.employeeRange,validate:w.FI}),t().createElement("p",{className:"cl-form__divide"}),t().createElement("p",{className:"cl-form__sectitle"},s("questionn.investigateDetailSecSetting")),t().createElement(p.gN,{component:z,displayType:"Custom",name:"openResult",defaultFieldList:n.openResult}),t().createElement(p.gN,{component:P.i0,displayType:"Custom",name:"supervisor",defaultFieldList:n.supervisor,createUserId:n.createUserId}),this.renderFooter(),t().createElement(P.I,null)))}}var pe=(0,C.Z)()(ue),ee={getInfo:I.ZP.PostTalentEvaluation.getInfo,add:I.ZP.PostTalentEvaluation.add,edit:I.ZP.PostTalentEvaluation.edit};class ie extends A.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",evaluationTools:"",termType:1,dateRange:{startTime:null,endTime:null},employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},openResult:!1,supervisor:{supervisorUserList:[],isChecked:!0,visibleAuthScope:!0,authScopeIsChecked:!1,hasMarking:!1}},saveType:"release",isLoading:!0},this.getDetail=a=>{D.WY.get({url:ee.getInfo(a)}).then(n=>{var s=n.data,o=s.supervisor_id.split(","),u=s.supervisor_user_name.split(",");o=o.map((ge,ye)=>({type:2,id:ge,name:u[ye],show:!0}));var l=n.data,f=l.user_list,x=l.department_list,E=l.group_list,N=l.post_list,S=l.open_result,R=l.product_id,te=l.start_time,j=l.end_time,ae=l.term_type,ve=l.title,ce=l.type,he=l.authority_range;this.setState({initialParams:{title:ve,evaluationTools:R,termType:ae==="permanent"?1:2,dateRange:{startTime:ae==="permanent"?null:(0,F.p6)(te,"yyyy-MM-dd hh:mm:ss"),endTime:ae==="permanent"?null:(0,F.p6)(j,"yyyy-MM-dd hh:mm:ss")},employeeRange:{rangeType:2,rangeList:{dept:x,post:N,group:E,user:f}},openResult:S===1,supervisor:{supervisorUserList:o,isChecked:!1,visibleAuthScope:!0,hasMarking:!1,authScopeIsChecked:he==="true"}},saveType:ce==="release"?1:0,isLoading:!1})})},this.handleTypeChange=a=>{this.setState({saveType:a})},this.handleSubmit=(a,n)=>{var s=a.title,o=a.termType,u=a.evaluationTools,l=a.openResult,f=a.employeeRange,x=a.dateRange,E=a.supervisor,N=L.parse(this.props.history.location.search),S=N.id,R=(0,K.b)(f.rangeList),te={open_result:l?1:0,group_ids:f.rangeType==2?R.groupIds.join(","):"",department_ids:f.rangeType==2?R.deptIds.join(","):"",user_ids:f.rangeType==2?R.userIds.join(","):"",post_ids:f.rangeType==2?R.postIds.join(","):"",product_id:u,term_type:o===1?"permanent":"custom",start_time:o===1?"":x.startTime,end_time:o===1?"":x.endTime,status:this.state.saveType==="release"?1:0,title:(0,F.fy)(s),supervisor_Id:E.supervisorUserList.map(j=>j.id).join(","),authority_range:E.authScopeIsChecked};D.WY.post({url:S?ee.edit(S):ee.add(),data:(0,se.Z)({},te)}).then(j=>{j.data?(O.default.success("".concat(this.state.saveType==="release"?S?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess"):this.props.t("common.draftSuccess"))),setTimeout(()=>{n.setSubmitting(!1),this.props.history.push("/talentedDevelopment/evaluationMenu/evaluation")},1e3)):n.setSubmitting(!1)})},this.handleCancel=()=>{this.props.history.push("/talentedDevelopment/evaluationMenu/evaluation")}}componentDidMount(){var a=L.parse(this.props.history.location.search),n=a.id;n?this.getDetail(n):this.setState({isLoading:!1})}render(){var a=this.props,n=a.prefixCls,s=a.history,o=a.t,u=this.state,l=u.initialParams,f=u.isLoading;if(f)return t().createElement(B.Z,{size:"large"});var x=L.parse(s.location.search),E=x.id,N="".concat(o(E?"common.edit":"common.add")).concat(o("questionn.postTalentEvaluation"));return t().createElement(b.Z,{pageContainerParams:{header:{title:N}}},t().createElement(Q.Z,{title:o("documentTitle.learningBatchAdd")}),t().createElement("div",{className:n},E&&t().createElement(le.q,null,t().createElement("title",null,"\u7F16\u8F91\u5C97\u4F4D\u4EBA\u624D\u6D4B\u8BC4")),t().createElement("div",{className:"".concat(n,"__content")},t().createElement(p.J9,{initialValues:l,onSubmit:this.handleSubmit,render:S=>t().createElement(pe,(0,c.Z)({},S,{title:N,isEdit:!!E,onCancel:this.handleCancel,onTypeChange:this.handleTypeChange}))}))))}}ie.defaultProps={prefixCls:"evaluation-detail"};var me=(0,C.Z)()(ie)}}]);
