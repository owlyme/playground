(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[7891],{67620:function(he,W,s){"use strict";var h=s(34792),B=s(48086),z=s(12924),A=s.n(z),L=s(19222),X=s.n(L),K=s(32407),N=s(37055),R=N.ZP.Common.editorUpload(),M="cl_editor_toolbar_default",o="cl_editor_content_default";class D extends z.Component{constructor(k){super(k);this.initEditor=()=>{this.editor=new(X())(".".concat(this.props.toolbarCls),".".concat(this.props.contentCls)),this.editor.config.zIndex=10,this.editor.config.onfocus=()=>{var e=document.querySelector(".".concat(this.props.contentCls));e&&(e.style.minHeight=this.props.contentHeight,e.style.height="auto")},this.editor.config.onblur=()=>{var e=document.querySelector(".".concat(this.props.contentCls));e&&(e.style.height=this.props.contentHeight)},this.editor.config.menus=this.props.controls,this.editor.config.placeholder=this.props.placeholderContent||K.Z.t("component.pleaseEnterText"),this.editor.config.onchange=e=>{this.props.onChange&&this.props.onChange(e)},this.editor.config.onchangeTimeout=300,this.editor.config.uploadImgServer=R,this.editor.config.uploadImgMaxLength=5,this.editor.config.uploadImgParams={access_token:window.localStorage.getItem("token")},this.editor.config.uploadFileName="files",this.editor.config.uploadImgHooks={customInsert(e,m){var ve=m.data;ve.forEach(H=>{e(H)})}},this.editor.config.pasteTextHandle=function(e){return~e.indexOf("<!--[if gte mso 9]><xml>")||~e.indexOf("<spanyes")?"\u7C98\u8D34\u5185\u5BB9\u6709\u4E71\u7801\uFF0C\u8BF7\u4F7F\u7528ctrl+shift+v\u6765\u7C98\u8D34\u5185\u5BB9(mac\u8BF7\u4F7F\u7528command+shift+v)":e},this.editor.config.focus=!1,this.editor.config.uploadImgMaxSize=3*1024*1024,this.editor.config.uploadImgAccept=["jpg","jpeg","png","gif","bmp"],this.editor.config.showLinkImg=!1,this.editor.config.customAlert=function(e,m){switch(m){case"success":B.default.success(e);break;case"info":B.default.info(e);break;case"warning":B.default.warning(e);break;case"error":B.default.error(e);break;default:B.default.info(e);break}},this.editor.create(),this.editor.txt.html("".concat(this.props.placeholder))},this.getHtml=()=>this.editor.txt.html(),this.getText=()=>this.editor.txt.text(),this.setHtml=e=>this.editor.txt.html(e),this.editor=null}componentDidMount(){this.initEditor()}render(){var k=this.props.toolbarCls?"".concat(this.props.toolbarCls," cl_editor_toolbar"):"".concat(M," cl_editor_toolbar"),e=this.props.contentCls?"".concat(this.props.contentCls," cl_editor_content"):"".concat(o," cl_editor_content");return A().createElement(A().Fragment,null,A().createElement("div",{className:k}),A().createElement("div",{className:e,style:{height:this.props.contentHeight,minHeight:this.props.contentHeight}}))}}D.defaultProps={controls:["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","video","code","undo","redo"],placeholder:"\u5185\u5BB9\u7F16\u8F91\u533A\u57DF",toolbarCls:M,contentCls:o,contentHeight:"300px",placeholderContent:""},W.Z=D},26697:function(he,W,s){"use strict";var h=s(71194),B=s(57016),z=s(57663),A=s(71577),L=s(34792),X=s(48086),K=s(57361),N=s(9754),R=s.n(N),M=s(12924),o=s.n(M),D=s(91768),F=s(10237),k=s(28216),e=s(37055);class m extends o().Component{constructor(H){var w;super(H);w=this,this.dealData=()=>{this.setState({recordList:this.props.record})},this.getPostTree=(0,K.Z)(R().mark(function v(){var E;return R().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,F.WY.get({url:e.ZP.LibraryList.listByLevel(),params:{level:2,is_layered:"true"}});case 2:E=O.sent,E&&w.setState({treeData:E.data});case 4:case"end":return O.stop()}},v)})),this.AIsure=function(){var v=(0,K.Z)(R().mark(function E(I){var O,U;return R().wrap(function($){for(;;)switch($.prev=$.next){case 0:return O=[],w.state.recordList.forEach(T=>{T.ai_resources.forEach(te=>{(te.ai_upgrade_status==="not"||te.ai_upgrade_status==="ai_failed")&&O.push({classify_id:I?te.categoryId:"",resourceId:te.resource_id,course_id:T.course_id})})}),$.next=4,F.WY.post({url:e.ZP.LibraryList.batchSubmit(),data:{resourceClassifyVoList:O}});case 4:U=$.sent,U&&(X.default.success(w.props.t("study.operateSuccess")),w.props.onCancel(!I));case 6:case"end":return $.stop()}},E)}));return function(E){return v.apply(this,arguments)}}(),this.handleChange=(v,E)=>{var I=[];I=this.state.recordList.map(O=>{var U=O;return U.ai_resources.map(ee=>{var $=ee;return ee.resource_id===E.resource_id&&($.categoryId=$.categoryId==v.id?"":v.id),$}),U}),this.setState({recordList:I})},this.state={recordList:[],treeData:[]},this.operateResourceItem=""}componentDidMount(){this.dealData(),this.getPostTree()}render(){var H=localStorage.getItem("themeColor")||"#465dcd";return o().createElement(B.Z,{title:"".concat(this.props.t("course.chooseAICategory")),visible:this.props.visible,onCancel:()=>this.props.onCancel(),className:"AIAllCourseModal",width:900,footer:null},this.props.visible&&o().createElement("div",{className:"AI-course-modal"},o().createElement("p",null,this.props.t("course.AIValue")),o().createElement("p",null,this.props.t("course.AITip")),o().createElement("div",{className:"AICategory-main"},this.state.recordList.map(w=>o().createElement("ul",{className:"AI-course-list"},w.ai_resources.map(v=>o().createElement("li",null,o().createElement("div",{className:"course-list-name"},v.name),this.state.treeData.map(E=>E.children.length?o().createElement("div",{className:"tabs-box"},o().createElement("p",null,E.name,"\uFF1A"),o().createElement("ul",{className:"tabs"},E.children.map(I=>o().createElement("li",{onClick:()=>this.handleChange(I,v),className:v.categoryId===I.id?"active":"",style:v.categoryId===I.id?{backgroundColor:H}:{}},I.name)))):null)))))),o().createElement("div",{className:"cl-form-fixed-footer__container"},o().createElement(A.Z,{className:"form-page-container-bottom-btn",onClick:()=>this.props.onCancel()},this.props.t("common.cancel")),o().createElement(A.Z,{type:"primary",onClick:()=>this.AIsure(!0)},this.props.t("course.AICut")),o().createElement(A.Z,{type:"primary",onClick:()=>this.AIsure()},this.props.t("course.ManualCut")))))}}W.Z=(0,k.$j)()((0,D.Z)()(m))},29284:function(he,W,s){"use strict";s.d(W,{lL:function(){return ze},kI:function(){return We},yX:function(){return je},UW:function(){return Ve},Rv:function(){return Ue},gg:function(){return Fe},_z:function(){return Ce},mh:function(){return $e},RQ:function(){return Be},J$:function(){return Me},_D:function(){return we}});var h=s(62029),B=s(62350),z=s(75443),A=s(22385),L=s(31097),X=s(57663),K=s(71577),N=s(88986),R=s(57361),M=s(34792),o=s(48086),D=s(9754),F=s.n(D),k=s(12924),e=s.n(k),m=s(91768),ve=s(94184),H=s.n(ve),w=s(28216),v=s(76651),E=s(57068),I=s(80991),O=s(36546),U=s(44289),ee=s(1164),$=s(76466),T=s(84874),te=s(86458),_=s(37055),Le=s(74262),Ee=s(10780),fe=s(6793),oe=s(86726),ne=V=>({userInfo:V.user,documentStudyLimit:V.advancedSetting.documentStudyLimit});class ue extends e().Component{constructor(i){var n;super(i);n=this,this.handleSelectCourseware=()=>{this.props.defaultFieldList.length>=50?o.default.warning(this.props.t("course.courseDetailResourceLimit")):this.setState({visible:!0})},this.handleUploadFileSuccess=t=>{var l=this.state,c=l.uploadShow,d=l.list,P=this.props.defaultFieldList,y=[...d,...t];if(P.length+t.length>50){o.default.warning(this.props.t("course.courseDetailResourceLimit"));return}Object.assign(c,{visible:!1}),this.setState({uploadShow:c,list:y},()=>{this.triggerChange(y)})},this.handleUploadClose=()=>{var t=this.state.uploadShow;Object.assign(t,{visible:!1}),this.setState({uploadShow:t})},this.handleChooseFiles=(0,R.Z)(F().mark(function t(){var l,c,d;return F().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return l=n.props.t,y.next=3,(0,fe.x8)("quota_source_book",l("course.sourceValidateLimit",{courseType:l("documentTitle.matter")}));case 3:if(c=y.sent,!c){y.next=6;break}return y.abrupt("return");case 6:d=n.state.uploadShow,Object.assign(d,{visible:!0}),n.setState({uploadShow:d});case 9:case"end":return y.stop()}},t)})),this.handleOk=t=>{var l=[...this.state.list].concat(t),c=(0,fe.Cj)(l);if(c.length>50){o.default.warning(this.props.t("course.courseDetailResourceLimit"));return}this.setState({list:c,visible:!1},()=>{this.triggerChange(c)})},this.handleCancel=()=>{this.setState({visible:!1})},this.handleAddArticle=()=>{ee.Z.targetTo({path:"/training/resourceManage/library/articleDetail?classifyId=0"})},this.triggerChange=t=>{this.props.formik.setFieldValue("resource",t);var l=0;l+=t.filter(c=>["h5","txt","doc","docx","xls","xlsx","pdf","ppt","pptx"].indexOf(c.type)>0).length,this.props.formik.setFieldValue("studyLimit",(0,N.Z)((0,N.Z)({},this.props.formik.values.studyLimit),{},{checked:this.props.documentStudyLimit!==0&&l>0}))},this.dealWatchType=t=>{var l=_.Yq.findIndex(ce=>t.type.toLowerCase().includes(ce))>-1,c=_.WB.indexOf(t.type.toLowerCase())>-1,d=_.SR.indexOf(t.type.toLowerCase())>-1||t.contentType.indexOf("html")>-1,P=t.contentType.indexOf("scorm")>-1,y=t.contentType.indexOf("video")>-1,Q=_.Ss.indexOf(t.contentType)>-1,G=t.contentType.indexOf("h5")>-1,b="";return G?b="article":l?b="doc":y||Q?b="video":c?b="image":d?b="html":P&&(b="scorm"),b},this.handlePreview=t=>{var l=t.item,c=this.state.previewInfo,d=l.data||l,P=d.status===1||d.status===2;if(P){o.default.warning(this.props.t("resourceLibrary.transcodingPlayerTip"));return}var y=this.dealWatchType(d),Q=_.Ss.indexOf(d.contentType)>-1;if(d.type==="mp4"&&d.aiUpgradeStatus==="finish"){v.m8.push({pathname:"/training/resourceManage/library/videoPreview",search:E.stringify({id:d.id})});return}if(y==="article"){var G=d.contentType,b=d.url,ce=G==="h5/link";ce?ee.Z.targetTo({path:b,isExternalLink:!0}):ee.Z.targetTo({path:"/training/resourceManage/library/articlePreview?id=".concat(d.id)});return}var de={mode:"preview",watchType:y};y==="doc"?Object.assign(de,{resourceInfo:{type:"",docType:d.type,aliUrl:d.path,url:d.url,docTitle:d.name,playId:d.videoId||d.video_id,storageType:d.storage_type}}):y==="image"?Object.assign(de,{resourceInfo:{url:d.url,playId:d.videoId||d.video_id,storageType:d.storage_type}}):y==="html"?Object.assign(de,{resourceInfo:{url:d.url}}):Object.assign(de,{resourceInfo:{source:{FD:d.url,OD:d.path},originUrl:d.url,contentType:Q?"mp3":d.type,playId:d.videoId||d.video_id,storageType:d.storage_type},autoPlay:!0,draggable:!0}),this.setState({resourcePlayInfo:de,previewInfo:(0,N.Z)((0,N.Z)({},c),{},{title:d.name,visible:!0,onCancel:this.cancelPreview})})},this.cancelPreview=()=>{var t=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"",resourceInfo:{}},previewInfo:(0,N.Z)((0,N.Z)({},t),{},{visible:!1})})},this.handleDelete=t=>{var l=[...this.state.list],c=l.findIndex(d=>d.id===t);c>-1&&l.splice(c,1),this.setState({list:l}),this.triggerChange(l)},this.handleDND=(t,l)=>{var c=this.state.list,d=c[t];c.splice(t,1),c.splice(l,0,d),this.setState({list:c})},this.generateCourseSelecorList=t=>{var l=[];return t.forEach(c=>{c.componentName==="CoursewareSelector"&&l.push({id:c.id,name:c.name,componentName:"CoursewareSelector",data:c.data,icon:_.e1[c.type],type:c.type,duration:c.data.duration})}),l},this.renderTitle=()=>{var t=(0,oe.V9)("courseManage",this.props.userInfo.modules),l=(0,oe.H3)("make_interactive_video",t),c=this.props,d=c.prefixCls,P=c.formik,y=c.t,Q=c.userInfo,G=this.state.list,b=Q.appType,ce=P.values.relationPlan,de=localStorage.getItem("themeColor")||"#465dcd",Re=0;return G.forEach(Ne=>{var Se=Ne.data?Ne.data:Ne;Se.contentType.includes("video")&&Se.status&&Se.status===3&&Se.privatization==="public"&&(Re+=1)}),e().createElement("h1",{className:"".concat(d,"__title")},y("course.courseDetailResource"),ce?null:this.renderHeaderAction(),Re>0&&l&&b!=="wx_app"&&e().createElement(L.Z,{placement:"top",title:y("course.interactiveVideoEdit")},e().createElement(K.Z,{className:"text-btn interactiveInter",style:{color:de},onClick:()=>this.props.handleSubmit("")},y("course.createInteractiveVideo"))))},this.renderHeaderAction=()=>{var t=this.props.t;return e().createElement("div",{className:"action-container"},e().createElement(K.Z,{type:"primary",className:"qa-course-library-selection-button",onClick:this.handleSelectCourseware},e().createElement(T.Z,{iconClass:"iconf-course-library",color:"#fff",size:"14px"}),t("course.courseDetailResourceCS")),e().createElement(K.Z,{type:"primary",className:"qa-local-upload-button",onClick:this.handleChooseFiles},e().createElement(T.Z,{iconClass:"iconf-folder",color:"#fff",size:"14px"}),t("course.courseDetailResourceUP")))},this.renderContent=()=>{var t=this.props.prefixCls,l=this.state.list;return e().createElement("ul",{className:"".concat(t,"__content")},l.map((c,d)=>this.renderItem(c,d)))},this.renderTooltip=t=>{var l=this.props.t;return t.status===3&&(t.type==="mp4"||t.type==="mp3")?e().createElement("span",{className:"item__duration"},(0,fe.xj)(t.duration)):t.status&&t.status!==3?e().createElement("span",{className:"resource-item-duration"},"--:--:--",e().createElement(L.Z,{placement:"top",title:l("course.transcodingStudyLimit")},e().createElement("span",null,e().createElement(T.Z,{iconClass:"icon-f-tipe",color:"#9C9C9F"})))):e().createElement("span",{className:"item__duration"},"--:--:--",e().createElement(L.Z,{placement:"top",title:this.getTitle(t)},e().createElement("span",null,e().createElement(T.Z,{iconClass:"icon-f-tipe",color:"#9C9C9F"}))))},this.getTitleTip=t=>{var l=this.props.t,c=t.data?t.data.privatization:t.privatization;return c!=="public"?l("course.interactiveVideoDisabledC"):t.status!==3?l("course.interactiveVideoDisabledB"):""},this.renderInteractiveVideo=t=>{var l=(0,oe.V9)("courseManage",this.props.userInfo.modules),c=(0,oe.H3)("make_interactive_video",l),d=this.props.t,P=t.data?t.data.contentType:t.contentType,y=t.data?t.data.privatization:t.privatization,Q=t.data?t.data.isInteract:t.isInteract;return P.includes("video")&&t.status&&t.status===3&&y==="public"&&c?e().createElement(L.Z,{placement:"top",title:d("course.interactiveVideoEdit")},e().createElement("span",{className:"interactiveInter interactiveSuccess",onClick:()=>this.props.handleSubmit(t.id)},e().createElement(T.Z,{color:"#4D67E9",iconClass:Q?"icon-yikanshipin1":"icon-hudongshipin",size:"16px"}))):P.includes("video")&&c&&(t.status&&t.status===3||y!=="public")?e().createElement(L.Z,{placement:"top",title:this.getTitleTip(t)},e().createElement("span",{className:"interactiveInter interactiveFail"},e().createElement(T.Z,{color:"#E1E0E5",iconClass:"icon-hudongshipin",size:"16px"}))):""},this.getTitle=t=>{var l=this.props.t;return t.type==="h5"?l("course.ArticleStudyLimit"):t.type==="html"||t.type==="jpg"||t.type==="jpeg"||t.type==="png"||t.type==="scorm"?l("common.notSupportSetTime"):l("course.documentStudyLimitTip3")},this.renderItem=(t,l)=>{var c=this.props,d=c.prefixCls,P=c.formik,y=c.t,Q=c.userInfo,G=P.values.relationPlan,b=Q.appType,ce=H()(["".concat(d,"__content__list item ").concat(G?"item-disabled":"")]);return t.type=_.Ss.indexOf(t.contentType)>-1?"mp3":t.type,e().createElement(te.Z,{id:t.id,key:t.id,title:t.title,content:t.content,index:l,disabled:G,onDND:this.handleDND},e().createElement("li",{className:ce,key:t.id},e().createElement(T.Z,{iconClass:_.e1[t.type],size:"16px"}),e().createElement("span",{className:"item__title",onClick:()=>this.handlePreview({item:t})},t.name),this.renderTooltip(t),G?e().createElement("span",{className:"item__action"},b!=="wx_app"&&this.renderInteractiveVideo(t)):e().createElement("span",{className:"item__action"},b!=="wx_app"&&this.renderInteractiveVideo(t),e().createElement(z.Z,{title:y("common.confirmDeleteTitle"),onConfirm:()=>this.handleDelete(t.id)},e().createElement("span",{className:"item__action__delete"},e().createElement(T.Z,{iconClass:"iconf-clear",size:"16px"}))),e().createElement("span",{className:"item__action__drag"},localStorage.getItem("dingPersonnel")!=="dingPersonnel"&&e().createElement(T.Z,{iconClass:"iconf-move",size:"19px"})))))},this.state={list:i.defaultFieldList,visible:!1,uploadShow:{visible:!1,title:this.props.t("common.storage"),onSuccess:t=>this.handleUploadFileSuccess(t),onCancel:()=>this.handleUploadClose()},resourcePlayInfo:{mode:"preview",watchType:"",resourceInfo:{},autoPlay:!0,draggable:!0},previewInfo:{visible:!1,destroyOnClose:!0,title:this.props.t("resourceLibrary.previewCourseware"),onCancel:()=>{}}}}render(){var i=this.props.prefixCls,n=this.state,t=n.visible,l=n.list,c=n.uploadShow,d=n.resourcePlayInfo,P=n.previewInfo;return e().createElement("section",{className:"".concat(i)},this.renderTitle(),this.renderContent(),e().createElement(Le.Z,(0,h.Z)({isAllowLocal:!0,params:{classifyId:0,bizType:0}},c)),e().createElement(Ee.Z,{visible:t,defaultChecked:this.generateCourseSelecorList(l),onOk:this.handleOk,onCancel:this.handleCancel,excludeType:"h5"}),e().createElement($.Z,(0,h.Z)({},d,{previewInfo:P})))}}ue.defaultProps={prefixCls:"resource"};var De=(0,w.$j)(ne)((0,O.Z5)(U.ZP)((0,I.$j)((0,m.Z)()(ue)))),Ze=s(31151),Te=s(60667);class Ie extends e().Component{constructor(){super(...arguments);this.state={visible:!1},this.handleSelectTeacher=()=>{this.setState({visible:!0})},this.handleCancel=()=>{this.setState({visible:!1})},this.handleOk=i=>{var n=i.id,t=i.name,l=i.data;this.props.formik.setFieldValue("teacher",{id:n,name:t,lecturer_sync_user_id:l.lecturer_sync_user_id,lecturer_source_type:l.lecturer_source_type,type:l.type}),this.handleCancel()},this.handleDelete=()=>{this.props.formik.setFieldValue("teacher",{id:0,name:""})}}render(){var i=this.props,n=i.prefixCls,t=i.defaultFieldList,l=t.id,c=t.name,d=t.lecturer_sync_user_id,P=t.lecturer_source_type,y=t.type,Q={id:l,name:c,data:{}},G=localStorage.getItem("themeColor")||"#516AE6";return e().createElement("div",{className:n},c?e().createElement("span",{className:"".concat(n,"__name")},y==="inside"?e().createElement(Te.Z,{dataType:"userName",value:d,name:c,type:P}):c,e().createElement("span",{className:"".concat(n,"__name__delete"),onClick:this.handleDelete},e().createElement(T.Z,{iconClass:"icon-guanbi1"}))):null,e().createElement("span",{className:"".concat(n,"__add"),style:{borderColor:G,color:G},onClick:this.handleSelectTeacher},e().createElement(T.Z,{iconClass:"iconf-add-man"})),e().createElement(Ze.Z,{visible:this.state.visible,selected:Q,onOk:this.handleOk,onCancel:this.handleCancel}))}}Ie.defaultProps={prefixCls:"teacher"};var pe=(0,I.$j)(Ie),be=s(88983),S=s(47933),se=s(81211);class ae extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]);return e().createElement(S.ZP.Group,(0,h.Z)({name:"originalGroup"},t),e().createElement(S.ZP,{value:1},n("course.courseDetailOriginalTrue"),e().createElement(L.Z,{title:n("course.courseDetailOriginalTrueTip")},e().createElement("span",{style:{marginLeft:"5px"}},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))),e().createElement(S.ZP,{value:0},n("course.courseDetailOriginalFalse"),e().createElement(L.Z,{title:n("course.courseDetailOriginalFalseTip")},e().createElement("span",{style:{marginLeft:"5px"}},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))))}}var Z=(0,m.Z)()(ae),a=s(67620);class p extends e().Component{constructor(i){super(i);this.handleChange=n=>{var t=n;this.setState({introduction:t}),this.triggerChange(t)},this.triggerChange=n=>{this.props.formik.setFieldValue("introduction",{desc:n})},this.getHtml=()=>{var n=this.editorInstance.getHtml();return n},this.state={introduction:i.defaultFieldList.desc}}render(){return e().createElement(a.Z,{ref:i=>this.editorInstance=i,toolbarCls:this.props.toolbarCls,contentCls:this.props.contentCls,placeholder:this.state.introduction,onChange:this.handleChange,controls:["head","bold","fontSize","fontName","italic","underline","strikeThrough","image","undo","redo"]})}}var r=(0,I.$j)(p),C=s(63185),u=s(9676),x=s(77883),f=s(21888);class g extends e().Component{constructor(){super(...arguments);this.renderText=()=>{var i=this.props.t;return e().createElement("div",null,e().createElement("p",{className:"title"},i("course.documentStudyLimitTip1")),e().createElement("p",{className:"title"},i("course.documentStudyLimitTip2")))},this.handleChangeCheckbox=i=>{var n=i.target.checked;this.props.formik.setFieldValue("studyLimit",{checked:n,limit:this.props.defaultFieldList.limit})},this.handleChangeInput=i=>{this.props.formik.setFieldValue("studyLimit",{checked:this.props.defaultFieldList.checked,limit:i})},this.renderInput=()=>{var i=this.props,n=i.defaultFieldList,t=i.t;return e().createElement("span",null,e().createElement(f.Z,{precision:0,min:1,max:9999,value:n.limit,disabled:!n.checked,onChange:this.handleChangeInput}),e().createElement("span",{style:{margin:"0 8px"}},t("course.secByPage"),e().createElement(L.Z,{placement:"top",title:this.renderText},e().createElement("span",null,e().createElement(T.Z,{iconClass:"icon-f-tipe"}))),n.checked?null:e().createElement("span",{style:{marginLeft:"8px"}},t("course.documentStudyLimitTip"))))}}render(){var i=this.props,n=i.defaultFieldList,t=i.shouldSetStudyLimit,l=i.t;return e().createElement(e().Fragment,null,e().createElement(u.Z,{onChange:this.handleChangeCheckbox,checked:n.checked,disabled:!t},l("course.documentLearningTime")),this.renderInput())}}var q=(0,I.$j)((0,m.Z)()(g));class J extends e().Component{constructor(){super(...arguments);this.handleChangeChecbox=i=>{var n=i.target.checked;this.props.formik.setFieldValue("credit",{checked:n,score:this.props.defaultFieldList.score})},this.handleChangeInput=i=>{this.props.formik.setFieldValue("credit",{checked:this.props.defaultFieldList.checked,score:i})},this.renderInput=()=>{var i=this.props.defaultFieldList;return e().createElement("span",null,e().createElement(f.Z,{precision:0,min:0,max:999,value:i.score,disabled:!i.checked,onChange:this.handleChangeInput}),this.props.t("course.courseDetailRewardUnit"))}}render(){var i=this.props.defaultFieldList;return e().createElement(e().Fragment,null,e().createElement(u.Z,{onChange:this.handleChangeChecbox,checked:i.checked},this.props.t("common.credit")),this.renderInput())}}var ie=(0,I.$j)((0,m.Z)()(J));class re extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]);return e().createElement(S.ZP.Group,(0,h.Z)({name:"downloadGroup"},t),e().createElement(S.ZP,{value:0},n("course.courseDetailDownloadForbidden")),e().createElement(S.ZP,{value:1},n("course.courseDetailDownloadAllow")))}}var Y=(0,m.Z)()(re);class ge extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]),l=v.m8.location.query.courseId;return e().createElement(e().Fragment,null,e().createElement(S.ZP.Group,(0,h.Z)({name:"completeCourseGroup"},t,{disabled:l}),e().createElement(S.ZP,{value:"all"},n("course.courseDetailCompleteAll")),e().createElement(S.ZP,{value:"onlyOne"},n("course.courseDetailCompleteAny")),e().createElement(L.Z,{title:n("course.courseDetailTip")},e().createElement("span",{className:"stydyTypeTip"},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))),e().createElement("span",null,n("course.courseDetailInfo")))}}var le=(0,m.Z)()(ge);class xe extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]);return e().createElement(S.ZP.Group,(0,h.Z)({name:"studyType"},t),e().createElement(S.ZP,{value:""},n("course.courseStudyTypeDefault"),e().createElement(L.Z,{title:n("course.courseStudyTypeDefaultTip")},e().createElement("span",{className:"stydyTypeTip"},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))),e().createElement(S.ZP,{value:"requiredCourse"},n("course.courseStudyTypeTrue"),e().createElement(L.Z,{title:n("course.courseStudyTypeTrueTip")},e().createElement("span",{className:"stydyTypeTip"},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))),e().createElement(S.ZP,{value:"notRequiredCourse"},n("course.courseStudyTypeFalse"),e().createElement(L.Z,{title:n("course.courseStudyTypeFalseTip")},e().createElement("span",{className:"stydyTypeTip"},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"})))))}}var Pe=(0,m.Z)()(xe);class Oe extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]);return e().createElement(S.ZP.Group,(0,h.Z)({name:"downloadGroup"},t),e().createElement(S.ZP,{value:0},n("common.outSync")),e().createElement(S.ZP,{value:1},n("common.synchronization")),e().createElement(L.Z,{title:n("common.scheduleSyncTip")},e().createElement("span",{className:"stydyTypeTip"},e().createElement(T.Z,{iconClass:"iconf-tipe",color:"#D5D8DE",size:"14px"}))))}}var Ae=(0,m.Z)()(Oe);class ye extends e().Component{render(){var i=this.props,n=i.t,t=(0,se.Z)(i,["t"]);return e().createElement(S.ZP.Group,(0,h.Z)({name:"commentSwitch"},t),e().createElement(S.ZP,{value:0},n("common.unactivated")),e().createElement(S.ZP,{value:1},n("common.open")))}}var me=(0,m.Z)()(ye),j=s(43859),Ce=(0,j.Z)(De),Me=(0,j.Z)(pe),Fe=(0,j.Z)(Z),we=(0,j.Z)(Pe),Ue=(0,j.Z)(r),$e=(0,j.Z)(q),je=(0,j.Z)(ie),Ve=(0,j.Z)(Y),We=(0,j.Z)(le),Be=(0,j.Z)(Ae),ze=(0,j.Z)(me)},60958:function(he,W,s){"use strict";s.r(W),s.d(W,{default:function(){return se}});var h=s(62029),B=s(20228),z=s(11382),A=s(57361),L=s(34792),X=s(48086),K=s(88986),N=s(9754),R=s.n(N),M=s(12924),o=s.n(M),D=s(28216),F=s(91768),k=s(57068),e=s(76651),m=s(80991),ve=s(57663),H=s(71577),w=s(19858),v=s(72538),E=s(29284),I=s(38642),O=s(2396),U=s(62615),ee=s(52670),$=s(7584),T=ae=>({userInfo:ae.user});class te extends o().Component{constructor(){var Z;super(...arguments);Z=this,this.state={},this.handlePropsSubmit=function(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2?arguments[2]:void 0,C=Z.props,u=C.handleSubmit,x=C.onTypeChange;x(a,p,r),u()},this.handCancel=()=>{var a=k.parse(e.m8.location.search),p=a.history,r=this.props.userInfo,C=r===void 0?{}:r,u=C.showUserModules,x=u===void 0?"":u,f,g;switch(p){case"courseManagement":f="/course/management",g="student";break;case"myCreate":f="/personal/profile?tab=mycreate",g="student";break;case"rescource":f="/knowledgeBase/learningResources/courseManage";break;default:f="/course/management",g="student";break}x&&p==="courseManagement"&&(f="/knowledgeBase/learningResources/courseManage",g=""),(0,I.eJ)({url:f,projectType:g||"manage"})}}render(){var Z=this.props,a=Z.values,p=Z.isSubmitting,r=p===void 0?!1:p,C=Z.title,u=Z.t,x=Z.tagGroupInit,f=0;return f+=a.resource.filter(g=>["h5","txt","doc","docx","xls","xlsx","pdf","ppt","pptx"].includes(g.type)).length,o().createElement(m.l0,{className:"cl-form"},o().createElement("h1",{className:"cl-form-htitle"},C),o().createElement(m.gN,(0,h.Z)({component:$.Z,name:"title",label:u("course.courseDetailName"),required:!0,type:"text",defaultValue:a.title,style:{width:"745px"},placeholder:u("course.courseDetailNamePlaceholder"),validate:g=>(0,O.QK)(g,u("course.courseDetailNamePlaceholder"))},v.I4)),o().createElement(m.gN,{component:E._z,displayType:"Custom",name:"resource",courseTitle:a.title,defaultFieldList:a.resource,handleSubmit:g=>this.handlePropsSubmit("draft",!1,g),validate:w.$h}),o().createElement(m.gN,(0,h.Z)({component:U.Y9,displayType:"Custom",name:"covers",label:u("course.courseDetailCover"),required:!0},v.I4)),o().createElement(m.gN,(0,h.Z)({component:U.O,displayType:"Custom",name:"courseClassify",label:u("course.courseDetailCategory"),isObj:!0,required:!0,validate:g=>(0,O.QK)(g.id,u("course.courseDetailCategoryPlaceholder")),defaultValue:a.courseClassify},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.J$,name:"teacher",label:u("course.courseDetailLecture"),displayType:"Custom",defaultFieldList:a.teacher},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.gg,name:"original",label:u("course.courseDetailOriginal"),type:"text",defaultValue:a.original},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E._D,name:"studyType",label:u("course.courseStudyType"),type:"text",defaultValue:a.studyType},v.I4)),o().createElement(m.gN,(0,h.Z)({component:U.QS,displayType:"Custom",name:"tagGroup",label:u("common.detailTag"),defaultFieldList:x},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.Rv,displayType:"Custom",name:"introduction",label:u("course.courseDetailIntro"),defaultFieldList:a.introduction,toolbarCls:"cl_editor_toolbar_coursedetail",contentCls:"cl_editor_content_coursedetail"},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.mh,label:u("course.selfStudyRequirements"),displayType:"Custom",name:"studyLimit",shouldSetStudyLimit:f>0,defaultFieldList:a.studyLimit,validate:w.T9},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.yX,label:u("course.courseDetailRewardScore"),displayType:"Custom",name:"credit",defaultFieldList:a.credit,validate:w.H4},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.UW,name:"download",label:u("course.courseDetailDownload"),type:"text",defaultValue:a.download},v.I4)),o().createElement(m.gN,(0,h.Z)({type:"text",component:E.lL,defaultValue:a.commentSwitch,label:u("course.courseCommentTitle"),name:"commentSwitch"},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.kI,name:"finishStandardStr",label:u("course.courseDetailComplete"),type:"text",defaultValue:a.finishStandardStr},v.I4)),o().createElement(m.gN,(0,h.Z)({component:E.RQ,name:"syncProgress",label:u("common.scheduleSync"),type:"text",defaultValue:a.syncProgress},v.I4)),o().createElement(m.gN,(0,h.Z)({component:U.ww,displayType:"Custom",name:"employeeRange",mode:["all","part","private"],orgProps:{title:u("component.chooseVisibleScope")},showSectitle:!1,qwTicketShow:!0,label:u("common.visibleRange"),defaultFieldList:a.employeeRange,validate:ee.FI},v.I4)),o().createElement(U.I,null),o().createElement("footer",{className:"cl-form-fixed-footer"},o().createElement("div",{className:"cl-form-fixed-footer__container"},o().createElement(H.Z,{onClick:this.handCancel},u("common.cancel")),o().createElement(H.Z,{disabled:r,loading:r,onClick:()=>this.handlePropsSubmit("draft")},u("common.draft")),o().createElement(H.Z,{type:"primary",disabled:r,loading:r,onClick:()=>this.handlePropsSubmit("release")},u("common.release")))))}}var _=(0,D.$j)(T)((0,F.Z)()(te)),Le=s(1164),Ee=s(6793),fe=s(34773),oe=s(86726),ne=s(37055),ue=s(10237),De=s(26697),Ze=s(4408),Te=s(28531),Ie=s(73704),pe={getScoreRule:ne.ZP.CourseManagement.getScoreRule,addCourse:ne.ZP.CourseManagement.addCourse,editCourse:ne.ZP.CourseManagement.editCourse,getCourseInfo:ne.ZP.CourseManagement.getCourseInfo,checkApproval:ne.ZP.CourseManagement.checkApproval},be=ae=>({documentStudyLimit:ae.advancedSetting.documentStudyLimit,userInfo:ae.user});class S extends o().Component{constructor(){var Z;super(...arguments);Z=this,this.state={initialParams:{title:"",resource:[],covers:{coverType:1,cover:"",baseCover:""},courseClassify:{id:"",name:""},teacher:{name:"",id:""},original:1,studyType:"",introduction:{desc:""},download:0,commentSwitch:1,finishStandardStr:"all",studyLimit:{checked:!1,limit:this.props.documentStudyLimit},credit:{checked:!1,score:0},syncProgress:0,employeeRange:{rangeType:3,qyWeChatVo:"",rangeList:{dept:[],post:[],group:[],user:[]}},relationPlan:!1,approval:""},initType:"release",isLoading:!0,isSubmitting:!1,AIModalFlag:!1,createList:[],allowActions:(0,oe.V9)("library",this.props.userInfo&&this.props.userInfo.modules),approvalModal:{isShowApprovalModal:!1,content:{},defaultTemplate:{}},courseId:"",temActions:{},temData:{}},this.onCancel=()=>{this.setState({AIModalFlag:!1});var a=this.props.userInfo,p=a===void 0?{}:a,r=p.showUserModules,C=r===void 0?"":r;C?e.m8.push("/knowledgeBase/learningResources/courseManage"):(0,I.eJ)({url:"/personal/profile?tab=mycreate"})},this.initParams=a=>{ue.WY.get({url:pe.getCourseInfo({id:a})}).then(p=>{var r=p.data;this.setState(()=>({initialParams:{title:(0,Ee.fy)(r.title),resource:r.resourceList,covers:{coverType:r.coverType,cover:r.cover,baseCover:r.baseCover},teacher:{name:r.teacherId!=0?r.teacherName:"",id:r.teacherId.toString(),type:r.teacher_type,lecturer_sync_user_id:r.teacher_sync_user_id,lecturer_source_type:r.teacher_source_type},original:r.original?1:0,studyType:r.studyType?r.studyType:"",introduction:{desc:r.introduction},download:r.download?1:0,finishStandardStr:r.finishStandardStr||"all",studyLimit:{checked:!!r.studyTimeLimit,limit:r.studyTimeLimit},credit:{checked:!!r.credit,score:r.credit},courseClassify:{id:r.courseClassify,name:r.courseClassifyName},employeeRange:{rangeType:r.isAll,qyWeChatVo:"",rangeList:{dept:r.departmentList||[],post:r.postList||[],group:r.groupList||[],user:r.userList||[]}},relationPlan:r.relationPlan||!1,syncProgress:r.syncProgress?1:0,commentSwitch:r.commentSwitch?1:0,approval:r.approval||""},isLoading:!1}))})},this.handleTypeChange=(a,p,r)=>{this.setState({initType:a,jump:p,jumpId:r})},this.handleSubmit=(a,p)=>{this.setState({temActions:p});var r=this.state.courseId,C=a.courseClassify,u=a.covers,x=a.credit,f=a.download,g=a.finishStandardStr,q=a.studyLimit,J=a.introduction,ie=a.original,re=a.tagGroup,Y=a.employeeRange,ge=a.resource,le=a.teacher,xe=a.title,Pe=a.studyType,Oe=a.syncProgress,Ae=a.commentSwitch,ye=re?re.tagsNameList:[],me=(0,fe.b)(Y.rangeList),j={id:r,title:(0,Ee.fy)(xe),introduction:J.desc,coverType:u.coverType,cover:u.cover,baseCover:u.baseCover,teacherId:le.id,courseClassify:C.id||"999",resource:JSON.stringify(ge.map((Ce,Me)=>({resourceId:Ce.id,sort:Me}))),original:ie,isAll:Y.rangeType,qy_we_chat_vo:Y.qyWeChatVo,groupIds:Y.rangeType===2?me.groupIds.join(","):"",departmentIds:Y.rangeType===2?me.deptIds.join(","):"",userIds:Y.rangeType===2?me.userIds.join(","):"",postIds:Y.rangeType===2?me.postIds.join(","):"",download:f,finishStandardStr:g,studyTimeLimit:q.checked?q.limit:0,credit:x.checked?x.score:0,init_type:this.state.initType,jump:!0,jumpId:"",studyType:Pe,syncProgress:Oe,tags:ye.length?ye.map(Ce=>Ce.tag_name).join(","):"",commentSwitch:Ae};this.funPublish({courseId:r,params:j,tagsNameList:ye})},this.funPublish=a=>{var p=a.courseId,r=a.params,C=a.tagsNameList;this.setState({isSubmitting:!0});var u;p?u=pe.editCourse():u=pe.addCourse(),ue.qg.post({url:u,data:(0,K.Z)({},r)}).then(x=>{var f=x.data,g=f.code,q=f.msg,J=f.data;if(p){var ie={tags:C,resourceId:p,resourceType:"course"};(0,Te.tB)(ie)}else if(C&&C.length){var re={tags:C,resourceId:J.course[0].course_id,resourceType:"course"};(0,Te.tB)(re)}g===0&&(this.setState({isSubmitting:!1}),this.state.initType==="draft"?(X.default.success(q),this.saveSuccessJump(p||J.course[0].course_id,g)):(X.default.success(this.props.t("common.saveSuccess")),this.setState({temData:r}),this.funCheckApproval(p||J.course[0].course_id,J,g)))}).catch(x=>{var f=x.response.data||"",g=f.code,q=this.props.t;g==="enterpriseapi.030610"?this.state.temActions.setSubmitting(!1):(X.default.error("".concat(q("course.releaseFailedTip"))),setTimeout(()=>{this.state.temActions.setSubmitting(!1)},1e3))})},this.funCheckApproval=(a,p,r)=>{this.setState({courseId:a});var C=p.state,u=p.approval_template;C?this.setState({approvalModal:{isShowApprovalModal:!0,defaultTemplate:u,content:{courseId:a,classifyType:"course"}}}):this.saveSuccessJump(a,r)},this.saveSuccessJump=(a,p)=>{this.setState({courseId:a});var r=k.parse(e.m8.location.search),C=r.from,u=r.history;if(!this.state.jump){var x=e.m8.location.pathname;e.m8.push({pathname:x,search:k.stringify({from:C,history:u,courseId:a})}),Le.Z.targetTo({path:"/training/learning/task/interactiveVideo?courseId=".concat(a,"&resourceId=").concat(this.state.jumpId)});return}var f=this.props.userInfo.enterpriseVersion==="comprehensive"&&(0,oe.H3)("ai_upgrade",this.state.allowActions);f&&!this.state.courseId?this.queryAiResource(a):setTimeout(()=>{this.state.temActions.setSubmitting(!1),p===0&&(C==="myCreate"?(0,I.eJ)({url:"/personal/profile?tab=mycreate",actionType:"replace"}):e.m8.replace("/knowledgeBase/learningResources/courseManage"))},1e3)},this.queryAiResource=(0,A.Z)(R().mark(function a(){var p,r,C,u;return R().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:p=Z.props.userInfo,r=p===void 0?{}:p,C=r.showUserModules,u=C===void 0?"":C,u?e.m8.replace("/knowledgeBase/learningResources/courseManage"):(0,I.eJ)({url:"/personal/profile?tab=mycreate",actionType:"replace"});case 3:case"end":return f.stop()}},a)})),this.getScoreRule=()=>{ue.WY.get({url:pe.getScoreRule()}).then(a=>{this.setState({isLoading:!1},()=>{this.initRef.setFieldValue("credit",{checked:!1,score:a.data.data.courseScoreList?a.data.data.courseScoreList[0].score:0})})})},this.handleCloseApproval=a=>{this.setState({approvalModal:{isShowApprovalModal:!1,content:{},defaultTemplate:{}}}),a==="submit"&&this.saveSuccessJump(this.state.courseId,0)}}componentDidMount(){var Z=k.parse(e.m8.location.search),a=Z.courseId;this.setState({courseId:a}),a?this.initParams(a):this.getScoreRule()}render(){var Z=this.props,a=Z.prefixCls,p=Z.t,r=this.state,C=r.initialParams,u=r.isLoading,x=r.isSubmitting,f=r.approvalModal,g=r.courseId,q=r.temData,J=f.isShowApprovalModal,ie=f.content,re=f.defaultTemplate;if(u)return o().createElement(z.Z,{size:"large"});var Y={resourceType:"course",resourceId:g},ge=g?"".concat(p("common.edit")).concat(p("course.courseDetailTitle")):"".concat(p("common.add")).concat(p("course.courseDetailTitle"));return o().createElement("div",{className:a},o().createElement(Ze.Z,{title:p(g?"documentTitle.editOnlineCourse":"documentTitle.newOnlineCourse")}),o().createElement("div",{className:"".concat(a,"__content")},o().createElement("div",{className:"".concat(a,"__content__form")},o().createElement(m.J9,{ref:le=>this.initRef=le,initialValues:C,onSubmit:this.handleSubmit,render:le=>o().createElement(_,(0,h.Z)({},le,{tagGroupInit:Y,title:ge,isEdit:!!g,isSubmitting:x,onTypeChange:this.handleTypeChange}))}))),this.state.AIModalFlag&&o().createElement(De.Z,{visible:this.state.AIModalFlag,record:this.state.createList,onCancel:()=>this.onCancel()}),J&&o().createElement(Ie.Z,{haveContent:!1,defaultTemplate:re,show:J,setShow:()=>this.handleCloseApproval(),submitRefresh:()=>this.handleCloseApproval("submit"),businessId:g,bizType:"course_task",title:q.title,content:ie}))}}S.defaultProps={prefixCls:"course-add"};var se=(0,D.$j)(be)((0,F.Z)()(S))},72538:function(he,W,s){"use strict";s.d(W,{I4:function(){return h},K5:function(){return z}});var h={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}},B={labelCol:{xs:{span:0},sm:{span:0}},wrapperCol:{xs:{span:24},sm:{span:24}}},z={labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},A={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:18,offset:3}}}},19858:function(he,W,s){"use strict";s.d(W,{$h:function(){return K},H4:function(){return N},T9:function(){return R}});var h=s(6793),B=s(2396),z=s(3407),A=(0,h.me)(),L=z.Z[A].course.validation,X=z.Z[A].integralMall,K=M=>M.length?"":L.courseDetailResourceNull,N=M=>{var o,D=M.score,F=Number.isNaN(D)||!(D>=0&&D<1e3);return M.checked&&F&&(o=L.courseDetailRewardScore),o},R=M=>{var o,D=M.limit,F=Number.isNaN(D)||!D||!(D>0&&D<=9999)||!B.fA.score.test(D);return M.checked&&F&&(o=X.durationLimit),o}}}]);
