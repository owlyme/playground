(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[819,2221],{69496:function(ra,ie,e){"use strict";e.r(ie),e.d(ie,{StoreCtx:function(){return ze},default:function(){return qe},useStore:function(){return ve}});var q=e(88986),m=e(57361),R=e(33565),de=e(9754),f=e.n(de),h=e(12924),a=e.n(h),z=e(91768),_=e(76651),B=e(96486),Q=e(57482),ee=e(92954),Ge=e(78138),he=e.n(Ge),v=e(9142),De=e(2396),He={labelCol:{xs:{span:12},sm:{span:3}},wrapperCol:{xs:{span:12},sm:{span:12}}},Me=t=>{var r=g=>(0,De.QK)(g,t("common.requiredNotBlank")),b=(0,ee.hP)(t),o=[{name:"name",label:t("training.planName"),type:"text",required:!0,validate:g=>g?(0,v.w)(g,t):r(g),config:{maxLength:60},placeholder:t("training.annual_plan"),layout:He},{name:"plan_year",label:t("training.plan_year"),type:"select",layout:He,config:{defaultValue:parseInt(he()(new Date).format("YYYY"))},placeholder:t("training.please_select_training_year"),options:b}];return[{fields:o,title:t("training.base_info"),category:"base_info"}]},Ke=t=>{var r={span:24,labelCol:{xs:{span:8},sm:{span:4}},wrapperCol:{xs:{span:12},sm:{span:16}}},b={span:8,labelCol:{xs:{span:24},sm:{span:12}},wrapperCol:{xs:{span:24},sm:{span:12}}},o=l=>(0,De.QK)(l,t("common.requiredNotBlank")),g=[{name:"name",label:t("training.training_topics"),type:"text",required:!0,validate:l=>l?(0,v.w)(l,t):o(l),config:{maxLength:60},placeholder:t("training.please_enter_training_requirements"),layout:r},{name:"category",label:t("training.category"),type:"text",config:{maxLength:60},placeholder:t("training.please_enter_a_category"),layout:r,validate:l=>l?(0,v.w)(l,t):""},{name:"form",label:t("training.training_form"),type:"select",placeholder:t("training.please_select_training_category"),config:{getPopupContainer:()=>document.getElementById("trainingAnnualForm"),defaultValue:"online"},options:[{label:t("training.on_line"),value:"online"},{label:t("training.offline"),value:"offline"},{label:t("training.blend"),value:"blend"},{label:t("training.other_training"),value:"other"}],layout:r},{name:"target",label:t("training.training_purpose"),type:"textArea",config:{maxLength:1e3},validate:l=>l?(0,v.w)(l,t):"",placeholder:t("training.please_enter_training_purpose"),layout:r},{name:"plan_user_quantity",label:t("training.planned_number"),type:"number",config:{addonAfter:t("training.person_time"),min:0,max:9999999,defaultValue:0,precision:0},validate:l=>l?(0,v.m)(l,t):"",layout:b},{name:"estimated_cost",label:t("training.estimated_cost"),config:{addonAfter:t("training.element"),min:0,max:9999999,step:.1,defaultValue:0,precision:1},validate:l=>l?(0,v.m)(l,t):"",type:"number",layout:b},{name:"class_hours",label:t("training.estimated_class_hours"),type:"number",config:{addonAfter:t("training.class_hour"),min:0,max:9999999,defaultValue:0,precision:0},validate:l=>l?(0,v.m)(l,t):"",layout:(0,q.Z)({offset:8},b)},{name:"session_quantity",label:t("training.estimated_number_of_sessions"),type:"number",config:{addonAfter:t("training.frequency"),min:1,max:9999999,defaultValue:0,precision:0},validate:l=>l?(0,v.m)(l,t):"",layout:b},{name:"lecturer",label:t("training.training_institution_lecturer"),type:"text",placeholder:t("training.please_fill_in_instructor"),config:{maxLength:60},layout:r,validate:l=>l?(0,v.w)(l,t):""},{name:"training_object",label:t("training.training_object"),type:"text",placeholder:t("training.please_enter_the_training_object"),layout:r,validate:l=>l?(0,v.w)(l,t):"",config:{maxLength:60}},{name:"training_year",label:t("training.year_of_training"),type:"select",required:!0,placeholder:t("training.please_select_training_year"),config:{getPopupContainer:()=>document.getElementById("trainingAnnualForm"),defaultValue:parseInt(he()(new Date).format("YYYY"))},validate:l=>l?"":t("common.requiredNotBlank"),layout:r,options:(0,ee.hP)(t)},{name:"training_month",label:t("training.training_month"),type:"month",config:{mode:"multiple",showAll:!1,allowClear:!0,showSearch:!1},layout:r,placeholder:t("training.please_select_training_month")},{name:"address",label:t("training.training_location"),layout:r,placeholder:t("training.please_enter_the_training_location"),validate:l=>l?(0,v.w)(l,t):"",config:{maxLength:1e3}},{name:"department_id",label:t("training.executive_department"),type:"department",config:{treeSelect:!0},layout:r},{name:"directors",label:t("training.person_in_charge"),type:"users",config:{onlyUser:!0},required:!0,validate:l=>(0,B.reduce)(l,(F,U)=>F.concat(U),[]).length===0?t("common.requiredNotBlank"):"",layout:r},{name:"executors",label:t("training.executor"),type:"users",layout:r,config:{onlyUser:!0}}];return[{fields:g,title:"",category:"train_content"}]},xe=e(56922),V=t=>{var r=t.t,b=t.initialValue,o=Me(r),g=ve(),l=g.basicRef;return a().createElement("div",null,a().createElement(xe.Z,{initialValues:{base_info:b},forms:o,ref:l}))},ue=(0,z.Z)()(V),la=e(57663),me=e(71577),we=e(71194),ne=e(57016),We=e(7145),be=e.n(We),A=e(36546),O=e(44289),D=e(94532),ia=e(62029),ae=t=>{var r=t.t,b=t.onOk,o=t.initialValue,g=o===void 0?{}:o,l=t.contentRef,F={okText:r("common.ok"),cancelText:r("common.cancel"),size:"medium",destroyOnClose:!0,maskClosable:!1},U=Ke(r),M=function(){var ge=(0,m.Z)(f().mark(function ye(){var Ze;return f().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,(0,ee.Gy)(l.current);case 2:Ze=re.sent,Ze||(b(l.current.state.values),t.onCancel());case 4:case"end":return re.stop()}},ye)}));return function(){return ge.apply(this,arguments)}}();return a().createElement(ne.Z,(0,ia.Z)({width:"60%",title:r("training.create_update_train_needs"),visible:t.visible},F,{onCancel:t.onCancel,onOk:M}),a().createElement("div",{id:"trainingAnnualForm"},a().createElement(xe.Z,{initialValues:{train_content:g},forms:U,ref:l})))},sa=(0,z.Z)()(ae),Oe=e(5080),ke=e.n(Oe),Qe=e(60667),Je=e(36202),Le=e(86458),Ie=e(84874),Xe=Le.Z.DragTableRow,Fe=t=>{var r=t.t,b=ve(),o=b.taskList,g=b.setTaskList,l=b.contentRef,F=(0,h.useState)({editIndex:-1,visible:!1,value:{}}),U=(0,R.Z)(F,2),M=U[0],ge=M.visible,ye=M.editIndex,Ze=M.value,Te=U[1],re=function(){var n=(0,m.Z)(f().mark(function u(d){return f().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!(d.department_id&&d.department_id!==0&&d.department_id!=="0")){Y.next=4;break}return Y.next=3,Be(d.department_id);case 3:d.department_name=Y.sent;case 4:ye>-1?g(w=>be()(w,{$splice:[[ye,1,d]]})):g(w=>be()(w,{$push:[d]}));case 6:case"end":return Y.stop()}},u)}));return function(d){return n.apply(this,arguments)}}(),Ee=(n,u)=>{var d=(0,B.cloneDeep)(o),P=d[n];d.splice(n,1),d.splice(u,0,P),g(d)},Re=n=>{var u=o[n];Te({visible:!0,value:u,editIndex:n})},Be=function(){var n=(0,m.Z)(f().mark(function u(d){var P;return f().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,(0,Q.Yy)(d);case 2:return P=w.sent,w.abrupt("return",P.data.data?_e(P.data.data):"-");case 4:case"end":return w.stop()}},u)}));return function(d){return n.apply(this,arguments)}}(),_e=n=>a().createElement(Qe.Z,{type:n.source_type,value:n.id,name:n.name,dataType:"departmentName"}),ea=n=>{ne.Z.confirm({title:r("common.tip"),content:r("course.sureToDelete"),okText:r("common.ok"),cancelText:r("common.cancel"),onOk:()=>{g(u=>u.filter((d,P)=>P!==n))}})},Ue=()=>{},aa=Ke(r),Ye=[{title:r("training.training_content"),dataIndex:"name",key:"name",width:140,fixed:"left",render:n=>a().createElement(D.Z,{title:n||"-",width:140,placement:"topLeft",isCoolCopy:!0,copyTitle:n||"-"},n||"-")},{title:r("training.category"),dataIndex:"category",key:"category",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n||"-",width:140,placement:"topLeft"},n||"-")},{title:r("training.training_object"),dataIndex:"training_object",key:"training_object",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n||"-",width:140,placement:"topLeft"},n||"-")},{title:r("training.training_form"),dataIndex:"form",key:"form",width:140,align:"center",render:n=>{var u=aa[0].fields.find(P=>{var Y=P.name;return Y==="form"}),d=u&&u.options.find(P=>P.value===n);return a().createElement("div",{className:"article-title"},d?d.label:"-")}},{title:r("training.training_purpose"),dataIndex:"target",key:"target",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n||"-",width:140,placement:"topLeft"},n||"-")},{title:r("training.training_location"),dataIndex:"address",key:"address",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n||"-",width:140,placement:"topLeft"},n||"-")},{title:r("training.estimated_number_of_sessions"),dataIndex:"session_quantity",key:"session_quantity",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n?n.toString():"1",width:140,placement:"topLeft"},n?n.toString():"1")},{title:r("training.estimated_class_hours"),dataIndex:"class_hours",key:"class_hours",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n?n.toString():"0",width:140,placement:"topLeft"},n?n.toString():"0")},{title:r("training.estimated_cost"),dataIndex:"estimated_cost",key:"estimated_cost",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n?n.toString():"0.0",width:140,placement:"topLeft"},n?n.toString():"0.0")},{title:r("training.planned_number"),dataIndex:"plan_user_quantity",key:"plan_user_quantity",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n?n.toString():"0",width:140,placement:"topLeft"},n?n.toString():"0")},{title:r("training.executive_department"),dataIndex:"department_id",key:"department_id",width:140,align:"center",render:(n,u)=>!n||n==="0"||n===0?"-":u.department_name},{title:r("training.person_in_charge"),dataIndex:"directors",key:"directors",width:140,align:"center",render:n=>{var u;return Object.keys(n).length>0&&n.user.length>0?u=(0,B.reduce)(n,(d,P)=>d.concat(P),[]).map(d=>d.name||d.user_name).join(","):u="",a().createElement(D.Z,{title:u||"-",width:140,placement:"topLeft"},u||"-")}},{title:r("training.executor"),dataIndex:"executors",key:"executors",width:140,align:"center",render:n=>{var u;return Object.keys(n).length>0&&n.user.length>0?u=(0,B.reduce)(n,(d,P)=>d.concat(P),[]).map(d=>d.name||d.user_name).join(","):u="",a().createElement(D.Z,{title:u||"-",width:140,placement:"topLeft"},u||"-")}},{title:r("training.year_of_training"),dataIndex:"training_year",key:"training_year",width:140,align:"center",render:n=>a().createElement("div",{className:"article-title"},n||"-")},{title:r("training.expected_training_month"),dataIndex:"training_month",key:"training_month",width:140,align:"center",render:n=>a().createElement(D.Z,{title:n.length>0?n.join(","):"-",width:140,placement:"topLeft"},n.length>0?n.join(","):"-")},{title:r("common.operate"),dataIndex:"operate",key:"operate",width:180,align:"center",fixed:"right",render:(n,u,d)=>a().createElement("div",{className:""},a().createElement(me.Z,{type:"link",onClick:()=>Re(d)},r("common.edit")),a().createElement(me.Z,{type:"link",onClick:()=>ea(d)},r("common.delete")),localStorage.getItem("dingPersonnel")!=="dingPersonnel"&&a().createElement(Ie.Z,{iconClass:"iconf-move"}))}];return a().createElement("div",{className:ke().training_content},a().createElement("h4",null,r("training.training_content")),a().createElement("div",{className:ke().add_train},a().createElement(me.Z,{onClick:()=>{Te({visible:!0,value:{},editIndex:-1})}},r("common.addSome"))),a().createElement(Je.f,{scroll:{y:"100%",x:"max-content"},dataSource:o,columns:Ye,rowKey:n=>n.id,pagination:!1,toolBarRender:Ue,onRow:(n,u)=>({index:u,record:n,keyName:"id",moveRow:Ee,onMouseEnter:()=>{},onMouseLeave:()=>{}}),components:{body:{row:localStorage.getItem("dingPersonnel")!=="dingPersonnel"?Xe:!1}},options:{setting:!1,density:!1,fullScreen:!1,reload:!1},tableUUID:"9a4c3eda-143c-4609-8fe9-9741e547b6f8"}),a().createElement(sa,{visible:ge,contentRef:l,onOk:re,initialValue:Ze,onCancel:()=>{Te({visible:!1,value:{},editIndex:-1})}}))},je=(0,z.Z)()((0,A.Z5)(O.ZP)(Fe)),Ae=t=>{var r=t.t,b=(0,h.useState)(!1),o=(0,R.Z)(b,2),g=o[0],l=o[1],F=ve(),U=F.onSubmit,M=ge=>()=>{switch(ge){case"draft":l(!0),U("save"),l(!1);break;case"release":l(!0),U(),l(!1);break;case"cancel":_.m8.push("/training/trainingPlan/annualPlan");break;default:break}};return a().createElement("footer",{className:"cl-form-fixed-footer"},a().createElement("div",{className:"cl-form-fixed-footer__container-screenful"},a().createElement(me.Z,{onClick:M("cancel")},r("common.cancel")),a().createElement(me.Z,{disabled:g,loading:g,onClick:M("draft")},r("common.draft")),a().createElement(me.Z,{type:"primary",disabled:g,loading:g,onClick:M("release")},r("common.release"))))},oa=(0,z.Z)()(Ae),$e=e(73704),da=e(11449),ce=e(4408),ze=(0,h.createContext)({}),ve=()=>(0,h.useContext)(ze),Ne=t=>{var r=t.t,b=t.initialValue,o=t.onRef,g=o===void 0?(0,h.createRef)():o,l=(0,B.get)(b,"content_list",[]),F=(0,h.useRef)(null),U=(0,h.useRef)(null),M=(0,h.useState)(l),ge=(0,R.Z)(M,2),ye=ge[0],Ze=ge[1],Te=(0,h.useState)({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),re=(0,R.Z)(Te,2),Ee=re[0],Re=re[1],Be=Ee.isShowApprovalModal,_e=Ee.businessId,ea=Ee.bizType,Ue=Ee.approvalTitle,aa=Ee.content,Ye=function(){var w=(0,m.Z)(f().mark(function Se(){var se,G,fe;return f().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return se=F&&F.current,s.next=3,(0,ee.Gy)(se);case 3:if(G=s.sent,G){s.next=7;break}return fe=(0,q.Z)((0,q.Z)({},se.state.values),{},{content_list:(0,ee.eP)(ye)}),s.abrupt("return",fe);case 7:case"end":return s.stop()}},Se)}));return function(){return w.apply(this,arguments)}}(),n=()=>{Re({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),_.m8.push("/training/trainingPlan/annualPlan")},u=w=>{Re({isShowApprovalModal:w,businessId:"",bizType:"",approvalTitle:"",content:{}}),_.m8.push("/training/trainingPlan/annualPlan")},d=function(){var w=(0,m.Z)(f().mark(function Se(){var se,G,fe,i,s,L,I,S,p=arguments;return f().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return se=p.length>0&&p[0]!==void 0?p[0]:"commit",c.next=3,Ye();case 3:if(G=c.sent,G){c.next=6;break}return c.abrupt("return");case 6:return G.content_list=G.content_list.length===0?null:G.content_list,c.next=10,(0,Q.B3)((0,q.Z)((0,q.Z)({},G),{},{submit_type:se}));case 10:fe=c.sent,i=fe.data.data,s=i.business_id,L=i.type,I=i.has_flow_template,S=i.content,((0,B.get)(fe,"data.code")===2e5||(0,B.get)(fe,"data.code")==="200000")&&(I&&se==="commit"?Re({isShowApprovalModal:!0,businessId:s,bizType:L,approvalTitle:G.name,content:S}):_.m8.push("/training/trainingPlan/annualPlan"));case 13:case"end":return c.stop()}},Se)}));return function(){return w.apply(this,arguments)}}();(0,h.useImperativeHandle)(g,()=>({onSubmit:function(){var w=(0,m.Z)(f().mark(function se(){var G;return f().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Ye();case 2:return G=i.sent,i.abrupt("return",G);case 4:case"end":return i.stop()}},se)}));function Se(){return w.apply(this,arguments)}return Se}()}));var P={basicRef:F,contentRef:U,onSubmit:d,taskList:ye,setTaskList:Ze},Y=a().createElement(a().Fragment,null,a().createElement("div",{className:"plan"},a().createElement(ze.Provider,{value:P},a().createElement(ue,{initialValue:b}),a().createElement(je,null),t.isEdit?"":a().createElement(oa,null))),Be&&a().createElement($e.Z,{content:aa,show:Be,setShow:u,submitRefresh:n,businessId:_e,bizType:ea,title:Ue}));return t.isEdit?Y:a().createElement(da.Z,{pageTitle:!t.isEdit&&r("training.new_plan"),pageContainerParams:{header:{title:!t.isEdit&&r("training.new_plan")}}},a().createElement(ce.Z,{title:r("documentTitle.newPlan")}),Y)},qe=(0,z.Z)()(Ne)},12103:function(ra,ie,e){"use strict";e.r(ie),e.d(ie,{default:function(){return fe}});var q=e(57361),m=e(88986),R=e(33565),de=e(9754),f=e.n(de),h=e(12924),a=e.n(h),z=e(91768),_=e(96486),B=e(11449),Q=e(76404),ee=e(57482),Ge=e(13062),he=e(71230),v=e(89032),De=e(15746),He=e(63185),Me=e(9676),Ke=e(14965),xe=e(11448),V=e(9715),ue=e(86585),la=e(57254),me={labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:16},sm:{span:16}}},we={plan_year:"plan_year",plan_month:"plan_month",status:"status",department:"department",create_user:"create_user",query_param:"query_param",is_my:"is_my"},ne={plan_year:"",status:"all"},We=e(7748),be=e.n(We),A=ue.Z.Item,O=i=>{var s=i.t,L=ue.Z.useForm(),I=(0,R.Z)(L,1),S=I[0],p=(0,Q.oR)(),T=p.filterValue,c=p.fetchData,x=(j,y)=>Z=>{var H=(0,_.get)(Z,"target.value")!==void 0?Z.target.value:Z;switch(y){case"checked":H=Z.target.checked;break;default:break}c(Object.assign(T,{[j]:H}))};return a().createElement(ue.Z,{name:"filter",initialValues:ne,form:S},a().createElement(he.Z,null,a().createElement(De.Z,{span:18,className:be().annualFilter},a().createElement(A,{name:we.plan_year,required:!1,style:{marginBottom:0}},a().createElement("span",null,a().createElement(xe.Z,{picker:"year",suffixIcon:a().createElement(la.Z,null),onChange:x(we.plan_year),placeholder:s("internationalizationDate.year"),className:be().yearPicker}))),a().createElement(A,{name:we.is_my,className:be().marginLeft,style:{marginBottom:0}},a().createElement(Me.Z,{style:{lineHeight:"31px"},onChange:x(we.is_my,"checked")},s("common.myCreated"))))))},D=(0,z.Z)()(O),ia=e(47673),ae=e(4107),sa=e(88983),Oe=e(47933),ke=e(36202),Qe=e(73665),Je=e(14781),Le=e(53431),Ie=e(62029),Xe=e(37055),Fe=(0,m.Z)((0,m.Z)({},Xe.XE.INITIAL_PAGINATION),{},{size:"right",pageSizeOptions:["20","30","40","50"]}),je=i=>{var s=(0,Q.oR)(),L=s.fetchData,I=s.filterValue,S=i.page_num,p=i.total,T=i.page_size,c=(x,j)=>{L((0,m.Z)((0,m.Z)({},I),{},{page_num:x,page_size:j}))};return a().createElement(Le.Z,(0,Ie.Z)({},Fe,{current:S,total:p,pageSize:T||20,onChange:c}))},Ae=je,oa=e(59250),$e=e(13013),da=e(57663),ce=e(71577),ze=e(30887),ve=e(99210),Ne=e(28216),qe=e(49101),t=e(76651),r=e(86726),b=e(56226),o=i=>{var s=i.t,L=(0,Q.oR)(),I=L.fetchData,S=(0,h.useState)(!1),p=(0,R.Z)(S,2),T=p[0],c=p[1],x=k=>{var $=k.key;switch($){case"create":t.m8.push("/training/trainingPlan/annualPlan/".concat($));break;case"import":c(!0);break;default:break}},j=(0,r.V9)("annualPlan",i.userInfo.modules),y=(0,r.H3)("enterPlan",j),Z=(0,r.H3)("importPlan",j),H=a().createElement(ve.Z,{onClick:x},y&&a().createElement(ve.Z.Item,{key:"create"},s("training.new_plan")),Z&&a().createElement(ve.Z.Item,{key:"import"},s("training.import_plan"))),J=[y,Z];return a().createElement(a().Fragment,null,J.filter(k=>k).length?a().createElement($e.Z,{overlay:H},a().createElement(ce.Z,{type:"primary"},a().createElement(qe.Z,null),s("common.add"))):"",a().createElement(b.Z,{title:s("training.annual_import"),visible:T,type:"annual",handleCloseModal:()=>{c(!1)},fetchRefresh:I}))},g=i=>({userInfo:i.user}),l=(0,Ne.$j)(g)((0,z.Z)()(o)),F=e(71194),U=e(57016),M=e(20228),ge=e(11382),ye=e(34792),Ze=e(48086),Te=e(73704),re=e(92954),Ee=e(69496),Re=i=>{var s=i.t,L=i.initialValue,I=i.id,S=i.visible,p=(0,h.useState)({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),T=(0,R.Z)(p,2),c=T[0],x=T[1],j=c.isShowApprovalModal,y=c.businessId,Z=c.bizType,H=c.approvalTitle,J=c.content,k=(0,h.useState)({data:L,loading:!1}),$=(0,R.Z)(k,2),N=$[0],E=$[1],le=(0,m.Z)({okText:s("common.ok"),cancelText:s("common.cancel"),size:"medium",destroyOnClose:!0,maskClosable:!1},i);(0,h.useEffect)(()=>{S&&I&&(E((0,m.Z)((0,m.Z)({},N),{},{loading:!0})),(0,ee.DM)("annual",I).then(W=>{if(W.data.code==="200000"||W.data.code===2e5){var te=(0,m.Z)((0,m.Z)({},W.data.data),{},{content_list:W.data.data.content_list&&(0,re.ut)(W.data.data.content_list)});E({data:te,loading:!1})}}).catch(()=>{E((0,m.Z)((0,m.Z)({},N),{},{loading:!1}))}))},[S]);var C=(0,h.createRef)(),Pe=function(){var W=(0,q.Z)(f().mark(function te(Ve){var pe,ma,oe,ta,na,ua,ga,ca,va,fa,pa;return f().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.next=2,C.current.onSubmit();case 2:if(pe=X.sent,!pe){X.next=17;break}return pe.content_list=pe.content_list.length===0?null:pe.content_list,X.prev=5,X.next=8,(0,ee.um)((0,m.Z)((0,m.Z)({},pe),{},{plan_id:N.plan_id,submit_type:Ve}));case 8:ma=X.sent,oe=ma.data.data,ta=oe.business_id,na=oe.type,ua=oe.has_flow_template,ga=oe.content,Ve==="commit"&&ua?x({isShowApprovalModal:!0,businessId:ta,bizType:na,approvalTitle:pe.name,content:ga}):i.onCancel(),X.next=17;break;case 13:X.prev=13,X.t0=X.catch(5),ca=X.t0.response.data,va=ca.code,fa=ca.data,(va===1001||va==="1001")&&(pa=(0,_.get)(fa,"0.message"),Ze.default.error(pa));case 17:case"end":return X.stop()}},te,null,[[5,13]])}));return function(Ve){return W.apply(this,arguments)}}(),Ce=()=>{x({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),i.onCancel()},K=()=>{x({isShowApprovalModal:!1,businessId:"",bizType:"",approvalTitle:"",content:{}}),i.onCancel()};return a().createElement(U.Z,(0,Ie.Z)({width:"60%",title:s("training.create_update_train_needs"),visible:i.visible},le,{footer:[a().createElement(ce.Z,{key:"cancel",onClick:i.onCancel},s("common.cancel")),a().createElement(ce.Z,{key:"save",onClick:()=>Pe("save")},s("common.save")),a().createElement(ce.Z,{key:"release",onClick:()=>Pe("commit"),type:"primary"},s("common.release"))]}),N.loading?a().createElement(ge.Z,null):a().createElement(Ee.default,{isEdit:!0,onRef:C,initialValue:N.data}),j&&a().createElement(Te.Z,{content:J,show:j,setShow:Ce,submitRefresh:K,businessId:y,bizType:Z,title:H}))},Be=(0,z.Z)()(Re),_e=e(78138),ea=e.n(_e),Ue=e(57068),aa=e(57119),Ye=e(65771),n=e(79734),u=e(94532),d={cancelRelease:"cancelRelease",delete:"delete",publish:"publish",edit:"edit",detail:"detail",summary:"summary"},P=i=>{var s=i.t,L=i.status,I=i.type,S="",p=()=>{},T="";switch(I){case d.cancelRelease:S="".concat(s("training.are_you_sure_you_want_to_cancel"),"\uFF1F"),p=ee.Lj,T=s("training.cancellation_succeeded");break;case d.delete:S=["published","under_approval "].includes(L)?s("training.please_cancel_publishing_before_attempting_the_operation"):"".concat(s("training.are_you_sure_you_want_to_delete"),"\uFF1F"),p=["published","under_approval "].includes(L)?p:ee.n_,T=s("common.deleteSuccess");break;default:break}return{title:S,method:p,successMsg:T}},Y=e(66663),w=(i,s)=>{var L=s.fetchData,I=s.filterValue,S=s.setVisibleModal,p=s.showOperation,T=p===void 0?!0:p,c=(y,Z,H)=>{var J=k=>{var $=k.title,N=k.method,E=k.successMsg;U.Z.confirm({title:$,icon:a().createElement(aa.Z,null),onOk:()=>{try{N&&N(H.id).then(()=>{L&&L(I)}),E&&Ze.default.success(E)}catch(le){console.error(le)}}})};return function(){var k=(0,q.Z)(f().mark(function $(N){var E;return f().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:E=P({t:i,status:Z,type:N}),C.t0=N,C.next=C.t0==="publish"?4:C.t0==="cancelRelease"?6:C.t0==="delete"?8:C.t0==="detail"?10:C.t0==="edit"?12:14;break;case 4:return S({visible:!0,id:y}),C.abrupt("break",15);case 6:return J(E),C.abrupt("break",15);case 8:return J(E),C.abrupt("break",15);case 10:return t.m8.push({pathname:"/training/trainingPlan/trainPlan/detail",search:Ue.stringify({bizType:Y.B.ANNUAL_PLAN,instanceId:H.workflow_instance_id,businessId:y})}),C.abrupt("break",15);case 12:return S({visible:!0,id:y}),C.abrupt("break",15);case 14:return C.abrupt("break",15);case 15:case"end":return C.stop()}},$)}));return function($){return k.apply(this,arguments)}}()},x=[{title:i("training.planName"),dataIndex:"name",key:"name",width:140,render:(y,Z)=>a().createElement(u.Z,{title:y||"-",width:140,placement:"topLeft",isCoolCopy:!0,copyTitle:y||"-"},a().createElement("a",{onClick:()=>{t.m8.push({pathname:"/training/trainingPlan/trainPlan/detail",search:Ue.stringify({bizType:Y.B.ANNUAL_PLAN,instanceId:Z.workflow_instance_id,businessId:Z.id})})}},y||"-"))},{title:i("training.plan_year"),dataIndex:"plan_year",key:"plan_year",width:140,align:"center",render:y=>a().createElement("div",{className:"article-title"},y)},{title:i("common.status"),dataIndex:"status",key:"status",width:140,align:"center",render:y=>{var Z=(0,Ye.y)(i).find(J=>{var k=J.key;return k===y})||{},H=Z.title;return a().createElement("div",{className:"article-title"},H)}},{title:i("common.createTime"),dataIndex:"create_time",key:"create_time",width:140,align:"center",render:y=>a().createElement("div",{className:"article-title"},ea()(parseInt(y)).format("YYYY-MM-DD HH: mm"))},{title:i("common.creator"),dataIndex:"create_user_name",key:"create_user_name",width:140,align:"center",render:y=>a().createElement("div",{className:"article-title"},y)}],j={title:i("common.operate"),dataIndex:"operate",key:"operate",align:"center",render:(y,Z)=>a().createElement("div",null,a().createElement(n.Z,{onOperation:c(Z.id,Z.status,Z),canPublished:["unpublished","reject"].includes(Z.status),canUnpublished:["under_approval","published"].includes(Z.status),status:Z.status,sourceType:"annual"}))};return T?x.concat(j):x};function Se(i){var s=i.isLoading,L=i.taskList,I=i.t,S=i.pagination,p=(0,Q.oR)(),T=p.fetchData,c=p.filterValue,x=(0,h.useState)(""),j=(0,R.Z)(x,2),y=j[0],Z=j[1],H=(0,h.useState)({}),J=(0,R.Z)(H,2),k=J[0],$=J[1],N=(0,h.useState)({visible:!1,id:""}),E=(0,R.Z)(N,2),le=E[0],C=E[1],Pe=w(I,{fetchData:T,filterValue:c,visible:y,setVisible:Z,popProps:k,setPopProps:$,setVisibleModal:C}),Ce=()=>a().createElement(a().Fragment,null,a().createElement(Oe.ZP.Group,{value:c.status||"all",onChange:K=>{var W=K.target?K.target.value:K,te={status:W};T(Object.assign(c,te))}},(0,Qe.lR)(I).map(K=>{var W=K.label,te=K.value;return a().createElement(Oe.ZP.Button,{key:te,value:te},W)})),a().createElement(ae.Z.Search,{className:"annual_search",placeholder:I("training.search_plan"),onSearch:K=>T(Object.assign(c,{query_param:K||""})),allowClear:!0}));return a().createElement(a().Fragment,null,a().createElement(ke.f,{scroll:{y:"100%",x:"max-content"},loading:s,dataSource:L,columns:Pe,rowKey:K=>K.id,pagination:!1,headerTitle:a().createElement("div",null,a().createElement(l,null)),toolBarRender:Ce,tableUUID:"bd173d2c-ed5c-49a2-8dff-b9d7458302db"}),a().createElement("div",{className:"annul-plan-list-pagination"},a().createElement(Ae,S),a().createElement(Be,{id:le.id,visible:le.visible,onCancel:()=>{C({visible:!1,id:""}),T(c)}})))}var se=(0,z.Z)()(Se);function G(i){var s=i.t,L=(0,h.useState)({taskList:[],pagination:{total:0},isLoading:!1}),I=(0,R.Z)(L,2),S=I[0],p=I[1],T=(0,h.useState)((0,m.Z)((0,m.Z)({},ne),{},{page_num:1,page_size:20})),c=(0,R.Z)(T,2),x=c[0],j=c[1],y=S.taskList,Z=S.isLoading,H=S.pagination,J=function(){var $=(0,q.Z)(f().mark(function N(E){var le,C,Pe,Ce,K,W,te,Ve,pe;return f().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return p((0,m.Z)((0,m.Z)({},S),{},{isLoading:!0})),E=(0,_.reduce)(E,(ta,na,ua)=>(na!=="all"&&(ta[ua]=na),ta),{}),E.plan_year&&(E.plan_year=typeof E.plan_year=="object"?E.plan_year.format("YYYY"):E.plan_year),oe.next=6,(0,ee.Wz)(E);case 6:le=oe.sent,C=le.data,Pe=C.code,Ce=C.data,K=Ce.list,W=Ce.total,te=Ce.page_num,Ve=Ce.page_size,Pe==="200000"||Pe===2e5?(pe={taskList:K,pagination:{total:W,page_num:te,page_size:Ve},isLoading:!1},j(Object.assign(E,{page_num:te,page_size:Ve,total:W})),p(pe)):p((0,m.Z)((0,m.Z)({},S),{},{isLoading:!1}));case 15:case"end":return oe.stop()}},N)}));return function(E){return $.apply(this,arguments)}}(),k={fetchData:J,filterValue:x};return(0,h.useEffect)(()=>{var $=(0,_.reduce)(x,(N,E,le)=>(E!=="all"&&(N[le]=E),N),{});J($)},[]),a().createElement(B.Z,{pageTitle:s("leftMenuLists.trainingPlan"),pageContainerParams:{header:{title:s("leftMenuLists.trainingPlan")}}},a().createElement(Q.nm.Provider,{value:k},a().createElement("div",{className:"annual-plan sticky-table"},a().createElement("div",{className:"annul-plan-container"},a().createElement("div",{className:"annul-plan-list"},a().createElement("div",{className:"annul-plan-list-top_search"},a().createElement(D,null)),a().createElement("div",{className:"annul-plan-list-table"},a().createElement(se,{isLoading:Z,taskList:y,pagination:H})))))))}var fe=(0,z.Z)()(G)},56226:function(ra,ie,e){"use strict";e.d(ie,{Z:function(){return be}});var q=e(71194),m=e(57016),R=e(43185),de=e(53251),f=e(62029),h=e(57663),a=e(71577),z=e(57361),_=e(34792),B=e(48086),Q=e(33565),ee=e(9754),Ge=e.n(ee),he=e(12924),v=e.n(he),De=e(91768),He=e(90631),Me=e(84874),Ke=e(36202),xe=e(79642),V=e(37055),ue=A=>{switch(A){case"training_month_plan":return"month";case"training_temp_plan":return"temp";default:return A}},la=A=>{var O=ue(A);switch(O){case"needs":return"".concat(V.ZP.trainingConfig.needsTemplate(),"?access_token=").concat(window.localStorage.getItem("token"));case"annual":return"".concat(V.ZP.trainingConfig.yearTemplate(),"?access_token=").concat(window.localStorage.getItem("token"));case"month":return"".concat(V.ZP.trainingConfig.monthAndTempTemplate(),"?type=month&access_token=").concat(window.localStorage.getItem("token"));case"temp":return"".concat(V.ZP.trainingConfig.monthAndTempTemplate(),"?type=temp&access_token=").concat(window.localStorage.getItem("token"));default:return"".concat(V.ZP.trainingConfig.needsTemplate(),"?access_token=").concat(window.localStorage.getItem("token"))}},me=(A,O)=>{var D=ue(A);switch(D){case"needs":return O?V.ZP.trainingConfig.needsImportCommit():V.ZP.trainingConfig.needsImportValidate();case"annual":return O?V.ZP.trainingConfig.yearPlanImportCommit():V.ZP.trainingConfig.yearPlanImportValidate();case"month":return O?V.ZP.trainingConfig.monthAndTempImportCommit():V.ZP.trainingConfig.monthAndTempImportValidate();case"temp":return O?V.ZP.trainingConfig.monthAndTempImportCommit():V.ZP.trainingConfig.monthAndTempImportValidate();default:return O?V.ZP.trainingConfig.needsImportCommit():V.ZP.trainingConfig.needsImportValidate()}},we=e(29712),ne=e.n(we),We=A=>{var O=A.type,D=A.visible,ia=A.title,ae=A.t,sa=A.width,Oe=A.handleCloseModal,ke=A.fetchRefresh,Qe=(0,he.useState)([]),Je=(0,Q.Z)(Qe,2),Le=Je[0],Ie=Je[1],Xe=(0,he.useState)([]),Fe=(0,Q.Z)(Xe,2),je=Fe[0],Ae=Fe[1],oa=(0,he.useState)(!1),$e=(0,Q.Z)(oa,2),da=$e[0],ce=$e[1],ze=o=>{if(o.file&&o.file.response)if(o.file.response.data){if(o.file.response.data.result==="false"){B.default.error(o.file.response.data.error_messages);return}o.file.response.data.error_messages&&(Ae(o.file.response.data.error_messages),Ie([o.file.response.data]))}else B.default.error(ae("upload.typeError"))},ve={name:"file",action:me(O,!1),showUploadList:!1,data:{access_token:window.localStorage.getItem("token"),type:ue(O)},headers:{"Enterprise-Id":localStorage.getItem("enterpriseId")},onChange:ze},Ne=()=>{Ie([]),Ae([]),Oe("import")},qe=function(){var o=(0,z.Z)(Ge().mark(function g(){var l,F;return Ge().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return ce(!0),M.next=3,(0,xe.Ji)({new_file_name:Le[0].new_file_name,type:ue(O)},me(O,!0));case 3:l=M.sent,l.data.code==="200000"?((F=l.data.data)===null||F===void 0?void 0:F.result)==="true"&&(Ne(),Ie([]),Ae([]),ke(),ce(!1)):(B.default.error(l.data.message),ce(!1));case 6:case"end":return M.stop()}},g)}));return function(){return o.apply(this,arguments)}}(),t=v().createElement("div",{className:ne().footerBtn},v().createElement(a.Z,{onClick:Ne,className:ne().btn},ae("training.cancle")),v().createElement(a.Z,{loading:da,onClick:qe,type:"primary",className:[ne().btn].join(" ")},ae("training.confirm"))),r=()=>{window.location.href=la(O)},b=o=>[{title:o("training.file_name"),dataIndex:"new_file_name",key:"new_file_name"},{title:o("training.success"),dataIndex:"success_count",key:"success_count",width:80},{title:o("training.fail"),dataIndex:"failed_count",key:"failed_count",width:80}];return v().createElement("div",null,v().createElement(m.Z,{title:ia,visible:D,onCancel:Ne,width:sa||800,footer:t,destroyOnClose:!0},v().createElement("div",{className:ne().importHeader},v().createElement("div",{className:ne().downloadTemplate},v().createElement(a.Z,{onClick:r},v().createElement(He.Z,null),ae("training.download_template")),v().createElement("span",{className:ne().text},ae("training.download_the_template_first_then_import"))),v().createElement(de.Z,(0,f.Z)({className:"import-score-import-btn right"},ve),v().createElement(a.Z,{type:"primary"},v().createElement(Me.Z,{iconClass:"icon-import"}),Le.length===0?ae("component.importLabel"):ae("employeeSummary.reImport")))),v().createElement(Ke.f,{scroll:{y:"100%",x:"max-content"},dataSource:Le,columns:b(ae),rowKey:o=>o.id,pagination:!1,options:{setting:!1,density:!1,fullScreen:!1,reload:!1},tableUUID:"5863e669-72f2-4e9f-adc1-a197feb12b4f"}),je.length>0?v().createElement("div",{className:"import-score-tip"},v().createElement("p",null,v().createElement(Me.Z,{iconClass:"icon-tishi"}),ae("component.errorTips"),":"),je.map((o,g)=>v().createElement("p",{key:g},o))):null))},be=(0,De.Z)()(We)},76404:function(ra,ie,e){"use strict";e.d(ie,{nm:function(){return de},oR:function(){return f},DG:function(){return h}});var q=e(33565),m=e(12924),R=e.n(m),de=(0,m.createContext)(()=>{}),f=()=>(0,m.useContext)(de),h=a=>Object.entries(a).map(z=>{var _=(0,q.Z)(z,2),B=_[0],Q=_[1];return"".concat(B,"=").concat(Q)}).join("&")},73665:function(ra,ie,e){"use strict";e.d(ie,{lR:function(){return m},zQ:function(){return R},Sc:function(){return de}});var q={labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:16},sm:{span:16}}},m=f=>[{label:f("training.whole"),value:"all"},{label:f("training.published"),value:"published"},{label:f("training.unpublished"),value:"unpublished"},{label:f("training.reject"),value:"reject"},{label:f("training.under_approval"),value:"under_approval"}],R={plan_year:"training_year",plan_month:"training_month",status:"status",department:"department_ids",create_user:"create_user",query_param:"query_param",is_my:"is_my"},de={training_year:"",status:"all"}}}]);
