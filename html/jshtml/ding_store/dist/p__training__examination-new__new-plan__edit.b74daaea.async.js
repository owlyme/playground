(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[129],{11449:function(ve,K,e){"use strict";e.d(K,{Z:function(){return n}});var T=e(88986),V=e(33565),W=e(12924),d=e.n(W),I=e(3115),q=e(49111),i=e(19650),ee=e(62029),ae=e(57663),D=e(71577),F=e(91768),U=e(28216),L=e(37055),Q=e(10237);function N(v){var u=L.ZP.getHelpContentByMenuKey(),_={key:v};return Q.WY.get({url:u,params:_})}var M=e(74228),a=e.n(M),S=e(1164),J=e(76466),Z=e(38642);class r extends d().Component{constructor(u){var _;super(u);_=this,this.getHelpContentByMenuKey=()=>{var E=this.props.defaultMenuKey;N(E).then(g=>{var P=g.data,y=P.help_url,$=P.video_url;this.setState({videoUrl:$,helpUrl:y})})},this.handleOpenHelpUrl=E=>{if((0,Z.ve)()){window.open(E,"_blank");return}S.Z.targetTo({path:E,isExternalLink:!0})},this.handleOpenVideo=function(E){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_.props.t("helpCenter.video");_.setState(P=>({resourcePlayInfo:(0,T.Z)((0,T.Z)({},P.resourcePlayInfo),{},{resourceInfo:{originUrl:E,source:{FD:E,OD:E},contentType:"mp4"}}),previewInfo:(0,T.Z)((0,T.Z)({},P.previewInfo),{},{title:g,visible:!0,onCancel:_.handleCancelPreview})}))},this.handleCancelPreview=()=>{var E=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,T.Z)((0,T.Z)({},E),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:u.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var u=this.state,_=u.helpUrl,E=u.resourcePlayInfo,g=u.previewInfo,P=u.videoUrl,y=this.props.t;return d().createElement("div",{className:a().helpCenter},P&&d().createElement(D.Z,{type:"link",className:a()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(P)},y("helpCenter.video")),_&&d().createElement(D.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(_)},y("helpCenter.tutorial")),d().createElement(J.Z,(0,ee.Z)({},E,{previewInfo:g})))}}var b=v=>({defaultMenuKey:v.currentRoute.menuKey});r.defaultProps={defaultMenuKey:""};var G=(0,U.$j)(b)((0,F.Z)()(r));function w(v){var u=v.extra,_=localStorage.getItem("dingPersonnel"),E=sessionStorage.getItem("dingPersonnel");return d().createElement(i.Z,null,u,_!=="dingPersonnel"&&E!=="dingPersonnel"&&(0,Z.eY)("COMMONEXTRA_HELP_CENTER")&&d().createElement(G,null))}var j=w,s=e(4408);function l(v){var u=(0,W.useState)({helpCenter:(0,Z.eY)("HEAD_HELP_CENTER_BUT")}),_=(0,V.Z)(u,1),E=_[0],g=v.pageContainerParams,P=g===void 0?{}:g,y=v.noPadding,$=y===void 0?!1:y,te=v.isPersonal,ne=te===void 0?!1:te,re=v.pageTitle,x=v.className,me=x===void 0?"":x,X={extra:E.helpCenter?d().createElement(j,{extra:P.extra}):P.extra},t=(0,T.Z)((0,T.Z)({},P),X);return d().createElement("div",{className:"page-container-content ".concat($?"page-container-noPadding":""," ").concat(ne?"page-container-content_personal_background":""," ").concat(me)},re&&d().createElement(s.Z,{title:re}),ne?d().createElement(I.Z,null,v.children):d().createElement(I.Z,t,v.children))}var n=l},70163:function(ve,K,e){"use strict";e.r(K);var T=e(20228),V=e(11382),W=e(33565),d=e(12924),I=e.n(d),q=e(91768),i=e(76651),ee=e(57068),ae=e(28216),D=e(44690),F=e(99897),U=e.n(F),L=e(11449),Q=e(35085),N=e(75205);function M(a){var S=a.t,J=(0,d.useState)(!1),Z=(0,W.Z)(J,2),r=Z[0],b=Z[1],G=(0,d.useState)(null),w=(0,W.Z)(G,2),j=w[0],s=w[1],l=(0,ae.v9)(u=>{var _=u.user;return{user:_}}),n=l.user;function v(u){var _=u.planId;b(!0),Q.GL({planId:_}).then(E=>{var g=E.data,P=g.code,y=g.data;P==="200000"&&s((0,N.AC)({data:y,user:{id:n.id,name:n.name,creator:!0}}))}).finally(()=>{b(!1)})}return(0,d.useEffect)(()=>{var u=ee.parse(i.m8.location.search),_=u.planId;_&&v({planId:_})},[]),I().createElement(L.Z,{pageContainerParams:{header:{title:S("examination.editExam")}},pageTitle:S("examination.editExam")},r?I().createElement("div",{className:U()["spin-container"]},I().createElement(V.Z,{spinning:r})):I().createElement("div",{className:U()["edit-page"]},j&&I().createElement(D.Z,{initialValues:j,type:D.w.EDIT})))}K.default=(0,q.Z)()(M)},44690:function(ve,K,e){"use strict";e.d(K,{w:function(){return x}});var T=e(20228),V=e(11382),W=e(57663),d=e(71577),I=e(22385),q=e(31097),i=e(62029),ee=e(71194),ae=e(57016),D=e(88986),F=e(81211),U=e(57361),L=e(33565),Q=e(9754),N=e.n(Q),M=e(12924),a=e.n(M),S=e(91768),J=e(57119),Z=e(1870),r=e(80991),b=e(57068),G=e(76651),w=e(17780),j=e(37905),s=e.n(j),l=e(64134),n=e(75205),v=e(62615),u=e(40572),_=e(2396),E=e(28531),g=e(16267),P=e(7584),y=e(70075),$=e(35085),te=e(38642),ne=e(22444),re=e(48194),x={ADD:"add",EDIT:"edit"};function me(X){var t=X.t,pe=X.initialValues,Y=X.type,se=(0,M.useRef)(),Re=(0,M.useState)(!1),ge=(0,L.Z)(Re,2),Ke=ge[0],H=ge[1],Ue=b.parse(G.m8.location.search),z=Ue.planId,Be=(0,M.useState)({visible:!1,planId:z}),fe=(0,L.Z)(Be,2),We=fe[0],Pe=fe[1],Se=(0,M.useState)([]),Ce=(0,L.Z)(Se,2),De=Ce[0],be=Ce[1];(0,M.useEffect)(()=>{we()},[]);var we=function(){var C=(0,U.Z)(N().mark(function p(){var m,c,A,h;return N().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,te.Kb)((0,re.q)());case 2:if(m=f.sent,c=(0,L.Z)(m,2),A=c[0],h=c[1],!A){f.next=8;break}return f.abrupt("return");case 8:h&&h.data&&h.data.sync_organizes&&be(h.data.sync_organizes||[]);case 9:case"end":return f.stop()}},p)}));return function(){return C.apply(this,arguments)}}(),je=function(){var C=(0,U.Z)(N().mark(function p(m){var c,A,h,ie,f,k,Te,Me,_e,ce,R,de,B,he,Ie,ue,xe,Ee,Le,le,Ne,Ze,Ae;return N().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(c=m.paperInfo,A=m.exam_times,h=m.cut_screen_times,ie=m.random_order,f=m.mark_setting,k=m.result_visible,Te=m.exam_certificate,Me=m.supervisor_list,_e=m.tagGroup,ce=m.status,R=m.reward_rule,de=m.jurisdiction,B=m.face_recognition,he=m.answer_device,Ie=(0,F.Z)(m,["paperInfo","exam_times","cut_screen_times","random_order","mark_setting","result_visible","exam_certificate","supervisor_list","tagGroup","status","reward_rule","jurisdiction","face_recognition","answer_device"]),ue=(0,D.Z)({paper_id:c.id,answer_rule:A.answer_rule,exam_count:A.exam_count||1,cut_screen_rule:h.cut_screen_rule,cut_screen_count:h.cut_screen_count||1,cut_screen_interval:h.cut_screen_interval||0,random_question:ie.random_question,random_options:ie.random_options,mark_type:f.mark_type,mark_question_type:{fill_blank:f.mark_type===n.lt.MANUAL?f.fill_blank:!1,short_answer:f.mark_type===n.lt.MANUAL?f.short_answer:!1},anonymous_marking:f.anonymous_marking,exam_certificate_id:Te.id,face_recognition:B.before_exam,face_snapshot_rule:{face_process_switch:B.in_exam.checked,face_process_type:B.in_exam.type,face_process_value:B.in_exam.type===ne.tT.FREQUENCY?B.in_exam.random_times:B.in_exam.custom_interval_time},supervisor_list:[...Me.map(O=>typeof O=="string"?O:O.id)],marker_list:f.mark_type===n.lt.SYSTEM?f.marker_list.filter(O=>{var oe=O.creator;return oe==="true"||oe===!0}).map(O=>{var oe=O.id;return oe}):[...f.marker_list.map(O=>typeof O=="string"?O:O.id)],result_view_rule:k.result_view_rule,answer_parsing:k.answer_parsing,ranking_list_view_rule:k.ranking_list_view_rule,show_result:k.show_result,status:ce,reward_rule:{type:R.type,absence:R.type===n.iN.NO_CREDIT?{checked:!0,score:0}:R.absence,passed:R.type===n.iN.NO_CREDIT?{checked:!0,score:0}:R.passed,failed:R.type===n.iN.NO_CREDIT?{checked:!0,score:0}:R.failed},authority_range:de.authority_range,supervisor_mark:de.supervisor_mark,answer_device:he||n.Tv.UNLIMITED},Ie),Y!==x.ADD){o.next=23;break}return H(!0),o.prev=4,o.next=7,$.MC(ue);case 7:if(xe=o.sent,Ee=xe.data,Le=Ee.code,le=Ee.data,Le!=="200000"){o.next=18;break}return Oe({status:ce,planId:le.id,title:le.title}),o.prev=12,o.next=15,(0,E.tB)({tags:_e.tagsNameList||[],resourceId:le.id,resourceType:"examTask"});case 15:return o.prev=15,H(!1),o.finish(15);case 18:return o.prev=18,H(!1),o.finish(18);case 21:o.next=42;break;case 23:if(Y!==x.EDIT){o.next=42;break}return H(!0),o.prev=25,o.next=28,$.WK({data:ue,planId:z});case 28:if(Ne=o.sent,Ze=Ne.data,Ae=Ze.code,Ae!=="200000"){o.next=39;break}return Oe({status:"published",planId:z,title:pe.title}),o.prev=33,o.next=36,(0,E.tB)({tags:_e.tagsNameList||[],resourceId:z,resourceType:"examTask"});case 36:return o.prev=36,H(!1),o.finish(36);case 39:return o.prev=39,H(!1),o.finish(39);case 42:case"end":return o.stop()}},p,null,[[4,,18,21],[12,,15,18],[25,,39,42],[33,,36,39]])}));return function(m){return C.apply(this,arguments)}}(),ye=C=>{se.current.runValidations().then(p=>{if(Object.keys(p).length)se.current.submitForm();else{var m=se.current.getFormikBag(),c=m.values;je((0,D.Z)((0,D.Z)({},c),{},{status:C}))}})},Oe=C=>{var p=C.status,m=C.planId,c=C.title;p==="published"?Pe(A=>(0,D.Z)((0,D.Z)({},A),{},{planId:m,repeatTaskTitle:c,visible:!0})):(0,n.F_)()},$e=()=>{ae.Z.confirm({title:"",icon:a().createElement(J.Z,null),content:t("examination.confirmCancel"),okText:t("common.ok"),cancelText:t("common.cancel"),onOk:()=>{(0,n.F_)()}})};return a().createElement("div",{className:s()["exam-form-container"]},a().createElement(V.Z,{spinning:Ke},a().createElement(r.J9,{ref:se,initialValues:pe,render:C=>{var p=C.values,m=C.setFieldValue;return a().createElement(r.l0,null,a().createElement("div",{className:s()["form-content"]},a().createElement("div",{className:"".concat(s()["important-info"])},a().createElement("div",{className:s()["exam-info"]},a().createElement(g.N,{title:t("examination.examInfo")}),a().createElement("div",{className:"".concat(s()["exam-info-content"]," ").concat(s()["section-content"])},a().createElement("div",{className:"".concat(s()["exam-content-container"])},a().createElement(r.gN,(0,i.Z)({component:l.wK,withBlankAndShortAnswer:!0,setFieldValue:m,displayType:"Custom",name:"paperInfo",from:"addPaper",placeholder:t("examination.selectPlaceholder"),label:t("examination.referencePapers"),validate:c=>(0,_.QK)(c.id,"".concat(t("examination.validatePaper"))),has_published:p.has_published,required:!0},n.mJ)),a().createElement(r.gN,(0,i.Z)({component:P.Z,valueSlice:!0,name:"title",label:t("examination.examTaskName"),validate:c=>(0,_.QK)(c,"".concat(t("examination.validateTaskName"))),required:!0,type:"text",LimitLength:60,showCount:!0,char:!0,placeholder:t("examination.inputPlaceholder")},n.mJ)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l._e,name:"exam_duration",label:t("examination.answerLength"),required:!0,validate:c=>l.XQ.validateExamDuration(c)},n.mJ)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.Fz,paperInfo:p.paperInfo,name:"pass_line",label:t("examination.passLine"),required:!0},n.mJ)),a().createElement(r.gN,(0,i.Z)({component:y.Z,name:"description",label:t("examination.examDesc"),type:"text",required:!1,LimitLength:200,char:!0,showCount:!0,rows:4,placeholder:t("examination.inputPlaceholder")},n.mJ)),a().createElement(r.gN,(0,i.Z)({name:"classify_id",label:t("examination.category"),displayType:"Custom",component:u.Z,classifyName:C.values.classify_name,value:C.values.classify_id},n.mJ)),a().createElement(r.gN,(0,i.Z)({name:"tagGroup",label:t("examination.detailTag"),displayType:"Custom",component:v.QS,defaultFieldList:{resourceType:"examTask",resourceId:z}},n.mJ)))))),a().createElement("div",{className:"".concat(s()["advance-info-container"])},a().createElement("div",{className:"".concat(s()["advance-info-content"])},a().createElement("h3",{className:s()["advance-title"]},t("examination.examAdvanceSetting")),a().createElement("div",{className:s()["advance-setting"]},a().createElement("div",{className:s()["setting-section"]},a().createElement(g.N,{title:t("examination.examSetting")}),a().createElement("div",{className:"".concat(s()["section-content"])},a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.QN,has_published:p.has_published,name:"exam_times",label:t("examination.exam_times")},n.wT)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.$O,has_published:p.has_published,name:"score_record_type",label:t("examination.score_record_type")},n.wT)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.Jv,name:"always_extract_paper",label:t("examination.always_extract_paper")},n.wT)),(0,n.Ks)({orgTypes:De,type:"cutScreen"})?a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.U6,name:"cut_screen_times",label:t("examination.cut_screen_times")},n.wT)):null,a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.LH,name:"random_order",label:t("examination.random_order")},n.wT)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.kE,face_recognition:p.face_recognition,name:"answer_device",label:t("examination.answerDevice")},n.wT)),(0,n.Ks)({orgTypes:De,type:"face"})&&!(0,w.xX)()?a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.Is,exam_duration:p.exam_duration,name:"face_recognition",label:t("examination.face_recognition"),validate:c=>l.XQ.validateFaceRecognition(c,p.exam_duration)},n.wT)):null,a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.Vu,name:"show_tag",label:t("examination.knowledgePoint")},n.wT)))),a().createElement("div",{className:s()["setting-section"]},a().createElement(g.N,{title:t("examination.displaySetting")}),a().createElement("div",{className:"".concat(s()["section-content"])},a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.xA,name:"result_visible",label:t("examination.testData")},n.wT)))),a().createElement("div",{className:s()["setting-section"]},a().createElement(g.N,{title:t("examination.bonusCreditSetting")}),a().createElement("div",{className:"".concat(s()["section-content"])},a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.EM,isEdit:Y===x.EDIT,validate:c=>l.XQ.validateBonusCredit(c),name:"reward_rule",label:t("examination.toCredit")},n.wT)),a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.wo,name:"exam_certificate",label:t("examination.exam_certificate")},n.wT)))),a().createElement("div",{className:s()["setting-section"]},a().createElement(g.N,{title:t("examination.markingMethodSetting")}),a().createElement("div",{className:"".concat(s()["section-content"])},a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.g4,isEdit:Y===x.EDIT,paperInfo:p.paperInfo,name:"mark_setting",label:t("examination.markingType"),validate:c=>l.XQ.validateMarkingMethod(c)},n.wT)))),a().createElement("div",{className:s()["setting-section"]},a().createElement(g.N,{title:t("examination.superviseSetting")},a().createElement("span",{className:s().tip},a().createElement(q.Z,{title:t("examination.supervisorExplain")},a().createElement(Z.Z,{style:{fontSize:"14px"}})))),a().createElement("div",{className:"".concat(s()["section-content"]," ").concat(s()["supervisor-section"])},a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.Or,name:"supervisor_list",label:t("examination.supervisor"),selectPersonOptions:{title:t("examination.addPeople")}},n.wT)),p.supervisor_list.length>1&&a().createElement(r.gN,(0,i.Z)({displayType:"Custom",component:l.hw,name:"jurisdiction",label:t("examination.supervisorAuth")},n.wT)))))))),a().createElement(v.I,null))}}),a().createElement("div",{className:s()["cl-form-fixed-footer"]},a().createElement("div",{className:s()["cl-form-fixed-footer__container"]},a().createElement(d.Z,{onClick:$e},t("common.cancel")),Y===x.ADD&&a().createElement(d.Z,{onClick:()=>{ye("draft")}},t("common.draft")),a().createElement(d.Z,{type:"primary",onClick:()=>{ye("published")}},t("common.release"))))),a().createElement(l.NI,(0,i.Z)({},We,{onCancel:()=>{Pe(C=>(0,D.Z)((0,D.Z)({},C),{},{visible:!1}))}})))}K.Z=(0,S.Z)()(me)}}]);
