(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[9379],{67620:function(Ee,q,n){"use strict";var W=n(34792),H=n(48086),T=n(12924),I=n.n(T),b=n(19222),de=n.n(b),ee=n(32407),se=n(37055),te=se.ZP.Common.editorUpload(),Q="cl_editor_toolbar_default",Z="cl_editor_content_default";class X extends T.Component{constructor(u){super(u);this.initEditor=()=>{this.editor=new(de())(".".concat(this.props.toolbarCls),".".concat(this.props.contentCls)),this.editor.config.zIndex=10,this.editor.config.onfocus=()=>{var e=document.querySelector(".".concat(this.props.contentCls));e&&(e.style.minHeight=this.props.contentHeight,e.style.height="auto")},this.editor.config.onblur=()=>{var e=document.querySelector(".".concat(this.props.contentCls));e&&(e.style.height=this.props.contentHeight)},this.editor.config.menus=this.props.controls,this.editor.config.placeholder=this.props.placeholderContent||ee.Z.t("component.pleaseEnterText"),this.editor.config.onchange=e=>{this.props.onChange&&this.props.onChange(e)},this.editor.config.onchangeTimeout=300,this.editor.config.uploadImgServer=te,this.editor.config.uploadImgMaxLength=5,this.editor.config.uploadImgParams={access_token:window.localStorage.getItem("token")},this.editor.config.uploadFileName="files",this.editor.config.uploadImgHooks={customInsert(e,j){var h=j.data;h.forEach(me=>{e(me)})}},this.editor.config.pasteTextHandle=function(e){return~e.indexOf("<!--[if gte mso 9]><xml>")||~e.indexOf("<spanyes")?"\u7C98\u8D34\u5185\u5BB9\u6709\u4E71\u7801\uFF0C\u8BF7\u4F7F\u7528ctrl+shift+v\u6765\u7C98\u8D34\u5185\u5BB9(mac\u8BF7\u4F7F\u7528command+shift+v)":e},this.editor.config.focus=!1,this.editor.config.uploadImgMaxSize=3*1024*1024,this.editor.config.uploadImgAccept=["jpg","jpeg","png","gif","bmp"],this.editor.config.showLinkImg=!1,this.editor.config.customAlert=function(e,j){switch(j){case"success":H.default.success(e);break;case"info":H.default.info(e);break;case"warning":H.default.warning(e);break;case"error":H.default.error(e);break;default:H.default.info(e);break}},this.editor.create(),this.editor.txt.html("".concat(this.props.placeholder))},this.getHtml=()=>this.editor.txt.html(),this.getText=()=>this.editor.txt.text(),this.setHtml=e=>this.editor.txt.html(e),this.editor=null}componentDidMount(){this.initEditor()}render(){var u=this.props.toolbarCls?"".concat(this.props.toolbarCls," cl_editor_toolbar"):"".concat(Q," cl_editor_toolbar"),e=this.props.contentCls?"".concat(this.props.contentCls," cl_editor_content"):"".concat(Z," cl_editor_content");return I().createElement(I().Fragment,null,I().createElement("div",{className:u}),I().createElement("div",{className:e,style:{height:this.props.contentHeight,minHeight:this.props.contentHeight}}))}}X.defaultProps={controls:["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","video","code","undo","redo"],placeholder:"\u5185\u5BB9\u7F16\u8F91\u533A\u57DF",toolbarCls:Q,contentCls:Z,contentHeight:"300px",placeholderContent:""},q.Z=X},11449:function(Ee,q,n){"use strict";n.d(q,{Z:function(){return V}});var W=n(88986),H=n(33565),T=n(12924),I=n.n(T),b=n(3115),de=n(49111),ee=n(19650),se=n(62029),te=n(57663),Q=n(71577),Z=n(91768),X=n(28216),ne=n(37055),u=n(10237);function e(U){var A=ne.ZP.getHelpContentByMenuKey(),k={key:U};return u.WY.get({url:A,params:k})}var j=n(74228),h=n.n(j),me=n(1164),z=n(76466),ae=n(38642);class le extends I().Component{constructor(A){var k;super(A);k=this,this.getHelpContentByMenuKey=()=>{var M=this.props.defaultMenuKey;e(M).then(B=>{var $=B.data,P=$.help_url,S=$.video_url;this.setState({videoUrl:S,helpUrl:P})})},this.handleOpenHelpUrl=M=>{if((0,ae.ve)()){window.open(M,"_blank");return}me.Z.targetTo({path:M,isExternalLink:!0})},this.handleOpenVideo=function(M){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:k.props.t("helpCenter.video");k.setState($=>({resourcePlayInfo:(0,W.Z)((0,W.Z)({},$.resourcePlayInfo),{},{resourceInfo:{originUrl:M,source:{FD:M,OD:M},contentType:"mp4"}}),previewInfo:(0,W.Z)((0,W.Z)({},$.previewInfo),{},{title:B,visible:!0,onCancel:k.handleCancelPreview})}))},this.handleCancelPreview=()=>{var M=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,W.Z)((0,W.Z)({},M),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:A.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var A=this.state,k=A.helpUrl,M=A.resourcePlayInfo,B=A.previewInfo,$=A.videoUrl,P=this.props.t;return I().createElement("div",{className:h().helpCenter},$&&I().createElement(Q.Z,{type:"link",className:h()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo($)},P("helpCenter.video")),k&&I().createElement(Q.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(k)},P("helpCenter.tutorial")),I().createElement(z.Z,(0,se.Z)({},M,{previewInfo:B})))}}var he=U=>({defaultMenuKey:U.currentRoute.menuKey});le.defaultProps={defaultMenuKey:""};var fe=(0,X.$j)(he)((0,Z.Z)()(le));function R(U){var A=U.extra,k=localStorage.getItem("dingPersonnel"),M=sessionStorage.getItem("dingPersonnel");return I().createElement(ee.Z,null,A,k!=="dingPersonnel"&&M!=="dingPersonnel"&&(0,ae.eY)("COMMONEXTRA_HELP_CENTER")&&I().createElement(fe,null))}var ve=R,ce=n(4408);function Ce(U){var A=(0,T.useState)({helpCenter:(0,ae.eY)("HEAD_HELP_CENTER_BUT")}),k=(0,H.Z)(A,1),M=k[0],B=U.pageContainerParams,$=B===void 0?{}:B,P=U.noPadding,S=P===void 0?!1:P,d=U.isPersonal,c=d===void 0?!1:d,p=U.pageTitle,v=U.className,E=v===void 0?"":v,C={extra:M.helpCenter?I().createElement(ve,{extra:$.extra}):$.extra},N=(0,W.Z)((0,W.Z)({},$),C);return I().createElement("div",{className:"page-container-content ".concat(S?"page-container-noPadding":""," ").concat(c?"page-container-content_personal_background":""," ").concat(E)},p&&I().createElement(ce.Z,{title:p}),c?I().createElement(b.Z,null,U.children):I().createElement(b.Z,N,U.children))}var V=Ce},88830:function(Ee,q,n){"use strict";n.r(q),n.d(q,{default:function(){return _t}});var W=n(13062),H=n(71230),T=n(62029),I=n(89032),b=n(15746),de=n(20228),ee=n(11382),se=n(57361),te=n(34792),Q=n(48086),Z=n(88986),X=n(9754),ne=n.n(X),u=n(12924),e=n.n(u),j=n(28216),h=n(80991),me=n(57068),z=n(91768),ae=n(76651),le=s=>{var a=s.operateStageList,t=s.opearateStage,r=s.onChangeStep,i=s.displayType,o=s.stepStyle,l=(m,g)=>m===g?"form-page-left-step-active":m>g||i==="edit"||o[g-1]==="success"?"form-page-left-step-success":"form-page-left-step-noallow";return e().createElement(e().Fragment,null,e().createElement("div",{className:"form-page-left-step"},a.map(m=>e().createElement("div",{onClick:()=>{m.key!==t&&r(m.key)},key:m.key,className:"form-page-left-step-item ".concat(l(t,m.key))},e().createElement("div",{className:"form-page-left-step-item-number"},m.key),e().createElement("div",{className:"form-page-left-step-item-name"},m.name)))))},he=le,fe=n(57663),R=n(71577),ve=n(78138),ce=n.n(ve),Ce=n(88983),V=n(47933),U=n(22385),A=n(31097),k=n(71194),M=n(57016),B=n(68628),$=s=>{var a=s.t,t=s.value,r=s.onChange,i=s.isEdit,o=s.lotteryPrizes,l=g=>{if(o&&o.length>0){var y=a("lottery.changeWiningModeTips"),F=a("lottery.quantityChangeTips");g.target.value==="rate"&&(F=a("lottery.rateChangeTips")),M.Z.warning({title:y,content:F})}r(g.target.value)},m=(g,y)=>e().createElement(e().Fragment,null,e().createElement("span",{className:"lottery_content_label_name"},g),e().createElement("span",{className:"lottery_content_label_tip"},e().createElement(A.Z,{placement:"top",title:y},e().createElement(B.Z,null))));return e().createElement(V.ZP.Group,{onChange:l,value:t,disabled:i},e().createElement(V.ZP,{value:"rate"},m(a("lottery.rateMode"),a("lottery.rateModeTips"))),e().createElement(V.ZP,{value:"quantity"},m(a("lottery.quantityMode"),a("lottery.quantityModeTips"))))},P=(0,z.Z)()($),S=n(49111),d=n(19650),c=s=>{var a=s.t,t=s.value,r=s.onChange,i=s.isEdit,o=s.showExample,l=s.isExpand,m=y=>{r(y.target.value)},g=()=>{o()};return e().createElement(e().Fragment,null,e().createElement("div",null,e().createElement(V.ZP.Group,{onChange:m,value:t,disabled:i},e().createElement(V.ZP,{value:"turnTable"},a("lottery.turnTable")),e().createElement(V.ZP,{value:"blindBox"},a("lottery.blindBox")),e().createElement(V.ZP,{value:"scratchCard"},a("lottery.scratchCard")),e().createElement(V.ZP,{value:"gashapon"},a("lottery.gashapon"))),e().createElement("span",{className:"cl-pointer",onClick:g},a(l?"common.collapse":"common.expand"))),l?e().createElement(d.Z,null,e().createElement("img",{src:a("lottery.turnTableTips"),width:"80",height:"150"}),e().createElement("img",{src:a("lottery.blindBoxTips"),width:"80",height:"150"}),e().createElement("img",{src:a("lottery.scratchCardTips"),width:"80",height:"150"}),e().createElement("img",{src:a("lottery.gashaponTips"),width:"80",height:"150"})):"")},p=(0,z.Z)()(c),v=n(66456),E=n(55313),C=n(49101),N=n(57119),f=n(96924),L={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:20}}},K=n(3407),_=n(6793),ie=(0,_.me)(),O=K.Z[ie].lottery,Y=K.Z[ie].learning,ye=s=>{var a=0;return s&&s.length>0&&s.forEach(t=>{if(t.winning_probability&&Number(t.winning_probability)>0)a+=Number(t.winning_probability);else return-1}),a},pe=s=>{if(s&&s.length>0){var a=/<[^>]+>/gi,t=s.replace(a,"");return t.length}else return 0},Pe=s=>{var a=0;return s&&s.length>0&&s.forEach(t=>{if(t.prizes_number&&Number(t.prizes_number)>0)a+=Number(t.prizes_number);else return-1}),a},w={title:s=>{var a;return s||(a=O.titleValidate),a},Required:(s,a)=>{var t;return s||(t=a),t},description:s=>{var a;if(s&&s.length>0){var t=pe(s);t>500&&(a="".concat(O.validDataDescription))}return a},getDescriptionLength:s=>pe(s),prizeName:(s,a,t)=>{var r;s||(r=O.goodsTitlePlaceHolder),s.search(/,|，/i)>-1&&(r=O.validDataPrizeNameComma);var i=t.filter(o=>o.title===s&&o.prize_order!==a);return i.length>0&&(r=O.validDataPrizeName),r},inputNumberMin:(s,a)=>{var t;return s||(t=typeof s=="number"?null:(0,_.ZT)(O.validationPositiveIntegerMin,a)),t},inputNumberPlayNum:(s,a)=>{var t;s||(t=typeof s=="number"?null:(0,_.ZT)(O.validationPositiveIntegerMin,"1"));var r=Pe(a);return s<r&&(t=O.validDataPlayNum),t},lotteryPrizesValid:(s,a,t)=>{var r=s.lotteryPrizes,i;if(r.length<3||r.length>8)return O.addPrizeTips;if(a==="rate"){var o=ye(r);o===-1?i=O.validDataRateValue:o>100&&(i=O.validDataRate)}else{r.forEach(m=>{!m.prizes_number&&Number(m.prizes_number)===0&&(i=O.validDataNumber)});var l=Pe(r);t<l&&(i=O.validDataPlayNum)}return i},registerRange:(s,a,t)=>{var r;return!s.startTime||!s.endTime?r=Y.validation.learningAddItemDateRangeNull:(0,_.jZ)(s.startTime)>=(0,_.jZ)(s.endTime)?r=Y.validation.learningAddItemDateRangeLimit:a==="un_start"&&(0,_.jZ)(s.startTime)<(0,_.jZ)()?r=Y.validation.greaterCurrentTime:a==="processing"&&(0,_.jZ)(s.endTime)<(0,_.jZ)()?r=Y.validation.pkEndTimeTips:a==="processing"&&t&&t.startTime&&(0,_.jZ)(s.startTime)!==(0,_.jZ)(t.startTime)&&(r="".concat(Y.validation.pkStartTimeDisable).concat((0,_.p6)(t.startTime))),r}},_e=n(7584),Fe=n(18329),re=n(43859),Ve={destroyOnClose:!0,bodyStyle:{padding:"0"},maskClosable:!1};class $e extends e().Component{constructor(){super(...arguments);this.handleOk=()=>{var a=this.props,t=a.defaultValues,r=a.defaultFieldList,i=r.lotteryPrizes;if(!!t.goodsType&&!!t.goodsTitle){var o=w.prizeName(t.goodsTitle,t.goodsOrder,i);if(!o){if(t.goodsType==="1"&&!t.goodsCoverEntity.length){if(!t.goodsCoverEntity.length)return}else if(!t.goodsCoverPoints.length||!t.goodsNumberIntegral||Number(t.goodsNumberIntegral)<1||Number(t.goodsNumberIntegral)>99999)return;!t.goodsNumberEntity||Number(t.goodsNumberEntity)<1||Number(t.goodsNumberEntity)>99999||t.winningMode==="rate"&&(t.goodsRate===""||Number(t.goodsRate)<0||Number(t.goodsRate)>100)||this.props.onHandleOk()}}},this.handleCancel=()=>{this.props.onHandleCancel()},this.renderFooter=()=>{var a=this.props,t=a.t,r=a.isPreview;return e().createElement(d.Z,{align:"center"},r?"":e().createElement(R.Z,{type:"primary",onClick:this.handleOk},t("common.ok")),e().createElement(R.Z,{className:"cancel_btn",onClick:this.handleCancel},t("common.cancel")))},this.typeRadio=(0,re.Z)(a=>{var t=a.value,r=a.onChange,i=o=>{r(o.target.value)};return e().createElement(V.ZP.Group,{onChange:i,value:t},e().createElement(V.ZP,{value:"1"},this.props.t("lottery.entity")),e().createElement(V.ZP,{value:"2"},this.props.t("lottery.points")))})}render(){var a=this.props,t=a.t,r=a.defaultValues,i=a.defaultFieldList,o=i.lotteryPrizes;return e().createElement(Fe.ZP,(0,T.Z)({},Ve,{onCancel:this.handleCancel,visible:!0,title:t("lottery.addPrize"),footer:this.renderFooter()}),e().createElement("div",{className:"choose-lottery-content"},e().createElement(h.gN,(0,T.Z)({name:"goodsType",label:t("lottery.prizeType"),component:this.typeRadio},L)),r.goodsType==="1"?e().createElement(h.gN,(0,T.Z)({label:t("lottery.prizeImage"),component:Oe,name:"goodsCoverEntity",defaultValue:r.goodsCoverEntity},L)):e().createElement(h.gN,(0,T.Z)({label:t("lottery.prizeImage"),component:Oe,name:"goodsCoverPoints",defaultValue:r.goodsCoverPoints},L)),r.goodsType==="1"&&!r.goodsCoverEntity.length||r.goodsType==="2"&&!r.goodsCoverPoints.length?e().createElement("div",{className:"lottery-alert"},t("lottery.validDataPrizeCover")):"",e().createElement(h.gN,(0,T.Z)({name:"goodsTitle",label:t("lottery.prizeName"),required:!0,validate:l=>w.prizeName(l,r.goodsOrder,o),component:_e.Z,style:{width:"400px"},placeholder:t("lottery.goodsTitlePlaceHolder"),maxLength:50,type:"text"},L)),r.goodsType==="2"?e().createElement(h.gN,{name:"goodsNumberIntegral",label:t("lottery.integralNumber"),required:!0,defaultValue:r.goodsNumberIntegral,max:99999,min:1,component:Te,validate:l=>w.inputNumberMin(l,"1")}):"",r.winningMode==="quantity"?e().createElement(h.gN,{name:"goodsNumberEntity",label:t("lottery.prizeNumber"),required:!0,defaultValue:r.goodsNumberEntity,max:99999,min:1,component:Te,validate:l=>w.inputNumberMin(l,"1")}):"",r.winningMode==="rate"?e().createElement(h.gN,{name:"goodsRate",label:t("lottery.prizeRate"),required:!0,defaultValue:r.goodsRate,unit:"%",max:100,min:1,component:Te,validate:l=>w.inputNumberMin(l,"1")}):""))}}var Ue=(0,h.$j)((0,z.Z)()($e));class Ie extends e().Component{constructor(a){super(a);this.handleClick=()=>{this.setDefaultGoods(),this.setState({visible:!0,operate:"add"})},this.setDefaultGoods=()=>{var t=this.props.defaultFieldList.lotteryPrizes;this.props.formik.setFieldValue("goodsTitle",f.ok.goodsTitle),this.props.formik.setFieldValue("goodsNumberEntity",f.ok.goodsNumberEntity),this.props.formik.setFieldValue("goodsNumberIntegral",f.ok.goodsNumberIntegral),this.props.formik.setFieldValue("goodsOrder",t.length),this.props.formik.setFieldValue("goodsCoverEntity",f.ok.goodsCoverEntity),this.props.formik.setFieldValue("goodsCoverPoints",f.ok.goodsCoverPoints),this.props.formik.setFieldValue("goodsType",f.ok.goodsType),this.props.formik.setFieldValue("goodsRate",f.ok.goodsRate)},this.setEditGoods=t=>{var r=[{uid:"123",url:t.cover,name:"",status:"done"}];this.props.formik.setFieldValue("goodsTitle",t.title),this.props.formik.setFieldValue("goodsNumberEntity",t.prizes_number),this.props.formik.setFieldValue("goodsNumberIntegral",t.integral_number),this.props.formik.setFieldValue("goodsOrder",t.prize_order),t.type.toString()==="1"?(this.props.formik.setFieldValue("goodsCoverEntity",r),this.props.formik.setFieldValue("goodsCoverPoints",f.ok.goodsCoverPoints)):(this.props.formik.setFieldValue("goodsCoverEntity",f.ok.goodsCoverEntity),this.props.formik.setFieldValue("goodsCoverPoints",r)),this.props.formik.setFieldValue("goodsType",t.type.toString()),this.props.formik.setFieldValue("goodsRate",t.winning_probability)},this.doAddGoods=()=>{var t=this.props,r=t.defaultFieldList.lotteryPrizes,i=t.defaultValues,o={cover:i.goodsType==="1"?i.goodsCoverEntity[0].url:i.goodsCoverPoints[0].url,integral_number:i.goodsNumberIntegral,prize_order:r.length?r.length.toString():"0",prizes_number:i.goodsNumberEntity,title:i.goodsTitle,type:i.goodsType,winning_probability:i.goodsRate},l=[o,...r];l.map((g,y)=>(g.prize_order=y.toString(),g));var m={lotteryPrizes:l};this.props.formik.setFieldValue("lotteryPrizesContent",m)},this.doEditGoods=()=>{var t=this.props,r=t.defaultFieldList.lotteryPrizes,i=t.defaultValues,o={cover:i.goodsType==="1"?i.goodsCoverEntity[0].url:i.goodsCoverPoints[0].url,integral_number:i.goodsNumberIntegral,prize_order:i.goodsOrder,prizes_number:i.goodsNumberEntity,title:i.goodsTitle,type:i.goodsType,winning_probability:i.goodsRate},l=r.map(g=>g.prize_order===i.goodsOrder?o:g),m={lotteryPrizes:[...l]};this.props.formik.setFieldValue("lotteryPrizesContent",m)},this.handleOk=()=>{var t=this.state.operate;t==="add"?this.doAddGoods():this.doEditGoods(),this.setState({visible:!1})},this.handleCancel=()=>{this.setState({visible:!1})},this.handleEditRow=t=>{this.setEditGoods(t),this.setState({visible:!0,operate:"edit"})},this.handleDeleteRow=t=>{var r=this.props,i=r.t,o=r.defaultFieldList,l=r.formik;M.Z.confirm({title:i("lottery.confirmDeleteTitle"),content:"",okText:i("common.ok"),cancelText:i("common.cancel"),centered:!0,onOk(){var m=o.lotteryPrizes,g=m.filter(F=>F.prize_order!==t.prize_order),y=(0,Z.Z)((0,Z.Z)({},o),{},{lotteryPrizes:g.map((F,G)=>(F.order=G.toString(),F))});l.setFieldValue("lotteryPrizesContent",y),Q.default.success(i("common.deleteSuccess"))}})},this.renderContent=()=>{var t=this.props,r=t.prefixCls,i=t.defaultFieldList,o=t.lotteryStatus,l=t.isPreview,m=t.t,g=this.props.form.values.winningMode,y=[],F={title:()=>"".concat(m("lottery.prizeRate")),dataIndex:"winning_probability",key:"winning_probability",width:"10%",render:ue=>"".concat(ue,"%")},G={title:()=>"".concat(m("lottery.prizeNumber")),dataIndex:"prizes_number",key:"prizes_number",width:"10%"},D={title:()=>"".concat(this.props.t("lottery.points")),dataIndex:"integral_number",key:"integral_number",width:"10%",render:(ue,oe)=>oe.type.toString()==="2"?ue:"--"},J={title:l?"":m("common.operate"),dataIndex:"action",key:"action",width:"20%",render:(ue,oe)=>{var Se="";return!l&&o==="un_start"&&oe.type.toString()!=="3"&&(Se=e().createElement(d.Z,null,e().createElement("a",{href:"javascript:;",onClick:()=>this.handleEditRow(oe),disabled:this.props.isEdit},m("common.edit")),e().createElement("a",{href:"javascript:;",onClick:()=>this.handleDeleteRow(oe),disabled:this.props.isEdit},m("common.delete")))),Se}};g==="rate"?y=[...this.columns,F,D]:y=[...this.columns,G,D],o==="un_start"&&(y=[...y,J]);var x=i.lotteryPrizes,xe="".concat(r,"__content");if(!x.length)return null;var Ne=x;if(g==="rate"){var be=(0,f.Vv)(x);be&&(Ne=[...x,be])}return e().createElement("div",{className:xe},e().createElement(E.Z,{size:"middle",pagination:!1,columns:y,rowKey:"key",dataSource:Ne}))},this.state={visible:!1},this.columns=[{title:this.props.t("lottery.prizeImage"),dataIndex:"cover",key:"cover",width:"10%",render:t=>e().createElement("img",{className:"list-content-table-goods-img",src:t||"".concat("https://oss.coolcollege.cn","/1790744830884843520.png")})},{title:()=>"".concat(this.props.t("lottery.prizeName")),dataIndex:"title",key:"title",width:"20%"},{title:()=>"".concat(this.props.t("lottery.prizeType")),dataIndex:"type",key:"type",width:"10%",render:t=>(0,f.m1)(t)}]}render(){var a=this.props,t=a.prefixCls,r=a.t,i=a.isPreview,o=a.isEdit,l=a.defaultFieldList.lotteryPrizes,m=this.state.visible;return e().createElement(e().Fragment,null,e().createElement("div",{className:t},e().createElement("div",{className:"lottery_choose_content"},!i&&e().createElement(e().Fragment,null,e().createElement(R.Z,{type:"link",icon:e().createElement(C.Z,null),disabled:o||l.length>6,onClick:this.handleClick},r("lottery.addPrize")),e().createElement("span",{className:"lottery_choose_select_tip"},e().createElement(N.Z,{style:{color:"#f61717",marginRight:"5px"}}),r("lottery.addPrizeTips")))),this.renderContent()),m?e().createElement(Ue,(0,T.Z)({},this.props,{onHandleOk:this.handleOk,onHandleCancel:this.handleCancel})):"")}}Ie.defaultProps={prefixCls:"lottery_add"};var ke=(0,h.$j)((0,z.Z)()(Ie)),Zt=n(77883),Me=n(21888);class Ge extends e().Component{constructor(){super(...arguments);this.onChange=a=>{var t=this.props.onChange;t&&t(a)}}render(){var a=this.props,t=a.defaultValue,r=a.unit,i=a.max,o=a.min,l=o===void 0?0:o,m=a.isPreview,g=a.isEdit;return e().createElement("div",null,m?e().createElement("span",null,t):e().createElement(Me.Z,{value:t,min:l,max:i,precision:0,defaultValue:t,disabled:g,onChange:this.onChange}),e().createElement("span",{style:{paddingLeft:"8px"}},r))}}var We=(0,z.Z)()(Ge);class Be extends e().Component{constructor(){super(...arguments);this.onChange=a=>{var t=this.props.onChange;t&&t(a<=0?"":a)}}render(){var a=this.props,t=a.defaultValue,r=a.unit,i=a.isPreview,o=a.isEdit;return e().createElement("div",null,i?e().createElement("span",null,t):e().createElement(Me.Z,{min:"",max:99999,precision:0,defaultValue:t,disabled:o,onChange:this.onChange}),e().createElement("span",{style:{paddingLeft:"8px"}},r))}}var Ke=(0,z.Z)()(Be),He=n(24144);class je extends e().Component{constructor(a){super(a);this.onChange=t=>{var r=t.fileList;this.props.onChange(r)},this.state={type:"crop"}}render(){var a=this.props,t=a.value,r=a.t;return e().createElement(e().Fragment,null,e().createElement("div",{className:"lottery_cover_upload_field"},e().createElement("div",{className:"lottery_cover_upload_container"},e().createElement(He.G2,{addTitle:"",imageContainerClassName:"lottery_cover_upload_container",fileList:t,uploadConfig:{accept:"jpeg, jpg, png"},onUploadedListChange:this.onChange,size:{value:3,unit:"MB"},clip:this.state.type,imgCropConfig:{widthScale:1,heightScale:1}})),e().createElement("span",{className:"lottery_cover_upload_tip"},r("lottery.prizeCoverTips"))))}}var Ye=(0,z.Z)()(je),Je=(0,re.Z)(P),Qe=(0,re.Z)(ke),Te=(0,re.Z)(We),Mt=(0,re.Z)(Ke),Xe=(0,re.Z)(p),Oe=(0,re.Z)(Ye),qe=s=>{var a=s.title,t=s.desc,r=s.t,i=(o,l)=>o===r("lottery.description")?e().createElement("div",{dangerouslySetInnerHTML:{__html:l}}):e().createElement("span",null,l);return e().createElement(H.Z,{className:"preview_item"},e().createElement(b.Z,{span:3},a,":"),e().createElement(b.Z,null,i(a,t)))},et=qe,tt=n(67620);class at extends e().Component{constructor(a){super(a);this.handleChange=t=>{this.props.onChange(t)},this.state={}}render(){var a=this.props,t=a.value,r=a.descriptionLength,i=a.t;return e().createElement("div",{className:"edit-content"},e().createElement(tt.Z,{style:{width:"776px"},ref:o=>this.editorInstance=o,onChange:o=>this.handleChange(o),placeholderContent:t?"":i("lottery.validDataDescription"),controls:[],placeholder:t||""}),e().createElement("span",{className:"dataCount"},e().createElement("span",{style:r>500?{color:"#F03A3A"}:{}},r),"/500"))}}var rt=(0,re.Z)((0,h.$j)((0,z.Z)()(at))),nt=n(62615),it=n(2396),st=s=>{var a=s.t,t=s.values,r=s.isPreview,i=s.isEdit,o=s.toEdit,l=s.cancelCreate,m=s.lotteryStatus,g=s.onExpandGameMode,y=s.isExpandGameMode,F=s.onChangeDescription,G=(0,Z.Z)({},t.oldDatePicker),D=[{title:a("lottery.activityName"),desc:t.title,key:1},{title:a("historicRecords.startDate"),desc:ce()(t.datePicker.startTime).format("YYYY-MM-DD HH:mm"),key:2},{title:a("common.endTime"),desc:ce()(t.datePicker.endTime).format("YYYY-MM-DD HH:mm"),key:3},{title:a("lottery.lotteryGame"),desc:(0,f.$Z)(t.gameType),key:5},{title:a("lottery.description"),desc:t.description,key:4},{title:a("lottery.lotteryMode"),desc:(0,f.Ir)(t.winningMode),key:5}],J=x=>{F(x)};return e().createElement("div",{className:"basic_info"},e().createElement("div",{className:"basic_lottery_title"},e().createElement("span",null,r?"".concat(a("lottery.basicInfo")+a("component.preview")," "):a("lottery.basicInfo"))),r?e().createElement("div",null,e().createElement("div",{className:"preview_container"},D.map(x=>e().createElement(et,{title:x.title,desc:x.desc,key:x.key,t:a}))),e().createElement("div",null,i?e().createElement(R.Z,{htmlType:"submit",type:"primary",className:"lottery-basic-info-release"},a("common.release")):"",e().createElement(R.Z,{className:"cancel_btn",onClick:o},a("common.return")))):e().createElement("div",null,e().createElement(h.gN,(0,T.Z)({name:"title",label:a("lottery.activityName"),required:!0,validate:x=>(0,it.QK)(x,a("lottery.titlePlaceHolder")),component:_e.Z,isPreview:r,style:{width:"532px"},placeholder:a("lottery.titlePlaceHolder"),maxLength:30,type:"text"},L)),e().createElement(h.gN,(0,T.Z)({component:nt.C0,displayType:"Custom",name:"datePicker",disabled:!(i||m==="processing"),label:a("common.startEndTime"),required:!0,defaultFieldList:t.datePicker,validate:x=>w.registerRange(x,m,G),onlyChangeEndTime:m==="processing"},L,{fieldName:"datePicker"})),e().createElement(h.gN,(0,T.Z)({name:"gameType",label:a("lottery.lotteryGame"),component:Xe,isEdit:!i,showExample:g,isExpand:y},L)),e().createElement(h.gN,(0,T.Z)({name:"description",label:a("lottery.description"),defaultValue:t.description,component:rt,value:t.description,validate:x=>w.description(x),width:"482px",descriptionLength:t.descriptionLength,displayType:"Custom",disabled:r,onChange:J},L)),e().createElement(h.gN,(0,T.Z)({name:"winningMode",label:a("lottery.lotteryMode"),component:Je,lotteryPrizes:t.lotteryPrizesContent.lotteryPrizes,isEdit:!i},L)),e().createElement("div",null,r?"":e().createElement(R.Z,{type:"primary",htmlType:"submit",className:"lottery-save-next-btn"},a("learning.learnUpgrade.saveAndNext")),e().createElement(R.Z,{className:"cancel_btn",onClick:l},a("common.cancel")))))},lt=(0,z.Z)()(st);class ot extends e().Component{constructor(){super(...arguments);this.renderCommonLabel=(a,t)=>e().createElement(e().Fragment,null,e().createElement("span",{className:"lottery_content_label_name"},a),e().createElement("span",{className:"lottery_content_label_tip"},e().createElement(A.Z,{placement:"top",title:t},e().createElement(B.Z,null)))),this.renderOption=()=>{var a=this.props,t=a.isPreview,r=a.isEdit,i=a.saveNext,o=a.t,l=a.toEdit,m=a.cancelCreate,g="";return t||(g=e().createElement(R.Z,{type:"primary",className:"lottery-save-next-btn",onClick:i},o("learning.learnUpgrade.saveAndNext"))),t&&r&&(g=e().createElement(R.Z,{htmlType:"submit",type:"primary",className:"lottery-content-release"},o("common.release"))),e().createElement("div",{className:"operate_container"},g,t?e().createElement(R.Z,{className:"cancel_btn",onClick:l},o("common.return")):e().createElement(R.Z,{className:"cancel_btn",onClick:m},o("common.cancel")))}}componentDidMount(){}render(){var a=this.props,t=a.t,r=a.values,i=a.values.winningMode,o=a.isPreview,l=a.lotteryStatus,m=a.isEdit,g=r.lotteryPrizesContent.lotteryPrizes;return e().createElement("div",{className:"lottery_content"},e().createElement("div",{className:"lottery_content__title"},e().createElement("span",null,o?"".concat(t("lottery.prizeSetting")+t("component.preview")," "):t("lottery.prizeSetting"))),e().createElement(h.gN,{name:"lotteryPrizesContent",label:t("lottery.selectPrize"),required:!0,isEdit:!m,defaultFieldList:r.lotteryPrizesContent,defaultValues:r,isPreview:o,lotteryStatus:l,component:Qe,validate:y=>w.lotteryPrizesValid(y,r.winningMode,r.limit_play_num)}),o?e().createElement("div",{className:"lottery-base-content"},i==="quantity"?e().createElement("div",{className:"lottery-item-preview"},e().createElement("div",{className:"lottery-item-preview-title"},t("lottery.limitPlayTips1"),":"),e().createElement("div",{className:"lottery-item-preview-value"},r.limit_play_num)):"",e().createElement("div",{className:"lottery-item-preview"},e().createElement("div",{className:"lottery-item-preview-title"},t("lottery.cashingContact"),":"),e().createElement("div",{className:"lottery-item-preview-value"},r.cashing_contact)),e().createElement("div",{className:"lottery-item-preview bottom"},e().createElement("div",{className:"lottery-item-preview-title"},t("lottery.cashingContactMobile"),":"),e().createElement("div",{className:"lottery-item-preview-value"},r.cashing_contact_mobile))):e().createElement("div",{className:"lottery-base-content"},i==="quantity"?e().createElement("div",{className:"lottery-item"},e().createElement(h.gN,{name:"limit_play_num",label:t("lottery.limitPlayTips1"),required:!0,isPreview:o,isEdit:!m,defaultValue:r.limit_play_num,max:999999,min:1,unit:t("lottery.limitPlayTips2"),component:Te,validate:y=>w.inputNumberPlayNum(y,g.length)})):"",e().createElement("div",{className:"lottery-item"},e().createElement(h.gN,(0,T.Z)({name:"cashing_contact",label:t("lottery.cashingContact"),required:!0,validate:y=>w.Required(y,t("lottery.cashingContactHolder")),component:_e.Z,style:{width:"500px"},isPreview:o,placeholder:t("lottery.cashingContactHolder"),maxLength:20,type:"text"},L))),e().createElement("div",{className:"lottery-item"},e().createElement(h.gN,(0,T.Z)({name:"cashing_contact_mobile",label:t("lottery.cashingContactMobile"),required:!0,validate:y=>w.Required(y,t("lottery.cashingContactMobileHolder")),component:_e.Z,style:{width:"500px"},isPreview:o,placeholder:t("lottery.cashingContactMobileHolder"),maxLength:120,type:"text"},L)))),this.renderOption())}}var dt=(0,z.Z)()(ot),Dt=n(71153),we=n(60331),mt=n(52670),ct=n(21063);class pt extends e().Component{constructor(){super(...arguments);this.handleLotteryGroupOk=a=>{var t=this.props,r=t.formik,i=t.rangeName,o=t.onLotteryGroupOk,l=a.rangeType,m=a.rangeList;r.setFieldValue(i,{rangeType:l,rangeList:m}),o(a)}}render(){var a=this.props,t=a.values,r=a.mode,i=a.showStudentList,o=a.rangeName,l=a.lotteryId,m=a.isEdit;return e().createElement(e().Fragment,null,e().createElement(h.gN,{component:ct.Z,displayType:"Custom",name:o,mode:r,showSectitle:!1,isAssignRange:!0,defaultFieldList:t[o],isShowLotteryStudentList:!!l,handleStudentList:i,validate:mt.FI,onLotteryGroupOk:this.handleLotteryGroupOk,disabled:!m,rangeType:m?2:1}))}}var ut=(0,h.$j)((0,z.Z)()(pt));class gt extends e().Component{constructor(){super(...arguments);this.onChange=a=>{var t=a.target.value,r=this.props.onChangeShow;r(t)}}render(){var a=this.props,t=a.value,r=a.t,i=a.disabled,o=a.isPreview;return e().createElement(V.ZP.Group,{onChange:this.onChange,size:"small",value:t?1:0,disabled:i||o},e().createElement(V.ZP,{value:0},r("lottery.unlimited")),e().createElement(V.ZP,{value:1},r("lottery.limit")))}}var Re=(0,z.Z)()((0,re.Z)(gt));class ht extends e().Component{constructor(){super(...arguments);this.handleChange=a=>{this.props.onChange(a)}}render(){var a=this.props,t=a.value,r=a.t,i=a.disabled,o=a.isPreview,l=a.max,m=a.min;return e().createElement("div",null,e().createElement(Me.Z,{min:m,max:l,value:t,onChange:g=>{this.handleChange(g)},disabled:i||o}),r("common.times"))}}var ze=(0,z.Z)()((0,h.$j)((0,re.Z)(ht)));class vt extends e().Component{constructor(a){super(a);this.getEmployeeArr=t=>{var r=t.dept,i=t.group,o=t.post,l=t.user;return[].concat(r,i,o,l)},this.handleChangeLotteryType=t=>{t===1&&this.props.formik.setFieldValue("win_limit_type",t),this.props.formik.setFieldValue("lottery_limit_type",t)},this.handleChangeWinType=t=>{this.props.formik.setFieldValue("win_limit_type",t)},this.state={groupSetting:[]}}componentDidMount(){var a=this.props.values;this.setState({groupSetting:[(0,Z.Z)({},a.employeeRange)]})}render(){var a=this.props,t=a.t,r=a.values,i=a.isPreview,o=a.toPreview,l=a.toEdit,m=a.cancelCreate,g=a.lotteryId,y=a.lotteryStatus,F=this.state.groupSetting,G=y==="un_start";return e().createElement("div",{className:"lottery_setting"},e().createElement("div",{className:"lottery_setting__title"},e().createElement("span",null,i?"".concat(t("lottery.lotteryUserSetting")+t("component.preview")," "):t("lottery.lotteryUserSetting"))),i?e().createElement(e().Fragment,null,e().createElement("div",{className:"preview_container"},e().createElement("div",{className:"preview_item"},e().createElement("div",{className:"preview_item_assign-range"},t("lottery.lotteryUser"),":"),e().createElement("div",{className:"preview_item_tag-content"},r.employeeRange.rangeType===1?e().createElement(we.Z,{className:"card_item"},t("common.allCompany")):this.getEmployeeArr(r.employeeRange.rangeList).map(D=>e().createElement(we.Z,{className:"card_item",key:D.id},D.name)))),e().createElement("div",{className:"preview_item"},e().createElement("div",{className:"preview_item_assign-range"},t("lottery.lotteryLimitTitle"),":"),e().createElement("div",{className:"preview_item_tag-content"},e().createElement(d.Z,null,r.lottery_limit_type?e().createElement("div",null,e().createElement("span",null,t("lottery.limit")),e().createElement("span",null,t("lottery.lotteryLimitTips")),e().createElement("span",null,r.lottery_limit_num),e().createElement("span",null,t("common.times"))):e().createElement("span",null,t("lottery.unlimited"))))),e().createElement("div",{className:"preview_item"},e().createElement("div",{className:"preview_item_assign-range"},t("lottery.winLimitTitle"),":"),e().createElement("div",{className:"preview_item_tag-content"},e().createElement(d.Z,null,r.win_limit_type?e().createElement("div",null,e().createElement("span",null,t("lottery.limit")),e().createElement("span",null,t("lottery.winLimitTips")),e().createElement("span",null,r.win_limit_num),e().createElement("span",null,t("common.times"))):e().createElement("span",null,t("lottery.unlimited")))))),e().createElement("div",null,e().createElement(R.Z,{htmlType:"submit",type:"primary",className:"lottery-setting-release"},t("common.release")),e().createElement(R.Z,{className:"cancel_btn",onClick:l},t("common.return")))):e().createElement(e().Fragment,null,F.map((D,J)=>e().createElement(ut,{key:J.toString(),rangeName:"employeeRange",values:r,mode:["all","part"],showStudentList:()=>{this.showStudentList(D)},onLotteryGroupOk:x=>{this.handleLotteryGroupOk(x,J)},onInputChange:x=>{this.onInputChange(x,J)},lotteryId:g,isEdit:G})),e().createElement("div",{className:"lottery-item"},e().createElement(h.gN,{name:"lottery_limit_type",label:t("lottery.lotteryLimitTitle"),required:!0,component:Re,disabled:!G,isPreview:i,onChangeShow:this.handleChangeLotteryType}),r.lottery_limit_type?e().createElement(d.Z,null,e().createElement("div",{className:"limitTips"},t("lottery.lotteryLimitTips")),e().createElement(h.gN,{name:"lottery_limit_num",component:ze,min:1,max:999,value:r.lottery_limit_num,required:!0,disabled:!G,isPreview:i,style:{marginTop:"-20px"},validate:D=>w.inputNumberMin(D,"1")})):""),e().createElement("div",{className:"lottery-item"},e().createElement(h.gN,{name:"win_limit_type",label:t("lottery.winLimitTitle"),required:!0,component:Re,disabled:!G||r.lottery_limit_type===1,isPreview:i,onChangeShow:this.handleChangeWinType}),r.win_limit_type?e().createElement(d.Z,null,e().createElement("div",{className:"limitTips"},t("lottery.winLimitTips")),e().createElement(h.gN,{name:"win_limit_num",component:ze,value:r.win_limit_num,max:r.lottery_limit_type?r.lottery_limit_num:999,min:1,required:!0,disabled:!G,isPreview:i,validate:D=>w.inputNumberMin(D,"1")})):""),e().createElement("div",null,e().createElement(R.Z,{type:"primary",htmlType:"submit",className:"lottery-release-next-btn"},t("common.release")),e().createElement(R.Z,{className:"preview_btn",onClick:o},t("component.preview")),e().createElement(R.Z,{className:"cancel_btn",onClick:m},t("common.cancel")))))}}var yt=(0,h.$j)((0,z.Z)()(vt)),Et=n(4408),De=n(37055),ft=n(11449),Ae=n(10237),Ct=s=>({userInfo:s.user});class Pt extends e().Component{constructor(a){var t;super(a);t=this,this.onExpandGameMode=()=>{var r=this.state.isExpandGameMode;this.setState({isExpandGameMode:!r})},this.onChangeStep=r=>{var i=this.state,o=i.stepStyle,l=i.displayType,m=i.opearateStage;o[r-1]==="success"&&(l==="edit"?this.changeStage(r):r<m&&(m!==2||o[2]==="disabled")?this.changeStage(r):this.leftValidateForm(r))},this.initialValues=(0,Z.Z)({title:"",start_time:"",lottery_limit_num:1,lottery_limit_type:1,win_limit_num:1,win_limit_type:1,limit_play_num:100,end_time:"",displayType:"",winningMode:"rate",gameType:"turnTable",description:"",datePicker:{startTime:"",endTime:""},oldDatePicker:{startTime:"",endTime:""},depart_post_group_mark:"",user_ids_mark:"",employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},lotteryPrizesContent:{lotteryPrizes:[]},cashing_contact_mobile:"",cashing_contact:""},f.ok),this.getDetails=()=>{var r=this.state.lotteryId,i=De.ZP.lottery.getDetails(r);Ae.WY.get({url:i}).then(o=>{var l=o.data.data;if(!o)return null;this.initialValues=(0,Z.Z)({title:l.title,displayType:"",winningMode:l.winning_mode,description:l.description,descriptionLength:0,gameType:l.type,datePicker:{endTime:(0,_.k7)(Number(l.end_time)),startTime:(0,_.k7)(Number(l.start_time))},oldDatePicker:{endTime:(0,_.k7)(Number(l.end_time)),startTime:(0,_.k7)(Number(l.start_time))},employeeRange:{rangeType:l.is_all==="all"?1:2,rangeList:{dept:l.department_vos||[],post:l.post_vos||[],group:l.group_vos||[],user:l.users||[]}},lotteryPrizesContent:{lotteryPrizes:l.lottery_prizes.filter(m=>m.type!==3)},cashing_contact_mobile:l.cashing_contact_mobile,cashing_contact:l.cashing_contact,lottery_limit_num:l.lottery_limit_num,lottery_limit_type:l.lottery_limit_type,win_limit_num:l.win_limit_num,win_limit_type:l.win_limit_type,limit_play_num:l.limit_play_num,depart_post_group_mark:l.depart_post_group_mark},f.ok),this.setState({showLoading:!1,lotteryStatus:l.lottery_status,canEdit:l.lottery_status==="un_start"},()=>{this.formRef.setFieldValue("displayType","add")})})},this.beforeSave=(0,_.E5)(r=>{var i=this.state.isSave;i&&this.setState({isSave:!1},()=>{this.save(r)})},1e3),this.save=r=>{var i=this.state.lotteryId,o=i?De.ZP.lottery.edit(i):De.ZP.lottery.add();Ae.WY.post({url:o,data:r}).then(l=>{var m=l.data,g=m.success,y=m.message;g==="true"?(Q.default.success(i?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess")),ae.m8.push("/operation/operationActivity/lottery")):(Q.default.error(y),this.setState({isSave:!0}))}).catch(()=>{this.setState({isSave:!0})})},this.filterData=r=>{var i=r.map(o=>o.id).join();return i},this.getNonPrize=(r,i)=>{if(i==="quantity")return[...r,f.$z];var o=(0,f.Vv)(r)||f.$z;return[...r,o]},this.handleSubmit=()=>{var r=this.state,i=r.opearateStage,o=r.isPreview,l=r.stepStyle;if(i<3&&!o)l[i]="success",this.setState({opearateStage:i+1,stepStyle:l});else{var m=this.formRef.state.values,g=m.title,y=m.datePicker,F=m.winningMode,G=m.gameType,D=m.employeeRange,J=m.lotteryPrizesContent,x=m.cashing_contact,xe=m.cashing_contact_mobile,Ne=m.description,be=m.lottery_limit_num,ue=m.lottery_limit_type,oe=m.win_limit_num,Se=m.win_limit_type,Tt=m.limit_play_num,Le=D.rangeList,Nt=Le.dept,bt=Le.post,St=Le.group,Lt=Le.user,ge={title:(0,_.fy)(g),description:Ne,end_time:(0,_.jZ)(y.endTime),start_time:(0,_.jZ)(y.startTime),lottery_prizes:this.getNonPrize(J.lotteryPrizes,G),lottery_limit_num:be,lottery_limit_type:ue,win_limit_num:oe,win_limit_type:Se,limit_play_num:Tt,winning_mode:F,type:G,is_all:D.rangeType===1?"all":"part",user_ids:this.filterData(Lt),cashing_contact:x,cashing_contact_mobile:xe,depart_post_group_mark:{departments:this.filterData(Nt),posts:this.filterData(bt),groups:this.filterData(St)}};for(var Ze in ge)(ge[Ze]instanceof Array&&!ge[Ze].length||ge[Ze]==="")&&delete ge[Ze];this.beforeSave(ge)}},this.toPreview=(0,se.Z)(ne().mark(function r(){var i;return ne().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,t.formRef.validateField("employeeRange");case 2:i=l.sent,i?t.formRef.setFieldTouched("employeeRange",!0):t.setState({isPreview:!0,opearateStage:1});case 4:case"end":return l.stop()}},r)})),this.cancelCreate=()=>{ae.m8.push("/operation/operationActivity/lottery")},this.toEdit=()=>{this.setState({isPreview:!1,opearateStage:3})},this.leftValidateForm=r=>{this.formRef.validateForm().then(i=>{Object.keys(i).length===0?this.setState({opearateStage:r}):this.dealNormalError(i)})},this.dealNormalError=r=>{for(var i in r)if(r[i]){this.formRef.setFieldTouched(i,!0);return}},this.changeStage=r=>{this.setState({opearateStage:r})},this.initRef=r=>{this.formRef=r},this.saveNext=()=>{this.formRef.submitForm()},this.handleChangeDescription=r=>{var i=w.getDescriptionLength(r);this.formRef.setFieldValue("description",r),this.formRef.setFieldValue("descriptionLength",i)},this.state={operateStageList:[{key:1,name:a.t("lottery.basicInfo")},{key:2,name:a.t("lottery.prizeSetting")},{key:3,name:a.t("lottery.lotteryUserSetting")}],opearateStage:1,isPreview:!1,lotteryId:"",showLoading:!0,stepStyle:["success","disabled","disabled"],displayType:"add",isExpandGameMode:!1,canEdit:!0,isSave:!0,lotteryStatus:"un_start"}}componentDidMount(){var a=me.parse(ae.m8.location.search),t=a.id;t?this.setState({lotteryId:t,displayType:"edit",stepStyle:["success","success","success"]},()=>{this.getDetails(t)}):this.setState({showLoading:!1},()=>{this.formRef.setFieldValue("displayType","add")})}render(){var a=this.state,t=a.lotteryId,r=a.operateStageList,i=a.opearateStage,o=a.isPreview,l=a.showLoading,m=a.displayType,g=a.stepStyle,y=a.canEdit,F=a.lotteryStatus,G=a.isExpandGameMode,D=this.props.t;return l?e().createElement(ee.Z,null):(t&&(document.title=D("lottery.edit")),e().createElement(ft.Z,{pageContainerParams:{header:{title:D(t?"lottery.edit":"lottery.add")}}},e().createElement("div",{className:"add_lottery"},e().createElement(Et.Z,{title:D(t?"lottery.edit":"lottery.add")}),e().createElement("div",{className:"form-page-container"},e().createElement(H.Z,{className:"form-page-container-row",justify:"space-between"},e().createElement(b.Z,{className:"form-page-aside form-page-left"},e().createElement(he,{operateStageList:r,onChangeStep:this.onChangeStep,opearateStage:i,displayType:m,stepStyle:g})),e().createElement(b.Z,{className:"form-page-aside form-page-right"},e().createElement(h.J9,{ref:this.initRef,initialValues:this.initialValues,onSubmit:this.handleSubmit,render:J=>e().createElement(h.l0,{className:"cl-form"},i===1&&e().createElement(lt,(0,T.Z)({},J,{isPreview:o,isEdit:y,toEdit:this.toEdit,lotteryId:t,cancelCreate:this.cancelCreate,lotteryStatus:F,onExpandGameMode:this.onExpandGameMode,isExpandGameMode:G,onChangeDescription:this.handleChangeDescription})),i===2&&e().createElement(dt,(0,T.Z)({},J,{isPreview:o,isEdit:y,cancelCreate:this.cancelCreate,toEdit:this.toEdit,saveNext:this.saveNext,lotteryStatus:F})),i===3&&e().createElement(yt,(0,T.Z)({},J,{isPreview:o,toPreview:this.toPreview,toEdit:this.toEdit,cancelCreate:this.cancelCreate,lotteryId:t,isEdit:y,lotteryStatus:F})))})))))))}}var _t=(0,j.$j)(Ct)((0,z.Z)()(Pt))},96924:function(Ee,q,n){"use strict";n.d(q,{$z:function(){return te},ok:function(){return Q},m1:function(){return Z},$Z:function(){return X},Ir:function(){return ne},Vv:function(){return u}});var W=n(88986),H=n(3407),T=n(6793),I=(0,T.me)(),b=H.Z[I].lottery,de="https://gsdn.coolcollege.cn/coolcollege-vue-h5/lottery-games/gray/images/default_entity.png",ee="https://gsdn.coolcollege.cn/coolcollege-vue-h5/lottery-games/gray/images/default_points.png",se="https://gsdn.coolcollege.cn/coolcollege-vue-h5/lottery-games/gray/images/thanks.png",te={id:null,title:b.thanks,cover:se,type:"3",prize_order:9,winning_probability:"0",prizes_number:"0",integral_number:"0"},Q={goodsTitle:"",goodsNumberEntity:"1",goodsNumberIntegral:"1",goodsOrder:"",goodsRate:"1",goodsCoverEntity:[{uid:"123",url:de,name:"",status:"done"}],goodsCoverPoints:[{uid:"123",url:ee,name:"",status:"done"}],goodsType:"1"},Z=e=>{switch(e.toString()){case"1":return b.entity;case"2":return b.points;case"3":return b.nonPrize;default:return e}},X=e=>{switch(e){case"turnTable":return b.turnTable;case"blindBox":return b.blindBox;case"scratchCard":return b.scratchCard;case"gashapon":return b.gashapon;default:return""}},ne=e=>{switch(e.toString()){case"rate":return b.rateMode;case"quantity":return b.quantityMode;default:return""}},u=e=>{var j=0;return e.forEach(h=>{j+=Number(h.winning_probability)}),j<100?(0,W.Z)((0,W.Z)({},te),{},{winning_probability:100-j}):null}},21063:function(Ee,q,n){"use strict";var W=n(62029),H=n(63185),T=n(9676),I=n(57663),b=n(71577),de=n(49111),ee=n(19650),se=n(22385),te=n(31097),Q=n(88983),Z=n(47933),X=n(88986),ne=n(12924),u=n.n(ne),e=n(91768),j=n(28216),h=n(96486),me=n.n(h),z=n(80991),ae=n(68628),le=n(49101),he=n(57119),fe=n(43859),R=n(37055),ve=n(10237),ce=n(84874),Ce=n(88311),V=n(8908),U=n(60667),A=n(26885),k=$=>{var P=$.advancedSetting,S=$.user;return{user:S,themeColor:P.themeColor}},M=()=>{};class B extends u().Component{constructor(P){var S;super(P);S=this,this.getUserManageRange=()=>{var d=R.ZP.Role.getUserManageRange();ve.WY.get({url:d}).then(function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=c.data,v=p===void 0?{}:p,E=v.range_type;S.setState({userManageType:E})})},this.handleChange=d=>{var c=d.target.value;this.setState({rangeType:c}),this.triggerChange({rangeType:c,rangeList:this.state.rangeList})},this.triggerChange=d=>{var c=d.rangeType,p=d.rangeList,v=this.props,E=v.isPkGroupSetting,C=v.onPkGroupOk;if(E){C({rangeType:c,rangeList:p});return}var N=this.props.from,f={rangeType:c,rangeList:p},L=localStorage.getItem("authorityType"),K=this.props.user.loginMode;N!=="employees"&&K==="WE_COM"&&L==="1"&&(f.qyWeChatVo=this.state.qyWeChatVo),N!=="employees"&&K==="WE_COM"&&L==="0"&&(f.qyWeChatVo=JSON.stringify({userList:p.user,departmentList:p.dept})),this.props.formik.setFieldValue("employeeRange",f)},this.handleOk=d=>{this.setRangeList(d)},this.setRangeList=d=>{var c=d.dept,p=d.group,v=d.post,E=d.user,C={dept:c,post:v,group:p,user:E};this.setState({rangeList:C,visible:!1}),this.triggerChange({rangeType:this.state.rangeType,rangeList:C})},this.importModalVisibility=function(d){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:M;S.setState({importVisible:d,rangeType:2},()=>{c()})},this.handleImportOk=d=>{var c=this.state.rangeList,p=c.user,v=p===void 0?[]:p,E=[...d,...v],C=(0,h.uniqBy)(E,"id");this.setState({rangeList:(0,X.Z)((0,X.Z)({},c),{},{user:C})},()=>{this.triggerChange({rangeType:this.state.rangeType,rangeList:this.state.rangeList}),this.importModalVisibility(!1)})},this.handleImportCancel=()=>{this.importModalVisibility(!1)},this.handleCancel=()=>{this.setOrgModalVisibility(!1)},this.handleDeleteItem=d=>{var c=(0,X.Z)({},this.state.rangeList),p,v;for(var E in c)if(p=c[E].findIndex(N=>N.id===d),p>-1){v=E;break}var C=[...c[v]];C.splice(p,1),c[v]=C,this.setState({rangeList:c}),this.triggerChange({rangeType:this.state.rangeType,rangeList:c})},this.handleSelectWx=()=>{var d=this.props.user,c=this.state.rangeList.user.map(p=>p.unionid||p.user_id||p.userId);(0,A.Sk)({userIds:c}).then(p=>{(0,A.$f)({result:p,user:d}).then(v=>{var E=v.qyWeChatVo,C=v.rangeList;this.setState({qyWeChatVo:E},()=>{this.handleOk(C)})})}).catch(()=>{this.handleCancel()})},this.setOrgModalVisibility=function(d){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:M,p=localStorage.getItem("authorityType"),v=S.props.user.loginMode,E=S.props.from;E!=="employees"&&d&&S.props.qwTicketShow&&v==="WE_COM"&&p==="1"?(S.handleSelectWx(),S.setState({rangeType:2})):S.setState({visible:d,rangeType:2},()=>{c()})},this.renderRadioGroup=()=>{var d=this.props,c=d.prefixCls,p=d.t,v=d.showSectitle,E=d.secTitle,C=E===void 0?p("common.assignRange"):E,N=d.secTitleInfoTip,f=N===void 0?"":N;return v?u().createElement("div",{className:"".concat(c,"__radios")},u().createElement("div",{className:"cl-form__sectitle"},C,f&&u().createElement("span",{className:"cl-form__sectitle__infotip"},f),this.renderRadios())):this.renderRadios()},this.handleVisibleType=d=>{var c=this.state.rangeType,p=d.target.value;this.setState({visibleType:p,rangeType:p==="follow"?0:c||3},()=>{this.triggerChange({rangeType:p==="follow"?0:c||3,rangeList:this.state.rangeList})})},this.renderRadios=()=>{var d=this.props,c=d.mode,p=d.t,v=d.prefixCls,E=d.rangeAuth,C=d.disabledAdd,N=d.themeColor,f=d.onlyDept,L=d.rangeType,K=d.handleStudentList,_=d.isShowPkStudentList,ie=this.props.partLabel,O=ie===void 0?p("common.deptAndStu"):ie,Y=this.state,ye=Y.resourceViewRange,pe=Y.visibleType,Pe=Y.userManageType,w=!!(L&&L!==2);return C?null:u().createElement("div",{className:"visible-range-setting"},c.includes("follow")&&u().createElement(Z.ZP.Group,{name:"visibleType",value:pe,onChange:this.handleVisibleType},u().createElement(Z.ZP,{value:"follow"},p("course.followClassify")),u().createElement(Z.ZP,{value:"define"},p("course.customRange"))),(this.state.rangeType>0||c.length===1||!c.includes("follow"))&&u().createElement("div",{className:"custom-range-setting"},u().createElement(Z.ZP.Group,{name:"rangeGroup",value:this.state.rangeType,disabled:this.props.disabled,onChange:this.handleChange},c.includes("all")&&u().createElement(Z.ZP,{value:1,disabled:Pe!=="all"},p("common.allCompany"),E&&ye&&u().createElement(te.Z,{title:p("setting.selectPeopleTip")},u().createElement("span",null,u().createElement(ae.Z,null)))),c.includes("under")&&u().createElement(Z.ZP,{value:4},u().createElement(ee.Z,null,p("setting.jurisdictionAndSubordinate"),u().createElement(te.Z,{title:p("setting.underTip")},u().createElement("span",null,u().createElement(ae.Z,null))))),c.includes("private")&&u().createElement(Z.ZP,{value:3},p("common.onlySelf")),c.includes("part")&&c.length>1&&u().createElement(Z.ZP,{value:2},O),u().createElement(ee.Z,null,!f&&u().createElement(b.Z,{className:"qa-assign-employee-selector",style:w?{}:{color:N,border:"1px solid ".concat(N)},icon:u().createElement(le.Z,null),disabled:w,onClick:()=>this.importModalVisibility(!0)},p("component.importPerson")),u().createElement(b.Z,{style:w?{}:{color:N,border:"1px solid ".concat(N)},className:"".concat(v,"__addbtn qa-assign-employee-selector"),icon:u().createElement(le.Z,null),disabled:w,onClick:()=>this.setOrgModalVisibility(!0)},p("common.select")),_?u().createElement(b.Z,{style:w?{}:{color:N,border:"1px solid ".concat(N)},onClick:K,disabled:w},p("pk.viewStudents")):""))))},this.renderGallery=()=>{var d=this.props.prefixCls,c=this.state.rangeType;return c!==2?null:u().createElement("div",{className:"".concat(d,"__gallery")},this.renderGropuGallery(),this.renderUserGallery())},this.renderGropuGallery=()=>{var d=this.props,c=d.prefixCls,p=d.t,v=this.state.rangeList,E=v.dept,C=v.group,N=v.post,f=[...E,...C,...N];return f.length?u().createElement("div",{className:"".concat(c,"__gallery__row cl-clearfix")},u().createElement("span",{className:"".concat(c,"__gallery__row__title")},p("common.selectedGroups"),"\uFF1A"),u().createElement("div",{className:"".concat(c,"__gallery__row__container cl-clearfix")},f.map(L=>this.renderGalleryItem(L,"dept")))):null},this.renderUserGallery=()=>{var d=this.props,c=d.prefixCls,p=d.t,v=this.state.rangeList.user,E=[...v];return E.length?u().createElement("div",{className:"".concat(c,"__gallery__row cl-clearfix")},u().createElement("span",{className:"".concat(c,"__gallery__row__title")},p("common.selectedUsers"),"\uFF1A"),u().createElement("div",{className:"".concat(c,"__gallery__row__container cl-clearfix")},E.map(C=>this.renderGalleryItem(C,"user")))):null},this.renderGalleryItem=(d,c)=>{var p=this.props,v=p.prefixCls,E=p.disabled,C=p.qwTicketShow,N=p.from,f="".concat(v,"__gallery__row__item"),L=this.props.user.loginMode,K=localStorage.getItem("authorityType"),_=N!=="employees"&&C&&K==="1"?d.unionid||d.userId||d.user_id||d.id:d.unionid||d.user_id,ie=d.source_type||d.sourceType,O={user:"userName",dept:"departmentName"}[c]||"",Y={user:_,dept:d.id}[c]||d.id;return u().createElement("span",{className:f,key:d.id},u().createElement(U.Z,{dataType:O,value:Y,name:d.name,type:ie}),E||N!=="employees"&&K==="1"&&C&&L==="WE_COM"?null:u().createElement("span",{className:"item-icon",onClick:()=>this.handleDeleteItem(d.id)},u().createElement(ce.Z,{iconClass:"icon-guanbi",size:"12px"})))},this.state={rangeType:P.defaultFieldList.rangeType,rangeList:P.defaultFieldList.rangeList||{},visible:!1,visibleType:P.defaultFieldList.rangeType===0?"follow":"define",userManageType:"all",importVisible:!1,qyWeChatVo:""}}componentDidMount(){this.getUserManageRange()}renderTransfer(){var P=E=>{this.props.formik.setFieldValue("open_transfer_student",E.target.checked)},S=this.props,d=S.prefixCls,c=S.t,p=S.formik.values.open_transfer_student,v=p===void 0?!1:p;return u().createElement("div",{className:"".concat(d,"__transfer")},u().createElement(T.Z,{onChange:P,checked:v},c("course.transferJoin")),u().createElement(te.Z,{title:c("course.transferJoin")},u().createElement(he.Z,null)))}render(){var P=this.props,S=P.prefixCls,d=P.orgProps,c=P.onlyDept,p=c===void 0?!1:c,v=P.onlyPost,E=v===void 0?!1:v,C=P.onlyChooseDept,N=C===void 0?!1:C,f=P.t,L=P.isAssignRange,K=P.noBorder,_=P.transferVisible,ie=_===void 0?!1:_,O=this.state,Y=O.rangeList,ye=O.visible,pe=O.importVisible;return u().createElement("div",{className:K?"":"visible-range-out"},K?null:u().createElement("div",{className:"visible-range-out-title"},f(L?"common.assignRange":"learning.learnUpgrade.visibleRange")),u().createElement("div",{className:"visible-range-out-inner".concat(K?"-no":"")},u().createElement("section",{className:"".concat(S)},this.renderRadioGroup(),this.renderGallery(),u().createElement(Ce.Z,(0,W.Z)({},d,{visible:ye,initData:Y,displayType:N?["dept"]:p&&E?["dept","post"]:["dept","group","post"],onlyDept:p,onlyPost:E,onOk:this.handleOk,onCancel:this.handleCancel})),u().createElement(V.Z,{visible:pe,onOk:this.handleImportOk,onCancel:this.handleImportCancel})),ie&&u().createElement("section",{className:"".concat(S)},this.renderTransfer())))}}B.defaultProps={prefixCls:"cl-employee-selector",showSectitle:!0,mode:["all","part"],orgProps:{},resourceViewRange:!1},q.Z=(0,j.$j)(k)((0,z.$j)((0,fe.Z)((0,e.Z)()(B))))}}]);
