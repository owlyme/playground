(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[3696],{11449:function(ve,A,e){"use strict";e.d(A,{Z:function(){return n}});var D=e(88986),R=e(33565),w=e(12924),u=e.n(w),B=e(3115),J=e(49111),s=e(19650),X=e(62029),Y=e(57663),y=e(71577),j=e(91768),K=e(28216),I=e(37055),W=e(10237);function N(v){var f=I.ZP.getHelpContentByMenuKey(),p={key:v};return W.WY.get({url:f,params:p})}var T=e(74228),t=e.n(T),ne=e(1164),re=e(76466),$=e(38642);class i extends u().Component{constructor(f){var p;super(f);p=this,this.getHelpContentByMenuKey=()=>{var c=this.props.defaultMenuKey;N(c).then(C=>{var P=C.data,M=P.help_url,S=P.video_url;this.setState({videoUrl:S,helpUrl:M})})},this.handleOpenHelpUrl=c=>{if((0,$.ve)()){window.open(c,"_blank");return}ne.Z.targetTo({path:c,isExternalLink:!0})},this.handleOpenVideo=function(c){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.props.t("helpCenter.video");p.setState(P=>({resourcePlayInfo:(0,D.Z)((0,D.Z)({},P.resourcePlayInfo),{},{resourceInfo:{originUrl:c,source:{FD:c,OD:c},contentType:"mp4"}}),previewInfo:(0,D.Z)((0,D.Z)({},P.previewInfo),{},{title:C,visible:!0,onCancel:p.handleCancelPreview})}))},this.handleCancelPreview=()=>{var c=this.state.previewInfo;this.setState({resourcePlayInfo:{mode:"preview",watchType:"video",resourceInfo:{}},previewInfo:(0,D.Z)((0,D.Z)({},c),{},{visible:!1})})},this.state={helpUrl:"",videoUrl:"",resourcePlayInfo:{autoPlay:!0,draggable:!0,mode:"preview",resourceInfo:{},watchType:"video"},previewInfo:{visible:!1,destroyOnClose:!0,title:f.t("helpCenter.video")||"\u89C6\u9891\u6307\u5BFC",onCancel:()=>{}}}}componentDidMount(){this.getHelpContentByMenuKey()}render(){var f=this.state,p=f.helpUrl,c=f.resourcePlayInfo,C=f.previewInfo,P=f.videoUrl,M=this.props.t;return u().createElement("div",{className:t().helpCenter},P&&u().createElement(y.Z,{type:"link",className:t()["video-btn"],style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenVideo(P)},M("helpCenter.video")),p&&u().createElement(y.Z,{type:"link",style:{borderWidth:"0px",padding:"0"},onClick:()=>this.handleOpenHelpUrl(p)},M("helpCenter.tutorial")),u().createElement(re.Z,(0,X.Z)({},c,{previewInfo:C})))}}var se=v=>({defaultMenuKey:v.currentRoute.menuKey});i.defaultProps={defaultMenuKey:""};var ie=(0,K.$j)(se)((0,j.Z)()(i));function le(v){var f=v.extra,p=localStorage.getItem("dingPersonnel"),c=sessionStorage.getItem("dingPersonnel");return u().createElement(s.Z,null,f,p!=="dingPersonnel"&&c!=="dingPersonnel"&&(0,$.eY)("COMMONEXTRA_HELP_CENTER")&&u().createElement(ie,null))}var oe=le,r=e(4408);function m(v){var f=(0,w.useState)({helpCenter:(0,$.eY)("HEAD_HELP_CENTER_BUT")}),p=(0,R.Z)(f,1),c=p[0],C=v.pageContainerParams,P=C===void 0?{}:C,M=v.noPadding,S=M===void 0?!1:M,G=v.isPersonal,k=G===void 0?!1:G,z=v.pageTitle,x=v.className,me=x===void 0?"":x,H={extra:c.helpCenter?u().createElement(oe,{extra:P.extra}):P.extra},a=(0,D.Z)((0,D.Z)({},P),H);return u().createElement("div",{className:"page-container-content ".concat(S?"page-container-noPadding":""," ").concat(k?"page-container-content_personal_background":""," ").concat(me)},z&&u().createElement(r.Z,{title:z}),k?u().createElement(B.Z,null,v.children):u().createElement(B.Z,a,v.children))}var n=m},35693:function(ve,A,e){"use strict";e.r(A);var D=e(12924),R=e.n(D),w=e(91768),u=e(28216),B=e(44690),J=e(36763),s=e.n(J),X=e(11449),Y=e(75205);function y(j){var K=j.t,I=(0,u.v9)(T=>{var t=T.user;return{user:t}}),W=I.user,N=(0,Y.AC)({user:{id:W.id,name:W.name,creator:!0}});return R().createElement(X.Z,{pageContainerParams:{header:{title:K("examination.newExam")}},pageTitle:K("examination.newExam")},R().createElement("div",{className:s()["add-page"]},R().createElement(B.Z,{initialValues:N,type:B.w.ADD})))}A.default=(0,w.Z)()(y)},44690:function(ve,A,e){"use strict";e.d(A,{w:function(){return x}});var D=e(20228),R=e(11382),w=e(57663),u=e(71577),B=e(22385),J=e(31097),s=e(62029),X=e(71194),Y=e(57016),y=e(88986),j=e(81211),K=e(57361),I=e(33565),W=e(9754),N=e.n(W),T=e(12924),t=e.n(T),ne=e(91768),re=e(57119),$=e(1870),i=e(80991),se=e(57068),ie=e(76651),le=e(17780),oe=e(37905),r=e.n(oe),m=e(64134),n=e(75205),v=e(62615),f=e(40572),p=e(2396),c=e(28531),C=e(16267),P=e(7584),M=e(70075),S=e(35085),G=e(38642),k=e(22444),z=e(48194),x={ADD:"add",EDIT:"edit"};function me(H){var a=H.t,pe=H.initialValues,F=H.type,q=(0,T.useRef)(),Re=(0,T.useState)(!1),ge=(0,I.Z)(Re,2),Ke=ge[0],b=ge[1],Ue=se.parse(ie.m8.location.search),V=Ue.planId,Be=(0,T.useState)({visible:!1,planId:V}),fe=(0,I.Z)(Be,2),We=fe[0],Ce=fe[1],Se=(0,T.useState)([]),Pe=(0,I.Z)(Se,2),ye=Pe[0],be=Pe[1];(0,T.useEffect)(()=>{we()},[]);var we=function(){var g=(0,K.Z)(N().mark(function d(){var o,_,L,h;return N().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,G.Kb)((0,z.q)());case 2:if(o=E.sent,_=(0,I.Z)(o,2),L=_[0],h=_[1],!L){E.next=8;break}return E.abrupt("return");case 8:h&&h.data&&h.data.sync_organizes&&be(h.data.sync_organizes||[]);case 9:case"end":return E.stop()}},d)}));return function(){return g.apply(this,arguments)}}(),je=function(){var g=(0,K.Z)(N().mark(function d(o){var _,L,h,ee,E,Q,Te,he,_e,ce,Z,de,U,Me,xe,ue,Ie,Ee,Ne,te,Le,Ze,Ae;return N().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(_=o.paperInfo,L=o.exam_times,h=o.cut_screen_times,ee=o.random_order,E=o.mark_setting,Q=o.result_visible,Te=o.exam_certificate,he=o.supervisor_list,_e=o.tagGroup,ce=o.status,Z=o.reward_rule,de=o.jurisdiction,U=o.face_recognition,Me=o.answer_device,xe=(0,j.Z)(o,["paperInfo","exam_times","cut_screen_times","random_order","mark_setting","result_visible","exam_certificate","supervisor_list","tagGroup","status","reward_rule","jurisdiction","face_recognition","answer_device"]),ue=(0,y.Z)({paper_id:_.id,answer_rule:L.answer_rule,exam_count:L.exam_count||1,cut_screen_rule:h.cut_screen_rule,cut_screen_count:h.cut_screen_count||1,cut_screen_interval:h.cut_screen_interval||0,random_question:ee.random_question,random_options:ee.random_options,mark_type:E.mark_type,mark_question_type:{fill_blank:E.mark_type===n.lt.MANUAL?E.fill_blank:!1,short_answer:E.mark_type===n.lt.MANUAL?E.short_answer:!1},anonymous_marking:E.anonymous_marking,exam_certificate_id:Te.id,face_recognition:U.before_exam,face_snapshot_rule:{face_process_switch:U.in_exam.checked,face_process_type:U.in_exam.type,face_process_value:U.in_exam.type===k.tT.FREQUENCY?U.in_exam.random_times:U.in_exam.custom_interval_time},supervisor_list:[...he.map(O=>typeof O=="string"?O:O.id)],marker_list:E.mark_type===n.lt.SYSTEM?E.marker_list.filter(O=>{var ae=O.creator;return ae==="true"||ae===!0}).map(O=>{var ae=O.id;return ae}):[...E.marker_list.map(O=>typeof O=="string"?O:O.id)],result_view_rule:Q.result_view_rule,answer_parsing:Q.answer_parsing,ranking_list_view_rule:Q.ranking_list_view_rule,show_result:Q.show_result,status:ce,reward_rule:{type:Z.type,absence:Z.type===n.iN.NO_CREDIT?{checked:!0,score:0}:Z.absence,passed:Z.type===n.iN.NO_CREDIT?{checked:!0,score:0}:Z.passed,failed:Z.type===n.iN.NO_CREDIT?{checked:!0,score:0}:Z.failed},authority_range:de.authority_range,supervisor_mark:de.supervisor_mark,answer_device:Me||n.Tv.UNLIMITED},xe),F!==x.ADD){l.next=23;break}return b(!0),l.prev=4,l.next=7,S.MC(ue);case 7:if(Ie=l.sent,Ee=Ie.data,Ne=Ee.code,te=Ee.data,Ne!=="200000"){l.next=18;break}return Oe({status:ce,planId:te.id,title:te.title}),l.prev=12,l.next=15,(0,c.tB)({tags:_e.tagsNameList||[],resourceId:te.id,resourceType:"examTask"});case 15:return l.prev=15,b(!1),l.finish(15);case 18:return l.prev=18,b(!1),l.finish(18);case 21:l.next=42;break;case 23:if(F!==x.EDIT){l.next=42;break}return b(!0),l.prev=25,l.next=28,S.WK({data:ue,planId:V});case 28:if(Le=l.sent,Ze=Le.data,Ae=Ze.code,Ae!=="200000"){l.next=39;break}return Oe({status:"published",planId:V,title:pe.title}),l.prev=33,l.next=36,(0,c.tB)({tags:_e.tagsNameList||[],resourceId:V,resourceType:"examTask"});case 36:return l.prev=36,b(!1),l.finish(36);case 39:return l.prev=39,b(!1),l.finish(39);case 42:case"end":return l.stop()}},d,null,[[4,,18,21],[12,,15,18],[25,,39,42],[33,,36,39]])}));return function(o){return g.apply(this,arguments)}}(),De=g=>{q.current.runValidations().then(d=>{if(Object.keys(d).length)q.current.submitForm();else{var o=q.current.getFormikBag(),_=o.values;je((0,y.Z)((0,y.Z)({},_),{},{status:g}))}})},Oe=g=>{var d=g.status,o=g.planId,_=g.title;d==="published"?Ce(L=>(0,y.Z)((0,y.Z)({},L),{},{planId:o,repeatTaskTitle:_,visible:!0})):(0,n.F_)()},$e=()=>{Y.Z.confirm({title:"",icon:t().createElement(re.Z,null),content:a("examination.confirmCancel"),okText:a("common.ok"),cancelText:a("common.cancel"),onOk:()=>{(0,n.F_)()}})};return t().createElement("div",{className:r()["exam-form-container"]},t().createElement(R.Z,{spinning:Ke},t().createElement(i.J9,{ref:q,initialValues:pe,render:g=>{var d=g.values,o=g.setFieldValue;return t().createElement(i.l0,null,t().createElement("div",{className:r()["form-content"]},t().createElement("div",{className:"".concat(r()["important-info"])},t().createElement("div",{className:r()["exam-info"]},t().createElement(C.N,{title:a("examination.examInfo")}),t().createElement("div",{className:"".concat(r()["exam-info-content"]," ").concat(r()["section-content"])},t().createElement("div",{className:"".concat(r()["exam-content-container"])},t().createElement(i.gN,(0,s.Z)({component:m.wK,withBlankAndShortAnswer:!0,setFieldValue:o,displayType:"Custom",name:"paperInfo",from:"addPaper",placeholder:a("examination.selectPlaceholder"),label:a("examination.referencePapers"),validate:_=>(0,p.QK)(_.id,"".concat(a("examination.validatePaper"))),has_published:d.has_published,required:!0},n.mJ)),t().createElement(i.gN,(0,s.Z)({component:P.Z,valueSlice:!0,name:"title",label:a("examination.examTaskName"),validate:_=>(0,p.QK)(_,"".concat(a("examination.validateTaskName"))),required:!0,type:"text",LimitLength:60,showCount:!0,char:!0,placeholder:a("examination.inputPlaceholder")},n.mJ)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m._e,name:"exam_duration",label:a("examination.answerLength"),required:!0,validate:_=>m.XQ.validateExamDuration(_)},n.mJ)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.Fz,paperInfo:d.paperInfo,name:"pass_line",label:a("examination.passLine"),required:!0},n.mJ)),t().createElement(i.gN,(0,s.Z)({component:M.Z,name:"description",label:a("examination.examDesc"),type:"text",required:!1,LimitLength:200,char:!0,showCount:!0,rows:4,placeholder:a("examination.inputPlaceholder")},n.mJ)),t().createElement(i.gN,(0,s.Z)({name:"classify_id",label:a("examination.category"),displayType:"Custom",component:f.Z,classifyName:g.values.classify_name,value:g.values.classify_id},n.mJ)),t().createElement(i.gN,(0,s.Z)({name:"tagGroup",label:a("examination.detailTag"),displayType:"Custom",component:v.QS,defaultFieldList:{resourceType:"examTask",resourceId:V}},n.mJ)))))),t().createElement("div",{className:"".concat(r()["advance-info-container"])},t().createElement("div",{className:"".concat(r()["advance-info-content"])},t().createElement("h3",{className:r()["advance-title"]},a("examination.examAdvanceSetting")),t().createElement("div",{className:r()["advance-setting"]},t().createElement("div",{className:r()["setting-section"]},t().createElement(C.N,{title:a("examination.examSetting")}),t().createElement("div",{className:"".concat(r()["section-content"])},t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.QN,has_published:d.has_published,name:"exam_times",label:a("examination.exam_times")},n.wT)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.$O,has_published:d.has_published,name:"score_record_type",label:a("examination.score_record_type")},n.wT)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.Jv,name:"always_extract_paper",label:a("examination.always_extract_paper")},n.wT)),(0,n.Ks)({orgTypes:ye,type:"cutScreen"})?t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.U6,name:"cut_screen_times",label:a("examination.cut_screen_times")},n.wT)):null,t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.LH,name:"random_order",label:a("examination.random_order")},n.wT)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.kE,face_recognition:d.face_recognition,name:"answer_device",label:a("examination.answerDevice")},n.wT)),(0,n.Ks)({orgTypes:ye,type:"face"})&&!(0,le.xX)()?t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.Is,exam_duration:d.exam_duration,name:"face_recognition",label:a("examination.face_recognition"),validate:_=>m.XQ.validateFaceRecognition(_,d.exam_duration)},n.wT)):null,t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.Vu,name:"show_tag",label:a("examination.knowledgePoint")},n.wT)))),t().createElement("div",{className:r()["setting-section"]},t().createElement(C.N,{title:a("examination.displaySetting")}),t().createElement("div",{className:"".concat(r()["section-content"])},t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.xA,name:"result_visible",label:a("examination.testData")},n.wT)))),t().createElement("div",{className:r()["setting-section"]},t().createElement(C.N,{title:a("examination.bonusCreditSetting")}),t().createElement("div",{className:"".concat(r()["section-content"])},t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.EM,isEdit:F===x.EDIT,validate:_=>m.XQ.validateBonusCredit(_),name:"reward_rule",label:a("examination.toCredit")},n.wT)),t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.wo,name:"exam_certificate",label:a("examination.exam_certificate")},n.wT)))),t().createElement("div",{className:r()["setting-section"]},t().createElement(C.N,{title:a("examination.markingMethodSetting")}),t().createElement("div",{className:"".concat(r()["section-content"])},t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.g4,isEdit:F===x.EDIT,paperInfo:d.paperInfo,name:"mark_setting",label:a("examination.markingType"),validate:_=>m.XQ.validateMarkingMethod(_)},n.wT)))),t().createElement("div",{className:r()["setting-section"]},t().createElement(C.N,{title:a("examination.superviseSetting")},t().createElement("span",{className:r().tip},t().createElement(J.Z,{title:a("examination.supervisorExplain")},t().createElement($.Z,{style:{fontSize:"14px"}})))),t().createElement("div",{className:"".concat(r()["section-content"]," ").concat(r()["supervisor-section"])},t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.Or,name:"supervisor_list",label:a("examination.supervisor"),selectPersonOptions:{title:a("examination.addPeople")}},n.wT)),d.supervisor_list.length>1&&t().createElement(i.gN,(0,s.Z)({displayType:"Custom",component:m.hw,name:"jurisdiction",label:a("examination.supervisorAuth")},n.wT)))))))),t().createElement(v.I,null))}}),t().createElement("div",{className:r()["cl-form-fixed-footer"]},t().createElement("div",{className:r()["cl-form-fixed-footer__container"]},t().createElement(u.Z,{onClick:$e},a("common.cancel")),F===x.ADD&&t().createElement(u.Z,{onClick:()=>{De("draft")}},a("common.draft")),t().createElement(u.Z,{type:"primary",onClick:()=>{De("published")}},a("common.release"))))),t().createElement(m.NI,(0,s.Z)({},We,{onCancel:()=>{Ce(g=>(0,y.Z)((0,y.Z)({},g),{},{visible:!1}))}})))}A.Z=(0,ne.Z)()(me)}}]);
