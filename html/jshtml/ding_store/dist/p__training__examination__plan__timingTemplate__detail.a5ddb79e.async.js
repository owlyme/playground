(self.webpackChunkkuxueyuan_manage=self.webpackChunkkuxueyuan_manage||[]).push([[7510],{61170:function(He,ne,r){"use strict";r.r(ne),r.d(ne,{default:function(){return be}});var y=r(62029),Xe=r(20228),he=r(11382),qe=r(34792),re=r(48086),b=r(88986),le=r(12924),a=r.n(le),G=r(57068),oe=r(91768),u=r(80991),I=r(76651),et=r(57663),ue=r(71577),tt=r(71194),fe=r(57016),ge=r(57119),H=r(52670),L=r(62615),de=r(86726),ve=r(7584),ke=r(70075),ye=r(2396),E=r(16381),g=r(59434),_={labelCol:{xs:{span:24},sm:{span:3}},wrapperCol:{xs:{span:24},sm:{span:21}}};class Ce extends a().Component{constructor(){super(...arguments);this.handlePropsSubmit=()=>{var t=this.props,s=t.handleSubmit,e=t.t,o=t.values,i=o===void 0?{}:o,c=i.markType,l=c===void 0?{}:c,v=l.checkedValue,d=v===void 0?1:v;d&&d===1?fe.Z.confirm({icon:a().createElement(ge.Z,{style:{color:"#516AE6"}}),title:e("common.tip"),content:e("learning.isModalReplyUploadWaringContent"),okText:e("common.ok"),cancelText:e("common.cancel"),onOk:()=>{s()}}):s()},this.renderQuestionsContent=()=>{var t=this.props.values,s=t.questionsMode===1;return s?this.renderFixedModeContent():this.renderRandomModeContent()},this.renderFixedModeContent=()=>{var t=this.props,s=t.values,e=t.disabled,o=t.t;return a().createElement(u.gN,(0,y.Z)({component:g.xE,displayType:"Custom",name:"fixedQuestion",label:o("exam.paper"),required:!0,defaultFieldList:s.fixedQuestion,validate:i=>(0,E.dy)(i,s),disabled:e},_))},this.renderRandomModeContent=()=>{var t=this.props,s=t.values,e=t.disabled,o=t.t;return a().createElement(u.gN,(0,y.Z)({component:g.B$,displayType:"Custom",name:"randomQuestion",customError:!0,label:o("exam.bank"),multipleMissedScore:this.props.multipleMissedScore,required:!0,defaultFieldList:s.randomQuestion,validate:i=>(0,E.cT)(i,s),disabled:e},_))},this.renderFooter=()=>{var t=this.props,s=t.disabled,e=s===void 0?!1:s,o=t.isSubmitting,i=o===void 0?!1:o,c=t.onCancel,l=t.t,v=t.isEdit;return a().createElement("footer",{className:"cl-form-fixed-footer"},a().createElement("div",{className:"cl-form-fixed-footer__container"},e?null:a().createElement(ue.Z,{type:"primary",disabled:i,loading:i,onClick:this.handlePropsSubmit},l(v?"common.save":"common.release")),a().createElement(ue.Z,{onClick:c},l("common.cancel"))))},this.renderDrawQuestions=()=>{var t=this.props,s=t.values,e=t.t,o=t.disabled,i=s.randomQuestion.bankQuesitonVoList&&s.randomQuestion.bankQuesitonVoList.length>0,c=s.questionsMode!==1;if(c&&i){var l=this.getAllQuestionsNumber(s.randomQuestion.bankQuesitonInfo);return a().createElement(u.gN,(0,y.Z)({component:g.p7,displayType:"Custom",name:"DrawQuestionsSwitch",label:e("exam.weightedQuestions"),defaultValue:s.isOpenDrawQuestions,questionsNumber:l,disabled:o},_))}return null},this.renderWeightInput=()=>{var t=this.props,s=t.values,e=t.disabled,o=s.questionsMode!==1;return s.isOpenDrawQuestions&&o&&s.randomQuestion.bankQuesitonVoList.length>0?a().createElement(u.gN,(0,y.Z)({component:g.CZ,displayType:"Custom",name:"proportional",required:!0,defaultFieldList:s.proportional,validate:E.RE,disabled:e},_)):null},this.getAllQuestionsNumber=t=>{var s=t.fillBlankCount,e=t.multipleCount,o=t.shortAnswerCount,i=t.singleCount,c=t.trueOrFalseCount;return s+e+o+i+c}}render(){var t=this.props,s=t.values,e=t.disabled,o=t.title,i=t.t,c=(0,de.V9)("classify",JSON.parse(localStorage.getItem("modules")));return a().createElement(a().Fragment,null,a().createElement(u.l0,{className:"cl-form"},this.renderFooter(),a().createElement("h1",{className:"cl-form-htitle"},o),a().createElement("p",{className:"cl-form__sectitle"},i("exam.selectPaper")),a().createElement(u.gN,(0,y.Z)({component:g.G2,displayType:"Custom",name:"questionsMode",label:i("exam.paperMode"),required:!0,defaultFieldList:s.questionsMode,disabled:e},_)),this.renderQuestionsContent(),this.renderDrawQuestions(),this.renderWeightInput(),a().createElement(u.gN,(0,y.Z)({component:g.Fz,displayType:"Custom",name:"passLine",label:i("exam.passLine"),required:!0,defaultFieldList:s.passLine,validate:E.QL,disabled:e},_)),a().createElement("p",{className:"cl-form__divide"}),a().createElement("p",{className:"cl-form__sectitle"},i("exam.basicInformation")),a().createElement(u.gN,(0,y.Z)({component:ve.Z,name:"title",label:i("exam.taskName"),required:!0,type:"text",style:{width:"350px"},className:"qa-mission-name-field",placeholder:i("exam.taskNamePlaceholder"),defaultValue:s.title,validate:l=>(0,ye.QK)(l,i("exam.taskNamePlaceholder")),isPreview:e,maxLength:60},_)),a().createElement(u.gN,(0,y.Z)({component:L.en,displayType:"Custom",name:"term",label:i("exam.validityPeriod"),required:!0,defaultFieldList:s.term,validate:H.EU,disabled:e},_)),a().createElement(u.gN,(0,y.Z)({component:g.Xk,displayType:"Custom",name:"examDuration",label:i("exam.examinationTime"),required:!0,defaultFieldList:s.examDuration,validate:E.$1,disabled:e},_)),a().createElement(u.gN,(0,y.Z)({name:"classify",label:i("learning.learningProjectAddCategory"),displayType:"Custom",defaultValue:s.classify,classifyName:s.classifyName,component:L.O,unclassified:!0,showAdd:(0,de.H3)("add",c)},_)),a().createElement(u.gN,(0,y.Z)({component:ke.Z,name:"summary",label:i("examing.examDesc"),type:"text",required:!1,defaultValue:s.summary,rows:4,maxLength:150,placeholder:i("exam.examInstructionPlaceholder"),disabled:e},_)),a().createElement("p",{className:"cl-form__divide"}),a().createElement(u.gN,{component:L.ww,displayType:"Custom",name:"employeeRange",mode:["part"],defaultFieldList:s.employeeRange,validate:H.FI,disabled:e}),a().createElement("p",{className:"cl-form__divide"}),a().createElement(u.gN,{component:L.q6,displayType:"Custom",name:"timer",defaultFieldList:s.timer,validate:H.oN,disabled:e,scopeType:"exam"}),a().createElement("p",{className:"cl-form__divide"}),a().createElement("p",{className:"cl-form__sectitle"},i("exam.settings")),a().createElement(u.gN,{component:g.wu,displayType:"Custom",name:"cheatFlag",defaultFieldList:s.cheatFlag,disabled:e,faceKnowDisabled:e}),a().createElement(u.gN,{component:g.Sm,displayType:"Custom",name:"reExam",defaultFieldList:s.reExam,disabled:e}),a().createElement(u.gN,{component:g.ZU,anonymousMarking:this.props.anonymousMarking,displayType:"Custom",name:"markType",validate:E._F,defaultFieldList:s.markType,papers:s.questionsMode===1?s.fixedQuestion.tableList:s.randomQuestion.bankQuesitonInfo,disabled:e}),a().createElement(u.gN,{component:g.Vu,displayType:"Custom",name:"knowledgePoints",defaultFieldList:s.knowledgePoints,disabled:e}),a().createElement(u.gN,{component:g.Qp,displayType:"Custom",name:"reward",defaultFieldList:s.reward,validate:E.JJ,disabled:e,customError:!0}),a().createElement(u.gN,{component:L.i0,displayType:"Custom",name:"supervisor",defaultFieldList:s.supervisor,disabled:e,createUserId:s.createUserId}),a().createElement(L.I,null)))}}var _e=(0,oe.Z)()(Ce),X=r(10237),B=r(37055),N=r(6793),xe=r(4408),O={getScoreRule:B.ZP.TimingTemplateDetail.getScoreRule,getPlanInfo:B.ZP.TimingTemplateDetail.getPlanInfo,add:B.ZP.TimingTemplateDetail.add,edit:B.ZP.TimingTemplateDetail.edit};class me extends le.Component{constructor(){super(...arguments);this.state={initialParams:{title:"",examDuration:"",employeeRange:{rangeType:"",rangeList:{dept:[],post:[],group:[],user:[]}},createUserId:"",cheatFlag:{isChecked:!1,switchNum:null,faceRecognition:"off"},reExam:{show_result:!0,isChecked:!0,notAllowed:{end:2},allowed:{reRule:0,record:0,end:5,reNum:1,viewRule:1}},markType:{checkedValue:1,artificialDisabled:!0,fillBlank:{checked:!0,disabled:!1},shortAnswer:{checked:!0,disabled:!1}},reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:0},flunk:{isChecked:!1,score:0},miss:{isChecked:!1,score:0}},questionsMode:1,knowledgePoints:1,passLine:"",fixedQuestion:{id:"",name:"",tableList:{fillBlankCount:0,fillBlankScore:0,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,singleCount:0,singleScore:0,totalCount:0,totalScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},randomQuestion:{bankQuesitonVoList:[],bankQuesitonInfo:{fillBlankCount:0,fillBlankScore:0,fillBlankType:1,multipleCount:0,multipleScore:0,shortAnswerCount:0,shortAnswerScore:0,shortAnswerType:1,singleCount:0,singleScore:0,trueOrFalseCount:0,trueOrFalseScore:0}},supervisor:{supervisorUserList:[],isChecked:!0,visibleAuthScope:!0,authScopeIsChecked:!1},term:{number:0,type:"D"},timer:{shouldRendered:!1,type:2,interval:0,times:0,startTime:Date.parse(new Date)},scheduleId:"",summary:"",isOpenDrawQuestions:!1,proportional:[],classify:"",classifyName:""},isLoading:!0},this.getScoreRule=()=>{X.WY.get({url:O.getScoreRule()}).then(t=>{this.setState(s=>({initialParams:(0,b.Z)((0,b.Z)({},s.initialParams),{},{reward:{certificate:{isChecked:!1,id:"",name:""},pass:{isChecked:!1,score:t.data.data.examScore[0].passScore},flunk:{isChecked:!1,score:t.data.data.examScore[0].unPassScore},miss:{isChecked:!1,score:t.data.data.examScore[0].missScore}}}),isLoading:!1}))})},this.getDetail=t=>{X.WY.get({url:O.getPlanInfo({templateId:t})}).then(s=>{var e=s.data,o=e.title,i=e.exam_duration,c=e.create_user,l=e.is_all_in,v=e.department_list,d=e.post_list,T=e.group_list,M=e.user_list,x=e.cheat_flag,Q=e.face_recognition,h=e.cut_screen_count,k=e.mark_type,Z=e.anonymous_marking,w=e.s_repeat_exam,P=e.answer_parsing,U=e.re_exam_rule,q=e.re_exam_number,ee=e.score_rule,te=e.view_rule,A=e.exam_certificate_id,R=e.exam_certificate_name,m=e.get_score_info,C=m===void 0?{}:m,j=e.question_mode,W=e.show_knowledge,J=e.pass_line,se=e.supervisor_id,ae=e.supervisor_user_name,f=e.supervisor_paper,Y=e.authority_range,$=e.bank_quesiton_list,F=e.fill_blank_count,Se=e.fill_blank_unit_score,Te=e.fill_blank_type,z=e.short_answer_count,Ee=e.short_answer_unit_score,Qe=e.short_answer_type,Le=e.single_count,Fe=e.single_unit_score,Ie=e.true_or_false_count,Ne=e.true_or_false_unit_score,Me=e.multiple_count,Ze=e.multiple_missed_score,Ae=e.multiple_unit_score,ce=e.paper_vo,p=ce===void 0?{}:ce,Re=e.term_type,$e=e.plan_term,D=e.scheduler_json,De=e.schedule_id,Ve=e.summary,V=e.proportionalExamVos,Be=e.classify_id,Oe=e.classify_name,Pe=e.show_result,Ue=se.split(","),je=ae.split(","),We=Ue.map((S,ie)=>({id:S,name:je[ie]})),n=j===1,K=[];$ instanceof Array&&$.length&&$.forEach(S=>{var ie=S.fill_blank_count,Je=S.multiple_count,Ye=S.short_answer_count,ze=S.single_count,Ke=S.total_count,Ge=S.true_or_false_count,pe={fillBlankCount:ie,shortAnswerCount:Ye,multipleCount:Je,singleCount:ze,totalCount:Ke,trueOrFalseCount:Ge};K.push((0,b.Z)((0,b.Z)((0,b.Z)({},S),pe),{},{data:(0,b.Z)({},pe)}))}),this.setState({initialParams:{title:o,examDuration:i,createUserId:c,employeeRange:{rangeType:l===!0?1:2,rangeList:{dept:l===!0?[]:v||[],post:l===!0?[]:d||[],group:l===!0?[]:T||[],user:l===!0?[]:M||[]}},cheatFlag:{isChecked:!!x,switchNum:h===-1?null:h,faceRecognition:Q},reExam:{show_result:Pe,isChecked:w==="true",notAllowed:{end:w==="true"?2:P},allowed:{reRule:U,record:ee,end:w==="true"?P:5,reNum:U===2?q:1,viewRule:te}},markType:{checkedValue:k===1?1:2,anonymousMarking:Z===!0||Z==="true",artificialDisabled:n?!(p.fill_blank_count||p.short_answer_count):!(F||z),fillBlank:{checked:n?(k===2||k===3)&&p.fill_blank_count:(k===2||k===3)&&F,disabled:n?!p.fill_blank_count:!F},shortAnswer:{checked:n?(k===2||k===4)&&p.short_answer_count:(k===2||k===4)&&z,disabled:n?!p.short_answer_count:!z}},reward:{certificate:{isChecked:A!=="0",id:A==="0"?"":A,name:R},pass:{isChecked:!!parseInt(C.pass_score,10),score:parseInt(C.pass_score||0,10)},flunk:{isChecked:!!parseInt(C.un_pass_score,10),score:parseInt(C.un_pass_score||0,10)},miss:{isChecked:!!parseInt(C.miss_score,10),score:parseInt(C.miss_score||0,10)}},questionsMode:j,knowledgePoints:W==="show"?1:2,passLine:J,fixedQuestion:{id:n?p.id:"",name:n?p.title:"",tableList:{fillBlankCount:n&&p.fill_blank_count||0,fillBlankScore:n&&p.fill_blank_score||0,multipleCount:n&&p.multiple_count||0,multipleScore:n&&p.multiple_score||0,shortAnswerCount:n&&p.short_answer_count||0,shortAnswerScore:n&&p.short_answer_score||0,singleCount:n&&p.single_count||0,singleScore:n&&p.single_score||0,totalCount:n&&p.total_count||0,totalScore:n&&p.total_score||0,trueOrFalseCount:n&&p.true_or_false_count||0,trueOrFalseScore:n&&p.true_or_false_score||0}},randomQuestion:{bankQuesitonVoList:n?[]:K,bankQuesitonInfo:{fillBlankCount:n?0:F||0,fillBlankScore:n?0:Se||0,fillBlankType:n?1:+Te||1,multipleCount:n?0:Me||0,multipleScore:n?0:Ae||0,multipleMissedScore:n?0:Ze||0,shortAnswerCount:n?0:z||0,shortAnswerScore:n?0:Ee||0,shortAnswerType:n?1:+Qe||1,singleCount:n?0:Le||0,singleScore:n?0:Fe||0,trueOrFalseCount:n?0:Ie||0,trueOrFalseScore:n?0:Ne}},supervisor:{supervisorUserList:We,isChecked:f===!0,visibleAuthScope:!0,authScopeIsChecked:Y==="true"},term:{number:$e,type:Re},timer:{shouldRendered:!0,type:D.type==="once"?1:2,interval:D.interval,times:D.remain_times,startTime:D.next_time?(0,N.jZ)(D.next_time):""},scheduleId:De,summary:Ve||"",isOpenDrawQuestions:V&&V.length>0,proportional:V&&(V.length>0?this.computedProportional(V,K):n?[]:this.computedQuesiton(K))||[],classify:Be,classifyName:Oe}},()=>{this.setState({isLoading:!1})})})},this.computedQuesiton=t=>t.map(s=>({name:s.name,id:s.id,proportion:0,disabled:s.data.totalCount===0})),this.computedProportional=(t,s)=>s.map((e,o)=>(0,b.Z)((0,b.Z)({},t[o]),{},{disabled:e.data.totalCount===0})),this.handleSubmit=(t,s)=>{var e=t.title,o=t.examDuration,i=t.employeeRange,c=t.cheatFlag,l=t.reExam,v=t.markType,d=t.reward,T=t.questionsMode,M=t.knowledgePoints,x=t.passLine,Q=t.fixedQuestion,h=t.randomQuestion,k=t.supervisor,Z=t.term,w=t.timer,P=t.scheduleId,U=t.summary,q=t.isOpenDrawQuestions,ee=t.proportional,te=t.classify,A=G.parse(I.m8.location.search),R=A.id,m=T===1,C=0,j=v.checkedValue,W=v.fillBlank,J=v.shortAnswer,se=v.anonymousMarking;j===2?W.checked&&!J.checked?C=3:!W.checked&&J.checked?C=4:C=2:C=1;var ae={question_mode:T,show_knowledge:M===1?"show":"hide",pass_line:x,total_score:m?Q.tableList.totalScore:"",single_count:m?"":h.bankQuesitonInfo.singleCount,single_unit_score:m?"":h.bankQuesitonInfo.singleScore,multiple_count:m?"":h.bankQuesitonInfo.multipleCount,multiple_unit_score:m?"":h.bankQuesitonInfo.multipleScore,multiple_missed_score:m?"":h.bankQuesitonInfo.multipleMissedScore,true_or_false_count:m?"":h.bankQuesitonInfo.trueOrFalseCount,true_or_false_unit_score:m?"":h.bankQuesitonInfo.trueOrFalseScore,fill_blank_count:m?"":h.bankQuesitonInfo.fillBlankCount,fill_blank_unit_score:m?"":h.bankQuesitonInfo.fillBlankScore,fill_blank_type:m?1:h.bankQuesitonInfo.fillBlankType,short_answer_count:m?"":h.bankQuesitonInfo.shortAnswerCount,short_answer_unit_score:m?"":h.bankQuesitonInfo.shortAnswerScore,short_answer_type:m?1:h.bankQuesitonInfo.shortAnswerType,paper_ids:m?Q.id:"",question_bank_list:m?"":h.bankQuesitonVoList.map(f=>f.id).join(","),answer_parsing:l.isChecked?l.allowed.end:l.notAllowed.end,title:(0,N.fy)(e),is_all_in:i.rangeType===1,group_ids:i.rangeList.group.map(f=>f.id).join(","),user_ids:i.rangeList.user.map(f=>f.id).join(","),department_ids:i.rangeList.dept.map(f=>f.id).join(","),postIds:i.rangeList.post.map(f=>f.id).join(","),post_ids:i.rangeList.post.map(f=>f.id).join(","),exam_duration:o,cheat_flag:c.isChecked?1:0,face_recognition:c.faceRecognition,s_repeat_exam:l.isChecked,mark_type:C,anonymousMarking:"".concat(se),exam_certificate_id:d.certificate.isChecked?d.certificate.id:0,passing_score:m?(0,N.Yz)(Q.tableList.totalScore*x/100):x,cut_screen_count:c.switchNum!==null?c.switchNum:-1,re_exam_rule:l.allowed.reRule,re_exam_number:l.allowed.reRule===2?l.allowed.reNum:0,score_rule:l.allowed.record,view_rule:l.allowed.viewRule,get_score_info:d.pass.isChecked||d.miss.isChecked||d.flunk.isChecked?{missScore:d.miss.isChecked?d.miss.score:0,passScore:d.pass.isChecked?d.pass.score:0,unPassScore:d.flunk.isChecked?d.flunk.score:0}:{},get_score:d.pass.isChecked||d.miss.isChecked||d.flunk.isChecked,supervisor_paper_str:k.isChecked.toString(),supervisor_id:k.supervisorUserList.map(f=>f.id).join(","),authority_range:k.authScopeIsChecked,status:"on",term_type:Z.type,plan_term:Z.number,scheduler_json:{interval:w.interval,next_time:(0,N.p6)(w.startTime),start_time:(0,N.p6)(w.startTime),times:w.times,type:w.type===1?"once":"period",scheduler_id:P},summary:U,proportional:!m&&q?ee:[],classify_id:te||999,show_result:(0,g.hi)(l)};X.WY.post({url:R?O.edit({templateId:R}):O.add(),data:(0,b.Z)({},ae)}).then(()=>{re.default.success(R?this.props.t("common.saveSuccess"):this.props.t("common.releaseSuccess")),setTimeout(()=>{s.setSubmitting(!1),I.m8.push("/training/examination/examTemplate")},1e3)}).catch(f=>{var Y=f.response.data,$=Y.code,F=Y.message;$==="enterpriseapi.542003"||(re.default.error(F),s.setSubmitting(!1))})},this.handleCancel=()=>{I.m8.push("/training/examination/examTemplate")}}componentDidMount(){var t=G.parse(I.m8.location.search),s=t.id;s?this.getDetail(s):this.getScoreRule()}render(){var t=this.props,s=t.prefixCls,e=t.preview,o=e===void 0?!1:e,i=t.t,c=this.state,l=c.initialParams,v=c.isLoading;if(v)return a().createElement(he.Z,{size:"large"});var d=G.parse(I.m8.location.search),T=d.id,M="".concat(i(o?"common.preview":T?"common.edit":"common.add")).concat(i("exam.examTemplateTaskTitle")),x="";return o?x=i("documentTitle.viewTimedExam"):T?x=i("documentTitle.editTimedExam"):x=i("documentTitle.addTimedExam"),a().createElement("div",{className:s},a().createElement(xe.Z,{title:x}),a().createElement("div",{className:"".concat(s,"__content")},a().createElement(u.J9,{initialValues:l,onSubmit:this.handleSubmit,render:Q=>a().createElement(_e,(0,y.Z)({},Q,{multipleMissedScore:!0,anonymousMarking:!0,disabled:o,title:M,isEdit:!!T,onCancel:this.handleCancel}))})))}}me.defaultProps={prefixCls:"timing-template-add"};var be=(0,oe.Z)()(me)}}]);
